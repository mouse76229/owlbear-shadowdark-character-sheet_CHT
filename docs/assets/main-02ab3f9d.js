import{n as K,s as rr,r as Ye,a as ke,i as ur,g as Ge,S as Ce,b as Ae,e as p,c as v,t as G,d as m,f as w,h as f,l as D,j as te,k as T,m as Te,o as Oe,p as Fe,q as kn,u as cr,v as fr,w as Cn,x as An,y as En,z as P,A as W,B as dr,C as We,D as je,E as ne,F as le,G as Ke,H as se,I as He,J as Re,K as pr,L as de,M as Pe,N as _t,O as Ue,P as qe,Q as he,R as fn,T as Be,U as mr,V as mn,W as Ns,X as hr,Y as _r,Z as gr,_ as Xn,$ as Ai,a0 as br,a1 as Ds,a2 as Ls,a3 as yr,a4 as Ei,a5 as Ps,a6 as vr}from"./index-a8934042.js";const Zt=[];function wr(t,e){return{subscribe:st(t,e).subscribe}}function st(t,e=K){let n;const l=new Set;function s(u){if(ke(t,u)&&(t=u,n)){const r=!Zt.length;for(const c of l)c[1](),Zt.push(c,t);if(r){for(let c=0;c<Zt.length;c+=2)Zt[c][0](Zt[c+1]);Zt.length=0}}}function o(u){s(u(t))}function a(u,r=K){const c=[u,r];return l.add(c),l.size===1&&(n=e(s)||K),u(t),()=>{l.delete(c),l.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:a}}function Tr(t,e,n){const l=!Array.isArray(t),s=l?[t]:t,o=e.length<2;return wr(n,a=>{let u=!1;const r=[];let c=0,i=K;const d=()=>{if(c)return;i();const y=e(l?r[0]:r,a);o?a(y):i=ur(y)?y:K},h=s.map((y,_)=>rr(y,b=>{r[_]=b,c&=~(1<<_),u&&d()},()=>{c|=1<<_}));return u=!0,d(),function(){Ye(h),i(),u=!1}})}const zl=[{name:"Plate mail",type:"Armor",cost:{gp:130,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:3},ac:{base:15,modifier:0},playerBonuses:[{type:"generic",name:"Disadv stealth",desc:"Disadvantage on stealth rolls",l10n:{name:"隱匿劣勢",desc:"隱匿檢定具有劣勢"}},{type:"generic",name:"Cannot swim",desc:"You cannot swim while wearing this armor",l10n:{name:"無法游泳",desc:"穿著此盔甲時無法游泳"}}],l10n:{name:"板甲"}},{name:"Mithral Plate Mail",type:"Armor",cost:{gp:520,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:2},ac:{base:15,modifier:0},l10n:{name:"秘銀板甲"}},{name:"Chainmail",type:"Armor",cost:{gp:60,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:2},ac:{base:13,modifier:0,stat:"DEX"},playerBonuses:[{type:"generic",name:"Disadv stealth",desc:"Disadvantage on stealth rolls",l10n:{name:"隱匿劣勢",desc:"隱匿檢定具有劣勢"}},{type:"generic",name:"Disadv swimming",desc:"Disadvantage on swimming rolls",l10n:{name:"游泳劣勢",desc:"游泳檢定具有劣勢"}}],l10n:{name:"鎖子甲"}},{name:"Mithral Chainmail",type:"Armor",cost:{gp:240,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},ac:{base:13,modifier:0,stat:"DEX"},l10n:{name:"秘銀鎖子甲"}},{name:"Leather Armor",type:"Armor",cost:{gp:10,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},ac:{base:11,modifier:0,stat:"DEX"},l10n:{name:"皮甲"}},{name:"Shield",type:"Armor",cost:{gp:10,sp:0,cp:0},properties:["OneHanded"],canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},ac:{base:0,modifier:2},l10n:{name:"盾牌"}}],Vl={};for(const t of zl)Vl[t.name.toLowerCase()]=t;const kr=[{name:"Pole",cost:{gp:0,sp:5,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"長竿"}},{name:"Rope, 60'",cost:{gp:1,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"繩索 (60呎)"}},{name:"Oil, Flask",cost:{gp:0,sp:5,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"油 (瓶)"}},{name:"Light Spell (Double Range)",cost:{gp:0,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:1},l10n:{name:"光亮術 (雙倍範圍)"}},{name:"Iron Spikes",cost:{gp:1,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:10,slotsUsed:1,freeCarry:0},l10n:{name:"鐵釘"}},{name:"Flint and Steel",cost:{gp:0,sp:5,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"打火石與火鐮"}},{name:"Mirror",cost:{gp:10,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"鏡子"}},{name:"Rations",cost:{gp:0,sp:5,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:3,slotsUsed:1,freeCarry:0},l10n:{name:"口糧"}},{name:"Crowbar",cost:{gp:0,sp:5,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"撬棍"}},{name:"Light Spell",cost:{gp:0,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:1},l10n:{name:"光亮術"}},{name:"Caltrops",cost:{gp:0,sp:5,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"鐵蒺藜"}},{name:"Flask",cost:{gp:0,sp:3,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"扁瓶"}},{name:"Arrows",cost:{gp:1,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:20,slotsUsed:1,freeCarry:0},l10n:{name:"箭矢"}},{name:"Bottle",cost:{gp:0,sp:3,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"瓶子"}},{name:"Grappling Hook",cost:{gp:1,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"爪鉤"}},{name:"Crossbow Bolts",cost:{gp:1,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:20,slotsUsed:1,freeCarry:0},l10n:{name:"十字弓矢"}},{name:"Lantern",cost:{gp:5,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"提燈"}},{name:"Thieves' Tools",cost:{gp:0,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:1},l10n:{name:"盜賊工具"}},{name:"Backpack",cost:{gp:2,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:1},l10n:{name:"背包"}},{name:"Light Spell (Double Time)",cost:{gp:0,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:1},l10n:{name:"光亮術 (雙倍時間)"}},{name:"Holy Symbol",cost:{gp:0,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:1},l10n:{name:"聖徽"}},{name:"Torch",cost:{gp:0,sp:5,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:1,freeCarry:0},l10n:{name:"火把"}},{name:"Thieving Tools",cost:{gp:0,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:0,freeCarry:1},l10n:{name:"盜賊工具"}},{name:"Holy Symbol",cost:{gp:0,sp:0,cp:0},canBeEquipped:!1,type:"Basic",slots:{perSlot:1,slotsUsed:0,freeCarry:1},l10n:{name:"聖徽"}}],jl={};for(const t of kr)jl[t.name.toLowerCase()]=t;const Jn=[{name:"Dominion",range:"Near",class:"Priest",tier:5,duration:{type:"Round",amt:10},desc:"Mighty beings come to your aid. The beings must have a combined total of 16 levels or less. Chaotic PCs summon demons/devils, and lawful or neutral PCs summon angels. The beings act of free will to aid you on your turn. After 10 rounds, they return to their realms. You cannot cast this spell again until you complete penance.",l10n:{name:"支配",desc:"強大的存在前來助你一臂之力。這些存在的等級總和必須在 16 等或以下。混沌陣營的角色召喚惡魔/魔鬼，守序或中立陣營的角色召喚天使。這些存在會依自由意志在你的回合協助你。10 輪後，祂們回歸原本的領域。在你完成贖罪之前無法再次施展此法術。"}},{name:"Charm Person",range:"Near",class:"Wizard",tier:1,desc:"You magically beguile one humanoid of LV 2 or less within near range, who regards you as a friend for the duration.The spell ends if you or your allies do anything harmful to the target.The target knows it was magically charmed after the spell ends.Roll 1d8 to determine amount of days effective",duration:{type:"Day",roll:{numDice:1,diceType:"d8"}},l10n:{name:"魅惑人類",desc:"你用魔法迷惑近距離內一名等級 2 以下的人形生物，持續時間內視你為朋友。若你或盟友傷害目標，法術立即結束。法術結束後目標會知道自己曾被魔法魅惑。擲 1d8 決定持續天數。"}},{name:"Fabricate",range:"Near",class:"Wizard",tier:3,duration:{type:"Round",amt:10},desc:"This spell can't target creatures. You turn a tree-sized collection of raw materials into a finished work. For example, you convert a pile of bricks or rocks into a bridge. The finished work converts back to raw materials when the spell ends.",l10n:{name:"鬼斧神工",desc:"此法術不能以生物為目標。你將一堆樹木大小的原料轉化為成品。例如，將一堆磚塊或岩石變成一座橋。法術結束時，成品會變回原料。"}},{name:"Fireball",range:"Far",class:"Wizard",tier:3,duration:{type:"Instant",amt:0},desc:"You hurl a small flame that erupts into a fiery blast. All creatures in a near-sized cube around where the flame lands take 4d6 damage.",l10n:{name:"火球術",desc:"你擲出一小團火焰，引發劇烈爆炸。火焰落點周圍近距離立方體內的所有生物受到 4d6 傷害。"}},{name:"Command",range:"Far",class:"Priest",tier:3,duration:{type:"Focus",amt:0},desc:"You issue a verbal command to one creature in range who can understand you. The command must be one word, such as “kneel.” The target obeys the command for as long as you focus. If your command is ever directly harmful to the creature, it may make a Charisma check vs. your last spellcasting check. On a success, the spell ends.",l10n:{name:"命令",desc:"你對範圍內一個能理解你的生物下達口頭命令。命令必須是一個詞，例如「跪下」。只要你維持專注，目標就會服從命令。若你的命令會直接傷害該生物，它可以進行魅力檢定對抗你最後的施法檢定。若成功，法術結束。"}},{name:"Commune",range:"Self",class:"Priest",tier:4,duration:{type:"Instant",amt:0},desc:`You seek your god's counsel. Ask the GM up to three yes or no questions. The GM truthfully answers "yes" or "no" to each. If you cast this spell more than once in 24 hours, treat a failed spellcasting check for it as a critical failure, instead.`,l10n:{name:"通神",desc:"你尋求神祇的建議。向 GM 詢問最多三個是非題。GM 會如實回答「是」或「否」。若你在 24 小時內施展此法術超過一次，失敗的施法檢定將視為大失敗。"}},{name:"Confusion",range:"Near",class:"Wizard",tier:4,duration:{type:"Focus",amt:0},desc:"You mesmerize one creature you can see in range. The target can't take actions, and it moves in a random direction on its turn. If the target is LV 9+, it may make a WIS check vs. your last spellcasting check at the start of its turn to end the spell.",l10n:{name:"困惑術",desc:"你催眠範圍內一個可見的生物。目標無法採取行動，並在回合中往隨機方向移動。若目標等級 9 以上，可在其回合開始時進行感知檢定對抗你最後的施法檢定以結束法術。"}},{name:"Control Water",range:"Far",class:"Wizard",tier:4,duration:{type:"Focus",amt:0},desc:"You move and shape water. You can cause a section of water up to 100 feet in width and depth to change shape, defy gravity, or flow in a different direction.",l10n:{name:"操控水體",desc:"你移動並塑造水流。你可以使寬度和深度達 100 呎的水域改變形狀、違抗重力或流向不同方向。"}},{name:"Create Undead",range:"Close",class:"Wizard",tier:5,duration:{type:"Day",subType:"InGame",amt:1},desc:"You conjure a vengeful undead creature to do your bidding. When you cast this spell, you choose to summon either a wight or wraith. It appears next to you and is under your control. The undead creature acts on your turn. After 1 day, it melts away into smoke.",l10n:{name:"喚起死靈",desc:"你召喚充滿復仇心態的亡靈為你效命。施展此法術時，選擇召喚屍妖或幽靈。它出現在你身旁受你控制。亡靈生物在你的回合行動。1 天後，它化為煙霧消散。"}},{name:"Disintegrate",range:"Far",class:"Wizard",tier:5,duration:{type:"Instant",amt:0},desc:"A green ray shoots from your finger and turns a creature or object into ash. A target creature of LV 5 or less instantly dies. If it is LV 6+, it takes 3d8 damage, instead. A non-magical object up to the size of a large tree is destroyed.",l10n:{name:"分解術",desc:"一道綠色射線從你手指射出，將生物或物體化為灰燼。等級 5 以下的目標生物立即死亡。若是等級 6 以上，則受到 3d8 傷害。最大如大樹般的非魔法物體會被摧毀。"}},{name:"Dimension Door",range:"Self",class:"Wizard",tier:4,duration:{type:"Instant",amt:0},desc:"You teleport yourself and up to one other willing creature to any point you can see.",l10n:{name:"次元門",desc:"將你和最多一名自願生物瞬間傳送到你可見的任何地點。"}},{name:"Divination",range:"Self",class:"Wizard",tier:4,duration:{type:"Instant",amt:0},desc:'You throw the divining bones or peer into the blackness between the stars, seeking a portent. You can ask the GM one yes or no question. The GM truthfully answers "yes" or "no." If you cast this spell more than once in 24 hours, treat a failed spellcasting check for it as a critical failure, instead.',l10n:{name:"預言",desc:"你擲出占卜骨或凝視星辰間的黑暗，尋求預兆。你可以問 GM 一個是非題。GM 會如實回答「是」或「否」。若你在 24 小時內施展此法術超過一次，失敗的施法檢定將視為大失敗。"}},{name:"Divine Vengeance",range:"Self",class:"Priest",tier:5,duration:{type:"Round",amt:10},desc:"You become the divine avatar of your god's wrath, wreathed in holy flames or a black aura of smoldering corruption. For the spell's duration, you can fly a near distance, your weapons are magical, and you have a +4 bonus to your weapon attacks and damage.",l10n:{name:"神聖復仇",desc:"你化身為神祇憤怒的化身，被聖火或腐敗黑氣環繞。在法術持續時間內，你可以飛行「近」距離，武器視為魔法武器，且武器攻擊和傷害獲得 +4 加值。"}},{name:"Fly",range:"Self",class:"Wizard",tier:3,duration:{type:"Round",amt:5},desc:"Your feet lift from the ground, and you take to the air like a hummingbird. You can fly near for the spell's duration and are able to hover in place.",l10n:{name:"飛行術",desc:"雙腳離地，像蜂鳥般飛向空中。法術持續期間你可以飛行「近」距離並能懸停。"}},{name:"Gaseous Form",range:"Self",tier:3,class:"Wizard",duration:{type:"Round",amt:10},desc:"You and your gear turn into a cloud of smoke for the spell's duration. You can fly and pass through any gap that smoke could. You can sense the terrain and any movement around you out to a near distance. You can't cast spells while in this form.",l10n:{name:"氣化形體",desc:"你和你的裝備化為一團煙霧。你可以飛行並穿過煙霧能通過的任何縫隙。你可以感知周圍「近」距離內的地形和動靜。此形態下無法施法。"}},{name:"Heal",range:"Close",tier:5,class:"Priest",duration:{type:"Instant",amt:0},desc:"One creature you touch is healed to full hit points. You cannot cast this spell again until you complete a rest.",l10n:{name:"治癒術",desc:"觸碰一名生物使其回復至滿生命值。在你完成休息前無法再次施展此法術。"}},{name:"Arcane Eye",range:"Near",class:"Wizard",tier:4,duration:{type:"Focus",amt:0},desc:"You conjure an invisible, grape- sized eye within range. You can see through the eye. It can see in the dark out to near range, fly near on your turn, and squeeze through openings as narrow as a keyhole.",l10n:{name:"秘法眼",desc:"你在範圍內召喚一顆隱形、葡萄大小的眼睛。你可以透過這顆眼睛觀看。它擁有「近」距離的黑暗視覺，能在你的回合飛行「近」距離，並能穿過鑰匙孔般狹窄的開口。"}},{name:"Cloudkill",range:"Far",class:"Wizard",tier:4,duration:{type:"Round",amt:5},desc:"A putrid cloud of yellow poison fills a near-sized cube within range. It spreads around corners. Creatures inside the cloud are blinded and take 2d6 damage at the beginning of their turns. A creature of LV 9 or less that ends its turn fully inside the cloud dies.",l10n:{name:"死雲術",desc:"一團腐臭的黃色毒雲充滿範圍內「近」距離大小的立方體空間。它會擴散繞過轉角。雲中的生物會目盲，並在回合開始時受到 2d6 傷害。等級 9 以下的生物若在回合結束時完全身處雲中則會死亡。"}},{name:"Feather Fall",range:"Self",class:"Wizard",tier:1,desc:"You may make an attempt to cast this spell when you fall.Your rate of descent slows so that you land safely on your feet.",duration:{type:"Instant",amt:0},l10n:{name:"羽落術",desc:"當你墜落時可嘗試施展此法術。你的下降速度減緩，使你安全著地。"}},{name:"Animate Dead",range:"Close",class:"Wizard",tier:3,desc:"You touch one humanoid’s remains, and it rises as a zombie or skeleton under your control. The remains must have at least three limbs and its head intact. The undead creature acts on your turn. After 1 day, the creature collapses into grave dust.",duration:{type:"Day",amt:1},l10n:{name:"活化死屍",desc:"你觸碰一具類人生物遺骸，將其喚起為受你控制的殭屍或骷髏。遺骸必須至少保有三肢與頭部。亡靈生物在你的回合行動。1 天後，該生物崩解為塵土。"}},{name:"Acid Arrow",range:"Far",class:"Wizard",tier:2,desc:"You conjure a corrosive bolt that hits one foe, dealing 1d6 damage a round. The bolt remains in the target for as long as you focus.",duration:{type:"Focus",amt:0},l10n:{name:"酸液箭",desc:"你召喚一支腐蝕箭擊中一名敵人，每輪造成 1d6 傷害。只要你維持專注，箭矢就會留在目標體內。"}},{name:"Antimagic Shell",range:"Self",class:"Wizard",tier:5,desc:"An invisible, near-sized cube of null-magic appears centered on you. Within the cube, no spells can be cast. Magic items and spells have no effect in the zone, and no magic can enter. The cube moves with you. Spells such as dispel magic have no effect on it. Another antimagic shell does not affect this one.",duration:{type:"Focus",amt:0},l10n:{name:"反魔場",desc:"以你為中心出現一個隱形、邊長為「近」距離的無魔方塊。在方塊內無法施法。魔法物品和法術在區域內無效，魔法也無法進入。方塊隨你移動。解除魔法等法術對其無效。另一個反魔場也不會影響此反魔場。"}},{name:"Dispel Magic",range:"Near",class:"Wizard",tier:3,duration:{type:"Instant",amt:0},desc:"End one spell that affects one target you can see in range.",l10n:{name:"解除魔法",desc:"結束範圍內你看見的一個目標身上的一個法術效果。"}},{name:"Silence",range:"Far",class:"Wizard",tier:2,desc:"You magically mute sound in a near cube within the spell’s range. Creatures inside the area are deafened, and any sounds they create cannot be heard.",duration:{type:"Focus",amt:0},l10n:{name:"沈默術",desc:"你消除範圍內「近」距離立方體空間的聲音。區域內的生物耳聾，且發出的任何聲音都無法被聽見。"}},{name:"Cleansing Weapon",range:"Close",class:"Priest",tier:2,desc:"One weapon you touch is wreathed in purifying flames. It deals an additional 1d4 damage (1d6 vs. undead) for the duration.",duration:{type:"Round",amt:5},l10n:{name:"淨化武器",desc:"你觸碰的武器被淨化火焰包覆。持續期間額外造成 1d4 傷害（對亡靈 1d6）。"}},{name:"Floating Disk",range:"Near",class:"Wizard",tier:1,desc:"You create a floating, circular disk of force with a concave center. It can carry up to 20 gear slots. It hovers at waist level and automatically stays within near of you. It can’t cross over drop- offs or pits taller than a human.",duration:{type:"Round",amt:10},l10n:{name:"浮碟術",desc:"你創造一個中間凹陷的圓形力場浮碟。它可承載多達 20 格物品。懸浮在腰部高度並自動保持在你「近」距離內。無法越過落差或高於人類的坑洞。"}},{name:"Misty Step",range:"Self",class:"Wizard",tier:2,desc:"In a puff of smoke, you teleport a near distance to an area you can see.",duration:{type:"Instant",amt:0},l10n:{name:"迷蹤步",desc:"原本的位置爆出一團煙霧，傳送「近」距離到你看得見的地方。"}},{name:"Augury",range:"Self",class:"Priest",tier:2,desc:"You interpret the meaning of supernatural portents and omens. Ask the GM one question about a specific course of action. The GM says whether the action will lead to “weal” or “woe.”",duration:{type:"Instant",amt:0},l10n:{name:"占卜",desc:"你解讀超自然預兆。針對特定行動問 GM 一個問題。GM 會告知該行動將導致「吉」或「凶」。"}},{name:"Mage Armor",range:"Self",class:"Wizard",tier:1,desc:"An invisible layer of magical force protects your vitals. Your armor class becomes 14 (18 on a critical spellcasting check) for the spell’s duration.",duration:{type:"Round",amt:10},l10n:{name:"法師護甲",desc:"一層隱形魔法力場保護你的要害。持續期間 AC 變為 14（施法大成功則為 18）。"}},{name:"Holy Weapon",range:"Close",class:"Priest",tier:1,desc:"One weapon you touch is imbued with a sacred blessing.The weapon becomes magical and has +1 to attack and damage rolls for the duration.",duration:{type:"Round",amt:5},l10n:{name:"神聖武器",desc:"你觸碰的武器灌注神聖祝福。持續期間武器視為魔法武器且攻擊和傷害檢定 +1。"}},{name:"Hold Person",range:"Near",class:"Wizard",tier:2,desc:"You magically paralyze one humanoid creature of LV 4 or less you can see within range.",duration:{type:"Focus",amt:0},l10n:{name:"定身術",desc:"你用魔法麻痺範圍內一名可見的 4 等以下類人生物。"}},{name:"Mirror Image",range:"Self",class:"Wizard",tier:2,desc:"You create a number of illusory duplicates of yourSelf equal to half your level rounded down (minimum 1). The duplicates surround you and mimic you.Each time a creature attacks you, the attack misses and causes one of the duplicates to evaporate.If all of the illusions have disappeared, the spell ends.",duration:{type:"Round",amt:5},l10n:{name:"鏡影術",desc:"你創造出數個虛幻分身，數量等你等級的一半（向下取整，至少 1 個）。分身環繞並模仿你。每當生物攻擊你時，該攻擊失誤並導致一個分身消散。若所有分身消失，法術結束。"}},{name:"Bless",range:"Close",class:"Priest",tier:2,desc:"One creature you touch gains a luck token.",duration:{type:"Instant",amt:0},l10n:{name:"祝福術",desc:"你觸碰的生物獲得一枚幸運代幣。"}},{name:"Burning Hands",range:"Close",class:"Wizard",tier:1,desc:"You spread your fingers with thumbs touching, unleashing a circle of flame that fills a close area around where you stand.Creatures within the area of effect take 1d6 damage.Unattended flammable objects ignite.",duration:{type:"Instant",amt:0},l10n:{name:"燃燒之手",desc:"你雙手拇指相觸張開手指，釋放一圈火焰填滿你身周「貼身」距離區域。區域內生物受到 1d6 傷害。無人持有的易燃物會著火。"}},{name:"Blind/Deafen",range:"Near",class:"Priest",tier:2,desc:"You utter a divine censure, blinding or deafening one creature you can see in range. The creature has disadvantage on tasks requiring the lost sense.",duration:{type:"Focus",amt:0},l10n:{name:"目盲/耳聾術",desc:"你發出神聖斥責，使範圍內一名可見生物目盲或耳聾。該生物在需要該感官的任務上具有劣勢。"}},{name:"Web",range:"Far",class:"Wizard",tier:2,desc:"You create a near-sized cube of sticky, dense spider web within the spell’s range. A creature stuck in the web can’t move and must succeed on a Strength check opposed by your spellcasting check to free itself.",duration:{type:"Round",amt:5},l10n:{name:"蛛網術",desc:"你在範圍內創造一個「近」距離大小的立方體黏稠蛛網。被困住的生物無法移動，必須通過力量檢定（對抗你的施法檢定）才能掙脫。"}},{name:"Light",range:"Close",class:"PriestWizard",tier:1,desc:"One object you touch glows with bright, heatless light, illuminating out to a near distance for 1 hour of real time.",duration:{type:"Hour",subType:"RealTime",amt:1},l10n:{name:"光亮術",desc:"你觸碰一個物體使其發出明亮冷光，照明範圍達「近」距離，持續 1 小時（現實時間）。"}},{name:"Cure Wounds",range:"Close",class:"Priest",tier:1,desc:"Your touch restores ebbing life.Roll a number of d6s equal to 1 + half your level (rounded down).One target you touch regains that many hit points.",duration:{type:"Instant",amt:0},l10n:{name:"治療輕傷",desc:"你的觸摸恢復生命。擲 d6，數量等同 1 + 等級的一半（向下取整）。你觸碰的目標回復該數值的生命值。"}},{name:"Invisibility",range:"Close",class:"Wizard",tier:2,desc:"A creature you touch becomes invisible for the spell’s duration.The spell ends if the target attacks or casts a spell.",duration:{type:"Round",amt:10},l10n:{name:"隱形術",desc:"你觸碰的生物變為隱形。若目標攻擊或施法，法術結束。"}},{name:"Detect Magic",range:"Near",class:"Wizard",tier:1,desc:"You can sense the presence of magic within near range for the spell's duration. If you focus for two rounds, you discern its general properties. Full barriers block this spell.",duration:{type:"Focus",amt:0},l10n:{name:"偵測魔法",desc:"持續期間你可以感知「近」距離內的魔法存在。若專注兩輪，可辨識其大致特性。完全的屏障可阻擋此法術。"}},{name:"Knock",range:"Near",class:"Wizard",tier:2,desc:"A door, window, gate, chest, or portal you can see within range instantly opens, defeating all mundane locks and barriers.This spell creates a loud knock audible to all within earshot.",duration:{type:"Instant",amt:0},l10n:{name:"敲擊術",desc:"範圍內你看見的門、窗、柵欄、箱子或傳送門瞬間打開，破解所有凡俗鎖具與障礙。此法術會發出響亮的敲擊聲，周圍皆可聽見。"}},{name:"Magic Missile",range:"Far",class:"Wizard",tier:1,desc:"You have advantage on your check to cast this spell.A glowing bolt of force streaks from your open hand, dealing 1d4 damage to one target.",duration:{type:"Instant",amt:0},l10n:{name:"魔法飛彈",desc:"此法術的施法檢定具有優勢。一道發光力場箭從你手中射出，對一個目標造成 1d4 傷害。"}},{name:"Detect Thoughts",range:"Near",class:"Wizard",tier:2,desc:"You peer into the mind of one creature you can see within the spell’s range.Each round, you learn the target’s immediate thoughts.On its turn, the target makes a Wisdom check opposed by your last spellcasting check. If the target succeeds, it notices your presence in its mind and the spell ends.",duration:{type:"Focus",amt:0},l10n:{name:"偵測思想",desc:"你窺視範圍內一個可見生物的心智。每輪你得知目標當下的想法。在它的回合，目標進行感知檢定對抗你最後的施法檢定。若成功，它察覺你進入其心智，法術結束。"}},{name:"Smite",range:"Near",class:"Priest",tier:2,desc:"You call down punishing flames on a creature you can see within range. It takes 1d6 damage.",duration:{type:"Instant",amt:0},l10n:{name:"懲擊",desc:"你召喚懲罰之火降臨在範圍內一個可見生物身上。造成 1d6 傷害。"}},{name:"Protection From Evil",range:"Close",class:"PriestWizard",tier:1,desc:"For the spell’s duration, chaotic beings have disadvantage on attack rolls and hostile spellcasting checks against the target. These beings also can’t possess, compel, or beguile it.When cast on an already-possessed target, the possessing entity makes a CHA check vs. the last spellcasting check. On a failure, the entity is expelled.",duration:{type:"Focus",amt:0},l10n:{name:"防護邪惡",desc:"持續期間，混沌生物對目標的攻擊檢定和敵對施法檢定具有劣勢。它們也無法附身、強迫或魅惑目標。若對已附身的目標施展，附身體需進行魅力檢定對抗施法檢定。若失敗則被驅逐。"}},{name:"Levitate",range:"Self",class:"Wizard",tier:2,desc:"You can float a near distance vertically per round on your turn.You can also push against solid objects to move horizontally.",duration:{type:"Focus",amt:0},l10n:{name:"漂浮術",desc:"你在自己回合可垂直漂浮「近」距離。你也可以推動固體物體來水平移動。"}},{name:"Alarm",range:"Close",class:"Wizard",tier:1,desc:"You touch one object, such as a door threshold, setting a magical alarm on it.If any creature you do not designate while casting the spell touches or crosses past the object, a magical bell sounds in your head.If any creature you do not designate while casting the spell touches or crosses past the object, a magical bell sounds in your head.",duration:{type:"Day",amt:1},l10n:{name:"警報術",desc:"你觸碰一個物體（如門檻）設下魔法警報。若未經你指定的生物觸碰或跨過該物體，魔法鈴聲會在你的腦海響起。"}},{name:"Shield of Faith",range:"Self",class:"Priest",tier:1,desc:"A protective force wrought of your holy conviction surrounds you. You gain a +2 bonus to your armor class for the duration.",duration:{type:"Round",amt:5},l10n:{name:"虔誠護盾",desc:"你的神聖信念化為防護力場環繞你。持續期間 AC +2。"}},{name:"Turn Undead",range:"Near",class:"Priest",tier:1,desc:"You rebuke undead creatures, forcing them to flee. You must present a holy symbol to cast this spell.Undead creatures within near of you must make a CHA check opposed by your spellcasting check. If a creature fails by 10+ points and is equal to or less than your level, it is destroyed. Otherwise, on a fail, it flees from you for 5 rounds.",duration:{type:"Instant",amt:0},l10n:{name:"驅散亡靈",desc:"你斥退亡靈使其逃跑。需出示聖徽。你周圍「近」距離內的亡靈進行魅力檢定對抗你的施法檢定。若失敗 10 點以上且等級不高於你，則被摧毀。否則失敗時逃跑 5 輪。"}},{name:"Sleep",range:"Near",class:"Wizard",tier:1,desc:"You weave a lulling spell that fills a near-sized cube extending from you. Living creatures in the area of effect fall into a deep sleep if they are LV 2 or less. Vigorous shaking or being injured wakes them.",duration:{type:"Instant",amt:0},l10n:{name:"睡眠術",desc:"你編織催眠魔法填滿從你延伸的「近」距離立方體。區域內等級 2 以下的活物陷入沉睡。劇烈搖晃或受傷會喚醒它們。"}},{name:"Flame Strike",range:"Far",tier:4,class:"Priest",duration:{type:"Instant",amt:0},desc:"You call down a holy pillar of fire, immolating one creature you can see within range. The target takes 2d6 damage.",l10n:{name:"焰擊術",desc:"你召喚神聖火柱，焚燒範圍內一名可見生物。目標受到 2d6 傷害。"}},{name:"Fixed Object",range:"Close",class:"Wizard",tier:2,desc:"An object you touch that weighs no more than 5 pounds becomes fixed in its current location. It can support up to 5,000 pounds of weight for the duration of the spell.",duration:{type:"Round",amt:5},l10n:{name:"定物術",desc:"你觸碰一個不超過 5 磅的物體，使其固定在當前位置。持續期間可承受 5000 磅重量。"}},{name:"Alter Self",range:"Self",class:"Wizard",tier:2,desc:"You magically change your physical form, gaining one feature that modifies your existing anatomy.For example, you can grow functional gills on your neck or bear claws on your fingers. This spell can’t grow wings or limbs.",duration:{type:"Round",amt:5},l10n:{name:"變顏術",desc:"你用魔法改變外形，獲得一個修改現有生理結構的特徵。例如：在頸部長出鰓或手指長出爪子。此法術不能長出翅膀或新的肢體。"}},{name:"Hold Portal",range:"Near",class:"Wizard",tier:1,desc:"You magically hold a portal closed for the duration. A creature must make a successful STR check vs. your spellcasting check to open the portal.The knock spell ends this spell.",duration:{type:"Round",amt:10},l10n:{name:"封門術",desc:"你用魔法將傳送門/門戶封閉。生物必須通過力量檢定（對抗你的施法檢定）才能打開。敲擊術可結束此法術。"}},{name:"Zone of Truth",range:"Near",class:"Priest",tier:2,desc:"You compel a creature you can see to speak truth. It can’t utter a deliberate lie while within range.",duration:{type:"Focus",amt:0},l10n:{name:"誠實之域",desc:"你強迫一名可見生物說實話。在範圍內它無法故意說謊。"}},{name:"Hold Monster",tier:5,class:"Wizard",duration:{type:"Focus",amt:0},range:"Near",desc:"You paralyze one creature you can see within range. If the target is LV 9+, it may make a STR check vs. your last spellcasting check at the start of its turn to end the spell.",l10n:{name:"怪物定身術",desc:"你麻痺範圍內一名可見生物。若目標等級 9 以上，可在其回合開始時進行力量檢定對抗你最後的施法檢定以結束法術。"}},{name:"Illusion",tier:3,class:"Wizard",duration:{type:"Focus",amt:0},range:"Far",desc:"You create a convincing visible and audible illusion that fills up to a near-sized cube in range. The illusion cannot cause harm, but creatures who believe the illusion is real react to it as though it were. A creature who inspects the illusion from afar must pass a Wisdom check vs. your last spellcasting check to perceive the false nature of the illusion. Touching the illusion also reveals its false nature.",l10n:{name:"幻術",desc:"你創造一個逼真的視聽幻象，填滿範圍內「近」距離大小的立方體。幻象無法造成傷害，但信以為真的生物會做出相應反應。從遠處檢查幻象的生物需通過感知檢定對抗你的施法檢定才能識破。觸碰幻象也會揭穿其假象。"}},{name:"Judgement",tier:5,class:"Priest",duration:{type:"Round",amt:5},range:"Close",desc:"You instantly banish a creature you touch, sending it and all possessions it carries to face the judgment of your god. You can banish an intelligent creature of LV 10 or less. When the creature returns in 5 rounds, it has been healed to full hit points if its deeds pleased your god. It has been reduced to 1 hit point if its deeds angered your god. If your god can't judge its actions, it is unchanged.",l10n:{name:"審判",desc:"你瞬間放逐觸碰的生物及其裝備，使其面對神祇的審判。可放逐 10 等以下的智慧生物。5 輪後回歸時，若其行為取悅神祇則滿血；若觸怒神祇則剩 1 點生命。若神祇無法審判則無變化。"}},{name:"Lay To Rest",tier:3,class:"Priest",duration:{type:"Instant",amt:0},range:"Close",desc:"You instantly send an undead creature you touch to its final afterlife, destroying it utterly. You can target an undead creature of LV 9 or less.",l10n:{name:"安息",desc:"瞬間將觸碰的亡靈送往來世，將其徹底摧毀。可針對 9 等以下的亡靈。"}},{name:"Lighting Bolt",tier:3,class:"Wizard",duration:{type:"Instant",amt:0},range:"Far",desc:"You shoot a blue-white ray of lightning from your hands, hitting all creatures in a straight line out to a far distance. Creatures struck by the lightning take 3d6 damage.",l10n:{name:"閃電束",desc:"你手掌射出一道藍白雷電，擊中直線「遠」距離內的所有生物。造成 3d6 傷害。"}},{name:"Magic Circle",tier:3,class:"Wizard",duration:{type:"Focus",amt:0},range:"Near",desc:"You conjure a circle of runes out to near-sized cube centered on yourself and name a type of creature (for example, demons). For the spell’s duration, creatures of the chosen type cannot attack or cast a hostile spell on anyone inside the circle. The chosen creatures also can’t possess, compel, or beguile anyone inside the circle.",l10n:{name:"魔法法陣",desc:"以你為中心召喚一圈符文覆蓋「近」距離立方體，並指定一種生物類別（如惡魔）。持續期間該類別生物無法攻擊或對圈內目標施展敵對法術，也無法附身、強迫或魅惑圈內任何人。"}},{name:"Mass Cure",tier:3,class:"Priest",duration:{type:"Instant",amt:0},range:"Near",desc:"All allies within near range of you regain 2d6 hit points.",l10n:{name:"群體治療",desc:"你周圍「近」距離內所有盟友回復 2d6 生命值。"}},{name:"Passwall",tier:4,class:"Wizard",duration:{type:"Round",amt:5},range:"Close",desc:"A tunnel of your height opens in a barrier you touch and lasts for the duration. The passage can be up to near distance in length and must be in a straight line.",l10n:{name:"穿牆術",desc:"在你觸碰的障礙物上開啟一個與你等高的隧道。長度可達「近」距離，必須是直線。"}},{name:"Pillar Of Salt",tier:4,class:"Priest",duration:{type:"Focus",amt:0},range:"Near",desc:"A creature you target turns into a statue made of hardened salt. You can target a creature you can see of LV 5 or less. If you successfully focus on this spell for 3 rounds in a row, the transformation becomes permanent.",l10n:{name:"鹽柱術",desc:"目標生物變成硬鹽雕像。可針對 5 等以下可見生物。若連續專注 3 輪，變形將永久化。"}},{name:"Plane Shift",tier:5,class:"PriestWizard",duration:{type:"Instant",amt:0},range:"Close",desc:"You fold space and time, transporting yourself and all willing creatures within close range to a location on another plane of your choice. Unless you have been to your intended location before, you appear in a random place on the destination plane.",l10n:{name:"異界傳送",desc:"摺疊時空，將自己和「貼身」距離內的自願生物傳送到你選擇的異界地點。若未曾去過該地，將出現在隨機地點。"}},{name:"Polymorph",tier:4,class:"Wizard",duration:{type:"Round",amt:10},range:"Close",desc:"You transform a creature you touch into another natural creature you choose of equal or smaller size. Any gear the target carries melds into its new form. The target gains the creature's physical statistics, but it retains its non-physical statistics. If the target goes to 0 hit points, it reverts to its true form at half its prior hit points. You can target any willing creature with this spell, or an unwilling creature whose level is less than or equal to half your level rounded down (minimum 1).",l10n:{name:"變形術",desc:"將觸碰的生物變形為你選擇的等體型或較小的自然生物。裝備融入新形態。目標獲得該生物的生理數值，但保留非生理數值。若生命值歸零則變回原形，生命值剩一半。可針對自願生物，或等級不高於你等級一半（至少 1）的非自願生物。"}},{name:"Power Word Kill",tier:5,class:"Wizard",duration:{type:"Instant",amt:0},range:"Near",desc:"You utter the Word of Doom. One creature you target of LV 9 or less dies if it hears you. Treat a failed spellcasting check for this spell as a critical failure, and roll the mishap with disadvantage.",l10n:{name:"律令：死",desc:"說出毀滅真言。目標 9 等以下生物若聽見則立即死亡。此法術施法失敗視為大失敗，且災難檢定具劣勢。"}},{name:"Prismatic Orb",tier:5,class:"Wizard",duration:{type:"Instant",amt:0},range:"Far",desc:"You send a strobing orb of energy streaking toward a target within range. Choose an energy type from fire, cold, or electricity. The orb deals 3d8 damage and delivers a concussive blast of the chosen energy type. If the energy type is anathema to the target's existence (for example, cold energy against a fire elemental), the orb deals double damage to it, instead.",l10n:{name:"虹光法球",desc:"射出一顆閃爍能量球攻擊目標。選擇火、冰或電屬性。造成 3d8 傷害及該屬性的衝擊波。若屬性剋制目標（如冰剋火元素），則造成雙倍傷害。"}},{name:"Prophecy",tier:5,class:"Priest",duration:{type:"Instant",amt:0},range:"Self",desc:"You commune directly with your god for guidance. Ask the GM one question. The GM answers the question truthfully using the knowledge your god possesses. Deities are mighty, but not omniscient. You cannot cast this spell again until you complete penance.",l10n:{name:"預言術",desc:"直接與神祇溝通尋求指引。問 GM 一個問題。GM 依神祇所知如實回答。神祇強大但非全知。贖罪前無法再施展。"}},{name:"Protection From Energy",tier:3,class:"Wizard",duration:{type:"Focus",amt:0},range:"Close",desc:"One creature you touch becomes impervious to the wild fury of the elements. Choose fire, cold, or electricity. For the spell's duration, the target is immune to harm from energy of the chosen type.",l10n:{name:"防護能量",desc:"觸碰的生物獲得對元素的免疫力。選擇火、冰或電。持續期間目標對該屬性傷害免疫。"}},{name:"Rebuke Unholy",tier:3,class:"Priest",duration:{type:"Instant",amt:0},range:"Near",desc:"You rebuke creatures who oppose your alignment, forcing them to flee. You must present a holy symbol to cast this spell. If you are lawful or neutral, this spell affects demons, devils, and outsiders. If you are chaotic, this spell affects angels and natural creatures of the wild. Affected creatures within near of you must make a CHA check vs. your spellcasting check. If a creature fails by 10+ points and is equal to or less than your level, it is destroyed. Otherwise, on a fail, it flees from you for 5 rounds.",l10n:{name:"斥責不潔",desc:"斥退與你陣營對立的生物。需出示聖徽。若你為守序/中立，影響惡魔/魔鬼/異界生物；若為混沌，影響天使/自然生物。周圍「近」距離目標進行魅力檢定對抗施法檢定。若失敗 10 點以上且等級不高於你則摧毀，否則逃跑 5 輪。"}},{name:"Regenerate",tier:4,class:"Priest",duration:{type:"Focus",amt:0},range:"Close",desc:"A creature you touch regains 1d4 hit points on your turn for the duration. This spell also regrows lost body parts.",l10n:{name:"再生術",desc:"持續期間，觸碰的生物每輪回復 1d4 生命。也會長回失去的肢體。"}},{name:"Resilient Sphere",tier:4,class:"Wizard",duration:{type:"Round",amt:5},range:"Close",desc:"You conjure a weightless, glassy sphere around you that extends out to close range. For the spell's duration, nothing can pass through or crush the sphere. You can roll the sphere a near distance on your turn.",l10n:{name:"彈力法球",desc:"在你周圍召喚一個延伸至「貼身」距離的無重力隱形球體。持續期間，無物能穿過或壓碎球體。你可在回合內滾動球體移動「近」距離。"}},{name:"Restoration",tier:3,class:"Priest",duration:{type:"Instant",amt:0},range:"Close",desc:"With the touch of your hands, you expunge curses and illnesses. One curse, illness, or affliction of your choice affecting the target creature ends.",l10n:{name:"復原術",desc:"觸摸消除詛咒與疾病。結束目標身上的一個詛咒、疾病或異常狀態。"}},{name:"Scrying",tier:5,class:"Wizard",duration:{type:"Focus",amt:0},range:"Self",desc:"You look into a crystal ball or reflecting pool, calling up images of a distant place. For the spell's duration, you can see and hear a creature or location you choose that is on the same plane. This spell is DC 18 to cast if you try to scry on a creature or location that is unfamiliar to you. Each round, creatures you view may make a Wisdom check vs. your last spellcasting check. On a success, they become aware of your magical observation.",l10n:{name:"探知",desc:"透過水晶球或水池觀看遠方。持續期間可視聽同一位面的選定生物或地點。若目標不熟悉，DC 為 18。每輪被觀察者可進行感知檢定對抗施法檢定，成功則察覺被窺視。"}},{name:"Sending",tier:3,class:"Wizard",duration:{type:"Instant",amt:0},range:"Far",desc:"Range Unlimited. You send a brief, mental message to any creature with whom you are familiar who is on the same plane.",l10n:{name:"短訊術",desc:"距離無限。傳送一則簡短心靈訊息給同一位面你熟悉的生物。"}},{name:"Shapechange",tier:5,class:"Wizard",duration:{type:"Focus",amt:0},range:"Self",desc:"You transform yourself and any gear you carry into another natural creature you've seen of level 10 or less. You assume the creature's physical statistics, but you retain your non-physical statistics (such as INT, WIS, and CHA). If you go to 0 HP while under the effects of this spell, you revert to your true form at 1 HP.",l10n:{name:"形體變化",desc:"你與裝備變形成你見過的 10 等以下自然生物。獲得其生理數值但保留心智數值（智/感/魅）。若生命歸零則變回原形並剩 1 點生命。"}},{name:"Speak With Dead",tier:3,class:"Wizard",duration:{type:"Instant",amt:0},range:"Close",desc:'A dead body you touch answers your questions in a distant, wheezing voice. You can ask the dead body up to three yes or no questions (one at a time). The GM truthfully answers "yes" or "no" to each. If you cast this spell more than once in 24 hours, treat a failed spellcasting check for it as a critical failure, instead.',l10n:{name:"死者交談",desc:"觸摸的屍體以嘶啞聲音回答問題。可問三個是非題。GM 如實回答。24 小時內施展超過一次，失敗視為大失敗。"}},{name:"Stoneskin",tier:4,class:"Wizard",duration:{type:"Round",amt:10},range:"Self",desc:"Your skin becomes like granite. For the spell's duration, your armor class becomes 17 (20 on a critical spellcasting check).",l10n:{name:"石膚術",desc:"皮膚變得像花崗岩。持續期間 AC 變為 17（施法大成功則為 20）。"}},{name:"Summon Extraplanar",tier:5,class:"Wizard",duration:{type:"Focus",amt:0},range:"Near",desc:"You reach into the outer planes, summoning forth a creature. You summon an elemental or outsider of LV 7 or less. The creature is under your control and acts on your turn. If you lose focus on this spell, you lose control of the creature and it becomes hostile toward you and your allies. You must pass a spellcasting check on your turn to return the creature to the outer planes.",l10n:{name:"異界盟誓",desc:"從外層位面召喚生物。召喚 7 等以下的元素或異界生物。受控於你並在你的回合行動。若失去專注則失控並敵視你。你必須通過施法檢定才能將其送回。"}},{name:"Telekinesis",tier:4,class:"Wizard",duration:{type:"Focus",amt:0},range:"Far",desc:"You lift a creature or object with your mind. Choose a target that weights 1,000 pounds or less. You can move it a near distance in any direction and hold it in place.",l10n:{name:"念力",desc:"用心靈在大於 1000 磅的物體或生物。可由任意方向移動「近」距離或將其固定。"}},{name:"Teleport",tier:5,class:"Wizard",duration:{type:"Instant",amt:0},range:"Close",desc:"You and any willing creatures you choose within close range teleport to a location you specify on your same plane. You can travel to a known teleportation sigil or to a location you've been before. Otherwise, you have a 50% chance of arriving off-target.",l10n:{name:"傳送術",desc:"你和「貼身」距離內的自願生物傳送到同一位面指定地點。可前往已知法陣或去過的地點。否則有 50% 機率傳錯位置。"}},{name:"Wall Of Force",tier:4,class:"Wizard",duration:{type:"Round",amt:5},range:"Near",desc:"You lift your hands, conjuring a transparent wall of force. The thin wall must be contiguous and can cover a near-sized area in width and length. You choose its shape. Nothing on the same plane can physically pass through the wall.",l10n:{name:"力場牆",desc:"召喚透明力場牆。牆體連續且覆蓋「近」距離長寬。形狀由你決定。同一位面亦無法物理穿過。"}},{name:"Wish",tier:5,class:"Wizard",duration:{type:"Instant",amt:5},range:"Self",desc:"This mighty spell alters reality. Make a single wish, stating it as exactly as possible. Your wish occurs, as interpreted by the GM. Treat a failed spellcasting check for this spell as a critical failure, and roll the mishap with disadvantage.",l10n:{name:"祈願術",desc:"改變現實的強大法術。許一個願望。願望會依 GM 解讀實現。施法失敗視為大失敗，且災難檢定具劣勢。"}},{name:"Wrath",tier:4,class:"Priest",duration:{type:"Round",amt:10},range:"Self",desc:"Your weapons become magical +2 and deal an additional d8 damage for the spell's duration.",l10n:{name:"神怒",desc:"持續期間，你的武器變為 +2 魔法武器，並額外造成 d8 傷害。"}}],Kl={};for(const t of Jn)Kl[t.name.toLowerCase()]=t;const Zn=[{name:"Bastard Sword",type:"Weapon",cost:{gp:10,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:2},properties:["Versatile"],range:"Close",weaponType:"Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1}},l10n:{name:"變種劍"}},{name:"Greataxe",type:"Weapon",cost:{gp:10,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:2},properties:["Versatile"],range:"Close",weaponType:"Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1}},l10n:{name:"巨斧"}},{name:"Staff",type:"Weapon",cost:{gp:0,sp:5,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},properties:["Versatile"],range:"Close",weaponType:"Melee",damage:{twoHanded:{diceType:"d4",numDice:1}},l10n:{name:"長棍"}},{name:"Javelin",type:"Weapon",cost:{gp:0,sp:5,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},properties:["Thrown"],range:["Close","Far"],weaponType:"MeleeRanged",damage:{oneHanded:{diceType:"d4",numDice:1}},l10n:{name:"標槍"}},{name:"Dagger",type:"Weapon",cost:{gp:0,sp:5,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},properties:["Finesse","Thrown"],range:["Close","Near"],weaponType:"MeleeRanged",damage:{oneHanded:{diceType:"d4",numDice:1}},l10n:{name:"匕首"}},{name:"Longbow",type:"Weapon",cost:{gp:8,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},range:["Far"],weaponType:"Ranged",damage:{twoHanded:{diceType:"d8",numDice:1}},l10n:{name:"長弓"}},{name:"Shortbow",type:"Weapon",cost:{gp:6,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},range:["Far"],weaponType:"Ranged",damage:{twoHanded:{diceType:"d4",numDice:1}},l10n:{name:"短弓"}},{name:"Club",type:"Weapon",cost:{gp:0,sp:0,cp:5},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},range:["Close"],weaponType:"Melee",damage:{oneHanded:{diceType:"d4",numDice:1}},l10n:{name:"棍棒"}},{name:"Greatsword",type:"Weapon",cost:{gp:12,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:2},range:["Close"],weaponType:"Melee",damage:{twoHanded:{diceType:"d12",numDice:1}},l10n:{name:"巨劍"}},{name:"Longsword",type:"Weapon",cost:{gp:9,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},range:["Close"],weaponType:"Melee",damage:{oneHanded:{diceType:"d8",numDice:1}},l10n:{name:"長劍"}},{name:"Shortsword",type:"Weapon",cost:{gp:7,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},range:["Close"],weaponType:"Melee",damage:{oneHanded:{diceType:"d6",numDice:1}},l10n:{name:"短劍"}},{name:"Spear",type:"Weapon",cost:{gp:0,sp:5,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},properties:["Thrown"],range:["Close","Near"],weaponType:"MeleeRanged",damage:{oneHanded:{diceType:"d6",numDice:1}},l10n:{name:"矛"}},{name:"Crossbow",type:"Weapon",cost:{gp:8,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},properties:["Loading"],range:["Far"],weaponType:"Ranged",damage:{twoHanded:{diceType:"d6",numDice:1}},l10n:{name:"十字弓"}},{name:"Mace",type:"Weapon",cost:{gp:5,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},range:["Close"],weaponType:"Melee",damage:{oneHanded:{diceType:"d6",numDice:1}},l10n:{name:"釘頭錘"}},{name:"Warhammer",type:"Weapon",cost:{gp:10,sp:0,cp:0},canBeEquipped:!0,slots:{freeCarry:0,perSlot:1,slotsUsed:1},range:["Close"],weaponType:"Melee",damage:{twoHanded:{diceType:"d10",numDice:1}},l10n:{name:"戰錘"}}],Xl={};for(const t of Zn)Xl[t.name.toLowerCase()]=t;let Jl=[],Si=[];function Cr(t){Jl=t.customGear??[],Si=t.customSpells??[]}function Bi(t){return Xl[t.toLowerCase()]??Br(t)}function Ar(t){return Vl[t.toLowerCase()]}function Er(t){return jl[t.toLowerCase()]}function Sr(t){return Si.find(e=>e.name.toLowerCase()===t.toLowerCase())}function Zl(t){return Kl[t.toLowerCase()]||Sr(t)}function Oi(t){return Jl.find(e=>e.name.toLowerCase()===t.toLowerCase())}function Br(t){return Jl.filter(e=>e.type==="Weapon").map(e=>e).find(e=>e.name.toLowerCase()===t.toLowerCase())}function Ve(t){return Bi(t)||Ar(t)||Er(t)||Oi(t)}const Or=["Shield","OneHanded","TwoHanded","Magic"],Ol=["Self","Close","Near","Far"],wt=["d4","d6","d8","d10","d12","d20"],Rr="1.0.0",Ri="sd-char-sheet",It=["STR","DEX","CON","INT","WIS","CHA"],Rl=["Neutral","Lawful","Chaotic"],Mr=["Finesse","Loading","Thrown","Versatile","Magic"],Hs=["Second","Minute","Round","Hour","Day","Week","Month","Year"],Ir=["gearSlots","stat","armorClass","backstabDice","hp"],Ml=["hpRoll","attackRoll","spellcastRoll","damageRoll","statRoll","initiativeRoll","talentRoll"],Gs=[...Ir,...Ml],an=["Fighter","Priest","Wizard","Thief","Ranger"],hn={Fighter:{Lawful:["Squire","Cavalier","Knight","Thane","Lord/Lady"],Chaotic:["Knave","Bandit","Slayer","Reaver","Warlord"],Neutral:["Warrior","Bararian","Battlerager","Warchief","Chieftain"]},Priest:{Lawful:["Acolyte","Crusader","Templar","Champion","Paladin"],Chaotic:["Initiate","Zealot","Cultist","Scourge","Chaos Knight"],Neutral:["Seeker","Invoker","Haruspex","Mystic","Oracle"]},Thief:{Lawful:["Footpad","Burglar","Rook","Underboss","Boss"],Chaotic:["Thug","Cutthroat","Shadow","Assassin","Wraith"],Neutral:["Robber","Outlaw","Rogue","Renegade","Bandit King/Queen"]},Wizard:{Lawful:["Apprentice","Conjurer","Arcanist","Mage","Archmage"],Chaotic:["Adept","Channeler","Witch/Warlock","Diabolist","Sorcerer"],Neutral:["Shaman","Seer","Warden","sage","Druid"]},Ranger:{Lawful:["Squire","Cavalier","Knight","Thane","Lord/Lady"],Chaotic:["Knave","Bandit","Slayer","Reaver","Warlord"],Neutral:["Warrior","Bararian","Battlerager","Warchief","Chieftain"]}},Il=["Elf","Human","Goblin","Halfling","Half-Orc","Dwarf"],Ws=["Common","Dwarvish","Elvish","Giant","Goblin","Merran","Orcish","Reptillian","Sylvan","Thanian","Celestial","Diabolic","Draconic","Primordial"],$r={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20};function Ql(t){const e=["Common"];switch(t.ancestry){case"Elf":e.push("Elvish","Sylvan");break;case"Human":break;case"Dwarf":{e.push("Dwarvish");break}case"Goblin":{e.push("Goblin");break}case"Halfling":break;case"Half-Orc":{e.push("Orcish");break}}for(const n of e)t.languages.includes(n)||t.languages.push(n)}function xl(t){Nr(t),Hr(t.bonuses,t.ancestry)}function al(t){Dr(t),!(!t.class||t.hasCustomClass)&&Gr(t.bonuses,t.class)}function il(t){Lr(t),!(!t.class||t.hasCustomClass)&&Pr(t.gear,t.class)}function Nr(t){t.bonuses=t.bonuses.filter(e=>!["Stout","Keen senses","Stealthy","Mighty Attack ancestry","Mighty Damage ancestry"].includes(e.name))}function Dr(t){t.bonuses=t.bonuses.filter(e=>!["Thievery","Backstab","Learning Spells","Hauler","Herbalism","Wayfinder"].includes(e.name)&&!e.name.includes("Thievery:"))}function Lr(t){t.gear=t.gear.filter(e=>!["Thieving Tools","Holy Symbol"].includes(e.name))}function Pr(t,e){e==="Thief"&&!t.find(n=>n.name==="Thieving Tools")?t.push({name:"Thieving Tools",quantity:1}):e==="Priest"&&!t.find(n=>n.name==="Holy Symbol")&&t.push({name:"Holy Symbol",quantity:1})}function Hr(t,e){switch(e){case"Elf":break;case"Human":break;case"Dwarf":{const n="Stout";t.find(l=>l.name===n)||t.push({name:n,bonusSource:"Ancestry",desc:"Roll your hit point gains with advantage",l10n:{name:"堅韌",desc:"擲生命值時有優勢"},type:"advantage",bonusTo:"hpRoll"});break}case"Goblin":{const n="Keen senses";t.find(l=>l.name===n)||t.push({name:n,bonusSource:"Ancestry",desc:"You can't be surprised",l10n:{name:"敏銳感官",desc:"你不會受驚"},type:"generic"});break}case"Halfling":{const n="Stealthy";t.find(l=>l.name===n)||t.push({name:n,bonusSource:"Ancestry",desc:"Once per day, you can become invisible for 3 rounds",l10n:{name:"隱匿",desc:"每天一次，你可以隱形 3 輪"},type:"generic"});break}case"Half-Orc":{const n="Mighty Attack ancestry",l="Mighty Damage ancestry";t.find(s=>s.name===n||s.name===l)||t.push({name:n,desc:"You have a +1 bonus to attack rolls with melee weapons",l10n:{name:"強壯攻擊",desc:"近戰武器攻擊檢定 +1"},bonusSource:"Ancestry",type:"modifyAmt",bonusTo:"attackRoll",bonusAmount:1,metadata:{type:"weaponType",weaponType:"Melee"}},{name:l,desc:"You have a +1 bonus to damage rolls with melee weapons",l10n:{name:"強壯傷害",desc:"近戰武器傷害 +1"},bonusSource:"Ancestry",type:"modifyAmt",bonusTo:"damageRoll",bonusAmount:1,metadata:{type:"weaponType",weaponType:"Melee"}});break}}}function Gr(t,e){switch(e){case"Thief":{let n="Thievery";t.find(l=>l.name===n)||t.push({name:n,bonusSource:"Class",desc:"Advantage on Climbing",l10n:{name:"竊盜術",desc:"攀爬檢定優勢"},type:"generic"},{name:n+": Sneaking/Hiding",bonusSource:"Class",desc:"Advantage on Sneaking/Hiding",l10n:{name:"竊盜術：潛行/躲藏",desc:"潛行與躲藏檢定優勢"},type:"generic"},{name:n+": disguises",bonusSource:"Class",desc:"Advantage on applying disguises",l10n:{name:"竊盜術：易容",desc:"易容檢定優勢"},type:"generic"},{name:n+": traps",bonusSource:"Class",desc:"Advantage on disabling traps",l10n:{name:"竊盜術：陷阱",desc:"解除陷阱檢定優勢"},type:"generic"},{name:n+": delicate",bonusSource:"Class",desc:"Advantage on picking pockets/opening locks",l10n:{name:"竊盜術：精細作業",desc:"扒竊與開鎖檢定優勢"},type:"generic"}),n="Backstab",t.find(l=>l.name===n)||t.push({name:n,bonusSource:"Class",desc:"+1 additional weapon dice of damage on unaware enemies",l10n:{name:"背刺",desc:"對未察覺的敵人造成額外 +1 武器傷害骰"},type:"modifyAmt",bonusTo:"backstabDice",bonusAmount:1,bonusIncreaseRatePerLevel:.5});break}case"Priest":break;case"Wizard":{const n="Learning Spells";t.find(l=>l.name===n)||t.push({name:n,bonusSource:"Class",desc:"Study a scroll (1 Day) + DC 15 check to permanently learn scroll",l10n:{name:"學習法術",desc:"研讀卷軸（1天）+ DC 15 檢定可永久學會卷軸法術"},type:"generic"});break}case"Fighter":{const n="Hauler";t.find(l=>l.name===n)||t.push({name:n,bonusSource:"Class",desc:"Add Your CON Modifer, if positive, to your total gear slots",l10n:{name:"負重者",desc:"將你的體質調整值（若為正）加到你的總裝備格數"},type:"modifyAmt",bonusTo:"gearSlots",bonusAmount:0,metadata:{type:"stat",stat:"CON"}});break}case"Ranger":{const n="Herbalism";t.find(l=>l.name===n)||t.push({name:n,bonusSource:"Class",desc:"Make an INT check to find some herbs",l10n:{name:"草藥學",desc:"進行智力檢定以尋找草藥"},type:"generic"},{name:"Wayfinder",bonusSource:"Class",desc:"Advantage on checks associated with navigation, survivalism, tracking, sneaking, hiding, nature, animals",l10n:{name:"尋路者",desc:"導航、求生、追蹤、潛行、躲藏、自然、動物相關檢定優勢"},type:"generic"})}}}function Wr(t,e,n){return Math.max(Math.min(n,t),e)}function Ot(t,e=1){let n=0;for(let l=0;l<e;l++)n+=Math.floor(Math.random()*$r[t])+1;return n}function Sn(t){return`${t>=0?"+":""}${t}`}function yn(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),t<e?-1:t>e?1:0}function Fs(t){return Ve(t.name)}function es(t,e=500,n,l){let s;return(...o)=>(n==null||n(),new Promise(a=>{s&&clearTimeout(s),s=setTimeout(()=>{a(t(...o)),l==null||l()},e)}))}function Us(t,e){return wt.findIndex(n=>n===t)-wt.findIndex(n=>n===e)}const Fr=100;function Ur(t){const e=[Ge(t)];let n=0;const l=st(!1),s=st(!1),o=es(a=>{if(a){for(n++,e[n]=JSON.parse(JSON.stringify(a));n<e.length-1;)e.pop();e.length>Fr&&(e.splice(0,1),n=Math.max(0,n-1)),l.set(!0),s.set(!1)}},1e3);return{subscribe:t.subscribe,canUndo:l,canRedo:s,set:a=>{o(a),t.set(a)},undo:()=>{n!==0&&(n--,n===0&&l.set(!1),s.set(!0),t.set(e[n]))},redo:()=>{n>=e.length-1||(n++,n>=e.length-1&&s.set(!1),l.set(!0),t.set(e[n]))}}}const be=Ur(st(Rt())),$e=be;function Rt(){return{name:"",ancestry:"Human",class:"",level:0,title:"Rook",alignment:"Lawful",background:"Scout",deity:"Gede",notes:"",gear:[],customGear:[],stats:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10},bonuses:[],customBonuses:[],customTalents:[],maxHitPoints:1,armorClass:10,gearSlotsTotal:10,gold:0,silver:0,copper:0,languages:["Common"],customLanguages:[],xp:0,spells:[],customSpells:[],hitPoints:1}}function $t(t,e){let n=0;const l=Wr(Math.floor((Mi(t,e)-10)/2),-4,4);return n+=l,n}function qr(t,e){t.class=e,al(t),il(t)}function Yr(t,e){t.ancestry=e,xl(t),Ql(t)}function Mi(t,e){return t.stats[e]+$i(t,e)}function Bn(t,e){var o,a;const n=!t.metadata,l=((o=t.metadata)==null?void 0:o.type)==="weaponType"&&e.weaponType.includes(t.metadata.weaponType),s=((a=t.metadata)==null?void 0:a.type)==="weapon"&&t.metadata.weapon===e.name;return n||l||s}function Ii(t,e,n){let l=e.damage[n].diceType;const s=t.bonuses.filter(o=>o.type==="diceType"&&o.bonusTo==="damageRoll"&&Bn(o,e)).map(o=>o.diceType).sort(Us).reverse();return s[0]&&Us(s[0],l)>0&&(l=s[0]),l}function $i(t,e){return t.bonuses.filter(n=>{var l;return n.type==="modifyAmt"&&n.bonusTo==="stat"&&((l=n.metadata)==null?void 0:l.type)==="stat"&&n.metadata.stat===e}).reduce((n,l)=>n+ut(t,l),0)}function zr(t){let e=t.armorClass,n=$t(t,"DEX"),l=0;for(const d of t.bonuses)d.type==="modifyAmt"&&d.bonusTo==="armorClass"&&!d.metadata&&(l+=ut(t,d));const s=t.gear.map(d=>({isEquipped:d.equipped,g:Ve(d.name)})).filter(({isEquipped:d,g:h})=>h&&(!h.canBeEquipped||d)).map(({g:d})=>d.playerBonuses).filter(Boolean).flat();let o=0;for(const d of s)d.type==="modifyAmt"&&d.bonusTo==="armorClass"&&(o+=ut(t,d));let a=0;const u=t.gear.filter(d=>d.equipped).map(Fs).filter(d=>{var h;return d.type==="Armor"&&((h=d.properties)==null?void 0:h.includes("OneHanded"))});for(const d of u)a+=d.ac.modifier;const r=t.gear.filter(d=>d.equipped).map(Fs).filter(d=>{var h;return d.type==="Armor"&&!((h=d.properties)!=null&&h.includes("OneHanded"))});let c=0,i=!0;for(const d of r)d.ac.stat&&d.ac.stat!=="DEX"&&(n=$t(t,d.ac.stat)),c+=d.ac.modifier,c+=t.bonuses.filter(h=>{var y;return h.type==="modifyAmt"&&((y=h.metadata)==null?void 0:y.type)==="armor"&&h.metadata.armor===d.name}).reduce((h,y)=>h+y.bonusAmount,0),d.ac.base>0&&(i=!!d.ac.stat,e=Math.max(d.ac.base,e));return e+l+o+a+c+(i?n:0)}function Vr(t){if(t.level===0||t.class==="")return null;try{return hn[t.class][t.alignment][Math.max(0,Math.floor((t.level-1)/2))]}catch{return null}}function jr(t,e){let n=0;const l=e.stat??(t.class==="Priest"?"WIS":"INT"),s=$t(t,l);n+=s;const o=t.bonuses.filter(u=>u.type==="modifyAmt"&&u.bonusTo==="spellcastRoll").reduce((u,r)=>((!r.metadata||r.metadata.type==="spell"&&r.metadata.spell===e.name)&&(u+=ut(t,r)),u),0);n+=o;const a=t.gear.map(u=>({isEquipped:u.equipped,g:Ve(u.name)})).filter(({isEquipped:u,g:r})=>r&&(!r.canBeEquipped||u)).map(({g:u})=>u.playerBonuses).filter(Boolean).flat().filter(u=>u.type==="modifyAmt"&&u.bonusTo==="spellcastRoll").reduce((u,r)=>((!r.metadata||r.metadata.type==="spell"&&r.metadata.spell===e.name)&&(u+=ut(t,r)),u),0);return n+=a,n}function On(t,e){let n=0;const l=t.bonuses.filter(o=>o.type==="modifyAmt"&&o.bonusTo==="damageRoll").reduce((o,a)=>(Bn(a,e)&&(o+=ut(t,a)),o),0);n+=l;const s=t.gear.map(o=>({isEquipped:o.equipped,g:Ve(o.name)})).filter(({isEquipped:o,g:a})=>a&&(!a.canBeEquipped||o)).map(({g:o})=>o.playerBonuses).filter(Boolean).flat().filter(o=>o.type==="modifyAmt"&&o.bonusTo==="damageRoll").reduce((o,a)=>(Bn(a,e)&&(o+=ut(t,a)),o),0);return n+=s,n}function qs(t,e){var u;let n=0;const l=$t(t,"STR"),s=$t(t,"DEX");(u=e.properties)!=null&&u.includes("Finesse")||e.weaponType==="MeleeRanged"?n+=Math.max(l,s):n+=e.weaponType==="Melee"?l:s;const o=t.bonuses.filter(r=>r.type==="modifyAmt"&&r.bonusTo==="attackRoll").reduce((r,c)=>(Bn(c,e)&&(r+=ut(t,c)),r),0);n+=o;const a=t.gear.map(r=>({isEquipped:r.equipped,g:Ve(r.name)})).filter(({isEquipped:r,g:c})=>c&&(!c.canBeEquipped||r)).map(({g:r})=>r.playerBonuses).filter(Boolean).flat().filter(r=>r.type==="modifyAmt"&&r.bonusTo==="attackRoll").reduce((r,c)=>(Bn(c,e)&&(r+=ut(t,c)),r),0);return n+=a,n}function Kr(t){const e=Math.max(10,t.stats.STR),n=t.bonuses.reduce((l,s)=>{var o;return s.type==="modifyAmt"&&s.bonusTo==="gearSlots"?((o=s.metadata)==null?void 0:o.type)==="stat"?l+Math.max(s.bonusAmount,$t(t,s.metadata.stat)):l+ut(t,s):l},0);return e+n}function Xr(t){const e=t.level===0?10:t.level*10;t.xp<e||t.level!=10&&(t.level+=1,t.xp-=e)}function Ni(t,e){return t.spells.findIndex(n=>n.name===e.name)>-1}function Jr(t,e){return t.hasCustomClass||e.class.toLowerCase().includes(t.class.toLowerCase())}function Zr(t,e){Ni(t,e)||t.spells.push({name:e.name})}function Qr(t,e){t.spells=t.spells.filter(n=>n.name!==e.name)}function _n(t,e){t.bonuses.push(e)}function xr(t,e){t.bonuses=t.bonuses.filter(n=>n.name!==e.name)}function Ys(t){const e=t.maxHitPoints,n=t.bonuses.filter(l=>l.type==="modifyAmt"&&l.bonusTo==="hp").reduce((l,s)=>l+ut(t,s),0);return e+n}function ut(t,e){var s;let n=e.bonusAmount;e.bonusTo!=="stat"&&((s=e.metadata)==null?void 0:s.type)==="stat"&&(n=Math.max(n,$t(t,e.metadata.stat)));const l=Math.floor(t.level*(e.bonusIncreaseRatePerLevel??0));return n+l}function eu(t,e){t.spells=t.spells.filter(n=>n.name!==e.name),t.bonuses=t.bonuses.filter(n=>{var l;return!(((l=n.metadata)==null?void 0:l.type)==="spell"&&n.metadata.spell===e.name)}),t.customSpells=t.customSpells.filter(n=>n.name!==e.name)}function tu(t,e){const{gp:n,sp:l,cp:s}=e.cost,o=n*100+l*10+s;return t.gold*100+t.silver*10+t.copper>=o}const nu={Fighter:"戰士",Priest:"牧師",Wizard:"法師",Thief:"盜賊",Ranger:"遊俠"},lu={Elf:"精靈",Human:"人類",Goblin:"哥布林",Halfling:"哈比人","Half-Orc":"半獸人",Dwarf:"矮人"},su={Lawful:"守序",Neutral:"中立",Chaotic:"混沌"},ou={STR:"力量",DEX:"敏捷",CON:"體質",INT:"智力",WIS:"感知",CHA:"魅力"},au={Common:"通用語",Dwarvish:"矮人語",Elvish:"精靈語",Giant:"巨人語",Goblin:"哥布林語",Merran:"梅蘭語",Orcish:"獸人語",Reptillian:"爬蟲語",Sylvan:"森林語",Thanian:"薩尼語",Celestial:"天界語",Diabolic:"煉獄語",Draconic:"龍語",Primordial:"原初語"},Gn={Fighter:{Lawful:["侍從","騎士","爵士","領主","領主/夫人"],Chaotic:["無賴","強盜","殺手","掠奪者","軍閥"],Neutral:["戰士","蠻族","狂戰士","戰爭酋長","酋長"]},Priest:{Lawful:["侍祭","十字軍","聖殿騎士","神選者","聖騎士"],Chaotic:["新信徒","狂熱者","異教徒","天譴者","混沌騎士"],Neutral:["探求者","祈求者","預兆師","秘術師","先知"]},Thief:{Lawful:["跑腿","飛賊","騙徒","幹部","老大"],Chaotic:["暴徒","割喉客","影子","刺客","幽靈"],Neutral:["強盜","不法之徒","流氓","叛變者","盜賊王/后"]},Wizard:{Lawful:["學徒","咒法師","奧術師","法師","大法師"],Chaotic:["熟練者","通靈師","巫師/術士","魔鬼崇拜者","術士"],Neutral:["薩滿","預言家","守望者","賢者","德魯伊"]},Ranger:{Lawful:["侍從","騎士","爵士","領主","領主/夫人"],Chaotic:["無賴","強盜","殺手","掠奪者","軍閥"],Neutral:["戰士","蠻族","狂戰士","戰爭酋長","酋長"]}};function $l(t){return nu[t]??t}function iu(t){return lu[t]??t}function ru(t){return su[t]??t}function rn(t){return ou[t]??t}function Nl(t){return au[t]??t}function zs(t,e,n){if(e&&n&&hn[e]&&hn[e][n]){const l=hn[e][n].indexOf(t);if(l>-1&&Gn[e]&&Gn[e][n])return Gn[e][n][l]}for(const l of an)for(const s of Rl){const o=hn[l][s].indexOf(t);if(o>-1)return Gn[l][s][o]}return t}function Vs(t,e,n){const l=t.slice();return l[8]=e[n],l}function js(t,e,n){const l=t.slice();return l[8]=e[n],l}function Ks(t){let e,n,l,s,o=Ws.filter(t[2]),a=[];for(let u=0;u<o.length;u+=1)a[u]=Xs(js(t,o,u));return{c(){e=p("select"),n=p("option");for(let u=0;u<a.length;u+=1)a[u].c();n.__value="",n.value=n.__value,m(e,"class","flex-grow")},m(u,r){w(u,e,r),f(e,n);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);l||(s=D(e,"change",t[3]),l=!0)},p(u,r){if(r&4){o=Ws.filter(u[2]);let c;for(c=0;c<o.length;c+=1){const i=js(u,o,c);a[c]?a[c].p(i,r):(a[c]=Xs(i),a[c].c(),a[c].m(e,null))}for(;c<a.length;c+=1)a[c].d(1);a.length=o.length}},d(u){u&&T(e),Te(a,u),l=!1,s()}}}function Xs(t){let e,n=Nl(t[8])+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[8],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Js(t){let e,n,l=Nl(t[8])+"",s,o,a,u,r,c;function i(){return t[6](t[8])}return{c(){e=p("li"),n=p("div"),s=G(l),o=v(),a=p("button"),a.innerHTML='<i class="material-icons translate-y-1">delete</i>',u=v(),m(a,"class","text-white bg-black p-1 text-xs"),m(e,"class","border-b flex justify-between gap-4")},m(d,h){w(d,e,h),f(e,n),f(n,s),f(e,o),f(e,a),f(e,u),r||(c=D(a,"click",i),r=!0)},p(d,h){t=d,h&2&&l!==(l=Nl(t[8])+"")&&te(s,l)},d(d){d&&T(e),r=!1,c()}}}function uu(t){let e,n,l,s,o,a=t[0]?"do_not_disturb_on":"add_circle",u,r,c,i,d,h,y=t[0]&&Ks(t),_=t[1].languages,b=[];for(let g=0;g<_.length;g+=1)b[g]=Js(Vs(t,_,g));return{c(){e=p("div"),n=p("h2"),n.textContent="語言",l=v(),s=p("button"),o=p("i"),u=G(a),r=v(),y&&y.c(),c=v(),i=p("ul");for(let g=0;g<b.length;g+=1)b[g].c();m(o,"class","material-icons translate-y-1"),m(s,"class","px-3 hover:bg-gray-400"),m(e,"class","flex justify-start")},m(g,C){w(g,e,C),f(e,n),f(e,l),f(e,s),f(s,o),f(o,u),f(e,r),y&&y.m(e,null),w(g,c,C),w(g,i,C);for(let A=0;A<b.length;A+=1)b[A]&&b[A].m(i,null);d||(h=D(s,"click",t[5]),d=!0)},p(g,[C]){if(C&1&&a!==(a=g[0]?"do_not_disturb_on":"add_circle")&&te(u,a),g[0]?y?y.p(g,C):(y=Ks(g),y.c(),y.m(e,null)):y&&(y.d(1),y=null),C&18){_=g[1].languages;let A;for(A=0;A<_.length;A+=1){const k=Vs(g,_,A);b[A]?b[A].p(k,C):(b[A]=Js(k),b[A].c(),b[A].m(i,null))}for(;A<b.length;A+=1)b[A].d(1);b.length=_.length}},i:K,o:K,d(g){g&&T(e),y&&y.d(),g&&T(c),g&&T(i),Te(b,g),d=!1,h()}}}function cu(t,e,n){let l;Oe(t,be,d=>n(1,l=d));let s=!1;function o(d){return!l.languages.includes(d)}function a(d){l.languages.push(d),n(0,s=!1),be.set(l)}function u(d){a(d.target.value)}function r(d){Fe(be,l.languages=l.languages.filter(h=>h!==d),l)}return[s,l,o,u,r,()=>{n(0,s=!s)},d=>{r(d)}]}class fu extends Ce{constructor(e){super(),Ae(this,e,cu,uu,ke,{})}}const du=t=>({}),Zs=t=>({});function pu(t){let e,n,l,s,o,a,u,r,c,i,d,h,y;const _=t[5].header,b=kn(_,t,t[4],Zs),g=t[5].default,C=kn(g,t,t[4],null);return{c(){e=p("dialog"),n=p("div"),l=p("button"),l.innerHTML='<i class="material-icons">close</i>',s=v(),b&&b.c(),o=v(),a=p("hr"),u=v(),C&&C.c(),r=v(),c=p("hr"),m(l,"class","absolute top-0 right-0 p-4 hover:bg-gray-200 rounded-md"),m(n,"class","svelte-eyp6eo"),m(e,"class","max-w-3xl svelte-eyp6eo"),m(e,"style",i=`min-width: 20rem; width: ${t[1]}vw;`+t[2]?`height: ${t[2]}vh`:"")},m(A,k){w(A,e,k),f(e,n),f(n,l),f(n,s),b&&b.m(n,null),f(n,o),f(n,a),f(n,u),C&&C.m(n,null),f(n,r),f(n,c),t[8](e),d=!0,h||(y=[D(l,"click",t[7]),D(n,"click",cr(t[6])),D(e,"close",t[9]),D(e,"click",fr(t[10]))],h=!0)},p(A,[k]){b&&b.p&&(!d||k&16)&&Cn(b,_,A,A[4],d?En(_,A[4],k,du):An(A[4]),Zs),C&&C.p&&(!d||k&16)&&Cn(C,g,A,A[4],d?En(g,A[4],k,null):An(A[4]),null),(!d||k&6&&i!==(i=`min-width: 20rem; width: ${A[1]}vw;`+A[2]?`height: ${A[2]}vh`:""))&&m(e,"style",i)},i(A){d||(P(b,A),P(C,A),d=!0)},o(A){W(b,A),W(C,A),d=!1},d(A){A&&T(e),b&&b.d(A),C&&C.d(A),t[8](null),h=!1,Ye(y)}}}function mu(t,e,n){let{$$slots:l={},$$scope:s}=e,{showModal:o=!0}=e,{vw:a=85}=e,{vh:u=void 0}=e,r;function c(_){dr.call(this,t,_)}const i=()=>{n(0,o=!1)};function d(_){We[_?"unshift":"push"](()=>{r=_,n(3,r)})}const h=()=>n(0,o=!1),y=()=>r.close();return t.$$set=_=>{"showModal"in _&&n(0,o=_.showModal),"vw"in _&&n(1,a=_.vw),"vh"in _&&n(2,u=_.vh),"$$scope"in _&&n(4,s=_.$$scope)},t.$$.update=()=>{t.$$.dirty&9&&r&&(o?r.showModal():r.close())},[o,a,u,r,s,l,c,i,d,h,y]}class ot extends Ce{constructor(e){super(),Ae(this,e,mu,pu,ke,{showModal:0,vw:1,vh:2})}}const Qn={Fighter:[{name:"Gain Weapon Mastery with one weapon",l10n:{name:"獲得一種武器的武器專精"},type:"chooseBonus",choices:Zn.map(t=>{var e,n,l,s;return[{name:`+1 to attack for ${t.name}`,desc:`+1 to attack for ${t.name}`,l10n:{name:`${((e=t.l10n)==null?void 0:e.name)??t.name} 攻擊 +1`,desc:`${((n=t.l10n)==null?void 0:n.name)??t.name} 攻擊檢定 +1`},type:"modifyAmt",bonusAmount:1,bonusTo:"attackRoll",bonusSource:"Talent",editable:!0,metadata:{type:"weapon",weapon:t.name}},{name:`+1 to damage for ${t.name}`,desc:`+1 to damage for ${t.name}`,l10n:{name:`${((l=t.l10n)==null?void 0:l.name)??t.name} 傷害 +1`,desc:`${((s=t.l10n)==null?void 0:s.name)??t.name} 傷害 +1`},type:"modifyAmt",bonusAmount:1,bonusTo:"damageRoll",bonusSource:"Talent",editable:!0,metadata:{type:"weapon",weapon:t.name}}]})},{name:"+1 to melee and ranged attacks",l10n:{name:"近戰與遠程攻擊 +1"},type:"bonus",bonuses:[{name:"+1 to attack type",desc:"+1 to melee attacks",l10n:{name:"近戰攻擊 +1",desc:"近戰攻擊檢定 +1"},type:"modifyAmt",bonusAmount:1,bonusTo:"attackRoll",bonusSource:"Talent",editable:!0,metadata:{type:"weaponType",weaponType:"Melee"}},{name:"+1 to attack type",desc:"+1 to ranged attacks",l10n:{name:"遠程攻擊 +1",desc:"遠程攻擊檢定 +1"},type:"modifyAmt",bonusAmount:1,bonusTo:"attackRoll",bonusSource:"Talent",editable:!0,metadata:{type:"weaponType",weaponType:"Ranged"}}]},{name:"+2 to Strenth, Dexterity, or Constitution stat",l10n:{name:"力量、敏捷或體質 +2"},type:"chooseBonus",choices:[{name:"+2 to STR",type:"modifyAmt",desc:"+2 to STR",l10n:{name:"力量 +2",desc:"力量屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"STR"}},{name:"+2 to DEX",type:"modifyAmt",desc:"+2 to DEX",l10n:{name:"敏捷 +2",desc:"敏捷屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"DEX"}},{name:"+2 to CON",type:"modifyAmt",desc:"+2 to CON",l10n:{name:"體質 +2",desc:"體質屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"CON"}}]},{name:"Choose one kind of armor. You get +1 AC from that armor",l10n:{name:"選擇一種盔甲，穿著該盔甲時 AC +1"},type:"chooseBonus",choices:zl.map(t=>{var e,n;return{name:`+1 to ${t.name}`,desc:`+1 to ${t.name}`,l10n:{name:`${((e=t.l10n)==null?void 0:e.name)??t.name} AC +1`,desc:`穿著${((n=t.l10n)==null?void 0:n.name)??t.name}時 AC +1`},type:"modifyAmt",bonusAmount:1,bonusTo:"armorClass",bonusSource:"Talent",editable:!0,metadata:{type:"armor",armor:t.name}}})}],Priest:[{name:"Gain advantage on casting one spell you know",l10n:{name:"獲得一個已知法術的施法優勢"},type:"chooseBonus",choices:Jn.map(t=>{var e,n;return{name:`Advantage to cast ${t.name}`,desc:`Advantage to cast ${t.name}`,l10n:{name:`${((e=t.l10n)==null?void 0:e.name)??t.name} 施法優勢`,desc:`施展 ${((n=t.l10n)==null?void 0:n.name)??t.name} 時具有優勢`},type:"advantage",bonusTo:"spellcastRoll",bonusSource:"Talent",editable:!0,metadata:{type:"spell",spell:t.name}}})},{name:"+1 to melee or ranged attacks",l10n:{name:"近戰或遠程攻擊 +1"},type:"chooseBonus",choices:[{name:"+1 to melee attacks",desc:"+1 to melee attacks",l10n:{name:"近戰攻擊 +1",desc:"近戰攻擊檢定 +1"},type:"modifyAmt",bonusTo:"attackRoll",bonusSource:"Talent",bonusAmount:1,editable:!0,metadata:{type:"weaponType",weaponType:"Melee"}},{name:"+1 to ranged attacks",desc:"+1 to ranged attacks",l10n:{name:"遠程攻擊 +1",desc:"遠程攻擊檢定 +1"},type:"modifyAmt",bonusTo:"attackRoll",bonusSource:"Talent",bonusAmount:1,editable:!0,metadata:{type:"weaponType",weaponType:"Ranged"}}]},{name:"+1 to priest spellcasting checks",l10n:{name:"牧師施法檢定 +1"},type:"bonus",bonuses:[{name:"+1 to spellcasting",desc:"+1 to spellcasting",l10n:{name:"施法 +1",desc:"施法檢定 +1"},type:"modifyAmt",bonusTo:"spellcastRoll",bonusAmount:1,bonusSource:"Talent",editable:!0}]},{name:"+2 to Strength or Wisdom stat",l10n:{name:"力量或感知 +2"},type:"chooseBonus",choices:[{name:"+2 to stat",type:"modifyAmt",desc:"+2 to STR",l10n:{name:"力量 +2",desc:"力量屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"STR"}},{name:"+2 to WIS",desc:"+2 to WIS",l10n:{name:"感知 +2",desc:"感知屬性 +2"},type:"modifyAmt",bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"WIS"}}]}],Thief:[{name:"Gain advantage on initiative rolls (reroll if duplicate)",l10n:{name:"先攻檢定優勢（若重複則重擲）"},type:"bonus",bonuses:[{name:"adv initiative",desc:"adv initiative rolls",l10n:{name:"先攻優勢",desc:"先攻檢定優勢"},type:"advantage",bonusTo:"initiativeRoll",bonusSource:"Talent",editable:!0}]},{name:"Your Backstab deals +1 dice of damage",l10n:{name:"背刺傷害增加一骰"},type:"bonus",bonuses:[{name:"+1 backstab dice",desc:"+1 backstab dice",l10n:{name:"背刺骰 +1",desc:"背刺傷害骰 +1"},type:"modifyAmt",bonusAmount:1,bonusTo:"backstabDice",bonusSource:"Talent",editable:!0}]},{name:"+2 to Strength, Dexterity, or Charisma stat",l10n:{name:"力量、敏捷或魅力 +2"},type:"chooseBonus",choices:[{name:"+2 to STR",type:"modifyAmt",desc:"+2 to",l10n:{name:"力量 +2",desc:"力量屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"STR"}},{name:"+2 to DEX",type:"modifyAmt",desc:"+2 to DEX",l10n:{name:"敏捷 +2",desc:"敏捷屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"DEX"}},{name:"+2 to CHA",type:"modifyAmt",desc:"+2 to CHA",l10n:{name:"魅力 +2",desc:"魅力屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"CHA"}}]},{name:"+1 to melee and ranged attacks",l10n:{name:"近戰與遠程攻擊 +1"},type:"bonus",bonuses:[{name:"+1 to attack type",desc:"+1 to melee attacks",l10n:{name:"近戰攻擊 +1",desc:"近戰攻擊檢定 +1"},type:"modifyAmt",bonusAmount:1,bonusTo:"attackRoll",bonusSource:"Talent",editable:!0,metadata:{type:"weaponType",weaponType:"Melee"}},{name:"+1 to attack type",desc:"+1 to ranged attacks",l10n:{name:"遠程攻擊 +1",desc:"遠程攻擊檢定 +1"},type:"modifyAmt",bonusAmount:1,bonusTo:"attackRoll",bonusSource:"Talent",editable:!0,metadata:{type:"weaponType",weaponType:"Ranged"}}]}],Wizard:[{name:"Make 1 random magic item of a type you choose",l10n:{name:"隨機製造一個你選擇類型的魔法物品"},type:"generic"},{name:"+2 to Intelligence stat or +1 to wizard spellcasting checks",l10n:{name:"智力 +2 或 法師施法檢定 +1"},type:"chooseBonus",choices:[{name:"+2 to INT",type:"modifyAmt",desc:"+2 to INT",l10n:{name:"智力 +2",desc:"智力屬性 +2"},bonusTo:"stat",bonusSource:"Talent",bonusAmount:2,editable:!0,metadata:{type:"stat",stat:"INT"}},{name:"+1 to spellcasting",desc:"+1 to spellcasting",l10n:{name:"施法 +1",desc:"施法檢定 +1"},type:"modifyAmt",bonusTo:"spellcastRoll",bonusSource:"Talent",bonusAmount:1,editable:!0}]},{name:"Gain advantage on casting one spell you know",l10n:{name:"獲得一個已知法術的施法優勢"},type:"chooseBonus",choices:Jn.map(t=>{var e,n;return{name:`Advantage to cast ${t.name}`,desc:`Advantage to cast ${t.name}`,l10n:{name:`${((e=t.l10n)==null?void 0:e.name)??t.name} 施法優勢`,desc:`施展 ${((n=t.l10n)==null?void 0:n.name)??t.name} 時具有優勢`},type:"advantage",bonusTo:"spellcastRoll",bonusSource:"Talent",editable:!0,metadata:{type:"spell",spell:t.name}}})},{name:"Learn one additional wizard spell of any tier you know",l10n:{name:"額外學會一個任意階級的法師法術"},type:"generic"}],Ranger:[{type:"chooseBonus",l10n:{name:"選擇一種武器，該武器傷害骰變為 d12"},choices:Zn.map(t=>{var e,n;return{name:`d12 damage for ${t.name}`,desc:`d12 damage for ${t.name}`,l10n:{name:`${((e=t.l10n)==null?void 0:e.name)??t.name} 傷害改為 d12`,desc:`${((n=t.l10n)==null?void 0:n.name)??t.name} 的傷害骰改為 d12`},type:"diceType",bonusTo:"damageRoll",bonusSource:"Talent",diceType:"d12",editable:!0,metadata:{type:"weapon",weapon:t.name}}}),name:"You deal d12 damage with one weapon you choose"},{name:"+1 to attacks and damage with melee or ranged weapons",l10n:{name:"近戰或遠程武器的攻擊與傷害 +1"},type:"chooseBonus",choices:["Melee","Ranged"].map(t=>[{name:`+1 to attack for ${t} weapons`,desc:`+1 to attack for ${t} weapons`,l10n:{name:`${t==="Melee"?"近戰":"遠程"}武器攻擊 +1`,desc:`${t==="Melee"?"近戰":"遠程"}武器攻擊檢定 +1`},type:"modifyAmt",bonusAmount:1,bonusTo:"attackRoll",bonusSource:"Talent",editable:!0,metadata:{type:"weaponType",weaponType:t}},{name:`+1 to damage for ${t} weapons`,desc:`+1 to damage for ${t} weapons`,l10n:{name:`${t==="Melee"?"近戰":"遠程"}武器傷害 +1`,desc:`${t==="Melee"?"近戰":"遠程"}武器傷害 +1`},type:"modifyAmt",bonusAmount:1,bonusTo:"damageRoll",bonusSource:"Talent",editable:!0,metadata:{type:"weaponType",weaponType:t}}])},{name:"+2 to Strength, Dexterity, or Intelligence stat",l10n:{name:"力量、敏捷或智力 +2"},type:"chooseBonus",choices:[{name:"+2 to STR",type:"modifyAmt",desc:"+2 to",l10n:{name:"力量 +2",desc:"力量屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"STR"}},{name:"+2 to DEX",type:"modifyAmt",desc:"+2 to DEX",l10n:{name:"敏捷 +2",desc:"敏捷屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"DEX"}},{name:"+2 to INT",type:"modifyAmt",desc:"+2 to INT",l10n:{name:"智力 +2",desc:"智力屬性 +2"},bonusTo:"stat",bonusAmount:2,bonusSource:"Talent",editable:!0,metadata:{type:"stat",stat:"INT"}}]},{name:"Reduce the difficulty of your herbalism checks by one step",l10n:{name:"草藥學檢定難度降低一階"},type:"generic"}]};function Qs(t,e,n){const l=t.slice();return l[27]=e[n],l}function xs(t,e,n){const l=t.slice();return l[30]=e[n],l}function eo(t,e,n){const l=t.slice();return l[33]=e[n],l[35]=n,l}function to(t,e,n){const l=t.slice();l[36]=e[n],l[35]=n;const s=Qn[l[2].class][l[35]];return l[37]=s,l}function no(t){var c,i,d;let e,n,l=(t[36].min===t[36].max?t[36].min:`${t[36].min}-${t[36].max}`)+"",s,o,a,u=(((i=(c=t[37])==null?void 0:c.l10n)==null?void 0:i.name)??((d=t[37])==null?void 0:d.name))+"",r;return{c(){e=p("tr"),n=p("td"),s=G(l),o=v(),a=p("td"),r=G(u),m(e,"class","border-b border-black"),Re(e,"bg-yellow-300",t[1]===t[35])},m(h,y){w(h,e,y),f(e,n),f(n,s),f(e,o),f(e,a),f(a,r)},p(h,y){var _,b,g;y[0]&4&&u!==(u=(((b=(_=h[37])==null?void 0:_.l10n)==null?void 0:b.name)??((g=h[37])==null?void 0:g.name))+"")&&te(r,u),y[0]&2&&Re(e,"bg-yellow-300",h[1]===h[35])},d(h){h&&T(e)}}}function lo(t){let e,n,l;return{c(){e=p("button"),e.textContent="擲骰",m(e,"class","w-full bg-black text-white p-1")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[11]),n=!0)},p:K,d(s){s&&T(e),n=!1,l()}}}function so(t){let e,n,l,s,o,a,u,r,c,i,d;return c=pr(t[18][0]),{c(){e=p("div"),n=p("label"),n.textContent="選擇天賦",l=v(),s=p("input"),o=v(),a=p("label"),a.textContent="分配屬性",u=v(),r=p("input"),m(n,"for","chooseTalentCheckBox"),m(s,"id","chooseTalentCheckBox"),m(s,"type","radio"),m(s,"name","pick"),s.__value="talent",s.value=s.__value,m(a,"for","distributeStatsCheckBox"),m(r,"id","distributeStatsCheckBox"),m(r,"type","radio"),m(r,"name","pick"),r.__value="stats",r.value=r.__value,m(e,"class","flex gap-5 items-center justify-center p-2"),c.p(s,r)},m(h,y){w(h,e,y),f(e,n),f(e,l),f(e,s),s.checked=s.__value===t[7],f(e,o),f(e,a),f(e,u),f(e,r),r.checked=r.__value===t[7],i||(d=[D(s,"change",t[17]),D(r,"change",t[19])],i=!0)},p(h,y){y[0]&128&&(s.checked=s.__value===h[7]),y[0]&128&&(r.checked=r.__value===h[7])},d(h){h&&T(e),c.r(),i=!1,Ye(d)}}}function oo(t){let e,n,l,s=Qn[t[2].class],o=[];for(let a=0;a<s.length;a+=1)o[a]=ao(eo(t,s,a));return{c(){e=p("select");for(let a=0;a<o.length;a+=1)o[a].c();m(e,"class","w-full svelte-ox30w2")},m(a,u){w(a,e,u);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null);de(e,t[1]),n||(l=D(e,"change",t[13]),n=!0)},p(a,u){if(u[0]&4){s=Qn[a[2].class];let r;for(r=0;r<s.length;r+=1){const c=eo(a,s,r);o[r]?o[r].p(c,u):(o[r]=ao(c),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=s.length}u[0]&2&&de(e,a[1])},d(a){a&&T(e),Te(o,a),n=!1,l()}}}function ao(t){var s;let e,n=(((s=t[33].l10n)==null?void 0:s.name)??t[33].name)+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[35],e.value=e.__value},m(o,a){w(o,e,a),f(e,l)},p(o,a){var u;a[0]&4&&n!==(n=(((u=o[33].l10n)==null?void 0:u.name)??o[33].name)+"")&&te(l,n)},d(o){o&&T(e)}}}function io(t){let e,n,l,s,o,a=It,u=[];for(let r=0;r<a.length;r+=1)u[r]=ro(xs(t,a,r));return{c(){e=p("div"),n=G("剩餘屬性點數: "),l=G(t[8]),s=v(),o=p("div");for(let r=0;r<u.length;r+=1)u[r].c();m(e,"class","self-center"),m(o,"class","flex flex-col gap-1 items-center")},m(r,c){w(r,e,c),f(e,n),f(e,l),w(r,s,c),w(r,o,c);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(o,null)},p(r,c){if(c[0]&256&&te(l,r[8]),c[0]&49668){a=It;let i;for(i=0;i<a.length;i+=1){const d=xs(r,a,i);u[i]?u[i].p(d,c):(u[i]=ro(d),u[i].c(),u[i].m(o,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}},d(r){r&&T(e),r&&T(s),r&&T(o),Te(u,r)}}}function ro(t){let e,n,l=t[30]+"",s,o,a,u=t[9][t[30]]+"",r,c,i,d,h,y,_,b;function g(){return t[20](t[30])}function C(){return t[21](t[30])}return{c(){e=p("div"),n=p("div"),s=G(l),o=v(),a=p("div"),r=G(u),c=v(),i=p("button"),i.innerHTML='<i class="material-icons">remove</i>',d=v(),h=p("button"),h.innerHTML='<i class="material-icons">add</i>',y=v(),m(n,"class","w-12"),m(a,"class","p-1 bg-gray-200 rounded-md"),Re(a,"text-green-600",t[9][t[30]]>t[2].stats[t[30]]),m(e,"class","flex items-center")},m(A,k){w(A,e,k),f(e,n),f(n,s),f(e,o),f(e,a),f(a,r),f(e,c),f(e,i),f(e,d),f(e,h),f(e,y),_||(b=[D(i,"click",g),D(h,"click",C)],_=!0)},p(A,k){t=A,k[0]&512&&u!==(u=t[9][t[30]]+"")&&te(r,u),k[0]&516&&Re(a,"text-green-600",t[9][t[30]]>t[2].stats[t[30]])},d(A){A&&T(e),_=!1,Ye(b)}}}function uo(t){let e,n,l,s=t[5],o=[];for(let a=0;a<s.length;a+=1)o[a]=co(Qs(t,s,a));return{c(){e=p("select");for(let a=0;a<o.length;a+=1)o[a].c();m(e,"class","svelte-ox30w2"),t[6]===void 0&&Pe(()=>t[22].call(e))},m(a,u){w(a,e,u);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null);de(e,t[6],!0),n||(l=D(e,"change",t[22]),n=!0)},p(a,u){if(u[0]&32){s=a[5];let r;for(r=0;r<s.length;r+=1){const c=Qs(a,s,r);o[r]?o[r].p(c,u):(o[r]=co(c),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=s.length}u[0]&96&&de(e,a[6])},d(a){a&&T(e),Te(o,a),n=!1,l()}}}function co(t){let e,n=po(t[27])+"",l,s;return{c(){e=p("option"),l=G(n),e.__value=s=t[27],e.value=e.__value},m(o,a){w(o,e,a),f(e,l)},p(o,a){a[0]&32&&n!==(n=po(o[27])+"")&&te(l,n),a[0]&32&&s!==(s=o[27])&&(e.__value=s,e.value=e.__value)},d(o){o&&T(e)}}}function fo(t){let e,n,l;return{c(){e=p("button"),e.textContent="更新角色卡",m(e,"class","w-full bg-black text-white p-1")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[12]),n=!0)},p:K,d(s){s&&T(e),n=!1,l()}}}function hu(t){let e,n,l,s,o,a,u,r,c,i,d,h,y=t[10],_=[];for(let E=0;E<y.length;E+=1)_[E]=no(to(t,y,E));let b=t[3]&&lo(t),g=t[1]===4&&so(t),C=t[7]==="talent"&&oo(t),A=t[7]==="stats"&&io(t),k=t[5].length&&uo(t),S=t[4]&&fo(t);return{c(){e=p("table"),n=p("tr"),n.innerHTML=`<th class="w-20">2d6</th> 
      <th>效果</th>`,l=v();for(let E=0;E<_.length;E+=1)_[E].c();s=v(),o=p("tr"),o.innerHTML=`<td>12</td> 
      <td>選擇一項天賦或 +2 點數分配至屬性</td>`,a=v(),b&&b.c(),u=v(),r=p("div"),g&&g.c(),c=v(),C&&C.c(),i=v(),A&&A.c(),d=v(),k&&k.c(),h=v(),S&&S.c(),m(n,"class","text-left border-b border-black"),m(o,"class","border-b border-black"),Re(o,"bg-yellow-300",t[1]===4),m(r,"class","flex flex-col gap-1")},m(E,R){w(E,e,R),f(e,n),f(e,l);for(let $=0;$<_.length;$+=1)_[$]&&_[$].m(e,null);f(e,s),f(e,o),w(E,a,R),b&&b.m(E,R),w(E,u,R),w(E,r,R),g&&g.m(r,null),f(r,c),C&&C.m(r,null),f(r,i),A&&A.m(r,null),f(r,d),k&&k.m(r,null),f(r,h),S&&S.m(r,null)},p(E,R){if(R[0]&1030){y=E[10];let $;for($=0;$<y.length;$+=1){const I=to(E,y,$);_[$]?_[$].p(I,R):(_[$]=no(I),_[$].c(),_[$].m(e,s))}for(;$<_.length;$+=1)_[$].d(1);_.length=y.length}R[0]&2&&Re(o,"bg-yellow-300",E[1]===4),E[3]?b?b.p(E,R):(b=lo(E),b.c(),b.m(u.parentNode,u)):b&&(b.d(1),b=null),E[1]===4?g?g.p(E,R):(g=so(E),g.c(),g.m(r,c)):g&&(g.d(1),g=null),E[7]==="talent"?C?C.p(E,R):(C=oo(E),C.c(),C.m(r,i)):C&&(C.d(1),C=null),E[7]==="stats"?A?A.p(E,R):(A=io(E),A.c(),A.m(r,d)):A&&(A.d(1),A=null),E[5].length?k?k.p(E,R):(k=uo(E),k.c(),k.m(r,h)):k&&(k.d(1),k=null),E[4]?S?S.p(E,R):(S=fo(E),S.c(),S.m(r,null)):S&&(S.d(1),S=null)},d(E){E&&T(e),Te(_,E),E&&T(a),b&&b.d(E),E&&T(u),E&&T(r),g&&g.d(),C&&C.d(),A&&A.d(),k&&k.d(),S&&S.d()}}}function _u(t){let e;return{c(){e=p("h2"),e.textContent="擲新天賦",m(e,"slot","header"),m(e,"class","text-lg")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function gu(t){let e,n,l,s,o,a,u;function r(i){t[23](i)}let c={$$slots:{header:[_u],default:[hu]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ot({props:c}),We.push(()=>je(l,"showModal",r)),{c(){e=p("button"),e.textContent="擲新天賦",n=v(),ne(l.$$.fragment),m(e,"class","bg-black text-white w-full p-2")},m(i,d){w(i,e,d),w(i,n,d),le(l,i,d),o=!0,a||(u=D(e,"click",t[16]),a=!0)},p(i,d){const h={};d[0]&1022|d[1]&256&&(h.$$scope={dirty:d,ctx:i}),!s&&d[0]&1&&(s=!0,h.showModal=i[0],Ke(()=>s=!1)),l.$set(h)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(e),i&&T(n),se(l,i),a=!1,u()}}}function po(t){var e;return Array.isArray(t)?t.map(n=>{var l;return((l=n.l10n)==null?void 0:l.name)??n.name}).join(" & "):((e=t.l10n)==null?void 0:e.name)??t.name}function bu(t,e,n){let l,s;Oe(t,$e,X=>n(2,s=X));let o=!1;const a=[{min:2,max:2},{min:3,max:7},{min:8,max:9},{min:10,max:11}];let u=!0,r=!1,c=-1;function i(){const X=Ot("d6")+Ot("d6");if(n(3,u=!1),X===12){n(1,c=4),n(4,r=!0);return}for(let J=0;J<a.length;J++){const oe=a[J];if(X>=oe.min&&X<=oe.max){n(1,c=J),n(4,r=!0);break}}}let d=[],h,y=()=>{};function _(X){const J=Qn[s.class][X];switch(J==null?void 0:J.type){case"generic":y=()=>{_n(s,{name:J.name,desc:J.name,type:"generic",editable:!0})};break;case"bonus":y=()=>{for(const fe of J.bonuses)_n(s,fe)};break;case"chooseBonus":const oe=J.choices[0];!Array.isArray(oe)&&oe.metadata&&oe.metadata.type==="spell"?n(5,d=J.choices.filter(fe=>s.spells.find(ce=>{var V;return ce.name===((V=fe.metadata)==null?void 0:V.spell)}))):n(5,d=J.choices);break}}function b(){n(3,u=!0),n(1,c=-1),n(4,r=!1),n(5,d=[]),n(6,h=void 0),n(7,C=void 0),n(8,A=2),n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})}function g(){if(C==="stats")Fe($e,s.stats=l,s);else if(h)if(Array.isArray(h))for(const X of h)_n(s,X);else _n(s,h);else y();$e.set(s),n(0,o=!1)}let C,A=2;function k(X){n(5,d=[]),_(parseInt(X.target.value))}function S(X){A<1||(n(9,l[X]+=1,l),n(8,A-=1))}function E(X){A===2||l[X]-1<s.stats[X]||(n(9,l[X]=Math.max(s.stats[X],l[X]-1),l),n(8,A+=1))}const R=[[]],$=()=>n(0,o=!0);function I(){C=this.__value,n(7,C)}function O(){C=this.__value,n(7,C)}const B=X=>E(X),M=X=>S(X);function Y(){h=He(this),n(6,h),n(5,d)}function x(X){o=X,n(0,o)}return t.$$.update=()=>{t.$$.dirty[0]&1&&(o||b()),t.$$.dirty[0]&2&&c>-1&&_(c),t.$$.dirty[0]&4&&n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})},[o,c,s,u,r,d,h,C,A,l,a,i,g,k,S,E,$,I,R,O,B,M,Y,x]}class yu extends Ce{constructor(e){super(),Ae(this,e,bu,gu,ke,{},null,[-1,-1])}}function vu(t){let e,n,l,s,o=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",a,u,r=t[1].diceType+"",c;return{c(){e=p("div"),n=G(t[3]),l=v(),s=p("div"),a=G(o),u=v(),c=G(r),m(e,"class","font-bold")},m(i,d){w(i,e,d),f(e,n),w(i,l,d),w(i,s,d),f(s,a),f(s,u),f(s,c)},p(i,d){d&8&&te(n,i[3]),d&2&&o!==(o=(i[5][i[1].bonusTo]??i[1].bonusTo)+"")&&te(a,o),d&2&&r!==(r=i[1].diceType+"")&&te(c,r)},d(i){i&&T(e),i&&T(l),i&&T(s)}}}function wu(t){let e,n,l,s,o=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",a,u,r=t[1].type==="advantage"?"優勢":"劣勢",c;return{c(){e=p("div"),n=G(t[3]),l=v(),s=p("div"),a=G(o),u=v(),c=G(r),m(e,"class","font-bold")},m(i,d){w(i,e,d),f(e,n),w(i,l,d),w(i,s,d),f(s,a),f(s,u),f(s,c)},p(i,d){d&8&&te(n,i[3]),d&2&&o!==(o=(i[5][i[1].bonusTo]??i[1].bonusTo)+"")&&te(a,o),d&2&&r!==(r=i[1].type==="advantage"?"優勢":"劣勢")&&te(c,r)},d(i){i&&T(e),i&&T(l),i&&T(s)}}}function Tu(t){let e,n,l,s,o=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",a,u,r=Sn(ut(t[4],t[1]))+"",c;return{c(){e=p("div"),n=G(t[3]),l=v(),s=p("div"),a=G(o),u=v(),c=G(r),m(e,"class","font-bold")},m(i,d){w(i,e,d),f(e,n),w(i,l,d),w(i,s,d),f(s,a),f(s,u),f(s,c)},p(i,d){d&8&&te(n,i[3]),d&2&&o!==(o=(i[5][i[1].bonusTo]??i[1].bonusTo)+"")&&te(a,o),d&18&&r!==(r=Sn(ut(i[4],i[1]))+"")&&te(c,r)},d(i){i&&T(e),i&&T(l),i&&T(s)}}}function ku(t){var s;let e,n=(((s=t[1].l10n)==null?void 0:s.desc)??t[1].desc)+"",l;return{c(){e=p("div"),l=G(n)},m(o,a){w(o,e,a),f(e,l)},p(o,a){var u;a&2&&n!==(n=(((u=o[1].l10n)==null?void 0:u.desc)??o[1].desc)+"")&&te(l,n)},d(o){o&&T(e)}}}function mo(t){let e,n,l;return{c(){e=p("button"),e.innerHTML='<i class="material-icons">info</i>'},m(s,o){w(s,e,o),n||(l=D(e,"click",t[8]),n=!0)},p:K,d(s){s&&T(e),n=!1,l()}}}function ho(t){let e,n,l,s;return{c(){e=p("div"),n=p("button"),n.innerHTML='<i class="material-icons">delete</i>',m(n,"class","pt-1 px-1 rounded-md bg-black text-white"),m(e,"class","flex gap-1")},m(o,a){w(o,e,a),f(e,n),l||(s=D(n,"click",t[9]),l=!0)},p:K,d(o){o&&T(e),l=!1,s()}}}function _o(t){let e,n,l;function s(a){t[10](a)}let o={$$slots:{header:[Au],default:[Cu]},$$scope:{ctx:t}};return t[2]!==void 0&&(o.showModal=t[2]),e=new ot({props:o}),We.push(()=>je(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(a,u){le(e,a,u),l=!0},p(a,u){const r={};u&2050&&(r.$$scope={dirty:u,ctx:a}),!n&&u&4&&(n=!0,r.showModal=a[2],Ke(()=>n=!1)),e.$set(r)},i(a){l||(P(e.$$.fragment,a),l=!0)},o(a){W(e.$$.fragment,a),l=!1},d(a){se(e,a)}}}function Cu(t){let e,n,l=t[1].desc+"",s,o,a,u,r=(t[1].bonusSource??"none")+"",c,i,d,h,y=(t[1].editable??"no")+"",_;return{c(){e=p("div"),n=G("Description: "),s=G(l),o=v(),a=p("div"),u=G("Source: "),c=G(r),i=v(),d=p("div"),h=G("Editable: "),_=G(y)},m(b,g){w(b,e,g),f(e,n),f(e,s),w(b,o,g),w(b,a,g),f(a,u),f(a,c),w(b,i,g),w(b,d,g),f(d,h),f(d,_)},p(b,g){g&2&&l!==(l=b[1].desc+"")&&te(s,l),g&2&&r!==(r=(b[1].bonusSource??"none")+"")&&te(c,r),g&2&&y!==(y=(b[1].editable??"no")+"")&&te(_,y)},d(b){b&&T(e),b&&T(o),b&&T(a),b&&T(i),b&&T(d)}}}function Au(t){let e,n=t[1].name+"",l;return{c(){e=p("h2"),l=G(n),m(e,"slot","header")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&2&&n!==(n=s[1].name+"")&&te(l,n)},d(s){s&&T(e)}}}function Eu(t){let e,n,l,s,o,a,u;function r(_,b){if(_[1].type==="generic")return ku;if(_[1].type==="modifyAmt")return Tu;if(_[1].type==="disadvantage"||_[1].type==="advantage")return wu;if(_[1].type==="diceType")return vu}let c=r(t),i=c&&c(t),d=t[0]&&mo(t),h=t[1].editable&&ho(t),y=t[2]&&_o(t);return{c(){e=p("div"),n=p("div"),i&&i.c(),l=v(),d&&d.c(),s=v(),h&&h.c(),o=v(),y&&y.c(),a=_t(),m(n,"class","flex gap-1"),m(e,"class","flex justify-between gap-3 items-center")},m(_,b){w(_,e,b),f(e,n),i&&i.m(n,null),f(n,l),d&&d.m(n,null),f(e,s),h&&h.m(e,null),w(_,o,b),y&&y.m(_,b),w(_,a,b),u=!0},p(_,[b]){c===(c=r(_))&&i?i.p(_,b):(i&&i.d(1),i=c&&c(_),i&&(i.c(),i.m(n,l))),_[0]?d?d.p(_,b):(d=mo(_),d.c(),d.m(n,null)):d&&(d.d(1),d=null),_[1].editable?h?h.p(_,b):(h=ho(_),h.c(),h.m(e,null)):h&&(h.d(1),h=null),_[2]?y?(y.p(_,b),b&4&&P(y,1)):(y=_o(_),y.c(),P(y,1),y.m(a.parentNode,a)):y&&(Ue(),W(y,1,1,()=>{y=null}),qe())},i(_){u||(P(y),u=!0)},o(_){W(y),u=!1},d(_){_&&T(e),i&&i.d(),d&&d.d(),h&&h.d(),_&&T(o),y&&y.d(_),_&&T(a)}}}function Su(t,e,n){let l,s;Oe(t,$e,_=>n(4,s=_));let{bonus:o}=e,{showInfo:a=!0}=e,u=!1;const r={attackRoll:"攻擊檢定",damageRoll:"傷害",armorClass:"AC",hp:"生命值",gearSlots:"裝備格",spellcastRoll:"施法檢定",backstabDice:"背刺骰",initiativeRoll:"先攻",hpRoll:"生命值擲骰",stat:"屬性",statRoll:"屬性檢定"};let c="";function i(_){xr(s,_),$e.set(s)}const d=()=>{n(2,u=!0)},h=()=>i(l);function y(_){u=_,n(2,u)}return t.$$set=_=>{"bonus"in _&&n(7,o=_.bonus),"showInfo"in _&&n(0,a=_.showInfo)},t.$$.update=()=>{var _,b,g,C;if(t.$$.dirty&128&&n(1,l=o),t.$$.dirty&2)switch((_=l.metadata)==null?void 0:_.type){case"weapon":{const A=Ve(l.metadata.weapon);n(3,c=(((b=A==null?void 0:A.l10n)==null?void 0:b.name)??l.metadata.weapon)+":");break}case"weaponType":{n(3,c=({Melee:"近戰",Ranged:"遠程",MeleeRanged:"近戰/遠程"}[l.metadata.weaponType]??l.metadata.weaponType)+":");break}case"armor":{const A=Ve(l.metadata.armor);n(3,c=(((g=A==null?void 0:A.l10n)==null?void 0:g.name)??l.metadata.armor)+":");break}case"stat":{n(3,c=rn(l.metadata.stat)+":");break}case"spell":{const A=Zl(l.metadata.spell);n(3,c=(((C=A==null?void 0:A.l10n)==null?void 0:C.name)??l.metadata.spell)+":");break}default:n(3,c="")}},[a,l,u,c,s,r,i,o,d,h,y]}class ts extends Ce{constructor(e){super(),Ae(this,e,Su,Eu,ke,{bonus:7,showInfo:0})}}function Bu(t,e,n){const l=t.slice();return l[40]=e[n],l}function go(t,e,n){const l=t.slice();return l[40]=e[n],l}function bo(t,e,n){const l=t.slice();return l[40]=e[n],l}function yo(t,e,n){const l=t.slice();return l[37]=e[n],l}function vo(t,e,n){const l=t.slice();return l[34]=e[n],l}function wo(t,e,n){const l=t.slice();return l[47]=e[n],l}function To(t,e,n){const l=t.slice();return l[50]=e[n],l}function ko(t,e,n){const l=t.slice();return l[50]=e[n],l}function Ou(t){let e,n,l,s,o,a=Gs,u=[];for(let r=0;r<a.length;r+=1)u[r]=Co(To(t,a,r));return{c(){e=p("label"),e.textContent="加值對象:",n=v(),l=p("select");for(let r=0;r<u.length;r+=1)u[r].c();m(e,"for","bto"),m(l,"id","bto"),t[2]===void 0&&Pe(()=>t[24].call(l))},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(l,null);de(l,t[2],!0),s||(o=D(l,"change",t[24]),s=!0)},p(r,c){if(c[0]&262144){a=Gs;let i;for(i=0;i<a.length;i+=1){const d=To(r,a,i);u[i]?u[i].p(d,c):(u[i]=Co(d),u[i].c(),u[i].m(l,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}c[0]&4&&de(l,r[2])},d(r){r&&T(e),r&&T(n),r&&T(l),Te(u,r),s=!1,o()}}}function Ru(t){let e,n,l,s,o,a=Ml,u=[];for(let r=0;r<a.length;r+=1)u[r]=Ao(ko(t,a,r));return{c(){e=p("label"),e.textContent="加值對象:",n=v(),l=p("select");for(let r=0;r<u.length;r+=1)u[r].c();m(e,"for","bto"),m(l,"id","bto"),t[2]===void 0&&Pe(()=>t[23].call(l))},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(l,null);de(l,t[2],!0),s||(o=D(l,"change",t[23]),s=!0)},p(r,c){if(c[0]&262144){a=Ml;let i;for(i=0;i<a.length;i+=1){const d=ko(r,a,i);u[i]?u[i].p(d,c):(u[i]=Ao(d),u[i].c(),u[i].m(l,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}c[0]&4&&de(l,r[2])},d(r){r&&T(e),r&&T(n),r&&T(l),Te(u,r),s=!1,o()}}}function Co(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[50],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Ao(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[50],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Mu(t){let e,n,l,s,o,a=wt,u=[];for(let r=0;r<a.length;r+=1)u[r]=Eo(wo(t,a,r));return{c(){e=p("label"),e.textContent="骰子類型",n=v(),l=p("select");for(let r=0;r<u.length;r+=1)u[r].c();m(e,"for","diceType"),m(l,"id","diceType"),t[8]===void 0&&Pe(()=>t[26].call(l))},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(l,null);de(l,t[8],!0),s||(o=D(l,"change",t[26]),s=!0)},p(r,c){if(c&0){a=wt;let i;for(i=0;i<a.length;i+=1){const d=wo(r,a,i);u[i]?u[i].p(d,c):(u[i]=Eo(d),u[i].c(),u[i].m(l,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}c[0]&256&&de(l,r[8])},d(r){r&&T(e),r&&T(n),r&&T(l),Te(u,r),s=!1,o()}}}function Iu(t){let e,n,l,s,o;return{c(){e=p("label"),e.textContent="數值多少?",n=v(),l=p("input"),m(e,"for","modifyAmt"),m(l,"id","modifyAmt"),m(l,"type","number"),m(l,"inputmode","numeric")},m(a,u){w(a,e,u),w(a,n,u),w(a,l,u),he(l,t[7]),s||(o=D(l,"input",t[25]),s=!0)},p(a,u){u[0]&128&&Be(l.value)!==a[7]&&he(l,a[7])},d(a){a&&T(e),a&&T(n),a&&T(l),s=!1,o()}}}function Eo(t){let e,n=t[47]+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[47],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function $u(t){let e,n,l,s,o,a=["Melee","Ranged"],u=[];for(let r=0;r<2;r+=1)u[r]=Hu(Bu(t,a,r));return{c(){e=p("label"),e.textContent="哪種武器類型?",n=v(),l=p("select");for(let r=0;r<2;r+=1)u[r].c();m(e,"for","weaponType"),m(l,"id","weaponType"),t[12]===void 0&&Pe(()=>t[32].call(l))},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c);for(let i=0;i<2;i+=1)u[i]&&u[i].m(l,null);de(l,t[12],!0),s||(o=D(l,"change",t[32]),s=!0)},p(r,c){c[0]&4096&&de(l,r[12])},d(r){r&&T(e),r&&T(n),r&&T(l),Te(u,r),s=!1,o()}}}function Nu(t){let e,n,l,s,o,a=It,u=[];for(let r=0;r<a.length;r+=1)u[r]=So(go(t,a,r));return{c(){e=p("label"),e.textContent="哪個屬性?",n=v(),l=p("select");for(let r=0;r<u.length;r+=1)u[r].c();m(e,"for","stat"),m(l,"id","stat"),t[4]===void 0&&Pe(()=>t[31].call(l))},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(l,null);de(l,t[4],!0),s||(o=D(l,"change",t[31]),s=!0)},p(r,c){if(c&0){a=It;let i;for(i=0;i<a.length;i+=1){const d=go(r,a,i);u[i]?u[i].p(d,c):(u[i]=So(d),u[i].c(),u[i].m(l,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}c[0]&16&&de(l,r[4])},d(r){r&&T(e),r&&T(n),r&&T(l),Te(u,r),s=!1,o()}}}function Du(t){let e,n,l,s,o,a=t[14],u=[];for(let r=0;r<a.length;r+=1)u[r]=Bo(bo(t,a,r));return{c(){e=p("label"),e.textContent="哪個法術?",n=v(),l=p("select");for(let r=0;r<u.length;r+=1)u[r].c();m(e,"for","spell"),m(l,"id","spell"),t[11]===void 0&&Pe(()=>t[30].call(l))},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(l,null);de(l,t[11],!0),s||(o=D(l,"change",t[30]),s=!0)},p(r,c){if(c[0]&16384){a=r[14];let i;for(i=0;i<a.length;i+=1){const d=bo(r,a,i);u[i]?u[i].p(d,c):(u[i]=Bo(d),u[i].c(),u[i].m(l,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}c[0]&18432&&de(l,r[11])},d(r){r&&T(e),r&&T(n),r&&T(l),Te(u,r),s=!1,o()}}}function Lu(t){let e,n,l,s,o,a=t[15],u=[];for(let r=0;r<a.length;r+=1)u[r]=Oo(yo(t,a,r));return{c(){e=p("label"),e.textContent="哪件防具?",n=v(),l=p("select");for(let r=0;r<u.length;r+=1)u[r].c();m(e,"for","armor"),m(l,"id","armor"),t[10]===void 0&&Pe(()=>t[29].call(l))},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(l,null);de(l,t[10],!0),s||(o=D(l,"change",t[29]),s=!0)},p(r,c){if(c[0]&32768){a=r[15];let i;for(i=0;i<a.length;i+=1){const d=yo(r,a,i);u[i]?u[i].p(d,c):(u[i]=Oo(d),u[i].c(),u[i].m(l,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}c[0]&33792&&de(l,r[10])},d(r){r&&T(e),r&&T(n),r&&T(l),Te(u,r),s=!1,o()}}}function Pu(t){let e,n,l,s,o,a=t[16],u=[];for(let r=0;r<a.length;r+=1)u[r]=Ro(vo(t,a,r));return{c(){e=p("label"),e.textContent="哪把武器?",n=v(),l=p("select");for(let r=0;r<u.length;r+=1)u[r].c();m(e,"for","weapon"),m(l,"id","weapon"),t[9]===void 0&&Pe(()=>t[28].call(l))},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(l,null);de(l,t[9],!0),s||(o=D(l,"change",t[28]),s=!0)},p(r,c){if(c[0]&65536){a=r[16];let i;for(i=0;i<a.length;i+=1){const d=vo(r,a,i);u[i]?u[i].p(d,c):(u[i]=Ro(d),u[i].c(),u[i].m(l,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}c[0]&66048&&de(l,r[9])},d(r){r&&T(e),r&&T(n),r&&T(l),Te(u,r),s=!1,o()}}}function Hu(t){let e,n=t[40]==="Melee"?"近戰":"遠程",l;return{c(){e=p("option"),l=G(n),e.__value=t[40],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function So(t){let e,n=rn(t[40])+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[40],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Bo(t){var o;let e,n=(((o=t[40].l10n)==null?void 0:o.name)??t[40].name)+"",l,s;return{c(){e=p("option"),l=G(n),e.__value=s=t[40].name,e.value=e.__value},m(a,u){w(a,e,u),f(e,l)},p(a,u){var r;u[0]&16384&&n!==(n=(((r=a[40].l10n)==null?void 0:r.name)??a[40].name)+"")&&te(l,n),u[0]&16384&&s!==(s=a[40].name)&&(e.__value=s,e.value=e.__value)},d(a){a&&T(e)}}}function Oo(t){var o;let e,n=(((o=t[37].l10n)==null?void 0:o.name)??t[37].name)+"",l,s;return{c(){e=p("option"),l=G(n),e.__value=s=t[37].name,e.value=e.__value},m(a,u){w(a,e,u),f(e,l)},p(a,u){var r;u[0]&32768&&n!==(n=(((r=a[37].l10n)==null?void 0:r.name)??a[37].name)+"")&&te(l,n),u[0]&32768&&s!==(s=a[37].name)&&(e.__value=s,e.value=e.__value)},d(a){a&&T(e)}}}function Ro(t){var o;let e,n=(((o=t[34].l10n)==null?void 0:o.name)??t[34].name)+"",l,s;return{c(){e=p("option"),l=G(n),e.__value=s=t[34].name,e.value=e.__value},m(a,u){w(a,e,u),f(e,l)},p(a,u){var r;u[0]&65536&&n!==(n=(((r=a[34].l10n)==null?void 0:r.name)??a[34].name)+"")&&te(l,n),u[0]&65536&&s!==(s=a[34].name)&&(e.__value=s,e.value=e.__value)},d(a){a&&T(e)}}}function Gu(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b,g,C,A,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve;function ee(L,re){if(L[6]==="diceType"||L[6]==="advantage"||L[6]==="disadvantage")return Ru;if(L[6]==="modifyAmt")return Ou}let ye=ee(t),q=ye&&ye(t);function ue(L,re){if(L[6]==="modifyAmt")return Iu;if(L[6]==="diceType")return Mu}let ie=ue(t),j=ie&&ie(t);function H(L,re){if(L[3]==="weapon")return Pu;if(L[3]==="armor")return Lu;if(L[3]==="spell")return Du;if(L[3]==="stat")return Nu;if(L[3]==="weaponType")return $u}let ae=H(t),Z=ae&&ae(t);return{c(){e=p("div"),n=p("label"),n.textContent="名稱",l=v(),s=p("input"),o=v(),a=p("label"),a.textContent="描述",u=v(),r=p("input"),c=v(),i=p("label"),i.textContent="加值類型",d=v(),h=p("select"),y=p("option"),y.textContent="一般",_=p("option"),_.textContent="數值修正 ",b=p("option"),b.textContent="優勢 ",g=p("option"),g.textContent="劣勢 ",C=p("option"),C.textContent="骰子類型",A=v(),q&&q.c(),k=v(),j&&j.c(),S=v(),E=p("label"),E.textContent="此加值是否針對特定物品、法術或屬性?",R=v(),$=p("select"),I=p("option"),I.textContent="否",O=p("option"),O.textContent="裝備中武器",B=p("option"),B.textContent="裝備中防具",M=p("option"),M.textContent="法術",Y=p("option"),Y.textContent="屬性",x=p("option"),x.textContent="武器類型",X=v(),Z&&Z.c(),J=v(),oe=p("button"),fe=G(t[13]),m(n,"for","name"),m(s,"id","name"),m(s,"type","text"),m(s,"placeholder","例如：中毒"),m(a,"for","desc"),m(r,"id","desc"),m(r,"placeholder","例如：10回合內 -2 體質"),m(i,"for","type"),y.__value="generic",y.value=y.__value,_.__value="modifyAmt",_.value=_.__value,b.__value="advantage",b.value=b.__value,g.__value="disadvantage",g.value=g.__value,C.__value="diceType",C.value=C.__value,m(h,"id","type"),t[6]===void 0&&Pe(()=>t[22].call(h)),m(E,"for","metaDataType"),I.__value="",I.value=I.__value,O.__value="weapon",O.value=O.__value,B.__value="armor",B.value=B.__value,M.__value="spell",M.value=M.__value,Y.__value="stat",Y.value=Y.__value,x.__value="weaponType",x.value=x.__value,m($,"id","metaDataType"),t[3]===void 0&&Pe(()=>t[27].call($)),m(oe,"class","w-full p-2 bg-black text-white mt-1"),oe.disabled=ce=!t[5],Re(oe,"opacity-50",!t[5]),m(e,"class","flex flex-col gap-1 w-full")},m(L,re){w(L,e,re),f(e,n),f(e,l),f(e,s),he(s,t[0]),f(e,o),f(e,a),f(e,u),f(e,r),he(r,t[1]),f(e,c),f(e,i),f(e,d),f(e,h),f(h,y),f(h,_),f(h,b),f(h,g),f(h,C),de(h,t[6],!0),f(e,A),q&&q.m(e,null),f(e,k),j&&j.m(e,null),f(e,S),f(e,E),f(e,R),f(e,$),f($,I),f($,O),f($,B),f($,M),f($,Y),f($,x),de($,t[3],!0),f(e,X),Z&&Z.m(e,null),f(e,J),f(e,oe),f(oe,fe),V||(ve=[D(s,"input",t[20]),D(r,"input",t[21]),D(h,"change",t[22]),D($,"change",t[27]),D(oe,"click",t[17])],V=!0)},p(L,re){re[0]&1&&s.value!==L[0]&&he(s,L[0]),re[0]&2&&r.value!==L[1]&&he(r,L[1]),re[0]&64&&de(h,L[6]),ye===(ye=ee(L))&&q?q.p(L,re):(q&&q.d(1),q=ye&&ye(L),q&&(q.c(),q.m(e,k))),ie===(ie=ue(L))&&j?j.p(L,re):(j&&j.d(1),j=ie&&ie(L),j&&(j.c(),j.m(e,S))),re[0]&8&&de($,L[3]),ae===(ae=H(L))&&Z?Z.p(L,re):(Z&&Z.d(1),Z=ae&&ae(L),Z&&(Z.c(),Z.m(e,J))),re[0]&8192&&te(fe,L[13]),re[0]&32&&ce!==(ce=!L[5])&&(oe.disabled=ce),re[0]&32&&Re(oe,"opacity-50",!L[5])},i:K,o:K,d(L){L&&T(e),q&&q.d(),j&&j.d(),Z&&Z.d(),V=!1,Ye(ve)}}}function Wu(t,e,n){let l,s,o,a;Oe(t,$e,ee=>n(19,a=ee));const u=fn();let r="",c="",i,d,h=1,y,_="d8",b,g,C,A,k,S=!!r&&!!c,E="新增";function R(){let ee;switch(i){case"generic":ee={name:r,desc:c,type:i};break;case"modifyAmt":ee={name:r,desc:c,type:i,bonusTo:d,bonusAmount:h};break;case"advantage":case"disadvantage":{ee={name:r,desc:c,type:i,bonusTo:d};break}case"diceType":ee={name:r,desc:c,type:i,bonusTo:d,diceType:_};break}switch(y){case"weapon":b&&(ee.metadata={type:y,weapon:b});break;case"weaponType":k&&(ee.metadata={type:y,weaponType:k});break;case"armor":g&&(ee.metadata={type:y,armor:g});break;case"stat":A&&(ee.metadata={type:y,stat:A});break;case"spell":C&&(ee.metadata={type:y,spell:C});break}ee.editable=!0,_n(a,ee),$e.set(a),u("finish")}const $={attackRoll:"攻擊檢定",damageRoll:"傷害檢定",armorClass:"防禦等級",hpRoll:"生命值檢定",stat:"屬性值",statRoll:"屬性檢定",initiative:"先攻",spellCastingCheck:"施法檢定"};function I(){r=this.value,n(0,r)}function O(){c=this.value,n(1,c)}function B(){i=He(this),n(6,i)}function M(){d=He(this),n(2,d)}function Y(){d=He(this),n(2,d)}function x(){h=Be(this.value),n(7,h)}function X(){_=He(this),n(8,_)}function J(){y=He(this),n(3,y),n(2,d),n(0,r),n(1,c),n(4,A),n(5,S)}function oe(){b=He(this),n(9,b),n(2,d),n(16,l),n(19,a)}function fe(){g=He(this),n(10,g),n(2,d),n(15,s),n(19,a)}function ce(){C=He(this),n(11,C),n(2,d),n(14,o),n(19,a)}function V(){A=He(this),n(4,A),n(2,d)}function ve(){k=He(this),n(12,k),n(2,d)}return t.$$.update=()=>{t.$$.dirty[0]&524288&&n(16,l=Zn.concat(a.customGear.filter(ee=>ee.type==="Weapon").map(ee=>ee)??[])),t.$$.dirty[0]&524288&&n(15,s=zl.concat(a.customGear.filter(ee=>ee.type==="Armor").map(ee=>ee)??[])),t.$$.dirty[0]&524288&&n(14,o=Jn.concat(a.customSpells??[])),t.$$.dirty[0]&4&&d&&(n(9,b=""),n(10,g=""),n(11,C=""),n(4,A=""),n(12,k="")),t.$$.dirty[0]&63&&(d==="stat"||d==="statRoll"?(n(3,y="stat"),n(5,S=!!r&&!!c&&!!A)):(y==="stat"&&n(3,y=""),n(5,S=!!r&&!!c)),n(13,E=S?"新增":"請填寫必要欄位"))},[r,c,d,y,A,S,i,h,_,b,g,C,k,E,o,s,l,R,$,a,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve]}class Fu extends Ce{constructor(e){super(),Ae(this,e,Wu,Gu,ke,{},null,[-1,-1])}}function Mo(t){let e,n,l;function s(a){t[4](a)}let o={$$slots:{header:[qu],default:[Uu]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ot({props:o}),We.push(()=>je(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(a,u){le(e,a,u),l=!0},p(a,u){const r={};u&33&&(r.$$scope={dirty:u,ctx:a}),!n&&u&2&&(n=!0,r.showModal=a[1],Ke(()=>n=!1)),e.$set(r)},i(a){l||(P(e.$$.fragment,a),l=!0)},o(a){W(e.$$.fragment,a),l=!1},d(a){se(e,a)}}}function Uu(t){let e,n;return e=new Fu({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:K,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function qu(t){let e;return{c(){e=p("h1"),e.textContent="自訂加值",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function Yu(t){let e,n,l,s,o,a,u=t[0]&&Mo(t);return{c(){e=p("button"),e.textContent="自訂加值",n=v(),u&&u.c(),l=_t(),m(e,"class","w-full bg-black text-white p-2")},m(r,c){w(r,e,c),w(r,n,c),u&&u.m(r,c),w(r,l,c),s=!0,o||(a=D(e,"click",t[2]),o=!0)},p(r,[c]){r[0]?u?(u.p(r,c),c&1&&P(u,1)):(u=Mo(r),u.c(),P(u,1),u.m(l.parentNode,l)):u&&(Ue(),W(u,1,1,()=>{u=null}),qe())},i(r){s||(P(u),s=!0)},o(r){W(u),s=!1},d(r){r&&T(e),r&&T(n),u&&u.d(r),r&&T(l),o=!1,a()}}}function zu(t,e,n){let l=!1,s=!1;const o=()=>{n(0,l=!0),n(1,s=!0)},a=()=>{n(0,l=!1)};function u(r){s=r,n(1,s)}return[l,s,o,a,u]}class Vu extends Ce{constructor(e){super(),Ae(this,e,zu,Yu,ke,{})}}function Io(t,e,n){const l=t.slice();return l[6]=e[n],l}function $o(t,e,n){const l=t.slice();return l[9]=e[n],l}function No(t,e,n){const l=t.slice();return l[6]=e[n],l}function Do(t,e,n){const l=t.slice();return l[9]=e[n],l}function Lo(t,e,n){const l=t.slice();return l[9]=e[n],l}function Po(t){let e,n,l,s;return n=new ts({props:{bonus:t[9]}}),{c(){e=p("li"),ne(n.$$.fragment),l=v(),m(e,"class","border-b")},m(o,a){w(o,e,a),le(n,e,null),f(e,l),s=!0},p(o,a){const u={};a&1&&(u.bonus=o[9]),n.$set(u)},i(o){s||(P(n.$$.fragment,o),s=!0)},o(o){W(n.$$.fragment,o),s=!1},d(o){o&&T(e),se(n)}}}function Ho(t){let e,n,l,s;return l=new ts({props:{bonus:t[9]}}),{c(){e=p("li"),n=G("* "),ne(l.$$.fragment),m(e,"class","border-b ps-8 flex gap-1")},m(o,a){w(o,e,a),f(e,n),le(l,e,null),s=!0},p(o,a){const u={};a&2&&(u.bonus=o[9]),l.$set(u)},i(o){s||(P(l.$$.fragment,o),s=!0)},o(o){W(l.$$.fragment,o),s=!1},d(o){o&&T(e),se(l)}}}function Go(t){var d;let e,n,l=(((d=t[6].l10n)==null?void 0:d.name)??t[6].name)+"",s,o,a,u,r=t[6].playerBonuses,c=[];for(let h=0;h<r.length;h+=1)c[h]=Ho(Do(t,r,h));const i=h=>W(c[h],1,1,()=>{c[h]=null});return{c(){e=p("li"),n=p("div"),s=G(l),o=v(),a=p("ul");for(let h=0;h<c.length;h+=1)c[h].c();m(n,"class","font-bold bg-gray-300"),m(e,"class","border-b")},m(h,y){w(h,e,y),f(e,n),f(n,s),f(e,o),f(e,a);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(a,null);u=!0},p(h,y){var _;if((!u||y&2)&&l!==(l=(((_=h[6].l10n)==null?void 0:_.name)??h[6].name)+"")&&te(s,l),y&2){r=h[6].playerBonuses;let b;for(b=0;b<r.length;b+=1){const g=Do(h,r,b);c[b]?(c[b].p(g,y),P(c[b],1)):(c[b]=Ho(g),c[b].c(),P(c[b],1),c[b].m(a,null))}for(Ue(),b=r.length;b<c.length;b+=1)i(b);qe()}},i(h){if(!u){for(let y=0;y<r.length;y+=1)P(c[y]);u=!0}},o(h){c=c.filter(Boolean);for(let y=0;y<c.length;y+=1)W(c[y]);u=!1},d(h){h&&T(e),Te(c,h)}}}function Wo(t){let e,n,l,s,o;return l=new ts({props:{bonus:t[9],showInfo:!1}}),{c(){e=p("li"),n=G("* "),ne(l.$$.fragment),s=v(),m(e,"class","border-b ps-8 flex gap-1")},m(a,u){w(a,e,u),f(e,n),le(l,e,null),f(e,s),o=!0},p(a,u){const r={};u&4&&(r.bonus=a[9]),l.$set(r)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),se(l)}}}function Fo(t){var h;let e,n,l=(((h=t[6].l10n)==null?void 0:h.name)??t[6].name)+"",s,o,a,u,r,c=t[6].playerBonuses,i=[];for(let y=0;y<c.length;y+=1)i[y]=Wo($o(t,c,y));const d=y=>W(i[y],1,1,()=>{i[y]=null});return{c(){e=p("li"),n=p("div"),s=G(l),o=v(),a=p("ul");for(let y=0;y<i.length;y+=1)i[y].c();u=v(),m(n,"class","font-bold bg-gray-300"),m(e,"class","border-b")},m(y,_){w(y,e,_),f(e,n),f(n,s),f(e,o),f(e,a);for(let b=0;b<i.length;b+=1)i[b]&&i[b].m(a,null);f(e,u),r=!0},p(y,_){var b;if((!r||_&4)&&l!==(l=(((b=y[6].l10n)==null?void 0:b.name)??y[6].name)+"")&&te(s,l),_&4){c=y[6].playerBonuses;let g;for(g=0;g<c.length;g+=1){const C=$o(y,c,g);i[g]?(i[g].p(C,_),P(i[g],1)):(i[g]=Wo(C),i[g].c(),P(i[g],1),i[g].m(a,null))}for(Ue(),g=c.length;g<i.length;g+=1)d(g);qe()}},i(y){if(!r){for(let _=0;_<c.length;_+=1)P(i[_]);r=!0}},o(y){i=i.filter(Boolean);for(let _=0;_<i.length;_+=1)W(i[_]);r=!1},d(y){y&&T(e),Te(i,y)}}}function Uo(t){let e,n;return e=new yu({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function ju(t){let e,n,l,s,o,a,u,r,c,i,d=t[0].level>0&&t[0].class&&!t[0].hasCustomClass&&an.includes(t[0].class),h,y,_,b=t[0].bonuses.sort(t[3]),g=[];for(let O=0;O<b.length;O+=1)g[O]=Po(Lo(t,b,O));const C=O=>W(g[O],1,1,()=>{g[O]=null});let A=t[1].sort(t[4]),k=[];for(let O=0;O<A.length;O+=1)k[O]=Go(No(t,A,O));const S=O=>W(k[O],1,1,()=>{k[O]=null});let E=t[2].sort(t[5]),R=[];for(let O=0;O<E.length;O+=1)R[O]=Fo(Io(t,E,O));const $=O=>W(R[O],1,1,()=>{R[O]=null});let I=d&&Uo();return y=new Vu({}),{c(){e=p("h2"),e.textContent="加值",n=v(),l=p("ul");for(let O=0;O<g.length;O+=1)g[O].c();s=v(),o=p("h2"),o.textContent="裝備加值",a=v(),u=p("ul");for(let O=0;O<k.length;O+=1)k[O].c();r=v();for(let O=0;O<R.length;O+=1)R[O].c();c=v(),i=p("div"),I&&I.c(),h=v(),ne(y.$$.fragment),m(l,"class","px-1"),m(i,"class","flex gap-1")},m(O,B){w(O,e,B),w(O,n,B),w(O,l,B);for(let M=0;M<g.length;M+=1)g[M]&&g[M].m(l,null);w(O,s,B),w(O,o,B),w(O,a,B),w(O,u,B);for(let M=0;M<k.length;M+=1)k[M]&&k[M].m(u,null);f(u,r);for(let M=0;M<R.length;M+=1)R[M]&&R[M].m(u,null);w(O,c,B),w(O,i,B),I&&I.m(i,null),f(i,h),le(y,i,null),_=!0},p(O,[B]){if(B&1){b=O[0].bonuses.sort(O[3]);let M;for(M=0;M<b.length;M+=1){const Y=Lo(O,b,M);g[M]?(g[M].p(Y,B),P(g[M],1)):(g[M]=Po(Y),g[M].c(),P(g[M],1),g[M].m(l,null))}for(Ue(),M=b.length;M<g.length;M+=1)C(M);qe()}if(B&2){A=O[1].sort(O[4]);let M;for(M=0;M<A.length;M+=1){const Y=No(O,A,M);k[M]?(k[M].p(Y,B),P(k[M],1)):(k[M]=Go(Y),k[M].c(),P(k[M],1),k[M].m(u,r))}for(Ue(),M=A.length;M<k.length;M+=1)S(M);qe()}if(B&4){E=O[2].sort(O[5]);let M;for(M=0;M<E.length;M+=1){const Y=Io(O,E,M);R[M]?(R[M].p(Y,B),P(R[M],1)):(R[M]=Fo(Y),R[M].c(),P(R[M],1),R[M].m(u,null))}for(Ue(),M=E.length;M<R.length;M+=1)$(M);qe()}B&1&&(d=O[0].level>0&&O[0].class&&!O[0].hasCustomClass&&an.includes(O[0].class)),d?I?B&1&&P(I,1):(I=Uo(),I.c(),P(I,1),I.m(i,h)):I&&(Ue(),W(I,1,1,()=>{I=null}),qe())},i(O){if(!_){for(let B=0;B<b.length;B+=1)P(g[B]);for(let B=0;B<A.length;B+=1)P(k[B]);for(let B=0;B<E.length;B+=1)P(R[B]);P(I),P(y.$$.fragment,O),_=!0}},o(O){g=g.filter(Boolean);for(let B=0;B<g.length;B+=1)W(g[B]);k=k.filter(Boolean);for(let B=0;B<k.length;B+=1)W(k[B]);R=R.filter(Boolean);for(let B=0;B<R.length;B+=1)W(R[B]);W(I),W(y.$$.fragment,O),_=!1},d(O){O&&T(e),O&&T(n),O&&T(l),Te(g,O),O&&T(s),O&&T(o),O&&T(a),O&&T(u),Te(k,O),Te(R,O),O&&T(c),O&&T(i),I&&I.d(),se(y)}}}function Ku(t,e,n){let l,s,o;Oe(t,$e,c=>n(0,o=c));const a=(c,i)=>yn(c.desc,i.desc),u=(c,i)=>yn(c.name,i.name),r=(c,i)=>yn(c.name,i.name);return t.$$.update=()=>{t.$$.dirty&1&&n(2,l=o.gear.filter(c=>c.equipped).map(c=>Ve(c.name)).filter(c=>{var i;return c&&c.canBeEquipped&&((i=c.playerBonuses)==null?void 0:i.length)>0})),t.$$.dirty&1&&n(1,s=o.gear.filter(c=>!c.equipped).map(c=>Ve(c.name)).filter(c=>{var i;return c&&((i=c.playerBonuses)==null?void 0:i.length)>0&&!c.canBeEquipped}))},[o,s,l,a,u,r]}class Xu extends Ce{constructor(e){super(),Ae(this,e,Ku,ju,ke,{})}}function qo(t,e,n){const l=t.slice();return l[31]=e[n],l}function Yo(t,e,n){const l=t.slice();return l[34]=e[n],l}function zo(t,e,n){const l=t.slice();return l[37]=e[n],l}function Vo(t,e,n){const l=t.slice();return l[40]=e[n],l}function jo(t){let e,n=rn(t[40])+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[40],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Ko(t){let e,n=(t[13][t[37]]??t[37])+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[37],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Xo(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_=wt,b=[];for(let k=0;k<_.length;k+=1)b[k]=Jo(Yo(t,_,k));let g=Hs,C=[];for(let k=0;k<g.length;k+=1)C[k]=Zo(qo(t,g,k));let A=t[5]!=="Round"&&Qo(t);return{c(){e=p("label"),e.textContent="持續多久？",n=v(),l=p("div"),s=p("input"),o=v(),a=p("select"),u=p("option");for(let k=0;k<b.length;k+=1)b[k].c();r=v(),c=p("select");for(let k=0;k<C.length;k+=1)C[k].c();i=v(),A&&A.c(),d=_t(),m(e,"for",""),m(s,"id","dice"),m(s,"type","number"),m(s,"min","1"),m(s,"inputmode","numeric"),m(s,"class","w-10 text-center svelte-uz2xsq"),u.__value="",u.value=u.__value,t[9]===void 0&&Pe(()=>t[23].call(a)),t[5]===void 0&&Pe(()=>t[24].call(c)),m(l,"class","flex gap-1")},m(k,S){w(k,e,S),w(k,n,S),w(k,l,S),f(l,s),he(s,t[10]),f(l,o),f(l,a),f(a,u);for(let E=0;E<b.length;E+=1)b[E]&&b[E].m(a,null);de(a,t[9],!0),f(l,r),f(l,c);for(let E=0;E<C.length;E+=1)C[E]&&C[E].m(c,null);de(c,t[5],!0),w(k,i,S),A&&A.m(k,S),w(k,d,S),h||(y=[D(s,"input",t[22]),D(a,"change",t[23]),D(c,"change",t[24])],h=!0)},p(k,S){if(S[0]&1024&&Be(s.value)!==k[10]&&he(s,k[10]),S&0){_=wt;let E;for(E=0;E<_.length;E+=1){const R=Yo(k,_,E);b[E]?b[E].p(R,S):(b[E]=Jo(R),b[E].c(),b[E].m(a,null))}for(;E<b.length;E+=1)b[E].d(1);b.length=_.length}if(S[0]&512&&de(a,k[9]),S[0]&16384){g=Hs;let E;for(E=0;E<g.length;E+=1){const R=qo(k,g,E);C[E]?C[E].p(R,S):(C[E]=Zo(R),C[E].c(),C[E].m(c,null))}for(;E<C.length;E+=1)C[E].d(1);C.length=g.length}S[0]&32&&de(c,k[5]),k[5]!=="Round"?A?A.p(k,S):(A=Qo(k),A.c(),A.m(d.parentNode,d)):A&&(A.d(1),A=null)},d(k){k&&T(e),k&&T(n),k&&T(l),Te(b,k),Te(C,k),k&&T(i),A&&A.d(k),k&&T(d),h=!1,Ye(y)}}}function Jo(t){let e,n=t[34]+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[34],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Zo(t){let e,n=(t[14][t[31]]??t[31])+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[31],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Qo(t){let e,n,l,s,o,a,u;return{c(){e=p("label"),e.textContent="遊戲內時間或現實時間？",n=v(),l=p("select"),s=p("option"),s.textContent="遊戲內時間",o=p("option"),o.textContent="現實時間",m(e,"for","durSubType"),s.__value="InGame",s.value=s.__value,o.__value="RealTime",o.value=o.__value,m(l,"id","durSubType"),t[6]===void 0&&Pe(()=>t[25].call(l))},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c),f(l,s),f(l,o),de(l,t[6],!0),a||(u=D(l,"change",t[25]),a=!0)},p(r,c){c[0]&64&&de(l,r[6])},d(r){r&&T(e),r&&T(n),r&&T(l),a=!1,u()}}}function Ju(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b,g,C,A,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve,ee,ye,q,ue,ie,j,H,ae=t[0]?"更新法術":"建立法術",Z,L,re,pe,Ie=It,me=[];for(let Q=0;Q<Ie.length;Q+=1)me[Q]=jo(Vo(t,Ie,Q));let _e=Ol,ge=[];for(let Q=0;Q<_e.length;Q+=1)ge[Q]=Ko(zo(t,_e,Q));let Ee=t[4]==="Time"&&Xo(t);return{c(){e=p("div"),n=p("label"),n.textContent="名稱",l=v(),s=p("input"),o=v(),a=p("label"),a.textContent="職業",u=v(),r=p("select"),c=p("option"),c.textContent="牧師",i=p("option"),i.textContent="法師",d=p("option"),d.textContent="牧師或法師",h=p("option"),h.textContent="其他",y=v(),_=p("label"),_.textContent="環階",b=v(),g=p("select"),C=p("option"),C.textContent="1",A=p("option"),A.textContent="2",k=p("option"),k.textContent="3",S=p("option"),S.textContent="4",E=p("option"),E.textContent="5",R=v(),$=p("label"),$.textContent="法術屬性",I=v(),O=p("select");for(let Q=0;Q<me.length;Q+=1)me[Q].c();B=v(),M=p("label"),M.textContent="距離",Y=v(),x=p("select");for(let Q=0;Q<ge.length;Q+=1)ge[Q].c();X=v(),J=p("label"),J.textContent="類型",oe=v(),fe=p("select"),ce=p("option"),ce.textContent="專注",V=p("option"),V.textContent="瞬間",ve=p("option"),ve.textContent="持續",ee=v(),Ee&&Ee.c(),ye=v(),q=p("label"),q.textContent="描述",ue=v(),ie=p("textarea"),j=v(),H=p("button"),Z=G(ae),m(n,"for","spellName"),m(s,"type","text"),m(s,"id","spellName"),m(s,"class","svelte-uz2xsq"),m(a,"for","spellClass"),c.__value="Priest",c.value=c.__value,i.__value="Wizard",i.value=i.__value,d.__value="PriestWizard",d.value=d.__value,h.__value="Other",h.value=h.__value,t[7]===void 0&&Pe(()=>t[17].call(r)),m(_,"for","spellTier"),C.__value="1",C.value=C.__value,A.__value="2",A.value=A.__value,k.__value="3",k.value=k.__value,S.__value="4",S.value=S.__value,E.__value="5",E.value=E.__value,t[3]===void 0&&Pe(()=>t[18].call(g)),m($,"for","spellStat"),t[11]===void 0&&Pe(()=>t[19].call(O)),m(M,"for","spellRange"),t[8]===void 0&&Pe(()=>t[20].call(x)),m(J,"for","spellDuration"),ce.__value="Focus",ce.value=ce.__value,V.__value="Instant",V.value=V.__value,ve.__value="Time",ve.value=ve.__value,t[4]===void 0&&Pe(()=>t[21].call(fe)),m(q,"for","spellDesc"),m(ie,"id","spellDesc"),m(ie,"cols","10"),m(H,"class","bg-black text-white p-2"),H.disabled=L=!t[12],Re(H,"opacity-50",!t[12]),m(e,"class","w-full flex flex-col gap-1 min-w-[250px]")},m(Q,Se){w(Q,e,Se),f(e,n),f(e,l),f(e,s),he(s,t[1]),f(e,o),f(e,a),f(e,u),f(e,r),f(r,c),f(r,i),f(r,d),f(r,h),de(r,t[7],!0),f(e,y),f(e,_),f(e,b),f(e,g),f(g,C),f(g,A),f(g,k),f(g,S),f(g,E),de(g,t[3],!0),f(e,R),f(e,$),f(e,I),f(e,O);for(let U=0;U<me.length;U+=1)me[U]&&me[U].m(O,null);de(O,t[11],!0),f(e,B),f(e,M),f(e,Y),f(e,x);for(let U=0;U<ge.length;U+=1)ge[U]&&ge[U].m(x,null);de(x,t[8],!0),f(e,X),f(e,J),f(e,oe),f(e,fe),f(fe,ce),f(fe,V),f(fe,ve),de(fe,t[4],!0),f(e,ee),Ee&&Ee.m(e,null),f(e,ye),f(e,q),f(e,ue),f(e,ie),he(ie,t[2]),f(e,j),f(e,H),f(H,Z),re||(pe=[D(s,"input",t[16]),D(r,"change",t[17]),D(g,"change",t[18]),D(O,"change",t[19]),D(x,"change",t[20]),D(fe,"change",t[21]),D(ie,"input",t[26]),D(H,"click",t[27])],re=!0)},p(Q,Se){if(Se[0]&2&&s.value!==Q[1]&&he(s,Q[1]),Se[0]&128&&de(r,Q[7]),Se[0]&8&&de(g,Q[3]),Se&0){Ie=It;let U;for(U=0;U<Ie.length;U+=1){const N=Vo(Q,Ie,U);me[U]?me[U].p(N,Se):(me[U]=jo(N),me[U].c(),me[U].m(O,null))}for(;U<me.length;U+=1)me[U].d(1);me.length=Ie.length}if(Se[0]&2048&&de(O,Q[11]),Se[0]&8192){_e=Ol;let U;for(U=0;U<_e.length;U+=1){const N=zo(Q,_e,U);ge[U]?ge[U].p(N,Se):(ge[U]=Ko(N),ge[U].c(),ge[U].m(x,null))}for(;U<ge.length;U+=1)ge[U].d(1);ge.length=_e.length}Se[0]&256&&de(x,Q[8]),Se[0]&16&&de(fe,Q[4]),Q[4]==="Time"?Ee?Ee.p(Q,Se):(Ee=Xo(Q),Ee.c(),Ee.m(e,ye)):Ee&&(Ee.d(1),Ee=null),Se[0]&4&&he(ie,Q[2]),Se[0]&1&&ae!==(ae=Q[0]?"更新法術":"建立法術")&&te(Z,ae),Se[0]&4096&&L!==(L=!Q[12])&&(H.disabled=L),Se[0]&4096&&Re(H,"opacity-50",!Q[12])},i:K,o:K,d(Q){Q&&T(e),Te(me,Q),Te(ge,Q),Ee&&Ee.d(),re=!1,Ye(pe)}}}function Zu(t,e,n){var ce,V,ve,ee,ye;let l,s;Oe(t,$e,q=>n(29,s=q));const o=fn();let{spellToEdit:a=void 0}=e,u=s.spells.find(q=>q.name===(a==null?void 0:a.name)),r=a==null?void 0:a.name,c=a==null?void 0:a.desc,i=`${(a==null?void 0:a.tier)??1}`,d="Instant",h=((ce=a==null?void 0:a.duration)==null?void 0:ce.type)??"Round",y=((V=a==null?void 0:a.duration)==null?void 0:V.subType)??"InGame",_=(a==null?void 0:a.class)??"Wizard",b=(a==null?void 0:a.range)??"Self",g=((ee=(ve=a==null?void 0:a.duration)==null?void 0:ve.roll)==null?void 0:ee.diceType)??"d8",C=((ye=a==null?void 0:a.duration)==null?void 0:ye.amt)??1,A=(a==null?void 0:a.stat)??"INT";const k={Self:"自身",Close:"貼身",Near:"近距",Far:"遠距"},S={Round:"回合",Minute:"分鐘",Hour:"小時",Day:"天"};function E(){const q=d==="Time"?h:d,ue={editable:!0,name:r,class:_,stat:A,tier:parseInt(i),range:b,duration:{type:q},desc:c};d==="Time"&&(ue.duration.subType=y,g.length>0?ue.duration.roll={diceType:g,numDice:C}:ue.duration.amt=C),a?(Object.assign(a,ue),u&&(u.name=ue.name)):(s.spells.push({name:ue.name}),s.customSpells.push(ue)),$e.set(s),o("finish")}function R(){r=this.value,n(1,r)}function $(){_=He(this),n(7,_)}function I(){i=He(this),n(3,i)}function O(){A=He(this),n(11,A)}function B(){b=He(this),n(8,b)}function M(){d=He(this),n(4,d)}function Y(){C=Be(this.value),n(10,C)}function x(){g=He(this),n(9,g)}function X(){h=He(this),n(5,h)}function J(){y=He(this),n(6,y)}function oe(){c=this.value,n(2,c)}const fe=()=>E();return t.$$set=q=>{"spellToEdit"in q&&n(0,a=q.spellToEdit)},t.$$.update=()=>{t.$$.dirty[0]&6&&n(12,l=!!(r&&c))},[a,r,c,i,d,h,y,_,b,g,C,A,l,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe]}class Di extends Ce{constructor(e){super(),Ae(this,e,Zu,Ju,ke,{spellToEdit:0},null,[-1,-1])}}function xo(t){let e,n,l;function s(a){t[4](a)}let o={vw:50,$$slots:{header:[xu],default:[Qu]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ot({props:o}),We.push(()=>je(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(a,u){le(e,a,u),l=!0},p(a,u){const r={};u&33&&(r.$$scope={dirty:u,ctx:a}),!n&&u&2&&(n=!0,r.showModal=a[1],Ke(()=>n=!1)),e.$set(r)},i(a){l||(P(e.$$.fragment,a),l=!0)},o(a){W(e.$$.fragment,a),l=!1},d(a){se(e,a)}}}function Qu(t){let e,n;return e=new Di({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:K,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function xu(t){let e;return{c(){e=p("h1"),e.textContent="Custom Spell",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function ec(t){let e,n,l,s,o,a,u=t[0]&&xo(t);return{c(){e=p("button"),e.textContent="Custom Spell",n=v(),u&&u.c(),l=_t(),m(e,"class","bg-black text-white w-full")},m(r,c){w(r,e,c),w(r,n,c),u&&u.m(r,c),w(r,l,c),s=!0,o||(a=D(e,"click",t[2]),o=!0)},p(r,[c]){r[0]?u?(u.p(r,c),c&1&&P(u,1)):(u=xo(r),u.c(),P(u,1),u.m(l.parentNode,l)):u&&(Ue(),W(u,1,1,()=>{u=null}),qe())},i(r){s||(P(u),s=!0)},o(r){W(u),s=!1},d(r){r&&T(e),r&&T(n),u&&u.d(r),r&&T(l),o=!1,a()}}}function tc(t,e,n){let l=!1,s=!1;const o=()=>{n(0,l=!0),n(1,s=!0)},a=()=>n(0,l=!1);function u(r){s=r,n(1,s)}return[l,s,o,a,u]}class nc extends Ce{constructor(e){super(),Ae(this,e,tc,ec,ke,{})}}function ea(t,{delay:e=0,duration:n=400,easing:l=mr}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:l,css:o=>`opacity: ${o*s}`}}const Li={};function lc(t){let e,n,l,s,o,a;const u=t[5].default,r=kn(u,t,t[4],null);return{c(){e=v(),n=p("div"),r&&r.c(),mn(n,"top",t[1]+"px"),mn(n,"left",t[0]+"px"),m(n,"class","svelte-zimeji")},m(c,i){w(c,e,i),w(c,n,i),r&&r.m(n,null),t[6](n),s=!0,o||(a=D(document.body,"click",t[3]),o=!0)},p(c,[i]){r&&r.p&&(!s||i&16)&&Cn(r,u,c,c[4],s?En(u,c[4],i,null):An(c[4]),null),(!s||i&2)&&mn(n,"top",c[1]+"px"),(!s||i&1)&&mn(n,"left",c[0]+"px")},i(c){s||(P(r,c),Pe(()=>{s&&(l||(l=Ns(n,ea,{duration:100},!0)),l.run(1))}),s=!0)},o(c){W(r,c),l||(l=Ns(n,ea,{duration:100},!1)),l.run(0),s=!1},d(c){c&&T(e),c&&T(n),r&&r.d(c),t[6](null),c&&l&&l.end(),o=!1,a()}}}function sc(t,e,n){let{$$slots:l={},$$scope:s}=e,{x:o}=e,{y:a}=e,u;const r=fn();hr(Li,{dispatchClick:()=>r("click")});function c(d){d.target===u||u.contains(d.target)||r("clickoutside")}function i(d){We[d?"unshift":"push"](()=>{u=d,n(2,u)})}return t.$$set=d=>{"x"in d&&n(0,o=d.x),"y"in d&&n(1,a=d.y),"$$scope"in d&&n(4,s=d.$$scope)},t.$$.update=()=>{if(t.$$.dirty&7&&u){const d=u.getBoundingClientRect();n(0,o=Math.min(window.innerWidth-d.width,o)),n(1,a=Math.min(window.innerHeight-d.height,a))}},[o,a,u,c,s,l,i]}class oc extends Ce{constructor(e){super(),Ae(this,e,sc,lc,ke,{x:0,y:1})}}function ac(t){let e;const n=t[4].default,l=kn(n,t,t[3],null);return{c(){l&&l.c()},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&8)&&Cn(l,n,s,s[3],e?En(n,s[3],o,null):An(s[3]),null)},i(s){e||(P(l,s),e=!0)},o(s){W(l,s),e=!1},d(s){l&&l.d(s)}}}function ic(t){let e;return{c(){e=G(t[1])},m(n,l){w(n,e,l)},p(n,l){l&2&&te(e,n[1])},i:K,o:K,d(n){n&&T(e)}}}function rc(t){let e,n,l,s,o,a;const u=[ic,ac],r=[];function c(i,d){return i[1]?0:1}return n=c(t),l=r[n]=u[n](t),{c(){e=p("div"),l.c(),m(e,"class","active:bg-gray-100 svelte-12ogry0"),Re(e,"disabled",t[0])},m(i,d){w(i,e,d),r[n].m(e,null),s=!0,o||(a=D(e,"click",t[2]),o=!0)},p(i,[d]){let h=n;n=c(i),n===h?r[n].p(i,d):(Ue(),W(r[h],1,1,()=>{r[h]=null}),qe(),l=r[n],l?l.p(i,d):(l=r[n]=u[n](i),l.c()),P(l,1),l.m(e,null)),(!s||d&1)&&Re(e,"disabled",i[0])},i(i){s||(P(l),s=!0)},o(i){W(l),s=!1},d(i){i&&T(e),r[n].d(),o=!1,a()}}}function uc(t,e,n){let{$$slots:l={},$$scope:s}=e,{isDisabled:o=!1}=e,{text:a=""}=e;const u=fn(),{dispatchClick:r}=_r(Li),c=()=>{o||(u("click"),r())};return t.$$set=i=>{"isDisabled"in i&&n(0,o=i.isDisabled),"text"in i&&n(1,a=i.text),"$$scope"in i&&n(3,s=i.$$scope)},[o,a,c,s,l]}class Wn extends Ce{constructor(e){super(),Ae(this,e,uc,rc,ke,{isDisabled:0,text:1})}}var tt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class cc{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return tt(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,n){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:n})})}deselect(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return tt(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return tt(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return tt(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return tt(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return tt(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return tt(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return tt(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:l}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return l.indexOf(e)>-1})}getConnectionId(){return tt(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const n=l=>{e(l.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",n)}}}var ht=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class fc{constructor(e){this.messageBus=e}reset(){return ht(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return ht(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return ht(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return ht(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return ht(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return ht(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return n})}inverseTransformPoint(e){return ht(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return n})}}function dc(t){return typeof t.id=="string"}var xn={},pc={get exports(){return xn},set exports(t){xn=t}},ln=typeof Reflect=="object"?Reflect:null,ta=ln&&typeof ln.apply=="function"?ln.apply:function(e,n,l){return Function.prototype.apply.call(e,n,l)},jn;ln&&typeof ln.ownKeys=="function"?jn=ln.ownKeys:Object.getOwnPropertySymbols?jn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:jn=function(e){return Object.getOwnPropertyNames(e)};function mc(t){console&&console.warn&&console.warn(t)}var Pi=Number.isNaN||function(e){return e!==e};function De(){De.init.call(this)}pc.exports=De;xn.once=bc;De.EventEmitter=De;De.prototype._events=void 0;De.prototype._eventsCount=0;De.prototype._maxListeners=void 0;var na=10;function rl(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(De,"defaultMaxListeners",{enumerable:!0,get:function(){return na},set:function(t){if(typeof t!="number"||t<0||Pi(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");na=t}});De.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};De.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Pi(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Hi(t){return t._maxListeners===void 0?De.defaultMaxListeners:t._maxListeners}De.prototype.getMaxListeners=function(){return Hi(this)};De.prototype.emit=function(e){for(var n=[],l=1;l<arguments.length;l++)n.push(arguments[l]);var s=e==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var a;if(n.length>0&&(a=n[0]),a instanceof Error)throw a;var u=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw u.context=a,u}var r=o[e];if(r===void 0)return!1;if(typeof r=="function")ta(r,this,n);else for(var c=r.length,i=qi(r,c),l=0;l<c;++l)ta(i[l],this,n);return!0};function Gi(t,e,n,l){var s,o,a;if(rl(n),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]),a===void 0)a=o[e]=n,++t._eventsCount;else if(typeof a=="function"?a=o[e]=l?[n,a]:[a,n]:l?a.unshift(n):a.push(n),s=Hi(t),s>0&&a.length>s&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=a.length,mc(u)}return t}De.prototype.addListener=function(e,n){return Gi(this,e,n,!1)};De.prototype.on=De.prototype.addListener;De.prototype.prependListener=function(e,n){return Gi(this,e,n,!0)};function hc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Wi(t,e,n){var l={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=hc.bind(l);return s.listener=n,l.wrapFn=s,s}De.prototype.once=function(e,n){return rl(n),this.on(e,Wi(this,e,n)),this};De.prototype.prependOnceListener=function(e,n){return rl(n),this.prependListener(e,Wi(this,e,n)),this};De.prototype.removeListener=function(e,n){var l,s,o,a,u;if(rl(n),s=this._events,s===void 0)return this;if(l=s[e],l===void 0)return this;if(l===n||l.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,l.listener||n));else if(typeof l!="function"){for(o=-1,a=l.length-1;a>=0;a--)if(l[a]===n||l[a].listener===n){u=l[a].listener,o=a;break}if(o<0)return this;o===0?l.shift():_c(l,o),l.length===1&&(s[e]=l[0]),s.removeListener!==void 0&&this.emit("removeListener",e,u||n)}return this};De.prototype.off=De.prototype.removeListener;De.prototype.removeAllListeners=function(e){var n,l,s;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[e]),this;if(arguments.length===0){var o=Object.keys(l),a;for(s=0;s<o.length;++s)a=o[s],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=l[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(e,n[s]);return this};function Fi(t,e,n){var l=t._events;if(l===void 0)return[];var s=l[e];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?gc(s):qi(s,s.length)}De.prototype.listeners=function(e){return Fi(this,e,!0)};De.prototype.rawListeners=function(e){return Fi(this,e,!1)};De.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ui.call(t,e)};De.prototype.listenerCount=Ui;function Ui(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}De.prototype.eventNames=function(){return this._eventsCount>0?jn(this._events):[]};function qi(t,e){for(var n=new Array(e),l=0;l<e;++l)n[l]=t[l];return n}function _c(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function gc(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function bc(t,e){return new Promise(function(n,l){function s(a){t.removeListener(e,o),l(a)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",s),n([].slice.call(arguments))}Yi(t,e,o,{once:!0}),e!=="error"&&yc(t,s,{once:!0})})}function yc(t,e,n){typeof t.on=="function"&&Yi(t,"error",e,n)}function Yi(t,e,n,l){if(typeof t.on=="function")l.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(o){l.once&&t.removeEventListener(e,s),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}let Fn;const vc=new Uint8Array(16);function wc(){if(!Fn&&(Fn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Fn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Fn(vc)}const Qe=[];for(let t=0;t<256;++t)Qe.push((t+256).toString(16).slice(1));function Tc(t,e=0){return(Qe[t[e+0]]+Qe[t[e+1]]+Qe[t[e+2]]+Qe[t[e+3]]+"-"+Qe[t[e+4]]+Qe[t[e+5]]+"-"+Qe[t[e+6]]+Qe[t[e+7]]+"-"+Qe[t[e+8]]+Qe[t[e+9]]+"-"+Qe[t[e+10]]+Qe[t[e+11]]+Qe[t[e+12]]+Qe[t[e+13]]+Qe[t[e+14]]+Qe[t[e+15]]).toLowerCase()}const kc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),la={randomUUID:kc};function Cc(t,e,n){if(la.randomUUID&&!e&&!t)return la.randomUUID();t=t||{};const l=t.random||(t.rng||wc)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,e){n=n||0;for(let s=0;s<16;++s)e[n+s]=l[s];return e}return Tc(l)}class Ac extends xn.EventEmitter{constructor(e,n){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=l=>{const s=l.data;if(l.origin===this.targetOrigin&&dc(s)){if(s.id==="OBR_READY"){this.ready=!0;const o=s.data;this.ref=o.ref,this.userId=o.userId}this.emit(s.id,s.data)}},this.send=(l,s,o)=>{var a;if(!this.ref)throw Error("Unable to send message: not ready");(a=window.parent)===null||a===void 0||a.postMessage({id:l,data:s,ref:this.ref,nonce:o},this.targetOrigin)},this.sendAsync=(l,s,o=5e3)=>{const a=`_${Cc()}`;return this.send(l,s,a),Promise.race([new Promise((u,r)=>{const c=this;function i(h){c.off(`${l}_RESPONSE${a}`,i),c.off(`${l}_ERROR${a}`,d),u(h)}function d(h){c.off(`${l}_RESPONSE${a}`,i),c.off(`${l}_ERROR${a}`,d),r(h)}this.on(`${l}_RESPONSE${a}`,i),this.on(`${l}_ERROR${a}`,d)}),...o>0?[new Promise((u,r)=>window.setTimeout(()=>r(new Error(`Message ${l} took longer than ${o}ms to get a result`)),o))]:[]])},this.roomId=n,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var sa=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class Ec{constructor(e){this.messageBus=e}show(e,n){return sa(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:n});return l})}close(e){return sa(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var Qt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class Sc{constructor(e){this.messageBus=e}getColor(){return Qt(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return Qt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return Qt(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return Qt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return Qt(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return Qt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const n=l=>{e(l.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",n)}}}var nt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class Bc{constructor(e){this.messageBus=e}getDpi(){return nt(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return nt(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return nt(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return nt(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return nt(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return nt(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return nt(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,n,l,s){return nt(this,void 0,void 0,function*(){const{position:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:n,useCorners:l,useCenter:s});return o})}getDistance(e,n){return nt(this,void 0,void 0,function*(){const{distance:l}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:n});return l})}onChange(e){const n=l=>{e(l.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",n)}}}var Un=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class Oc{constructor(e){this.messageBus=e}undo(){return Un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Un(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Un(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function xe(t){for(var e=arguments.length,n=Array(e>1?e-1:0),l=1;l<e;l++)n[l-1]=arguments[l];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(s){return"'"+s+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Ut(t){return!!t&&!!t[ct]}function Nt(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var l=Object.getPrototypeOf(n);if(l===null)return!0;var s=Object.hasOwnProperty.call(l,"constructor")&&l.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===Pc}(t)||Array.isArray(t)||!!t[vn]||!!(!((e=t.constructor)===null||e===void 0)&&e[vn])||ul(t)||cl(t))}function un(t,e,n){n===void 0&&(n=!1),Dt(t)===0?(n?Object.keys:rs)(t).forEach(function(l){n&&typeof l=="symbol"||e(l,t[l],t)}):t.forEach(function(l,s){return e(s,l,t)})}function Dt(t){var e=t[ct];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:ul(t)?2:cl(t)?3:0}function Rn(t,e){return Dt(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Kn(t,e){return Dt(t)===2?t.get(e):t[e]}function zi(t,e,n){var l=Dt(t);l===2?t.set(e,n):l===3?t.add(n):t[e]=n}function Rc(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function ul(t){return Dc&&t instanceof Map}function cl(t){return Lc&&t instanceof Set}function Wt(t){return t.o||t.t}function ns(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=Hc(t);delete e[ct];for(var n=rs(e),l=0;l<n.length;l++){var s=n[l],o=e[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(e[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:t[s]})}return Object.create(Object.getPrototypeOf(t),e)}function ls(t,e){return e===void 0&&(e=!1),ss(t)||Ut(t)||!Nt(t)||(Dt(t)>1&&(t.set=t.add=t.clear=t.delete=Mc),Object.freeze(t),e&&un(t,function(n,l){return ls(l,!0)},!0)),t}function Mc(){xe(2)}function ss(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function Tt(t){var e=Hl[t];return e||xe(18,t),e}function Ic(t,e){Hl[t]||(Hl[t]=e)}function oa(){return Mn}function wl(t,e){e&&(Tt("Patches"),t.u=[],t.s=[],t.v=e)}function el(t){Dl(t),t.p.forEach($c),t.p=null}function Dl(t){t===Mn&&(Mn=t.l)}function aa(t){return Mn={p:[],l:Mn,h:t,m:!0,_:0}}function $c(t){var e=t[ct];e.i===0||e.i===1?e.j():e.g=!0}function Tl(t,e){e._=e.p.length;var n=e.p[0],l=t!==void 0&&t!==n;return e.h.O||Tt("ES5").S(e,t,l),l?(n[ct].P&&(el(e),xe(4)),Nt(t)&&(t=tl(e,t),e.l||nl(e,t)),e.u&&Tt("Patches").M(n[ct].t,t,e.u,e.s)):t=tl(e,n,[]),el(e),e.u&&e.v(e.u,e.s),t!==is?t:void 0}function tl(t,e,n){if(ss(e))return e;var l=e[ct];if(!l)return un(e,function(u,r){return ia(t,l,e,u,r,n)},!0),e;if(l.A!==t)return e;if(!l.P)return nl(t,l.t,!0),l.t;if(!l.I){l.I=!0,l.A._--;var s=l.i===4||l.i===5?l.o=ns(l.k):l.o,o=s,a=!1;l.i===3&&(o=new Set(s),s.clear(),a=!0),un(o,function(u,r){return ia(t,l,s,u,r,n,a)}),nl(t,s,!1),n&&t.u&&Tt("Patches").N(l,n,t.u,t.s)}return l.o}function ia(t,e,n,l,s,o,a){if(Ut(s)){var u=tl(t,s,o&&e&&e.i!==3&&!Rn(e.R,l)?o.concat(l):void 0);if(zi(n,l,u),!Ut(u))return;t.m=!1}else a&&n.add(s);if(Nt(s)&&!ss(s)){if(!t.h.D&&t._<1)return;tl(t,s),e&&e.A.l||nl(t,s)}}function nl(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&ls(e,n)}function kl(t,e){var n=t[ct];return(n?Wt(n):t)[e]}function ra(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var l=Object.getOwnPropertyDescriptor(n,e);if(l)return l;n=Object.getPrototypeOf(n)}}function Ll(t){t.P||(t.P=!0,t.l&&Ll(t.l))}function Cl(t){t.o||(t.o=ns(t.t))}function Pl(t,e,n){var l=ul(e)?Tt("MapSet").F(e,n):cl(e)?Tt("MapSet").T(e,n):t.O?function(s,o){var a=Array.isArray(s),u={i:a?1:0,A:o?o.A:oa(),P:!1,I:!1,R:{},l:o,t:s,k:null,o:null,j:null,C:!1},r=u,c=Gl;a&&(r=[u],c=gn);var i=Proxy.revocable(r,c),d=i.revoke,h=i.proxy;return u.k=h,u.j=d,h}(e,n):Tt("ES5").J(e,n);return(n?n.A:oa()).p.push(l),l}function Nc(t){return Ut(t)||xe(22,t),function e(n){if(!Nt(n))return n;var l,s=n[ct],o=Dt(n);if(s){if(!s.P&&(s.i<4||!Tt("ES5").K(s)))return s.t;s.I=!0,l=ua(n,o),s.I=!1}else l=ua(n,o);return un(l,function(a,u){s&&Kn(s.t,a)===u||zi(l,a,e(u))}),o===3?new Set(l):l}(t)}function ua(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return ns(t)}function os(){function t(l){if(!Nt(l))return l;if(Array.isArray(l))return l.map(t);if(ul(l))return new Map(Array.from(l.entries()).map(function(a){return[a[0],t(a[1])]}));if(cl(l))return new Set(Array.from(l).map(t));var s=Object.create(Object.getPrototypeOf(l));for(var o in l)s[o]=t(l[o]);return Rn(l,vn)&&(s[vn]=l[vn]),s}function e(l){return Ut(l)?t(l):l}var n="add";Ic("Patches",{$:function(l,s){return s.forEach(function(o){for(var a=o.path,u=o.op,r=l,c=0;c<a.length-1;c++){var i=Dt(r),d=a[c];typeof d!="string"&&typeof d!="number"&&(d=""+d),i!==0&&i!==1||d!=="__proto__"&&d!=="constructor"||xe(24),typeof r=="function"&&d==="prototype"&&xe(24),typeof(r=Kn(r,d))!="object"&&xe(15,a.join("/"))}var h=Dt(r),y=t(o.value),_=a[a.length-1];switch(u){case"replace":switch(h){case 2:return r.set(_,y);case 3:xe(16);default:return r[_]=y}case n:switch(h){case 1:return _==="-"?r.push(y):r.splice(_,0,y);case 2:return r.set(_,y);case 3:return r.add(y);default:return r[_]=y}case"remove":switch(h){case 1:return r.splice(_,1);case 2:return r.delete(_);case 3:return r.delete(o.value);default:return delete r[_]}default:xe(17,u)}}),l},N:function(l,s,o,a){switch(l.i){case 0:case 4:case 2:return function(u,r,c,i){var d=u.t,h=u.o;un(u.R,function(y,_){var b=Kn(d,y),g=Kn(h,y),C=_?Rn(d,y)?"replace":n:"remove";if(b!==g||C!=="replace"){var A=r.concat(y);c.push(C==="remove"?{op:C,path:A}:{op:C,path:A,value:g}),i.push(C===n?{op:"remove",path:A}:C==="remove"?{op:n,path:A,value:e(b)}:{op:"replace",path:A,value:e(b)})}})}(l,s,o,a);case 5:case 1:return function(u,r,c,i){var d=u.t,h=u.R,y=u.o;if(y.length<d.length){var _=[y,d];d=_[0],y=_[1];var b=[i,c];c=b[0],i=b[1]}for(var g=0;g<d.length;g++)if(h[g]&&y[g]!==d[g]){var C=r.concat([g]);c.push({op:"replace",path:C,value:e(y[g])}),i.push({op:"replace",path:C,value:e(d[g])})}for(var A=d.length;A<y.length;A++){var k=r.concat([A]);c.push({op:n,path:k,value:e(y[A])})}d.length<y.length&&i.push({op:"replace",path:r.concat(["length"]),value:d.length})}(l,s,o,a);case 3:return function(u,r,c,i){var d=u.t,h=u.o,y=0;d.forEach(function(_){if(!h.has(_)){var b=r.concat([y]);c.push({op:"remove",path:b,value:_}),i.unshift({op:n,path:b,value:_})}y++}),y=0,h.forEach(function(_){if(!d.has(_)){var b=r.concat([y]);c.push({op:n,path:b,value:_}),i.unshift({op:"remove",path:b,value:_})}y++})}(l,s,o,a)}},M:function(l,s,o,a){o.push({op:"replace",path:[],value:s===is?void 0:s}),a.push({op:"replace",path:[],value:l})}})}var ca,Mn,as=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Dc=typeof Map<"u",Lc=typeof Set<"u",fa=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",is=as?Symbol.for("immer-nothing"):((ca={})["immer-nothing"]=!0,ca),vn=as?Symbol.for("immer-draftable"):"__$immer_draftable",ct=as?Symbol.for("immer-state"):"__$immer_state",Pc=""+Object.prototype.constructor,rs=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,Hc=Object.getOwnPropertyDescriptors||function(t){var e={};return rs(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},Hl={},Gl={get:function(t,e){if(e===ct)return t;var n=Wt(t);if(!Rn(n,e))return function(s,o,a){var u,r=ra(o,a);return r?"value"in r?r.value:(u=r.get)===null||u===void 0?void 0:u.call(s.k):void 0}(t,n,e);var l=n[e];return t.I||!Nt(l)?l:l===kl(t.t,e)?(Cl(t),t.o[e]=Pl(t.A.h,l,t)):l},has:function(t,e){return e in Wt(t)},ownKeys:function(t){return Reflect.ownKeys(Wt(t))},set:function(t,e,n){var l=ra(Wt(t),e);if(l!=null&&l.set)return l.set.call(t.k,n),!0;if(!t.P){var s=kl(Wt(t),e),o=s==null?void 0:s[ct];if(o&&o.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(Rc(n,s)&&(n!==void 0||Rn(t.t,e)))return!0;Cl(t),Ll(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return kl(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,Cl(t),Ll(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=Wt(t),l=Reflect.getOwnPropertyDescriptor(n,e);return l&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:l.enumerable,value:n[e]}},defineProperty:function(){xe(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){xe(12)}},gn={};un(Gl,function(t,e){gn[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),gn.deleteProperty=function(t,e){return gn.set.call(this,t,e,void 0)},gn.set=function(t,e,n){return Gl.set.call(this,t[0],e,n,t[0])};var Gc=function(){function t(n){var l=this;this.O=fa,this.D=!0,this.produce=function(s,o,a){if(typeof s=="function"&&typeof o!="function"){var u=o;o=s;var r=l;return function(b){var g=this;b===void 0&&(b=u);for(var C=arguments.length,A=Array(C>1?C-1:0),k=1;k<C;k++)A[k-1]=arguments[k];return r.produce(b,function(S){var E;return(E=o).call.apply(E,[g,S].concat(A))})}}var c;if(typeof o!="function"&&xe(6),a!==void 0&&typeof a!="function"&&xe(7),Nt(s)){var i=aa(l),d=Pl(l,s,void 0),h=!0;try{c=o(d),h=!1}finally{h?el(i):Dl(i)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(b){return wl(i,a),Tl(b,i)},function(b){throw el(i),b}):(wl(i,a),Tl(c,i))}if(!s||typeof s!="object"){if((c=o(s))===void 0&&(c=s),c===is&&(c=void 0),l.D&&ls(c,!0),a){var y=[],_=[];Tt("Patches").M(s,c,y,_),a(y,_)}return c}xe(21,s)},this.produceWithPatches=function(s,o){if(typeof s=="function")return function(c){for(var i=arguments.length,d=Array(i>1?i-1:0),h=1;h<i;h++)d[h-1]=arguments[h];return l.produceWithPatches(c,function(y){return s.apply(void 0,[y].concat(d))})};var a,u,r=l.produce(s,o,function(c,i){a=c,u=i});return typeof Promise<"u"&&r instanceof Promise?r.then(function(c){return[c,a,u]}):[r,a,u]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){Nt(n)||xe(8),Ut(n)&&(n=Nc(n));var l=aa(this),s=Pl(this,n,void 0);return s[ct].C=!0,Dl(l),s},e.finishDraft=function(n,l){var s=n&&n[ct],o=s.A;return wl(o,l),Tl(void 0,o)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!fa&&xe(20),this.O=n},e.applyPatches=function(n,l){var s;for(s=l.length-1;s>=0;s--){var o=l[s];if(o.path.length===0&&o.op==="replace"){n=o.value;break}}s>-1&&(l=l.slice(s+1));var a=Tt("Patches").$;return Ut(n)?a(n,l):this.produce(n,function(u){return a(u,l)})},t}(),ft=new Gc;ft.produce;var us=ft.produceWithPatches.bind(ft);ft.setAutoFreeze.bind(ft);ft.setUseProxies.bind(ft);ft.applyPatches.bind(ft);ft.createDraft.bind(ft);ft.finishDraft.bind(ft);var xt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};os();class Wc{constructor(e){this.messageBus=e}getItems(e){return xt(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n}})}isItemArray(e){return Array.isArray(e)&&e.every(n=>typeof n!="string")}updateItems(e,n,l=!0){return xt(this,void 0,void 0,function*(){let s;this.isItemArray(e)?s=e:s=yield this.getItems(e);const[o,a]=us(s,n),u=o.map(c=>({id:c.id,type:c.type}));for(const c of a){const[i,d]=c.path;typeof i=="number"&&typeof d=="string"&&(u[i][d]=o[i][d])}const r=u.filter(c=>Object.keys(c).length>2);r.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:r,updateAttachments:l}))})}addItems(e){return xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return xt(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return xt(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",n)}}}var en=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};os();class Fc{constructor(e){this.messageBus=e}getItems(e){return en(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n}})}updateItems(e,n,l,s=!0){return en(this,void 0,void 0,function*(){const o=yield this.getItems(e),[a,u]=us(o,n),r=a.map(i=>({id:i.id,type:i.type}));for(const i of u){const[d,h]=i.path;typeof d=="number"&&typeof h=="string"&&(r[d][h]=a[d][h])}const c=r.filter(i=>Object.keys(i).length>2);c.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:c,fastUpdate:l,updateAttachments:s}))})}addItems(e){return en(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return en(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return en(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return en(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",n)}}}var Al=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class Uc{constructor(e){this.messageBus=e,this.grid=new Bc(e),this.fog=new Sc(e),this.history=new Oc(e),this.items=new Wc(e),this.local=new Fc(e)}isReady(){return Al(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const n=l=>{e(l.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",n)}}getMetadata(){return Al(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return Al(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",n)}}}function Vi(t){return t.startsWith("http")?t:`${window.location.origin}${t}`}function wn(t){return t.map(e=>Object.assign(Object.assign({},e),{icon:Vi(e.icon)}))}function cs(t){return Object.assign(Object.assign({},t),{url:Vi(t.url)})}var da=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class qc{constructor(e){this.contextMenus={},this.handleClick=n=>{var l;const s=this.contextMenus[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return da(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:wn(e.icons),embed:e.embed&&cs(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return da(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var yt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class Yc{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=n=>{const l=this.tools[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(o=>{o&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})},this.handleToolActionClick=n=>{var l;const s=this.toolActions[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.handleToolModeClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(o=>{o&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})},this.handleToolModeToolClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolClick){const s=l.onToolClick(n.context,n.event);Promise.resolve(s).then(o=>{o&&n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDoubleClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolDoubleClick){const s=l.onToolDoubleClick(n.context,n.event);Promise.resolve(s).then(o=>{o&&n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragStart=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragStart)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragEnd=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragEnd)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragCancel=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragCancel)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeActivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onActivate)===null||l===void 0||l.call(s,n.context))},this.handleToolModeDeactivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onDeactivate)===null||l===void 0||l.call(s,n.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return yt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:wn(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return yt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return yt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return yt(this,void 0,void 0,function*(){const{metadata:n}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return n})}setMetadata(e,n){return yt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:n})})}createAction(e){return yt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:wn(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return yt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return yt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:wn(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return yt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,n){return yt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:n})})}}var tn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class zc{constructor(e){this.messageBus=e}open(e){return tn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},cs(e)))})}close(e){return tn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return tn(this,void 0,void 0,function*(){const{width:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return n})}setWidth(e,n){return tn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:n})})}getHeight(e){return tn(this,void 0,void 0,function*(){const{height:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return n})}setHeight(e,n){return tn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:n})})}}var pa=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class Vc{constructor(e){this.messageBus=e}open(e){return pa(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},cs(e)))})}close(e){return pa(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var lt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class jc{constructor(e){this.messageBus=e}getWidth(){return lt(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return lt(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return lt(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return lt(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return lt(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return lt(this,void 0,void 0,function*(){const n=wn([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:n[0].icon})})}getTitle(){return lt(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return lt(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const n=l=>{e(l.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n)}}}var Kc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};os();class Xc{constructor(e){this.messageBus=e}startItemInteraction(e,n=!0){return Kc(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:n});let s=e;return[u=>{const[r,c]=us(s,u);return s=r,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:l,patches:c}),r},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:l})}]})}}var Jc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class Zc{constructor(e){this.messageBus=e}getPlayers(){return Jc(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const n=l=>{e(l.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",n)}}}var El=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class Qc{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return El(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return El(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return El(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",n)}}onPermissionsChange(e){const n=l=>{e(l.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n)}}}var xc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class ef{constructor(e){this.messageBus=e}getTheme(){return xc(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const n=l=>{e(l.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",n)}}}var qn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class tf{constructor(e){this.messageBus=e}uploadImages(e,n){return qn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e,typeHint:n})})}uploadScenes(e,n){return qn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e,disableShowScenes:n})})}downloadImages(e,n,l){return qn(this,void 0,void 0,function*(){const{images:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:e,defaultSearch:n,typeHint:l},-1);return s})}downloadScenes(e,n){return qn(this,void 0,void 0,function*(){const{scenes:l}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:e,defaultSearch:n},-1);return l})}}var nf=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(i){try{c(l.next(i))}catch(d){a(d)}}function r(i){try{c(l.throw(i))}catch(d){a(d)}}function c(i){i.done?o(i.value):s(i.value).then(u,r)}c((l=l.apply(t,e||[])).next())})};class lf{constructor(e){this.messageBus=e}sendMessage(e,n){return nf(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:e,data:n})})}onMessage(e,n){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:e}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${e}`,n),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:e}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${e}`,n)}}}const sf=typeof atob=="function",fs=typeof Buffer=="function",ma=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const of="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",af=Array.prototype.slice.call(of),Yn=(t=>{let e={};return t.forEach((n,l)=>e[n]=l),e})(af),rf=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Ft=String.fromCharCode.bind(String),ha=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),ji=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),uf=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cf=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return Ft((n>>>10)+55296)+Ft((n&1023)+56320);case 3:return Ft((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Ft((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},ff=t=>t.replace(uf,cf),df=t=>{if(t=t.replace(/\s+/g,""),!rf.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",l,s;for(let o=0;o<t.length;)e=Yn[t.charAt(o++)]<<18|Yn[t.charAt(o++)]<<12|(l=Yn[t.charAt(o++)])<<6|(s=Yn[t.charAt(o++)]),n+=l===64?Ft(e>>16&255):s===64?Ft(e>>16&255,e>>8&255):Ft(e>>16&255,e>>8&255,e&255);return n},Ki=sf?t=>atob(ji(t)):fs?t=>Buffer.from(t,"base64").toString("binary"):df,pf=fs?t=>ha(Buffer.from(t,"base64")):t=>ha(Ki(t).split("").map(e=>e.charCodeAt(0))),mf=fs?t=>Buffer.from(t,"base64").toString("utf8"):ma?t=>ma.decode(pf(t)):t=>ff(Ki(t)),hf=t=>ji(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),_f=t=>mf(hf(t));function gf(){const e=new URLSearchParams(window.location.search).get("obrref");let n="",l="";if(e){const o=_f(e).split(" ");o.length===2&&(n=o[0],l=o[1])}return{origin:n,roomId:l}}var _a;(function(t){t[t.MOVE=0]="MOVE",t[t.LINE=1]="LINE",t[t.QUAD=2]="QUAD",t[t.CONIC=3]="CONIC",t[t.CUBIC=4]="CUBIC",t[t.CLOSE=5]="CLOSE"})(_a||(_a={}));const Wl=gf(),Je=new Ac(Wl.origin,Wl.roomId),bf=new fc(Je),yf=new cc(Je),vf=new Zc(Je),wf=new Ec(Je),Tf=new Uc(Je),kf=new qc(Je),Cf=new Yc(Je),Af=new zc(Je),Ef=new Vc(Je),Sf=new jc(Je),Bf=new Xc(Je),Of=new Qc(Je),Rf=new ef(Je),Mf=new tf(Je),If=new lf(Je),ze={onReady:t=>{Je.ready?t():Je.once("OBR_READY",()=>t())},get isReady(){return Je.ready},viewport:bf,player:yf,party:vf,notification:wf,scene:Tf,contextMenu:kf,tool:Cf,popover:Af,modal:Ef,action:Sf,interaction:Bf,room:Of,theme:Rf,assets:Mf,broadcast:If,isAvailable:!!Wl.origin},$f=50,ds=st([]);function Nf(t){ds.update(e=>(e.push({msg:t,timestamp:new Date}),e.length>$f&&e.shift(),e))}function Df(){ds.set([])}const ll=8,rt=st(1);function Lf(t){const e=JSON.parse(t);if(e.schemaType===Ri){const n=e;return Xi(n),n}else return Pf(e)}function Xi(t){var n;t.customGear||(t.customGear=[]),t.customBonuses||(t.customBonuses=[]),t.customTalents||(t.customTalents=[]),t.customLanguages||(t.customLanguages=[]);const e=(n=t.gear)==null?void 0:n.findIndex(l=>l.name==="Crawling Kit");e&&e>-1&&t.gear.splice(e,1),t.customGear&&t.customGear.forEach(l=>{l.editable=!0}),t.customSpells&&t.customSpells.forEach(l=>{l.editable=!0}),t.bonuses&&t.bonuses.forEach(l=>{l.editable=!0}),t.class==="Level 0"&&(t.class=""),xl(t),al(t),il(t),Ql(t),Ji(t)}function Pf(t){const e=Gf(t),n=[];for(const u of t.gear){const r=Ve(u.name);r&&n.push({name:r.name,quantity:u.quantity})}const l=t.languages.split(",").map(u=>u.trim()).filter(u=>u!=="None"),s=t.bonuses.filter(u=>!u.name.includes("Spell:")&&!u.bonusName.includes("StatBonus")&&!u.bonusTo.includes("Languages")).map(Hf).flat(),o=t.class==="Level 0"?"":t.class,a={name:t.name,ancestry:t.ancestry,hasCustomAncestry:!Il.includes(t.ancestry),class:o,hasCustomClass:!an.includes(o),level:t.level,notes:"",title:t.title,alignment:t.alignment,background:t.background,deity:t.deity,gear:n,customGear:[],stats:t.stats,bonuses:s,customBonuses:[],customTalents:[],maxHitPoints:t.maxHitPoints,hitPoints:t.maxHitPoints,armorClass:10,gearSlotsTotal:t.gearSlotsTotal,gold:t.gold,silver:t.silver,copper:t.copper,languages:l,customLanguages:[],xp:0,spells:e,customSpells:[]};return al(a),il(a),Ql(a),xl(a),Ji(a),a}function Hf(t){const e={name:t.name,bonusSource:t.sourceType};if(t.bonusName==="Plus1ToCastingSpells")return{bonusTo:"spellcastRoll",desc:"+1 to spellcasting checks",l10n:{name:"施法優勢",desc:"施法檢定 +1"},bonusAmount:1,type:"modifyAmt",...e};if(t.name==="WeaponMastery")return[{bonusTo:"attackRoll",type:"modifyAmt",desc:`${t.bonusTo}: +1 to attack rolls`,l10n:{name:`${t.bonusTo}: 攻擊 +1`,desc:`${t.bonusTo}: 攻擊檢定 +1`},bonusAmount:1,bonusIncreaseRatePerLevel:.5,metadata:{type:"weapon",weapon:t.bonusTo},...e},{bonusTo:"damageRoll",type:"modifyAmt",desc:`${t.bonusTo}: +1 to damage rolls`,l10n:{name:`${t.bonusTo}: 傷害 +1`,desc:`${t.bonusTo}: 傷害 +1`},bonusAmount:1,bonusIncreaseRatePerLevel:.5,metadata:{type:"weapon",weapon:t.bonusTo},...e}];if(t.name==="Grit")return{bonusTo:"statRoll",type:"advantage",desc:`Advantage on ${t.bonusName} checks`,l10n:{name:`${t.bonusName} 優勢`,desc:`${t.bonusName} 檢定優勢`},metadata:{type:"stat",stat:"STR"},...e};if(t.name==="ArmorMaster")return{bonusTo:"armorClass",type:"modifyAmt",bonusAmount:1,metadata:{type:"armor",armor:t.bonusTo},desc:`+1 AC from ${t.bonusTo} armor`,l10n:{name:"盔甲大師",desc:`穿著 ${t.bonusTo} 獲得 +1 AC`},...e};if(t.name==="BackStabIncrease")return{bonusTo:"backstabDice",type:"modifyAmt",bonusAmount:1,desc:"Your backstab deals +1 dice of damage",l10n:{name:"背刺強化",desc:"背刺傷害增加一骰"},...e};if(t.name==="AdvOnInitiative")return{bonusTo:"initiativeRoll",type:"advantage",desc:"Advantage on Initiative rolls",l10n:{name:"先攻優勢",desc:"先攻檢定優勢"},...e};if(t.name==="Plus1ToHit")return[{bonusTo:"attackRoll",type:"modifyAmt",bonusAmount:1,desc:"+1 to melee attacks",l10n:{name:"近戰攻擊 +1",desc:"近戰攻擊檢定 +1"},metadata:{type:"weaponType",weaponType:"Melee"},...e},{bonusTo:"attackRoll",type:"modifyAmt",bonusAmount:1,desc:"+1 to ranged attacks",l10n:{name:"遠程攻擊 +1",desc:"遠程攻擊檢定 +1"},metadata:{type:"weaponType",weaponType:"Ranged"},...e}];if(t.name==="AdvOnCastOneSpell")return{bonusTo:"spellcastRoll",type:"advantage",desc:`Advantage to cast spell: ${t.bonusTo}`,l10n:{name:"施法優勢",desc:`施展法術 ${t.bonusTo} 時具有優勢`},metadata:{type:"spell",spell:t.bonusName},...e};if(t.name==="SetWeaponTypeDamage"){const[n]=t.bonusTo.split(":");return{type:"diceType",bonusTo:"damageRoll",desc:`Use a d12 for damage rolls for ${n}s`,l10n:{name:"傷害強化",desc:`${n} 的傷害骰改為 d12`},diceType:"d12",metadata:{type:"weapon",weapon:n},...e}}else if(t.name==="Plus1ToHitAndDamage"){const n=t.bonusTo.toLowerCase().includes("ranged")?"Ranged":"Melee";return[{bonusTo:"attackRoll",type:"modifyAmt",desc:`${n}: +1 to attack rolls`,l10n:{name:`${n}: 攻擊 +1`,desc:`${n}攻擊檢定 +1`},bonusAmount:1,metadata:{type:"weaponType",weaponType:n},...e},{bonusTo:"damageRoll",type:"modifyAmt",desc:`${n}: +1 to damage rolls`,l10n:{name:`${n}: 傷害 +1`,desc:`${n}傷害 +1`},bonusAmount:1,metadata:{type:"weaponType",weaponType:n},...e}]}else if(t.name==="ReduceHerbalismDC")return{type:"generic",desc:"Reduce the difficulty of your herbalism checks by one step",l10n:{name:"草藥學",desc:"草藥學檢定難度降低一階"},...e};return[]}function Ji(t){t.bonuses.map(e=>e.metadata).filter(e=>!!e&&e.type==="weapon").forEach(e=>{e.weapon==="Bastard sword"&&(e.weapon="Bastard Sword")})}function Gf(t){const e=[];return t.bonuses.forEach(async n=>{if(n.name.includes("Spell:")||n.name==="LearnExtraSpell"){const l=Zl(n.bonusName);l&&e.push(l)}}),e}const Fl=st(!1),ga=es(Zi,2e3,()=>Fl.set(!0),()=>Fl.set(!1));async function Wf(){for(let t=0;t<ll;t++)await kt.removeItem(fl(t+1))}async function Ff(){rt.subscribe(t=>ga(Ge(be),t)),be.subscribe(t=>ga(t,Ge(rt))),rt.subscribe(async t=>{be.set(await er(t))}),rt.set(await Qi()),rt.subscribe(xi)}async function Zi(t,e){kt.setItem(fl(e),JSON.stringify(t))}function fl(t){return`sd-character-sheet-slot-${t}`}async function Qi(){return parseInt(await kt.getItem("sd-character-sheet-chosen-slot")??"1")}async function xi(t){kt.setItem("sd-character-sheet-chosen-slot",`${t}`)}async function er(t){await Uf(t);const e=await kt.getItem(fl(t));if(!e)return Rt();const n=JSON.parse(e);return Xi(n),n}async function Uf(t){const e="sd-character-sheet",n=await kt.getItem(e);n&&(await kt.setItem(fl(t),n),await kt.removeItem(e))}const kt={setItem:async function(t,e){return Promise.resolve().then(function(){window.localStorage.setItem(t,e)})},getItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.getItem(t)})},removeItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.removeItem(t)})}},qf="com.maxpaulus.sd-character-sheet",bn=st({}),pn=st({});function cn(t){return`${qf}/${t}`}const Mt=st(!1),Tn=st([]),vt=st(),In=st(),ps=st(),sn=Tr(vt,t=>t==Ge(In));async function tr(){ze.onReady(async()=>{Mt.set(await ze.player.getRole()==="GM"),Yf(),Ge(Mt)&&zf(),ba()})}function Yf(){ze.broadcast.onMessage(lr,({data:t})=>{typeof t=="string"&&ql(t)})}async function zf(){In.set(ze.player.id),vt.set(ze.player.id),ze.player.onChange(t=>{ps.set(t)}),ze.party.onChange(t=>{Tn.set(t)}),Tn.subscribe(async t=>{const e={};e[ze.player.id]=(await ze.player.getMetadata())[cn("sheetData")];for(const l of t)e[l.id]=l.metadata[cn("sheetData")];bn.set(e);const n=Ge(vt);t.find(l=>l.id===n)||vt.set(ze.player.id)}),bn.subscribe(t=>{var l;const e=Ge(rt),n=Ge(vt);be.set(((l=t[n])==null?void 0:l[`slot-${e}`])??Rt())}),rt.subscribe(t=>{var l;const e=Ge(bn),n=Ge(vt);be.set(((l=e[n])==null?void 0:l[`slot-${t}`])??Rt())}),vt.subscribe(t=>{var l;const e=Ge(bn),n=Ge(rt);be.set(((l=e[t])==null?void 0:l[`slot-${n}`])??Rt())}),Tn.set(await ze.party.getPlayers())}async function ba(){rt.set(await Qi());const t={};for(let e=1;e<=ll;e++)t[`slot-${e}`]=await er(e)??Rt();pn.set(t),be.subscribe(es(e=>{if(Ge(Mt)&&!Ge(sn))return;const n=Ge(pn),l=Ge(rt);Zi(e,l),n[`slot-${l}`]=e,pn.set(n)},1e3)),rt.subscribe(e=>{if(Ge(Mt)&&!Ge(sn))return;xi(e);const n=Ge(pn);be.set(n[`slot-${e}`])}),pn.subscribe(e=>{if(Ge(Mt)){if(!Ge(sn))return;const n=Ge(bn),l=Ge(In);n[l]=e}ze.player.setMetadata({[cn("sheetData")]:e})})}const Vf=Object.freeze(Object.defineProperty({__proto__:null,GmId:In,GmPlayer:ps,PartyStore:Tn,TrackedPlayer:vt,init:tr,isGM:Mt,isTrackedPlayerGM:sn,pluginId:cn},Symbol.toStringTag,{value:"Module"})),nr="sd-character-sheet-local-settings";function Ul(){return{popoverDuration:5}}const on=st(Ul());async function jf(){on.set(await Kf()),on.subscribe(t=>{if(t.popoverDuration<0){on.set({...t,popoverDuration:0});return}kt.setItem(nr,JSON.stringify(t))})}async function Kf(){try{const t=await kt.getItem(nr);return JSON.parse(t)??Ul()}catch{return console.error("couldn't load settings from local storage"),Ul()}}const lr=cn("notification");async function zn(t,e={}){if(!ze.isAvailable){alert(t);return}const l=`${await ze.player.getName()}: ${t}`;e.secret?ql(`Secret: ${l}`):(ze.broadcast.sendMessage(lr,l),ql(l))}let Vn;async function ql(t){Nf(t);const e=cn("popover");Vn&&(clearTimeout(Vn),Vn=null);try{await ze.popover.open({id:e,url:`/owlbear-shadowdark-character-sheet_CHT/popover.html?msg=${encodeURIComponent(t)}`,height:100,width:400}),Vn=setTimeout(()=>{ze.popover.close(e)},(Ge(on).popoverDuration??5)*1e3)}catch{alert(t)}}function Xf(t){let e,n=Sn(t[0])+"",l;return{c(){e=p("div"),l=G(n),m(e,"class","rounded-md bg-black text-white p-1")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&1&&n!==(n=Sn(s[0])+"")&&te(l,n)},d(s){s&&T(e)}}}function ya(t){let e,n;const l=[t[3]];let s={$$slots:{default:[xf]},$$scope:{ctx:t}};for(let o=0;o<l.length;o+=1)s=Xn(s,l[o]);return e=new oc({props:s}),e.$on("click",t[11]),e.$on("clickoutside",t[11]),{c(){ne(e.$$.fragment)},m(o,a){le(e,o,a),n=!0},p(o,a){const u=a&8?Ai(l,[br(o[3])]):{};a&32768&&(u.$$scope={dirty:a,ctx:o}),e.$set(u)},i(o){n||(P(e.$$.fragment,o),n=!0)},o(o){W(e.$$.fragment,o),n=!1},d(o){se(e,o)}}}function Jf(t){let e;return{c(){e=p("div"),e.textContent="秘密擲骰",m(e,"class","text-black")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function Zf(t){let e;return{c(){e=p("div"),e.textContent="優勢擲骰",m(e,"class","text-green-700")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function Qf(t){let e;return{c(){e=p("div"),e.textContent="劣勢擲骰",m(e,"class","text-red-700")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function xf(t){let e,n,l,s,o,a,u,r;return e=new Wn({props:{text:"擲骰"}}),e.$on("click",t[6]),l=new Wn({props:{$$slots:{default:[Jf]},$$scope:{ctx:t}}}),l.$on("click",t[9]),o=new Wn({props:{$$slots:{default:[Zf]},$$scope:{ctx:t}}}),o.$on("click",t[7]),u=new Wn({props:{$$slots:{default:[Qf]},$$scope:{ctx:t}}}),u.$on("click",t[8]),{c(){ne(e.$$.fragment),n=v(),ne(l.$$.fragment),s=v(),ne(o.$$.fragment),a=v(),ne(u.$$.fragment)},m(c,i){le(e,c,i),w(c,n,i),le(l,c,i),w(c,s,i),le(o,c,i),w(c,a,i),le(u,c,i),r=!0},p(c,i){const d={};i&32768&&(d.$$scope={dirty:i,ctx:c}),l.$set(d);const h={};i&32768&&(h.$$scope={dirty:i,ctx:c}),o.$set(h);const y={};i&32768&&(y.$$scope={dirty:i,ctx:c}),u.$set(y)},i(c){r||(P(e.$$.fragment,c),P(l.$$.fragment,c),P(o.$$.fragment,c),P(u.$$.fragment,c),r=!0)},o(c){W(e.$$.fragment,c),W(l.$$.fragment,c),W(o.$$.fragment,c),W(u.$$.fragment,c),r=!1},d(c){se(e,c),c&&T(n),se(l,c),c&&T(s),se(o,c),c&&T(a),se(u,c)}}}function ed(t){let e,n,l,s,o,a;const u=t[14].default,r=kn(u,t,t[15],null),c=r||Xf(t);let i=t[2]&&ya(t);return{c(){e=p("div"),n=p("button"),c&&c.c(),l=v(),i&&i.c(),n.disabled=t[1],m(n,"class","bg-black text-white pt-1 px-1 rounded-md"),Re(n,"opacity-50",t[1]),Re(n,"cursor-not-allowed",t[1])},m(d,h){w(d,e,h),f(e,n),c&&c.m(n,null),f(e,l),i&&i.m(e,null),s=!0,o||(a=[D(n,"click",t[6]),D(n,"contextmenu",gr(t[10])),D(n,"touchstart",t[4]),D(n,"touchend",t[5],{passive:!0})],o=!0)},p(d,[h]){r?r.p&&(!s||h&32768)&&Cn(r,u,d,d[15],s?En(u,d[15],h,null):An(d[15]),null):c&&c.p&&(!s||h&1)&&c.p(d,s?h:-1),(!s||h&2)&&(n.disabled=d[1]),(!s||h&2)&&Re(n,"opacity-50",d[1]),(!s||h&2)&&Re(n,"cursor-not-allowed",d[1]),d[2]?i?(i.p(d,h),h&4&&P(i,1)):(i=ya(d),i.c(),P(i,1),i.m(e,null)):i&&(Ue(),W(i,1,1,()=>{i=null}),qe())},i(d){s||(P(c,d),P(i),s=!0)},o(d){W(c,d),W(i),s=!1},d(d){d&&T(e),c&&c.d(d),i&&i.d(),o=!1,Ye(a)}}}function td(t,e,n){let{$$slots:l={},$$scope:s}=e,{modifier:o=0}=e,{numDice:a=1}=e,{diceType:u="d20"}=e,{disabled:r=!1}=e,c=!1,i={x:0,y:0},d;function h(S){d=setTimeout(()=>{A(S),d=null},500)}function y(){d&&(clearTimeout(d),d=null)}function _(){const S=Ot(u,a),R=`擲出 ${a}${u}: ${S} + ${o} = ${S+o}`;zn(R)}function b(){const S=Ot(u,a),E=Ot(u,a),R=Math.max(S,E),I=`擲出 ${a}${u}: ${S} 與 ${E};
 ${R} + ${o} = ${R+o}`;zn(I)}function g(){const S=Ot(u,a),E=Ot(u,a),R=Math.min(S,E),I=`擲出 ${a}${u}: ${S} 與 ${E};
 ${R} + ${o} = ${R+o}`;zn(I)}function C(){const S=Ot(u,a),R=`擲出 ${a}${u}: ${S} + ${o} = ${S+o}`;zn(R,{secret:!0})}async function A(S){r||(c&&(n(2,c=!1),await new Promise(E=>setTimeout(E,100))),n(3,i={x:S.clientX,y:S.clientY}),n(2,c=!0))}function k(){n(2,c=!1)}return t.$$set=S=>{"modifier"in S&&n(0,o=S.modifier),"numDice"in S&&n(12,a=S.numDice),"diceType"in S&&n(13,u=S.diceType),"disabled"in S&&n(1,r=S.disabled),"$$scope"in S&&n(15,s=S.$$scope)},[o,r,c,i,h,y,_,b,g,C,A,k,a,u,l,s]}class $n extends Ce{constructor(e){super(),Ae(this,e,td,ed,ke,{modifier:0,numDice:12,diceType:13,disabled:1})}}function va(t){let e,n,l;return{c(){e=p("button"),e.innerHTML='<i class="material-icons bg-gray-500 text-white rounded-full text-md p-1 scale-[60%]">close</i>',m(e,"class","absolute right-0")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[3]),n=!0)},p:K,d(s){s&&T(e),n=!1,l()}}}function nd(t){let e,n,l,s,o,a=[{type:"text"},t[1]],u={};for(let c=0;c<a.length;c+=1)u=Xn(u,a[c]);let r=t[0]&&va(t);return{c(){e=p("div"),n=p("input"),l=v(),r&&r.c(),Ds(n,u),Re(n,"svelte-hnbmdk",!0),m(e,"class","relative")},m(c,i){w(c,e,i),f(e,n),n.autofocus&&n.focus(),he(n,t[0]),f(e,l),r&&r.m(e,null),s||(o=D(n,"input",t[2]),s=!0)},p(c,[i]){Ds(n,u=Ai(a,[{type:"text"},i&2&&c[1]])),i&1&&n.value!==c[0]&&he(n,c[0]),Re(n,"svelte-hnbmdk",!0),c[0]?r?r.p(c,i):(r=va(c),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},i:K,o:K,d(c){c&&T(e),r&&r.d(),s=!1,o()}}}function ld(t,e,n){const l=["value"];let s=Ls(e,l),{value:o}=e;function a(){o=this.value,n(0,o)}const u=()=>{n(0,o="")};return t.$$set=r=>{e=Xn(Xn({},e),yr(r)),n(1,s=Ls(e,l)),"value"in r&&n(0,o=r.value)},[o,s,a,u]}class sr extends Ce{constructor(e){super(),Ae(this,e,ld,nd,ke,{value:0})}}function wa(t){let e,n,l,s,o=t[0].stat+"",a;return{c(){e=p("div"),n=p("span"),n.textContent="屬性:",l=v(),s=p("span"),a=G(o),m(n,"class","font-bold")},m(u,r){w(u,e,r),f(e,n),f(e,l),f(e,s),f(s,a)},p(u,r){r&1&&o!==(o=u[0].stat+"")&&te(a,o)},d(u){u&&T(e)}}}function sd(t){let e,n,l;return{c(){e=p("button"),e.textContent="無法學習",m(e,"class","bg-gray-600 text-white w-full p-3"),e.disabled=!0},m(s,o){w(s,e,o),n||(l=D(e,"click",t[12]),n=!0)},p:K,d(s){s&&T(e),n=!1,l()}}}function od(t){let e,n,l;return{c(){e=p("button"),e.textContent="學習",m(e,"class","bg-black text-white w-full p-3")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[11]),n=!0)},p:K,d(s){s&&T(e),n=!1,l()}}}function ad(t){let e,n,l;return{c(){e=p("button"),e.textContent="遺忘",m(e,"class","bg-black text-white w-full p-3")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[10]),n=!0)},p:K,d(s){s&&T(e),n=!1,l()}}}function Ta(t){let e,n,l,s,o;return{c(){e=p("button"),e.innerHTML='<i class="material-icons translate-y-1">delete</i>',n=v(),l=p("button"),l.innerHTML='<i class="material-icons translate-y-1">edit</i>',m(e,"class","bg-black text-white p-3"),m(l,"class","bg-black text-white p-3")},m(a,u){w(a,e,u),w(a,n,u),w(a,l,u),s||(o=[D(e,"click",t[13]),D(l,"click",t[14])],s=!0)},p:K,d(a){a&&T(e),a&&T(n),a&&T(l),s=!1,Ye(o)}}}function ka(t){let e,n,l;function s(a){t[16](a)}let o={$$slots:{header:[rd],default:[id]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ot({props:o}),We.push(()=>je(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(a,u){le(e,a,u),l=!0},p(a,u){const r={};u&262147&&(r.$$scope={dirty:u,ctx:a}),!n&&u&2&&(n=!0,r.showModal=a[1],Ke(()=>n=!1)),e.$set(r)},i(a){l||(P(e.$$.fragment,a),l=!0)},o(a){W(e.$$.fragment,a),l=!1},d(a){se(e,a)}}}function id(t){let e,n;return e=new Di({props:{spellToEdit:t[0]}}),e.$on("finish",t[15]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&1&&(o.spellToEdit=l[0]),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function rd(t){var o;let e,n,l=(((o=t[0].l10n)==null?void 0:o.name)??t[0].name)+"",s;return{c(){e=p("h2"),n=G("編輯法術: "),s=G(l),m(e,"slot","header")},m(a,u){w(a,e,u),f(e,n),f(e,s)},p(a,u){var r;u&1&&l!==(l=(((r=a[0].l10n)==null?void 0:r.name)??a[0].name)+"")&&te(s,l)},d(a){a&&T(e)}}}function ud(t){var Ee,Q,Se,U;let e,n,l,s=(((Ee=t[0].l10n)==null?void 0:Ee.name)??t[0].name)+"",o,a,u,r,c=t[0].tier+"",i,d,h=$l(t[0].class)+"",y,_,b,g,C,A,k,S,E,R=(((Q=t[0].duration.roll)==null?void 0:Q.numDice)??"")+"",$,I=(((Se=t[0].duration.roll)==null?void 0:Se.diceType)??"")+"",O,B=" "+(t[5][t[0].duration.type]??t[0].duration.type),M,Y,x,X,J,oe,fe=(t[6][t[0].range]??t[0].range)+"",ce,V,ve,ee=(((U=t[0].l10n)==null?void 0:U.desc)??t[0].desc)+"",ye,q,ue,ie,j,H,ae,Z,L,re=t[0].stat&&wa(t);function pe(N,F){return F&17&&(ie=null),F&17&&(j=null),ie==null&&(ie=!!Ni(N[4],N[0])),ie?ad:(j==null&&(j=!!Jr(N[4],N[0])),j?od:sd)}let Ie=pe(t,-1),me=Ie(t),_e=t[0].editable&&Ta(t),ge=t[1]&&ka(t);return{c(){e=p("div"),n=p("div"),l=p("span"),o=G(s),a=v(),u=p("span"),r=G("(環階 "),i=G(c),d=G(", "),y=G(h),_=G(")"),b=v(),re&&re.c(),g=v(),C=p("div"),A=p("span"),A.textContent="持續:",k=v(),S=p("span"),E=G(t[3]),$=G(R),O=G(I),M=G(B),Y=G(t[2]),x=v(),X=p("div"),J=p("span"),J.textContent="距離:",oe=p("span"),ce=G(fe),V=v(),ve=p("div"),ye=G(ee),q=v(),ue=p("div"),me.c(),H=v(),_e&&_e.c(),ae=v(),ge&&ge.c(),Z=_t(),m(l,"class","font-bold text-lg"),m(A,"class","font-bold"),m(J,"class","font-bold mr-1"),m(ue,"class","flex gap-1"),m(e,"class","shadow-md border border-gray-200 mb-3 p-2")},m(N,F){w(N,e,F),f(e,n),f(n,l),f(l,o),f(n,a),f(n,u),f(u,r),f(u,i),f(u,d),f(u,y),f(u,_),f(e,b),re&&re.m(e,null),f(e,g),f(e,C),f(C,A),f(C,k),f(C,S),f(S,E),f(S,$),f(S,O),f(S,M),f(S,Y),f(e,x),f(e,X),f(X,J),f(X,oe),f(oe,ce),f(e,V),f(e,ve),f(ve,ye),f(e,q),f(e,ue),me.m(ue,null),f(ue,H),_e&&_e.m(ue,null),w(N,ae,F),ge&&ge.m(N,F),w(N,Z,F),L=!0},p(N,[F]){var Ne,pt,we,Xe;(!L||F&1)&&s!==(s=(((Ne=N[0].l10n)==null?void 0:Ne.name)??N[0].name)+"")&&te(o,s),(!L||F&1)&&c!==(c=N[0].tier+"")&&te(i,c),(!L||F&1)&&h!==(h=$l(N[0].class)+"")&&te(y,h),N[0].stat?re?re.p(N,F):(re=wa(N),re.c(),re.m(e,g)):re&&(re.d(1),re=null),(!L||F&8)&&te(E,N[3]),(!L||F&1)&&R!==(R=(((pt=N[0].duration.roll)==null?void 0:pt.numDice)??"")+"")&&te($,R),(!L||F&1)&&I!==(I=(((we=N[0].duration.roll)==null?void 0:we.diceType)??"")+"")&&te(O,I),(!L||F&1)&&B!==(B=" "+(N[5][N[0].duration.type]??N[0].duration.type))&&te(M,B),(!L||F&4)&&te(Y,N[2]),(!L||F&1)&&fe!==(fe=(N[6][N[0].range]??N[0].range)+"")&&te(ce,fe),(!L||F&1)&&ee!==(ee=(((Xe=N[0].l10n)==null?void 0:Xe.desc)??N[0].desc)+"")&&te(ye,ee),Ie===(Ie=pe(N,F))&&me?me.p(N,F):(me.d(1),me=Ie(N),me&&(me.c(),me.m(ue,H))),N[0].editable?_e?_e.p(N,F):(_e=Ta(N),_e.c(),_e.m(ue,null)):_e&&(_e.d(1),_e=null),N[1]?ge?(ge.p(N,F),F&2&&P(ge,1)):(ge=ka(N),ge.c(),P(ge,1),ge.m(Z.parentNode,Z)):ge&&(Ue(),W(ge,1,1,()=>{ge=null}),qe())},i(N){L||(P(ge),L=!0)},o(N){W(ge),L=!1},d(N){N&&T(e),re&&re.d(),me.d(),_e&&_e.d(),N&&T(ae),ge&&ge.d(N),N&&T(Z)}}}function cd(t,e,n){let l,s,o;Oe(t,$e,E=>n(4,o=E));let{s:a}=e,u=fn(),r=!1;const c={Instant:"瞬間",Round:"回合",Focus:"專注",Minute:"分鐘",Hour:"小時",Day:"天"},i={Self:"自身",Close:"貼身",Near:"近距",Far:"遠距"};function d(E){Zr(o,E),$e.set(o)}function h(E){Qr(o,E),$e.set(o),u("close")}function y(E){eu(o,E),$e.set(o),u("close")}const _=()=>h(a),b=()=>d(a),g=()=>d(a),C=()=>y(a),A=()=>{n(1,r=!0)},k=()=>{n(1,r=!1),n(0,a)};function S(E){r=E,n(1,r)}return t.$$set=E=>{"s"in E&&n(0,a=E.s)},t.$$.update=()=>{t.$$.dirty&1&&n(3,l=a.duration.amt>0?a.duration.amt:"")},n(2,s=""),[a,r,s,l,o,c,i,d,h,y,_,b,g,C,A,k,S]}class or extends Ce{constructor(e){super(),Ae(this,e,cd,ud,ke,{s:0})}}function Ca(t,e,n){const l=t.slice();return l[32]=e[n],l}function Aa(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b,g,C,A,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve,ee,ye,q,ue,ie,j,H,ae,Z,L,re,pe,Ie,me,_e,ge,Ee,Q,Se,U,N,F,Ne,pt,we,Xe,dn;return{c(){e=p("div"),n=p("div"),n.textContent="環階:",l=v(),s=p("input"),o=v(),a=p("label"),a.textContent="1",u=v(),r=p("input"),c=v(),i=p("label"),i.textContent="2",d=v(),h=p("input"),y=v(),_=p("label"),_.textContent="3",b=v(),g=p("input"),C=v(),A=p("label"),A.textContent="4",k=v(),S=p("input"),E=v(),R=p("label"),R.textContent="5",$=v(),I=p("div"),O=p("div"),O.textContent="職業:",B=v(),M=p("input"),Y=v(),x=p("label"),x.textContent="牧師",X=v(),J=p("input"),oe=v(),fe=p("label"),fe.textContent="法師",ce=v(),V=p("input"),ve=v(),ee=p("label"),ee.textContent="其他",ye=v(),q=p("div"),ue=p("div"),ue.textContent="距離:",ie=v(),j=p("input"),H=v(),ae=p("label"),ae.textContent="自身",Z=v(),L=p("input"),re=v(),pe=p("label"),pe.textContent="貼身",Ie=v(),me=p("input"),_e=v(),ge=p("label"),ge.textContent="近距",Ee=v(),Q=p("input"),Se=v(),U=p("label"),U.textContent="遠距",N=v(),F=p("div"),Ne=p("label"),Ne.textContent="自訂",pt=v(),we=p("input"),m(n,"class","font-bold"),m(s,"id","showTier1"),m(s,"type","checkbox"),m(s,"class","svelte-1ep1fgl"),m(a,"for","showTier1"),m(r,"id","showTier2"),m(r,"type","checkbox"),m(r,"class","svelte-1ep1fgl"),m(i,"for","showTier2"),m(h,"id","showTier3"),m(h,"type","checkbox"),m(h,"class","svelte-1ep1fgl"),m(_,"for","showTier3"),m(g,"id","showTier4"),m(g,"type","checkbox"),m(g,"class","svelte-1ep1fgl"),m(A,"for","showTier4"),m(S,"id","showTier5"),m(S,"type","checkbox"),m(S,"class","svelte-1ep1fgl"),m(R,"for","showTier5"),m(e,"class","flex gap-1 items-center"),m(O,"class","font-bold"),m(M,"id","showPriest"),m(M,"type","checkbox"),m(M,"class","svelte-1ep1fgl"),m(x,"for","showPriest"),m(J,"id","showWizard"),m(J,"type","checkbox"),m(J,"class","svelte-1ep1fgl"),m(fe,"for","showWizard"),m(V,"id","showOther"),m(V,"type","checkbox"),m(V,"class","svelte-1ep1fgl"),m(ee,"for","showWizard"),m(I,"class","flex gap-1 items-center"),m(ue,"class","font-bold"),m(j,"id","showSelf"),m(j,"type","checkbox"),m(j,"class","svelte-1ep1fgl"),m(ae,"for","showSelf"),m(L,"id","showClose"),m(L,"type","checkbox"),m(L,"class","svelte-1ep1fgl"),m(pe,"for","showClose"),m(me,"id","showNear"),m(me,"type","checkbox"),m(me,"class","svelte-1ep1fgl"),m(ge,"for","showNear"),m(Q,"id","showFar"),m(Q,"type","checkbox"),m(Q,"class","svelte-1ep1fgl"),m(U,"for","showFar"),m(q,"class","flex gap-1 items-center"),m(Ne,"for","showCustom"),m(Ne,"class","font-bold"),m(we,"id","showCustom"),m(we,"type","checkbox"),m(we,"class","svelte-1ep1fgl"),m(F,"class","flex gap-1 items-center")},m(Me,Le){w(Me,e,Le),f(e,n),f(e,l),f(e,s),s.checked=t[1],f(e,o),f(e,a),f(e,u),f(e,r),r.checked=t[2],f(e,c),f(e,i),f(e,d),f(e,h),h.checked=t[3],f(e,y),f(e,_),f(e,b),f(e,g),g.checked=t[4],f(e,C),f(e,A),f(e,k),f(e,S),S.checked=t[5],f(e,E),f(e,R),w(Me,$,Le),w(Me,I,Le),f(I,O),f(I,B),f(I,M),M.checked=t[6],f(I,Y),f(I,x),f(I,X),f(I,J),J.checked=t[7],f(I,oe),f(I,fe),f(I,ce),f(I,V),V.checked=t[8],f(I,ve),f(I,ee),w(Me,ye,Le),w(Me,q,Le),f(q,ue),f(q,ie),f(q,j),j.checked=t[9],f(q,H),f(q,ae),f(q,Z),f(q,L),L.checked=t[10],f(q,re),f(q,pe),f(q,Ie),f(q,me),me.checked=t[11],f(q,_e),f(q,ge),f(q,Ee),f(q,Q),Q.checked=t[12],f(q,Se),f(q,U),w(Me,N,Le),w(Me,F,Le),f(F,Ne),f(F,pt),f(F,we),we.checked=t[13],Xe||(dn=[D(s,"change",t[19]),D(r,"change",t[20]),D(h,"change",t[21]),D(g,"change",t[22]),D(S,"change",t[23]),D(M,"change",t[24]),D(J,"change",t[25]),D(V,"change",t[26]),D(j,"change",t[27]),D(L,"change",t[28]),D(me,"change",t[29]),D(Q,"change",t[30]),D(we,"change",t[31])],Xe=!0)},p(Me,Le){Le[0]&2&&(s.checked=Me[1]),Le[0]&4&&(r.checked=Me[2]),Le[0]&8&&(h.checked=Me[3]),Le[0]&16&&(g.checked=Me[4]),Le[0]&32&&(S.checked=Me[5]),Le[0]&64&&(M.checked=Me[6]),Le[0]&128&&(J.checked=Me[7]),Le[0]&256&&(V.checked=Me[8]),Le[0]&512&&(j.checked=Me[9]),Le[0]&1024&&(L.checked=Me[10]),Le[0]&2048&&(me.checked=Me[11]),Le[0]&4096&&(Q.checked=Me[12]),Le[0]&8192&&(we.checked=Me[13])},d(Me){Me&&T(e),Me&&T($),Me&&T(I),Me&&T(ye),Me&&T(q),Me&&T(N),Me&&T(F),Xe=!1,Ye(dn)}}}function Ea(t){let e,n,l,s,o;return l=new or({props:{s:t[32]}}),{c(){e=p("li"),n=p("div"),ne(l.$$.fragment),s=v(),m(n,"class","shadow-md border border-gray-200 mb-3 p-2")},m(a,u){w(a,e,u),f(e,n),le(l,n,null),f(e,s),o=!0},p(a,u){const r={};u[0]&32768&&(r.s=a[32]),l.$set(r)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),se(l)}}}function fd(t){let e,n,l,s,o,a,u=t[14]?"隱藏":"顯示",r,c,i,d,h,y,_,b,g;function C($){t[17]($)}let A={placeholder:"搜尋 例如: 燃燒之手",class:"w-full"};t[0]!==void 0&&(A.value=t[0]),l=new sr({props:A}),We.push(()=>je(l,"value",C));let k=t[14]&&Aa(t),S=t[15],E=[];for(let $=0;$<S.length;$+=1)E[$]=Ea(Ca(t,S,$));const R=$=>W(E[$],1,1,()=>{E[$]=null});return{c(){e=p("div"),n=p("div"),ne(l.$$.fragment),o=v(),a=p("button"),r=G(u),c=G(" 過濾器"),i=v(),k&&k.c(),d=v(),h=p("div"),y=p("ol");for(let $=0;$<E.length;$+=1)E[$].c();m(a,"class","blk-btn"),m(n,"class","sticky top-0 flex flex-col bg-white p-3"),m(e,"class","flex flex-col gap-1")},m($,I){w($,e,I),f(e,n),le(l,n,null),f(n,o),f(n,a),f(a,r),f(a,c),f(n,i),k&&k.m(n,null),f(e,d),f(e,h),f(h,y);for(let O=0;O<E.length;O+=1)E[O]&&E[O].m(y,null);_=!0,b||(g=D(a,"click",t[18]),b=!0)},p($,I){const O={};if(!s&&I[0]&1&&(s=!0,O.value=$[0],Ke(()=>s=!1)),l.$set(O),(!_||I[0]&16384)&&u!==(u=$[14]?"隱藏":"顯示")&&te(r,u),$[14]?k?k.p($,I):(k=Aa($),k.c(),k.m(n,null)):k&&(k.d(1),k=null),I[0]&32768){S=$[15];let B;for(B=0;B<S.length;B+=1){const M=Ca($,S,B);E[B]?(E[B].p(M,I),P(E[B],1)):(E[B]=Ea(M),E[B].c(),P(E[B],1),E[B].m(y,null))}for(Ue(),B=S.length;B<E.length;B+=1)R(B);qe()}},i($){if(!_){P(l.$$.fragment,$);for(let I=0;I<S.length;I+=1)P(E[I]);_=!0}},o($){W(l.$$.fragment,$),E=E.filter(Boolean);for(let I=0;I<E.length;I+=1)W(E[I]);_=!1},d($){$&&T(e),se(l),k&&k.d(),Te(E,$),b=!1,g()}}}function dd(t,e,n){let l,s;Oe(t,$e,V=>n(16,s=V));let o="",a=!0,u=!0,r=!0,c=!0,i=!0,d=!0,h=!0,y=!0,_=!0,b=!0,g=!0,C=!0,A=!0,k=!1;function S(V){o=V,n(0,o)}const E=()=>n(14,a=!a);function R(){u=this.checked,n(1,u)}function $(){r=this.checked,n(2,r)}function I(){c=this.checked,n(3,c)}function O(){i=this.checked,n(4,i)}function B(){d=this.checked,n(5,d)}function M(){h=this.checked,n(6,h)}function Y(){y=this.checked,n(7,y)}function x(){_=this.checked,n(8,_)}function X(){b=this.checked,n(9,b)}function J(){g=this.checked,n(10,g)}function oe(){C=this.checked,n(11,C)}function fe(){A=this.checked,n(12,A)}function ce(){k=this.checked,n(13,k)}return t.$$.update=()=>{t.$$.dirty[0]&81919&&n(15,l=Object.values(Kl).concat(s.customSpells??[]).filter(V=>{if(!u&&V.tier===1||!r&&V.tier===2||!c&&V.tier===3||!i&&V.tier===4||!d&&V.tier===5||!h&&V.class==="Priest"||!y&&V.class==="Wizard"||!_&&V.class==="Other"||!b&&V.range==="Self"||!g&&V.range==="Close"||!C&&V.range==="Near"||!A&&V.range==="Far"||k&&!s.customSpells.find(ee=>ee.name===V.name))return!1;const ve=o.toLowerCase();return V.name.toLowerCase().includes(ve)||V.desc.toLowerCase().includes(ve)||V.duration.type.toLowerCase().includes(ve)}))},[o,u,r,c,i,d,h,y,_,b,g,C,A,k,a,l,s,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce]}class pd extends Ce{constructor(e){super(),Ae(this,e,dd,fd,ke,{},null,[-1,-1])}}function md(t){let e,n;return e=new pd({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function hd(t){let e;return{c(){e=p("h1"),e.textContent="法術",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function _d(t){let e,n,l,s,o,a,u;function r(i){t[2](i)}let c={vh:90,$$slots:{header:[hd],default:[md]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ot({props:c}),We.push(()=>je(l,"showModal",r)),{c(){e=p("button"),e.textContent="法術",n=v(),ne(l.$$.fragment),m(e,"class","bg-black text-white p-2 w-full")},m(i,d){w(i,e,d),w(i,n,d),le(l,i,d),o=!0,a||(u=D(e,"click",t[1]),a=!0)},p(i,[d]){const h={};d&8&&(h.$$scope={dirty:d,ctx:i}),!s&&d&1&&(s=!0,h.showModal=i[0],Ke(()=>s=!1)),l.$set(h)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(e),i&&T(n),se(l,i),a=!1,u()}}}function gd(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function o(a){l=a,n(0,l)}return[l,s,o]}class bd extends Ce{constructor(e){super(),Ae(this,e,gd,_d,ke,{})}}function yd(t){let e,n;return e=new or({props:{s:t[0]}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&1&&(o.s=l[0]),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function vd(t){let e,n=t[0].name+"",l;return{c(){e=p("h2"),l=G(n),m(e,"slot","header")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&1&&n!==(n=s[0].name+"")&&te(l,n)},d(s){s&&T(e)}}}function wd(t){let e,n,l,s,o,a,u;function r(i){t[4](i)}let c={$$slots:{header:[vd],default:[yd]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ot({props:c}),We.push(()=>je(l,"showModal",r)),{c(){e=p("button"),e.innerHTML='<i class="material-icons">info</i>',n=v(),ne(l.$$.fragment)},m(i,d){w(i,e,d),w(i,n,d),le(l,i,d),o=!0,a||(u=D(e,"click",t[2]),a=!0)},p(i,[d]){const h={};d&35&&(h.$$scope={dirty:d,ctx:i}),!s&&d&2&&(s=!0,h.showModal=i[1],Ke(()=>s=!1)),l.$set(h)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(e),i&&T(n),se(l,i),a=!1,u()}}}function Td(t,e,n){let{spell:l}=e,s=!1;const o=()=>{n(1,s=!0)},a=()=>{n(1,s=!1)};function u(r){s=r,n(1,s)}return t.$$set=r=>{"spell"in r&&n(0,l=r.spell)},[l,s,o,a,u]}class kd extends Ce{constructor(e){super(),Ae(this,e,Td,wd,ke,{spell:0})}}const{Boolean:Cd}=Ei;function Sa(t,e,n){const l=t.slice();l[6]=e[n];const s=jr(l[1],l[6]);return l[7]=s,l}function Ba(t){let e,n,l=t[0],s=[];for(let a=0;a<l.length;a+=1)s[a]=Oa(Sa(t,l,a));const o=a=>W(s[a],1,1,()=>{s[a]=null});return{c(){e=p("ul");for(let a=0;a<s.length;a+=1)s[a].c();m(e,"class","flex flex-col gap-1")},m(a,u){w(a,e,u);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null);n=!0},p(a,u){if(u&27){l=a[0];let r;for(r=0;r<l.length;r+=1){const c=Sa(a,l,r);s[r]?(s[r].p(c,u),P(s[r],1)):(s[r]=Oa(c),s[r].c(),P(s[r],1),s[r].m(e,null))}for(Ue(),r=l.length;r<s.length;r+=1)o(r);qe()}},i(a){if(!n){for(let u=0;u<l.length;u+=1)P(s[u]);n=!0}},o(a){s=s.filter(Cd);for(let u=0;u<s.length;u+=1)W(s[u]);n=!1},d(a){a&&T(e),Te(s,a)}}}function Oa(t){var S;let e,n,l,s,o=(((S=t[6].l10n)==null?void 0:S.name)??t[6].name)+"",a,u,r,c,i,d,h,y,_,b,g,C,A;r=new kd({props:{spell:t[6]}});function k(){return t[5](t[6])}return _=new $n({props:{disabled:t[4](t[6]),modifier:t[7]}}),{c(){e=p("li"),n=p("div"),l=p("div"),s=p("div"),a=G(o),u=v(),ne(r.$$.fragment),c=v(),i=p("div"),d=p("input"),y=v(),ne(_.$$.fragment),b=v(),m(l,"class","flex gap-1"),m(d,"title","施法失敗"),m(d,"type","checkbox"),m(d,"class","w-6 h-6"),d.checked=h=t[4](t[6]),m(i,"class","flex items-center gap-2"),m(n,"class","flex justify-between border-b border-gray-400 items-center")},m(E,R){w(E,e,R),f(e,n),f(n,l),f(l,s),f(s,a),f(l,u),le(r,l,null),f(n,c),f(n,i),f(i,d),f(i,y),le(_,i,null),f(e,b),g=!0,C||(A=D(d,"click",k),C=!0)},p(E,R){var O;t=E,(!g||R&1)&&o!==(o=(((O=t[6].l10n)==null?void 0:O.name)??t[6].name)+"")&&te(a,o);const $={};R&1&&($.spell=t[6]),r.$set($),(!g||R&1&&h!==(h=t[4](t[6])))&&(d.checked=h);const I={};R&1&&(I.disabled=t[4](t[6])),R&3&&(I.modifier=t[7]),_.$set(I)},i(E){g||(P(r.$$.fragment,E),P(_.$$.fragment,E),g=!0)},o(E){W(r.$$.fragment,E),W(_.$$.fragment,E),g=!1},d(E){E&&T(e),se(r),se(_),C=!1,A()}}}function Ad(t){let e,n,l,s,o,a,u,r,c=t[2]&&Ba(t);return o=new bd({}),u=new nc({}),{c(){e=p("h2"),e.textContent="法術",n=v(),c&&c.c(),l=v(),s=p("div"),ne(o.$$.fragment),a=v(),ne(u.$$.fragment),m(s,"class","flex gap-1")},m(i,d){w(i,e,d),w(i,n,d),c&&c.m(i,d),w(i,l,d),w(i,s,d),le(o,s,null),f(s,a),le(u,s,null),r=!0},p(i,[d]){i[2]?c?(c.p(i,d),d&4&&P(c,1)):(c=Ba(i),c.c(),P(c,1),c.m(l.parentNode,l)):c&&(Ue(),W(c,1,1,()=>{c=null}),qe())},i(i){r||(P(c),P(o.$$.fragment,i),P(u.$$.fragment,i),r=!0)},o(i){W(c),W(o.$$.fragment,i),W(u.$$.fragment,i),r=!1},d(i){i&&T(e),i&&T(n),c&&c.d(i),i&&T(l),i&&T(s),se(o),se(u)}}}function Ed(t,e,n){let l,s,o;Oe(t,$e,c=>n(1,o=c));function a(c){const i=o.spells.findIndex(d=>d.name===c.name);i===-1?o.spells.push({name:c.name,failed:!0}):Fe($e,o.spells[i].failed=!o.spells[i].failed,o),$e.set(o)}function u(c){const i=o.spells.findIndex(d=>d.name===c.name);return i!==-1&&o.spells[i].failed}const r=c=>a(c);return t.$$.update=()=>{t.$$.dirty&2&&n(0,l=o.spells.map(c=>Zl(c.name)).filter(Boolean)),t.$$.dirty&1&&n(2,s=(l==null?void 0:l.length)>0)},[l,o,s,a,u,r]}class Sd extends Ce{constructor(e){super(),Ae(this,e,Ed,Ad,ke,{})}}function Bd(t){let e,n,l,s,o,a,u,r,c;return s=new Sd({}),a=new Xu({}),r=new fu({}),{c(){e=p("h2"),e.textContent="法術 / 加值 / 語言",n=v(),l=p("div"),ne(s.$$.fragment),o=v(),ne(a.$$.fragment),u=v(),ne(r.$$.fragment),m(l,"class","overflow-y-auto")},m(i,d){w(i,e,d),w(i,n,d),w(i,l,d),le(s,l,null),f(l,o),le(a,l,null),f(l,u),le(r,l,null),c=!0},p:K,i(i){c||(P(s.$$.fragment,i),P(a.$$.fragment,i),P(r.$$.fragment,i),c=!0)},o(i){W(s.$$.fragment,i),W(a.$$.fragment,i),W(r.$$.fragment,i),c=!1},d(i){i&&T(e),i&&T(n),i&&T(l),se(s),se(a),se(r)}}}class Od extends Ce{constructor(e){super(),Ae(this,e,null,Bd,ke,{})}}function Rd(t){let e,n,l,s=rn(t[0])+"",o,a,u,r,c,i,d,h,y,_;return d=new $n({props:{modifier:t[2]}}),{c(){e=p("div"),n=p("label"),l=p("h2"),o=G(s),a=v(),u=p("div"),r=p("input"),i=G(" / "),ne(d.$$.fragment),m(r,"id",c=`${t[0]}-input}`),m(r,"type","number"),m(r,"inputmode","numeric"),r.value=t[1],m(r,"min","1"),m(r,"max","20"),m(r,"class","w-1/2"),m(u,"class","sheet-stat flex gap-1"),m(e,"class","flex flex-col")},m(b,g){w(b,e,g),f(e,n),f(n,l),f(l,o),f(n,a),f(n,u),f(u,r),f(u,i),le(d,u,null),h=!0,y||(_=D(r,"input",t[4]),y=!0)},p(b,[g]){(!h||g&1)&&s!==(s=rn(b[0])+"")&&te(o,s),(!h||g&1&&c!==(c=`${b[0]}-input}`))&&m(r,"id",c),(!h||g&2&&r.value!==b[1])&&(r.value=b[1]);const C={};g&4&&(C.modifier=b[2]),d.$set(C)},i(b){h||(P(d.$$.fragment,b),h=!0)},o(b){W(d.$$.fragment,b),h=!1},d(b){b&&T(e),se(d),y=!1,_()}}}function Md(t,e,n){let l,s,o,{forStat:a}=e;const u=be;Oe(t,u,c=>n(5,o=c));function r(c){Fe(u,o.stats[a]=parseInt(c.target.value)-$i(o,a),o)}return t.$$set=c=>{"forStat"in c&&n(0,a=c.forStat)},t.$$.update=()=>{t.$$.dirty&33&&n(2,l=$t(o,a)),t.$$.dirty&33&&n(1,s=Mi(o,a))},[a,s,l,u,r,o]}class nn extends Ce{constructor(e){super(),Ae(this,e,Md,Rd,ke,{forStat:0})}}function Ra(t,e,n){const l=t.slice();l[7]=e[n];const s=l[0].includes(l[7]);return l[8]=s,l}function Ma(t){let e,n,l=(t[3][t[7]]??t[7])+"",s,o,a,u,r;function c(){return t[6](t[7])}return{c(){e=p("button"),n=p("div"),s=G(l),a=v(),m(n,"class",o=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)},m(i,d){w(i,e,d),f(e,n),f(n,s),f(e,a),u||(r=D(e,"click",c),u=!0)},p(i,d){t=i,d&12&&l!==(l=(t[3][t[7]]??t[7])+"")&&te(s,l),d&5&&o!==(o=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)&&m(n,"class",o)},d(i){i&&T(e),u=!1,r()}}}function Id(t){let e,n=t[2],l=[];for(let s=0;s<n.length;s+=1)l[s]=Ma(Ra(t,n,s));return{c(){e=p("div");for(let s=0;s<l.length;s+=1)l[s].c();m(e,"id",t[1]),m(e,"class","w-full flex flex-wrap gap-1")},m(s,o){w(s,e,o);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(s,[o]){if(o&29){n=s[2];let a;for(a=0;a<n.length;a+=1){const u=Ra(s,n,a);l[a]?l[a].p(u,o):(l[a]=Ma(u),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}o&2&&m(e,"id",s[1])},i:K,o:K,d(s){s&&T(e),Te(l,s)}}}function $d(t,e,n){let{id:l="multiSelect"}=e,{values:s=[]}=e,{minSelected:o=0}=e,{options:a=[]}=e,{labels:u={}}=e;function r(i){const d=s.findIndex(h=>h===i);d>=0?s.length>o&&s.splice(d,1):s.push(i),n(0,s)}const c=i=>r(i);return t.$$set=i=>{"id"in i&&n(1,l=i.id),"values"in i&&n(0,s=i.values),"minSelected"in i&&n(5,o=i.minSelected),"options"in i&&n(2,a=i.options),"labels"in i&&n(3,u=i.labels)},[s,l,a,u,r,o,c]}class Yl extends Ce{constructor(e){super(),Ae(this,e,$d,Id,ke,{id:1,values:0,minSelected:5,options:2,labels:3})}}function Ia(t,e,n){const l=t.slice();return l[41]=e[n],l}function $a(t,e,n){const l=t.slice();return l[36]=e[n],l}function Na(t,e,n){const l=t.slice();return l[36]=e[n],l}function Nd(t,e,n){const l=t.slice();return l[44]=e[n],l}function Dd(t){let e,n;return{c(){e=p("option"),n=G(t[44]),e.__value=t[44],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:K,d(l){l&&T(e)}}}function Da(t){let e,n,l,s,o,a,u,r,c,i,d,h,y;const _=[Hd,Pd,Ld],b=[];function g(C,A){return C[1].gearType==="Basic"?0:C[1].gearType==="Weapon"?1:C[1].gearType==="Armor"?2:-1}return~(r=g(t))&&(c=b[r]=_[r](t)),{c(){e=p("label"),e.textContent="裝備類型",n=v(),l=p("select"),s=p("option"),s.textContent="基礎",o=p("option"),o.textContent="武器",a=p("option"),a.textContent="防具",u=v(),c&&c.c(),i=_t(),m(e,"for","gearType"),s.__value="Basic",s.value=s.__value,o.__value="Weapon",o.value=o.__value,a.__value="Armor",a.value=a.__value,m(l,"name","gearType"),t[1].gearType===void 0&&Pe(()=>t[15].call(l))},m(C,A){w(C,e,A),w(C,n,A),w(C,l,A),f(l,s),f(l,o),f(l,a),de(l,t[1].gearType,!0),w(C,u,A),~r&&b[r].m(C,A),w(C,i,A),d=!0,h||(y=D(l,"change",t[15]),h=!0)},p(C,A){A[0]&2&&de(l,C[1].gearType);let k=r;r=g(C),r===k?~r&&b[r].p(C,A):(c&&(Ue(),W(b[k],1,1,()=>{b[k]=null}),qe()),~r?(c=b[r],c?c.p(C,A):(c=b[r]=_[r](C),c.c()),P(c,1),c.m(i.parentNode,i)):c=null)},i(C){d||(P(c),d=!0)},o(C){W(c),d=!1},d(C){C&&T(e),C&&T(n),C&&T(l),C&&T(u),~r&&b[r].d(C),C&&T(i),h=!1,y()}}}function Ld(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b,g,C,A,k,S,E;function R(B){t[28](B)}let $={id:"armorProperties",options:Or,labels:t[6]};t[1].armorProperties!==void 0&&($.values=t[1].armorProperties),l=new Yl({props:$}),We.push(()=>je(l,"values",R));let I=It,O=[];for(let B=0;B<I.length;B+=1)O[B]=La(Ia(t,I,B));return{c(){e=p("label"),e.textContent="防具特性",n=v(),ne(l.$$.fragment),o=v(),a=p("label"),a.textContent="基礎 AC",u=v(),r=p("input"),c=v(),i=p("label"),i.textContent="AC 修正",d=v(),h=p("input"),y=v(),_=p("label"),_.textContent="此防具是否隨屬性調整？",b=v(),g=p("select"),C=p("option"),A=G("否");for(let B=0;B<O.length;B+=1)O[B].c();m(e,"for","armorProperties"),m(a,"for","baseAC"),m(r,"type","number"),m(r,"inputmode","numeric"),m(i,"for","acModifier"),m(h,"type","number"),m(h,"inputmode","numeric"),m(_,"for","armorStat"),C.__value=void 0,C.value=C.__value,m(g,"name",""),m(g,"id",""),t[1].armorStat===void 0&&Pe(()=>t[31].call(g))},m(B,M){w(B,e,M),w(B,n,M),le(l,B,M),w(B,o,M),w(B,a,M),w(B,u,M),w(B,r,M),he(r,t[1].baseAC),w(B,c,M),w(B,i,M),w(B,d,M),w(B,h,M),he(h,t[1].acModifier),w(B,y,M),w(B,_,M),w(B,b,M),w(B,g,M),f(g,C),f(C,A);for(let Y=0;Y<O.length;Y+=1)O[Y]&&O[Y].m(g,null);de(g,t[1].armorStat,!0),k=!0,S||(E=[D(r,"input",t[29]),D(h,"input",t[30]),D(g,"change",t[31])],S=!0)},p(B,M){const Y={};if(!s&&M[0]&2&&(s=!0,Y.values=B[1].armorProperties,Ke(()=>s=!1)),l.$set(Y),M[0]&2&&Be(r.value)!==B[1].baseAC&&he(r,B[1].baseAC),M[0]&2&&Be(h.value)!==B[1].acModifier&&he(h,B[1].acModifier),M&0){I=It;let x;for(x=0;x<I.length;x+=1){const X=Ia(B,I,x);O[x]?O[x].p(X,M):(O[x]=La(X),O[x].c(),O[x].m(g,null))}for(;x<O.length;x+=1)O[x].d(1);O.length=I.length}M[0]&2&&de(g,B[1].armorStat)},i(B){k||(P(l.$$.fragment,B),k=!0)},o(B){W(l.$$.fragment,B),k=!1},d(B){B&&T(e),B&&T(n),se(l,B),B&&T(o),B&&T(a),B&&T(u),B&&T(r),B&&T(c),B&&T(i),B&&T(d),B&&T(h),B&&T(y),B&&T(_),B&&T(b),B&&T(g),Te(O,B),S=!1,Ye(E)}}}function Pd(t){let e,n,l,s,o,a,u,r,c,i,d,h,y=t[1].weaponProperties.includes("Magic"),_,b,g,C,A,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve,ee,ye,q,ue,ie,j,H,ae,Z,L,re;function pe(N){t[19](N)}let Ie={id:"weaponProperties",options:Mr,labels:t[4]};t[1].weaponProperties!==void 0&&(Ie.values=t[1].weaponProperties),i=new Yl({props:Ie}),We.push(()=>je(i,"values",pe));let me=y&&Pa(t);function _e(N){t[21](N)}let ge={id:"ranges",minSelected:1,options:Ol,labels:t[5]};t[1].weaponRanges!==void 0&&(ge.values=t[1].weaponRanges),C=new Yl({props:ge}),We.push(()=>je(C,"values",_e));let Ee=wt,Q=[];for(let N=0;N<Ee.length;N+=1)Q[N]=Ha(Na(t,Ee,N));let Se=wt,U=[];for(let N=0;N<Se.length;N+=1)U[N]=Ga($a(t,Se,N));return{c(){e=p("label"),e.textContent="武器類型",n=v(),l=p("select"),s=p("option"),s.textContent="近戰",o=p("option"),o.textContent="遠程",a=p("option"),a.textContent="近戰或遠程",u=v(),r=p("label"),r.textContent="武器特性",c=v(),ne(i.$$.fragment),h=v(),me&&me.c(),_=v(),b=p("label"),b.textContent="距離",g=v(),ne(C.$$.fragment),k=v(),S=p("label"),S.innerHTML='傷害<span class="text-red-700">*</span>',E=v(),R=p("div"),$=p("input"),I=v(),O=p("div"),B=p("div"),B.textContent="單手:",M=v(),Y=p("input"),X=v(),J=p("select");for(let N=0;N<Q.length;N+=1)Q[N].c();fe=v(),ce=p("div"),V=p("input"),ve=v(),ee=p("div"),ye=p("div"),ye.textContent="雙手:",q=v(),ue=p("input"),j=v(),H=p("select");for(let N=0;N<U.length;N+=1)U[N].c();m(e,"for",""),s.__value="Melee",s.value=s.__value,o.__value="Ranged",o.value=o.__value,a.__value="MeleeRanged",a.value=a.__value,m(l,"name",""),m(l,"id",""),t[1].weaponType===void 0&&Pe(()=>t[18].call(l)),m(r,"for","weaponProperties"),m(b,"for","range"),m(S,"for","damage"),m($,"type","checkbox"),m($,"class","svelte-qhgyyp"),Y.disabled=x=!t[1].hasOneHandedAttack,m(Y,"type","number"),m(Y,"inputmode","numeric"),m(Y,"class","w-10 text-center"),m(J,"name",""),m(J,"id",""),J.disabled=oe=!t[1].hasOneHandedAttack,t[1].oneHandedDiceType===void 0&&Pe(()=>t[24].call(J)),m(O,"class","flex gap-1 items-center"),Re(O,"opacity-25",!t[1].hasOneHandedAttack),m(R,"class","flex gap-1 items-center"),m(V,"type","checkbox"),m(V,"class","svelte-qhgyyp"),ue.disabled=ie=!t[1].hasTwoHandedAttack,m(ue,"type","number"),m(ue,"inputmode","numeric"),m(ue,"class","w-10 text-center"),m(H,"name",""),m(H,"id",""),H.disabled=ae=!t[1].hasTwoHandedAttack,t[1].twoHandedDiceType===void 0&&Pe(()=>t[27].call(H)),m(ee,"class","flex gap-1 items-center"),Re(ee,"opacity-25",!t[1].hasTwoHandedAttack),m(ce,"class","flex gap-1 items-center")},m(N,F){w(N,e,F),w(N,n,F),w(N,l,F),f(l,s),f(l,o),f(l,a),de(l,t[1].weaponType,!0),w(N,u,F),w(N,r,F),w(N,c,F),le(i,N,F),w(N,h,F),me&&me.m(N,F),w(N,_,F),w(N,b,F),w(N,g,F),le(C,N,F),w(N,k,F),w(N,S,F),w(N,E,F),w(N,R,F),f(R,$),$.checked=t[1].hasOneHandedAttack,f(R,I),f(R,O),f(O,B),f(O,M),f(O,Y),he(Y,t[1].oneHandedNumDice),f(O,X),f(O,J);for(let Ne=0;Ne<Q.length;Ne+=1)Q[Ne]&&Q[Ne].m(J,null);de(J,t[1].oneHandedDiceType,!0),w(N,fe,F),w(N,ce,F),f(ce,V),V.checked=t[1].hasTwoHandedAttack,f(ce,ve),f(ce,ee),f(ee,ye),f(ee,q),f(ee,ue),he(ue,t[1].twoHandedNumDice),f(ee,j),f(ee,H);for(let Ne=0;Ne<U.length;Ne+=1)U[Ne]&&U[Ne].m(H,null);de(H,t[1].twoHandedDiceType,!0),Z=!0,L||(re=[D(l,"change",t[18]),D($,"change",t[22]),D(Y,"input",t[23]),D(J,"change",t[24]),D(V,"change",t[25]),D(ue,"input",t[26]),D(H,"change",t[27])],L=!0)},p(N,F){F[0]&2&&de(l,N[1].weaponType);const Ne={};!d&&F[0]&2&&(d=!0,Ne.values=N[1].weaponProperties,Ke(()=>d=!1)),i.$set(Ne),F[0]&2&&(y=N[1].weaponProperties.includes("Magic")),y?me?me.p(N,F):(me=Pa(N),me.c(),me.m(_.parentNode,_)):me&&(me.d(1),me=null);const pt={};if(!A&&F[0]&2&&(A=!0,pt.values=N[1].weaponRanges,Ke(()=>A=!1)),C.$set(pt),F[0]&2&&($.checked=N[1].hasOneHandedAttack),(!Z||F[0]&2&&x!==(x=!N[1].hasOneHandedAttack))&&(Y.disabled=x),F[0]&2&&Be(Y.value)!==N[1].oneHandedNumDice&&he(Y,N[1].oneHandedNumDice),F&0){Ee=wt;let we;for(we=0;we<Ee.length;we+=1){const Xe=Na(N,Ee,we);Q[we]?Q[we].p(Xe,F):(Q[we]=Ha(Xe),Q[we].c(),Q[we].m(J,null))}for(;we<Q.length;we+=1)Q[we].d(1);Q.length=Ee.length}if((!Z||F[0]&2&&oe!==(oe=!N[1].hasOneHandedAttack))&&(J.disabled=oe),F[0]&2&&de(J,N[1].oneHandedDiceType),(!Z||F[0]&2)&&Re(O,"opacity-25",!N[1].hasOneHandedAttack),F[0]&2&&(V.checked=N[1].hasTwoHandedAttack),(!Z||F[0]&2&&ie!==(ie=!N[1].hasTwoHandedAttack))&&(ue.disabled=ie),F[0]&2&&Be(ue.value)!==N[1].twoHandedNumDice&&he(ue,N[1].twoHandedNumDice),F&0){Se=wt;let we;for(we=0;we<Se.length;we+=1){const Xe=$a(N,Se,we);U[we]?U[we].p(Xe,F):(U[we]=Ga(Xe),U[we].c(),U[we].m(H,null))}for(;we<U.length;we+=1)U[we].d(1);U.length=Se.length}(!Z||F[0]&2&&ae!==(ae=!N[1].hasTwoHandedAttack))&&(H.disabled=ae),F[0]&2&&de(H,N[1].twoHandedDiceType),(!Z||F[0]&2)&&Re(ee,"opacity-25",!N[1].hasTwoHandedAttack)},i(N){Z||(P(i.$$.fragment,N),P(C.$$.fragment,N),Z=!0)},o(N){W(i.$$.fragment,N),W(C.$$.fragment,N),Z=!1},d(N){N&&T(e),N&&T(n),N&&T(l),N&&T(u),N&&T(r),N&&T(c),se(i,N),N&&T(h),me&&me.d(N),N&&T(_),N&&T(b),N&&T(g),se(C,N),N&&T(k),N&&T(S),N&&T(E),N&&T(R),Te(Q,N),N&&T(fe),N&&T(ce),Te(U,N),L=!1,Ye(re)}}}function Hd(t){let e,n,l,s,o,a,u,r,c=t[1].canBeEquipped&&Wa(t);return{c(){e=p("div"),n=p("input"),l=v(),s=p("label"),s.textContent="可裝備？",o=v(),c&&c.c(),a=_t(),m(n,"id","canBeEquipped"),m(n,"type","checkbox"),m(n,"class","svelte-qhgyyp"),m(s,"for","canBeEquipped"),m(e,"class","flex gap-1")},m(i,d){w(i,e,d),f(e,n),n.checked=t[1].canBeEquipped,f(e,l),f(e,s),w(i,o,d),c&&c.m(i,d),w(i,a,d),u||(r=D(n,"change",t[16]),u=!0)},p(i,d){d[0]&2&&(n.checked=i[1].canBeEquipped),i[1].canBeEquipped?c?c.p(i,d):(c=Wa(i),c.c(),c.m(a.parentNode,a)):c&&(c.d(1),c=null)},i:K,o:K,d(i){i&&T(e),i&&T(o),c&&c.d(i),i&&T(a),u=!1,r()}}}function La(t){let e,n=rn(t[41])+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[41],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Pa(t){let e,n,l,s,o,a;return{c(){e=p("div"),n=p("label"),n.textContent="魔法武器修正: +",l=v(),s=p("input"),m(n,"for","magicWeaponModifier"),m(s,"id","magicWeaponModifier"),m(s,"type","number"),m(s,"min","0"),m(s,"inputmode","numeric"),m(s,"class","w-10 text-center"),m(e,"class","flex flex-row gap-1 items-center")},m(u,r){w(u,e,r),f(e,n),f(e,l),f(e,s),he(s,t[1].magicWeaponModifier),o||(a=D(s,"input",t[20]),o=!0)},p(u,r){r[0]&2&&Be(s.value)!==u[1].magicWeaponModifier&&he(s,u[1].magicWeaponModifier)},d(u){u&&T(e),o=!1,a()}}}function Ha(t){let e,n=t[36]+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[36],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Ga(t){let e,n=t[36]+"",l;return{c(){e=p("option"),l=G(n),e.__value=t[36],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:K,d(s){s&&T(e)}}}function Wa(t){let e,n,l,s,o,a;return{c(){e=p("div"),n=p("input"),l=v(),s=p("label"),s.innerHTML='裝備時顯示於 <span class="pirata text-lg">攻擊</span> 列表？',m(n,"id","attackable"),m(n,"type","checkbox"),m(n,"class","svelte-qhgyyp"),m(s,"for","attackable"),m(e,"class","flex gap-1 items-center")},m(u,r){w(u,e,r),f(e,n),n.checked=t[1].attackable,f(e,l),f(e,s),o||(a=D(n,"change",t[17]),o=!0)},p(u,r){r[0]&2&&(n.checked=u[1].attackable)},d(u){u&&T(e),o=!1,a()}}}function Gd(t){let e;return{c(){e=G("新增")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Wd(t){let e;return{c(){e=G("更新")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Fd(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b,g,C,A,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve,ee=["gp","sp","cp"],ye=[];for(let H=0;H<3;H+=1)ye[H]=Dd(Nd(t,ee,H));let q=t[1].showAdvanced&&Da(t);function ue(H,ae){return H[0]?Wd:Gd}let ie=ue(t),j=ie(t);return{c(){e=p("div"),n=p("label"),n.innerHTML='名稱<span class="text-red-700">*</span>',l=v(),s=p("input"),o=v(),a=p("label"),a.textContent="格數",u=v(),r=p("input"),c=v(),i=p("label"),i.textContent="每格數量",d=v(),h=p("input"),y=v(),_=p("label"),_.textContent="價格",b=v(),g=p("input"),C=v(),A=p("label"),A.textContent="貨幣",k=v(),S=p("select");for(let H=0;H<3;H+=1)ye[H].c();E=v(),R=p("label"),R.innerHTML='數量<span class="text-red-700">*</span>',$=v(),I=p("input"),O=v(),B=p("div"),M=p("input"),Y=v(),x=p("label"),x.textContent="進階選項",X=v(),q&&q.c(),J=v(),oe=p("button"),j.c(),m(n,"for","name"),m(s,"id","name"),m(s,"type","text"),m(a,"for","slots"),m(r,"id","slots"),m(r,"type","number"),m(r,"inputmode","numeric"),m(r,"min","0"),m(i,"for","perSlot"),m(h,"id","perSlot"),m(h,"type","number"),m(h,"inputmode","numeric"),m(h,"min","1"),m(_,"for","cost"),m(g,"id","cost"),m(g,"type","number"),m(g,"inputmode","numeric"),m(g,"min","0"),m(A,"for","currency"),m(S,"id","currency"),t[1].currency===void 0&&Pe(()=>t[12].call(S)),m(R,"for","quantity"),m(I,"id","quantity"),m(I,"type","number"),m(I,"inputmode","numeric"),m(I,"min","1"),m(M,"id","showAdvanced"),m(M,"type","checkbox"),m(M,"class","svelte-qhgyyp"),m(x,"for","showAdvanced"),m(B,"class","flex gap-1 items-center"),m(oe,"class","px-3 hover:bg-gray-400 bg-black text-white p-2"),oe.disabled=fe=!t[2],Re(oe,"opacity-50",!t[2]),m(e,"class","flex flex-col gap-1")},m(H,ae){w(H,e,ae),f(e,n),f(e,l),f(e,s),he(s,t[1].name),f(e,o),f(e,a),f(e,u),f(e,r),he(r,t[1].slots),f(e,c),f(e,i),f(e,d),f(e,h),he(h,t[1].quantityPerSlot),f(e,y),f(e,_),f(e,b),f(e,g),he(g,t[1].cost),f(e,C),f(e,A),f(e,k),f(e,S);for(let Z=0;Z<3;Z+=1)ye[Z]&&ye[Z].m(S,null);de(S,t[1].currency,!0),f(e,E),f(e,R),f(e,$),f(e,I),he(I,t[1].quantity),f(e,O),f(e,B),f(B,M),M.checked=t[1].showAdvanced,f(B,Y),f(B,x),f(e,X),q&&q.m(e,null),f(e,J),f(e,oe),j.m(oe,null),ce=!0,V||(ve=[D(s,"input",t[8]),D(r,"input",t[9]),D(h,"input",t[10]),D(g,"input",t[11]),D(S,"change",t[12]),D(I,"input",t[13]),D(M,"change",t[14]),D(oe,"click",t[3])],V=!0)},p(H,ae){ae[0]&2&&s.value!==H[1].name&&he(s,H[1].name),ae[0]&2&&Be(r.value)!==H[1].slots&&he(r,H[1].slots),ae[0]&2&&Be(h.value)!==H[1].quantityPerSlot&&he(h,H[1].quantityPerSlot),ae[0]&2&&Be(g.value)!==H[1].cost&&he(g,H[1].cost),ae[0]&2&&de(S,H[1].currency),ae[0]&2&&Be(I.value)!==H[1].quantity&&he(I,H[1].quantity),ae[0]&2&&(M.checked=H[1].showAdvanced),H[1].showAdvanced?q?(q.p(H,ae),ae[0]&2&&P(q,1)):(q=Da(H),q.c(),P(q,1),q.m(e,J)):q&&(Ue(),W(q,1,1,()=>{q=null}),qe()),ie!==(ie=ue(H))&&(j.d(1),j=ie(H),j&&(j.c(),j.m(oe,null))),(!ce||ae[0]&4&&fe!==(fe=!H[2]))&&(oe.disabled=fe),(!ce||ae[0]&4)&&Re(oe,"opacity-50",!H[2])},i(H){ce||(P(q),ce=!0)},o(H){W(q),ce=!1},d(H){H&&T(e),Te(ye,H),q&&q.d(),j.d(),V=!1,Ye(ve)}}}function Ud(t){var n;if(!t)return 0;let e=(n=t==null?void 0:t.playerBonuses)==null?void 0:n.find(l=>l.type==="modifyAmt"&&l.bonusTo==="attackRoll");return(e==null?void 0:e.bonusAmount)??0}function qd(t){if(!t)return["Close"];const e=t.range;return Array.isArray(e)?e:[e]}function Yd(t,e,n){var q,ue,ie,j,H,ae,Z,L,re,pe,Ie,me,_e,ge,Ee,Q,Se;let l,s,o;Oe(t,$e,U=>n(33,o=U));const a=fn();let{gear:u=void 0}=e;const r=o.gear.find(U=>U.name===(u==null?void 0:u.name)),c={name:(u==null?void 0:u.name)??void 0,slots:((q=u==null?void 0:u.slots)==null?void 0:q.slotsUsed)??1,cost:((ue=u==null?void 0:u.cost)==null?void 0:ue.gp)??0,currency:"gp",quantity:(r==null?void 0:r.quantity)??1,quantityPerSlot:((ie=u==null?void 0:u.slots)==null?void 0:ie.perSlot)??1,showAdvanced:(u==null?void 0:u.type)!==void 0&&(u==null?void 0:u.type)!=="Basic",gearType:(u==null?void 0:u.type)??"Basic",canBeEquipped:(u==null?void 0:u.canBeEquipped)??!1,attackable:((j=u==null?void 0:u.properties)==null?void 0:j.includes("Attackable"))??!1,weaponProperties:(u==null?void 0:u.properties)??[],magicWeaponModifier:Ud(u),weaponType:(u==null?void 0:u.weaponType)??"Melee",weaponRanges:qd(u),hasOneHandedAttack:u?!!((H=u==null?void 0:u.damage)!=null&&H.oneHanded):!0,oneHandedNumDice:((Z=(ae=u==null?void 0:u.damage)==null?void 0:ae.oneHanded)==null?void 0:Z.numDice)??1,oneHandedDiceType:((re=(L=u==null?void 0:u.damage)==null?void 0:L.oneHanded)==null?void 0:re.diceType)??"d6",hasTwoHandedAttack:!!((pe=u==null?void 0:u.damage)!=null&&pe.twoHanded),twoHandedNumDice:((me=(Ie=u==null?void 0:u.damage)==null?void 0:Ie.twoHanded)==null?void 0:me.numDice)??1,twoHandedDiceType:((ge=(_e=u==null?void 0:u.damage)==null?void 0:_e.twoHanded)==null?void 0:ge.diceType)??"d8",baseAC:((Ee=u==null?void 0:u.ac)==null?void 0:Ee.base)??10,armorProperties:(u==null?void 0:u.properties)??[],acModifier:((Q=u==null?void 0:u.ac)==null?void 0:Q.modifier)??0,armorStat:(Se=u==null?void 0:u.ac)==null?void 0:Se.stat};let i=JSON.parse(JSON.stringify(c));function d(){var N;let U={name:i.name,type:i.gearType,canBeEquipped:i.canBeEquipped,desc:i.name,slots:{slotsUsed:i.slots,perSlot:i.quantityPerSlot,freeCarry:i.slots>0?0:1},editable:!0,playerBonuses:[],cost:{gp:0,sp:0,cp:0,[i.currency]:i.cost}};switch(i.gearType){case"Basic":{i.canBeEquipped&&i.attackable&&(U.properties=["Attackable"]);break}case"Weapon":{let F=U;F.properties=i.weaponProperties,F.weaponType=i.weaponType,F.range=i.weaponRanges,F.canBeEquipped=!0,F.damage={},i.hasOneHandedAttack&&(F.damage.oneHanded={numDice:i.oneHandedNumDice,diceType:i.oneHandedDiceType}),i.hasTwoHandedAttack&&(F.damage.twoHanded={numDice:i.twoHandedNumDice,diceType:i.twoHandedDiceType}),i.weaponProperties.includes("Magic")&&i.magicWeaponModifier>0&&(F.playerBonuses.push({name:F.name+`: +${i.magicWeaponModifier} to atk`,desc:`+${i.magicWeaponModifier} to attack rolls when ${F.name} is equipped`,type:"modifyAmt",bonusAmount:i.magicWeaponModifier,bonusTo:"attackRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:F.name}}),F.playerBonuses.push({name:F.name+`: +${i.magicWeaponModifier} to dmg`,desc:`+${i.magicWeaponModifier} to damage rolls when ${F.name} is equipped`,type:"modifyAmt",bonusAmount:i.magicWeaponModifier,bonusTo:"damageRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:F.name}}));break}case"Armor":{let F=U;F.properties=i.armorProperties,F.canBeEquipped=!0,F.ac={base:i.baseAC,modifier:i.acModifier,stat:i.armorStat};break}}if(u){for(let F in u)u.hasOwnProperty(F)&&delete u[F];U.type!=="Basic"&&(U.properties=(N=U.properties)==null?void 0:N.filter(F=>F!=="Attackable")),Object.assign(u,U),r&&(r.name=U.name,r.quantity=i.quantity)}else o.customGear.push(U),o.gear.push({name:U.name,quantity:i.quantity});$e.set(o),a("finish")}const h={Finesse:"靈巧",Thrown:"投擲",TwoHanded:"雙手",Versatile:"通用",Magic:"魔法",Loading:"裝填"},y={Close:"貼身",Near:"近距",Far:"遠距",Self:"自身"},_={Shield:"盾牌",OneHanded:"單手",TwoHanded:"雙手",Disadvantage:"劣勢"};function b(){i.name=this.value,n(1,i)}function g(){i.slots=Be(this.value),n(1,i)}function C(){i.quantityPerSlot=Be(this.value),n(1,i)}function A(){i.cost=Be(this.value),n(1,i)}function k(){i.currency=He(this),n(1,i)}function S(){i.quantity=Be(this.value),n(1,i)}function E(){i.showAdvanced=this.checked,n(1,i)}function R(){i.gearType=He(this),n(1,i)}function $(){i.canBeEquipped=this.checked,n(1,i)}function I(){i.attackable=this.checked,n(1,i)}function O(){i.weaponType=He(this),n(1,i)}function B(U){t.$$.not_equal(i.weaponProperties,U)&&(i.weaponProperties=U,n(1,i))}function M(){i.magicWeaponModifier=Be(this.value),n(1,i)}function Y(U){t.$$.not_equal(i.weaponRanges,U)&&(i.weaponRanges=U,n(1,i))}function x(){i.hasOneHandedAttack=this.checked,n(1,i)}function X(){i.oneHandedNumDice=Be(this.value),n(1,i)}function J(){i.oneHandedDiceType=He(this),n(1,i)}function oe(){i.hasTwoHandedAttack=this.checked,n(1,i)}function fe(){i.twoHandedNumDice=Be(this.value),n(1,i)}function ce(){i.twoHandedDiceType=He(this),n(1,i)}function V(U){t.$$.not_equal(i.armorProperties,U)&&(i.armorProperties=U,n(1,i))}function ve(){i.baseAC=Be(this.value),n(1,i)}function ee(){i.acModifier=Be(this.value),n(1,i)}function ye(){i.armorStat=He(this),n(1,i)}return t.$$set=U=>{"gear"in U&&n(0,u=U.gear)},t.$$.update=()=>{var U;if(t.$$.dirty[0]&2&&(i.showAdvanced||(n(1,i.gearType="Basic",i),n(1,i.canBeEquipped=!1,i),n(1,i.attackable=!1,i))),t.$$.dirty[0]&2&&n(7,l=i.gearType!=="Weapon"||i.hasOneHandedAttack||i.hasTwoHandedAttack),t.$$.dirty[0]&130&&n(2,s=((U=i.name)==null?void 0:U.length)>0&&i.quantity>0&&l),t.$$.dirty[0]&2)if(i.hasOneHandedAttack&&i.hasTwoHandedAttack)i.weaponProperties.includes("Versatile")||i.weaponProperties.push("Versatile");else{const N=i.weaponProperties.findIndex(F=>F==="Versatile");N>=0&&i.weaponProperties.splice(N,1)}t.$$.dirty[0]&2&&i.armorProperties.includes("Shield")&&!i.armorProperties.includes("OneHanded")&&!i.armorProperties.includes("TwoHanded")&&i.armorProperties.push("OneHanded")},[u,i,s,d,h,y,_,l,b,g,C,A,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve,ee,ye]}class ar extends Ce{constructor(e){super(),Ae(this,e,Yd,Fd,ke,{gear:0},null,[-1,-1])}}function Fa(t){let e,n,l;function s(a){t[4](a)}let o={vw:50,$$slots:{header:[Vd],default:[zd]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ot({props:o}),We.push(()=>je(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(a,u){le(e,a,u),l=!0},p(a,u){const r={};u&33&&(r.$$scope={dirty:u,ctx:a}),!n&&u&2&&(n=!0,r.showModal=a[1],Ke(()=>n=!1)),e.$set(r)},i(a){l||(P(e.$$.fragment,a),l=!0)},o(a){W(e.$$.fragment,a),l=!1},d(a){se(e,a)}}}function zd(t){let e,n;return e=new ar({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:K,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Vd(t){let e;return{c(){e=p("h1"),e.textContent="Custom Gear",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function jd(t){let e,n,l,s,o,a,u=t[0]&&Fa(t);return{c(){e=p("button"),e.textContent="Custom Gear",n=v(),u&&u.c(),l=_t(),m(e,"class","bg-black text-white px-2")},m(r,c){w(r,e,c),w(r,n,c),u&&u.m(r,c),w(r,l,c),s=!0,o||(a=D(e,"click",t[2]),o=!0)},p(r,[c]){r[0]?u?(u.p(r,c),c&1&&P(u,1)):(u=Fa(r),u.c(),P(u,1),u.m(l.parentNode,l)):u&&(Ue(),W(u,1,1,()=>{u=null}),qe())},i(r){s||(P(u),s=!0)},o(r){W(u),s=!1},d(r){r&&T(e),r&&T(n),u&&u.d(r),r&&T(l),o=!1,a()}}}function Kd(t,e,n){let l=!1,s=!1;const o=()=>{n(0,l=!0),n(1,s=!0)},a=()=>{n(0,l=!1)};function u(r){s=r,n(1,s)}return[l,s,o,a,u]}class Xd extends Ce{constructor(e){super(),Ae(this,e,Kd,jd,ke,{})}}function Ua(t,e,n){const l=t.slice();return l[23]=e[n],l[25]=n,l}function qa(t){let e,n,l,s,o;function a(){return t[18](t[23])}function u(){return t[19](t[23])}return{c(){e=p("button"),e.innerHTML='<i class="material-icons">delete</i>',n=v(),l=p("button"),l.innerHTML='<i class="material-icons">edit</i>',m(e,"class","bg-black rounded-md text-white px-1 text-xs"),m(l,"class","bg-black rounded-md text-white px-1 text-xs")},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c),s||(o=[D(e,"click",a),D(l,"click",u)],s=!0)},p(r,c){t=r},d(r){r&&T(e),r&&T(n),r&&T(l),s=!1,Ye(o)}}}function Ya(t){var R;let e,n,l=(((R=t[23].l10n)==null?void 0:R.name)??t[23].name)+"",s,o,a,u=Va(t[23])+"",r,c,i,d=(t[23].slots.freeCarry?"免費":t[23].slots.slotsUsed)+"",h,y,_,b,g,C,A,k,S=t[23].editable&&qa(t);function E(){return t[20](t[23])}return{c(){e=p("tr"),n=p("td"),s=G(l),o=v(),a=p("td"),r=G(u),c=v(),i=p("td"),h=G(d),y=v(),_=p("td"),S&&S.c(),b=v(),g=p("button"),g.innerHTML='<i class="material-icons translate-y-1">add_circle</i>',C=v(),m(n,"class","pl-3"),m(g,"class","px-3 hover:bg-gray-400"),m(_,"class","flex justify-end gap-1"),m(e,"class","border-b"),Re(e,"bg-gray-100",t[25]%2==0)},m($,I){w($,e,I),f(e,n),f(n,s),f(e,o),f(e,a),f(a,r),f(e,c),f(e,i),f(i,h),f(e,y),f(e,_),S&&S.m(_,null),f(_,b),f(_,g),f(e,C),A||(k=D(g,"click",E),A=!0)},p($,I){var O;t=$,I&256&&l!==(l=(((O=t[23].l10n)==null?void 0:O.name)??t[23].name)+"")&&te(s,l),I&256&&u!==(u=Va(t[23])+"")&&te(r,u),I&256&&d!==(d=(t[23].slots.freeCarry?"免費":t[23].slots.slotsUsed)+"")&&te(h,d),t[23].editable?S?S.p(t,I):(S=qa(t),S.c(),S.m(_,b)):S&&(S.d(1),S=null)},d($){$&&T(e),S&&S.d(),A=!1,k()}}}function za(t){let e,n,l;function s(a){t[22](a)}let o={$$slots:{header:[Zd],default:[Jd]},$$scope:{ctx:t}};return t[7]!==void 0&&(o.showModal=t[7]),e=new ot({props:o}),We.push(()=>je(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(a,u){le(e,a,u),l=!0},p(a,u){const r={};u&67109056&&(r.$$scope={dirty:u,ctx:a}),!n&&u&128&&(n=!0,r.showModal=a[7],Ke(()=>n=!1)),e.$set(r)},i(a){l||(P(e.$$.fragment,a),l=!0)},o(a){W(e.$$.fragment,a),l=!1},d(a){se(e,a)}}}function Jd(t){let e,n;return e=new ar({props:{gear:t[6]}}),e.$on("finish",t[21]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&64&&(o.gear=l[6]),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Zd(t){let e;return{c(){e=p("h2"),e.textContent="自訂裝備",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function Qd(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b,g,C,A,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve,ee;function ye(H){t[12](H)}let q={placeholder:"搜尋 例如: 火把",class:"w-full"};t[5]!==void 0&&(q.value=t[5]),n=new sr({props:q}),We.push(()=>je(n,"value",ye));let ue=t[8],ie=[];for(let H=0;H<ue.length;H+=1)ie[H]=Ya(Ua(t,ue,H));let j=t[7]&&t[6]&&za(t);return{c(){e=p("div"),ne(n.$$.fragment),s=v(),o=p("div"),a=p("div"),a.textContent="過濾:",u=v(),r=p("input"),c=v(),i=p("label"),i.textContent="武器",d=v(),h=p("input"),y=v(),_=p("label"),_.textContent="防具",b=v(),g=p("input"),C=v(),A=p("label"),A.textContent="基礎",k=v(),S=p("input"),E=v(),R=p("label"),R.textContent="自訂",$=v(),I=p("input"),O=v(),B=p("label"),B.textContent="可負擔",M=v(),Y=p("div"),x=p("table"),X=p("thead"),X.innerHTML=`<tr><th>名稱</th> 
          <th>價格</th> 
          <th>格數</th></tr>`,J=v(),oe=p("tbody");for(let H=0;H<ie.length;H+=1)ie[H].c();fe=v(),j&&j.c(),ce=_t(),m(a,"class","font-bold"),m(r,"id","showWeapon"),m(r,"type","checkbox"),m(i,"for","showWeapon"),m(h,"id","showArmor"),m(h,"type","checkbox"),m(_,"for","showArmor"),m(g,"id","showBasic"),m(g,"type","checkbox"),m(A,"for","showBasic"),m(S,"id","showCustom"),m(S,"type","checkbox"),m(R,"for","showCustom"),m(I,"id","showAffordable"),m(I,"type","checkbox"),m(B,"for","showAffordable"),m(o,"class","flex gap-1 items-center flex-wrap"),m(X,"class","text-left sticky top-0 bg-white"),m(x,"class","w-full"),m(e,"class","border-b flex flex-col gap-1")},m(H,ae){w(H,e,ae),le(n,e,null),f(e,s),f(e,o),f(o,a),f(o,u),f(o,r),r.checked=t[1],f(o,c),f(o,i),f(o,d),f(o,h),h.checked=t[2],f(o,y),f(o,_),f(o,b),f(o,g),g.checked=t[3],f(o,C),f(o,A),f(o,k),f(o,S),S.checked=t[4],f(o,E),f(o,R),f(o,$),f(o,I),I.checked=t[0],f(o,O),f(o,B),f(e,M),f(e,Y),f(Y,x),f(x,X),f(x,J),f(x,oe);for(let Z=0;Z<ie.length;Z+=1)ie[Z]&&ie[Z].m(oe,null);w(H,fe,ae),j&&j.m(H,ae),w(H,ce,ae),V=!0,ve||(ee=[D(r,"change",t[13]),D(h,"change",t[14]),D(g,"change",t[15]),D(S,"change",t[16]),D(I,"change",t[17])],ve=!0)},p(H,[ae]){const Z={};if(!l&&ae&32&&(l=!0,Z.value=H[5],Ke(()=>l=!1)),n.$set(Z),ae&2&&(r.checked=H[1]),ae&4&&(h.checked=H[2]),ae&8&&(g.checked=H[3]),ae&16&&(S.checked=H[4]),ae&1&&(I.checked=H[0]),ae&1984){ue=H[8];let L;for(L=0;L<ue.length;L+=1){const re=Ua(H,ue,L);ie[L]?ie[L].p(re,ae):(ie[L]=Ya(re),ie[L].c(),ie[L].m(oe,null))}for(;L<ie.length;L+=1)ie[L].d(1);ie.length=ue.length}H[7]&&H[6]?j?(j.p(H,ae),ae&192&&P(j,1)):(j=za(H),j.c(),P(j,1),j.m(ce.parentNode,ce)):j&&(Ue(),W(j,1,1,()=>{j=null}),qe())},i(H){V||(P(n.$$.fragment,H),P(j),V=!0)},o(H){W(n.$$.fragment,H),W(j),V=!1},d(H){H&&T(e),se(n),Te(ie,H),H&&T(fe),j&&j.d(H),H&&T(ce),ve=!1,Ye(ee)}}}function Va(t){const{gp:e,sp:n,cp:l}=t.cost;let s,o,a;return e&&(s=`${e}gp`),n&&(o=`${n}sp`),l&&(a=`${l}cp`),[s,o,a].join(" ")}function xd(t,e,n){let l,s;Oe(t,$e,B=>n(11,s=B));let o,a=!1,u=!1,r=!0,c=!0,i=!0,d=!1,h="";function y(B){const M=s.gear.find(Y=>Y.name===B.name);if(M)M.quantity++;else{const Y={name:B.name,quantity:1};s.gear.push(Y)}$e.set(s)}function _(B){Fe($e,s.gear=s.gear.filter(M=>M.name!==B.name),s),Fe($e,s.bonuses=s.bonuses.filter(M=>{var Y,x;return!(((Y=M.metadata)==null?void 0:Y.type)==="weapon"&&M.metadata.weapon===B.name||((x=M.metadata)==null?void 0:x.type)==="armor"&&M.metadata.armor===B.name)}),s),Fe($e,s.customGear=s.customGear.filter(M=>M.name!==B.name),s)}function b(B){h=B,n(5,h)}function g(){r=this.checked,n(1,r)}function C(){c=this.checked,n(2,c)}function A(){i=this.checked,n(3,i)}function k(){d=this.checked,n(4,d)}function S(){u=this.checked,n(0,u)}const E=B=>_(B),R=B=>{n(6,o=B),n(7,a=!0)},$=B=>y(B),I=()=>{n(7,a=!1),n(6,o=void 0)};function O(B){a=B,n(7,a)}return t.$$.update=()=>{t.$$.dirty&2111&&n(8,l=Object.values(jl).concat(Object.values(Vl)).concat(Object.values(Xl)).concat(s.customGear??[]).filter(B=>d&&!s.customGear.find(M=>M.name===B.name)||!r&&B.type==="Weapon"||!c&&B.type==="Armor"||!i&&B.type==="Basic"||u&&!tu(s,B)?!1:B.name.toLowerCase().includes(h.toLowerCase())))},[u,r,c,i,d,h,o,a,l,y,_,s,b,g,C,A,k,S,E,R,$,I,O]}class ep extends Ce{constructor(e){super(),Ae(this,e,xd,Qd,ke,{})}}function tp(t){let e,n;return e=new ep({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function np(t){let e;return{c(){e=p("h1"),e.textContent="裝備",m(e,"slot","header"),m(e,"class","min-w-[300px]")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function lp(t){let e,n,l,s,o,a,u;function r(i){t[2](i)}let c={vh:90,$$slots:{header:[np],default:[tp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ot({props:c}),We.push(()=>je(l,"showModal",r)),{c(){e=p("button"),e.textContent="裝備",n=v(),ne(l.$$.fragment),m(e,"class","bg-black text-white px-3 rounded-md")},m(i,d){w(i,e,d),w(i,n,d),le(l,i,d),o=!0,a||(u=D(e,"click",t[1]),a=!0)},p(i,[d]){const h={};d&8&&(h.$$scope={dirty:d,ctx:i}),!s&&d&1&&(s=!0,h.showModal=i[0],Ke(()=>s=!1)),l.$set(h)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(e),i&&T(n),se(l,i),a=!1,u()}}}function sp(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function o(a){l=a,n(0,l)}return[l,s,o]}class op extends Ce{constructor(e){super(),Ae(this,e,sp,lp,ke,{})}}function ja(t,e,n){const l=t.slice();return l[16]=e[n],l[18]=n,l}function Ka(t,e,n){const l=t.slice();return l[16]=e[n],l[18]=n,l}function Xa(t){let e;return{c(){e=p("div"),e.textContent="負重過重",m(e,"class","text-red-600")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Ja(t){let e,n=Ve(t[16].name).canBeEquipped,l,s,o,a,u=n&&Za(t);function r(){return t[13](t[16])}return{c(){e=p("div"),u&&u.c(),l=v(),s=p("button"),s.innerHTML='<i class="material-icons">delete</i>',m(s,"class","px-1 pt-1 rounded-md bg-black text-white"),m(e,"class","flex gap-1 items-center")},m(c,i){w(c,e,i),u&&u.m(e,null),f(e,l),f(e,s),o||(a=D(s,"click",r),o=!0)},p(c,i){t=c,i&1&&(n=Ve(t[16].name).canBeEquipped),n?u?u.p(t,i):(u=Za(t),u.c(),u.m(e,l)):u&&(u.d(1),u=null)},d(c){c&&T(e),u&&u.d(),o=!1,a()}}}function Za(t){let e,n,l,s,o;function a(){return t[12](t[16])}return{c(){e=p("input"),m(e,"title","equipped"),m(e,"type","checkbox"),m(e,"class","w-6 h-6"),e.checked=n=t[16].equipped,e.disabled=l=!ol(t[16])},m(u,r){w(u,e,r),s||(o=D(e,"click",a),s=!0)},p(u,r){t=u,r&1&&n!==(n=t[16].equipped)&&(e.checked=n),r&1&&l!==(l=!ol(t[16]))&&(e.disabled=l)},d(u){u&&T(e),s=!1,o()}}}function Qa(t){var S,E;let e,n,l,s,o=t[18]+1+"",a,u,r=(((E=(S=Ve(t[16].name))==null?void 0:S.l10n)==null?void 0:E.name)??t[16].name)+"",c,i,d=t[16].quantity+"",h,y,_=t[5](t[16])+"",b,g,C,A,k=t[16].name!==sl&&Ja(t);return{c(){e=p("li"),n=p("div"),l=p("div"),s=p("span"),a=G(o),u=G(". "),c=G(r),i=G(" x "),h=G(d),y=G(" ("),b=G(_),g=G(" 格)"),C=v(),k&&k.c(),A=v(),m(l,"class","flex justify-between"),m(n,"class","flex gap-1 items-center justify-between border-b border-gray-400")},m(R,$){w(R,e,$),f(e,n),f(n,l),f(l,s),f(s,a),f(s,u),f(s,c),f(s,i),f(s,h),f(s,y),f(s,b),f(s,g),f(n,C),k&&k.m(n,null),f(e,A)},p(R,$){var I,O;$&1&&r!==(r=(((O=(I=Ve(R[16].name))==null?void 0:I.l10n)==null?void 0:O.name)??R[16].name)+"")&&te(c,r),$&1&&d!==(d=R[16].quantity+"")&&te(h,d),$&1&&_!==(_=R[5](R[16])+"")&&te(b,_),R[16].name!==sl?k?k.p(R,$):(k=Ja(R),k.c(),k.m(n,null)):k&&(k.d(1),k=null)},d(R){R&&T(e),k&&k.d()}}}function xa(t){let e,n,l,s,o;function a(){return t[14](t[16])}return{c(){e=p("input"),m(e,"title","equipped"),m(e,"type","checkbox"),m(e,"class","w-6 h-6"),e.checked=n=t[16].equipped,e.disabled=l=!ol(t[16])},m(u,r){w(u,e,r),s||(o=D(e,"click",a),s=!0)},p(u,r){t=u,r&16&&n!==(n=t[16].equipped)&&(e.checked=n),r&16&&l!==(l=!ol(t[16]))&&(e.disabled=l)},d(u){u&&T(e),s=!1,o()}}}function ei(t){var E,R;let e,n,l,s=t[18]+1+". ",o,a=(((R=(E=Ve(t[16].name))==null?void 0:E.l10n)==null?void 0:R.name)??t[16].name)+"",u,r,c=t[16].quantity+"",i,d,h,y=Ve(t[16].name).canBeEquipped,_,b,g,C,A,k=y&&xa(t);function S(){return t[15](t[16])}return{c(){e=p("li"),n=p("div"),l=p("span"),o=G(s),u=G(a),r=G(" x "),i=G(c),d=v(),h=p("div"),k&&k.c(),_=v(),b=p("button"),b.innerHTML='<i class="material-icons">delete</i>',g=v(),m(b,"class","px-1 pt-1 rounded-md bg-black text-white"),m(h,"class","flex gap-1 items-center"),m(n,"class","flex gap-1 items-center justify-between border-b border-gray-400")},m($,I){w($,e,I),f(e,n),f(n,l),f(l,o),f(l,u),f(l,r),f(l,i),f(n,d),f(n,h),k&&k.m(h,null),f(h,_),f(h,b),f(e,g),C||(A=D(b,"click",S),C=!0)},p($,I){var O,B;t=$,I&16&&a!==(a=(((B=(O=Ve(t[16].name))==null?void 0:O.l10n)==null?void 0:B.name)??t[16].name)+"")&&te(u,a),I&16&&c!==(c=t[16].quantity+"")&&te(i,c),I&16&&(y=Ve(t[16].name).canBeEquipped),y?k?k.p(t,I):(k=xa(t),k.c(),k.m(h,_)):k&&(k.d(1),k=null)},d($){$&&T(e),k&&k.d(),C=!1,A()}}}function ap(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b,g,C,A,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve,ee,ye,q,ue;d=new op({}),y=new Xd({});let ie=t[3]<0&&Xa(),j=t[0],H=[];for(let L=0;L<j.length;L+=1)H[L]=Qa(Ka(t,j,L));let ae=t[4],Z=[];for(let L=0;L<ae.length;L+=1)Z[L]=ei(ja(t,ae,L));return{c(){e=p("div"),n=p("h2"),n.textContent="裝備",l=v(),s=p("span"),o=G("("),a=G(t[1]),u=G(" 格, "),r=G(t[3]),c=G(" 空位)"),i=v(),ne(d.$$.fragment),h=v(),ne(y.$$.fragment),_=v(),ie&&ie.c(),b=v(),g=p("div"),C=p("div"),A=p("div"),A.textContent="GP:",k=v(),S=p("input"),E=v(),R=p("div"),$=p("div"),$.textContent="SP:",I=v(),O=p("input"),B=v(),M=p("div"),Y=p("div"),Y.textContent="CP:",x=v(),X=p("input"),J=v(),oe=p("div"),fe=p("ul");for(let L=0;L<H.length;L+=1)H[L].c();ce=v(),V=p("h2"),V.textContent="免費攜帶",ve=v(),ee=p("ul");for(let L=0;L<Z.length;L+=1)Z[L].c();m(e,"class","flex gap-1 p-1"),m(S,"type","number"),m(S,"inputmode","numeric"),m(S,"class","w-16"),m(C,"class","flex items-center"),m(O,"type","number"),m(O,"inputmode","numeric"),m(O,"class","w-16"),m(R,"class","flex items-center"),m(X,"type","number"),m(X,"inputmode","numeric"),m(X,"class","w-16"),m(M,"class","flex items-center"),m(g,"class","flex gap-1"),m(oe,"class","overflow-scroll flex flex-col gap-1 p-2"),mn(oe,"box-shadow","inset 0 0 5px #000")},m(L,re){w(L,e,re),f(e,n),f(e,l),f(e,s),f(s,o),f(s,a),f(s,u),f(s,r),f(s,c),f(e,i),le(d,e,null),f(e,h),le(y,e,null),w(L,_,re),ie&&ie.m(L,re),w(L,b,re),w(L,g,re),f(g,C),f(C,A),f(C,k),f(C,S),he(S,t[2].gold),f(g,E),f(g,R),f(R,$),f(R,I),f(R,O),he(O,t[2].silver),f(g,B),f(g,M),f(M,Y),f(M,x),f(M,X),he(X,t[2].copper),w(L,J,re),w(L,oe,re),f(oe,fe);for(let pe=0;pe<H.length;pe+=1)H[pe]&&H[pe].m(fe,null);f(oe,ce),f(oe,V),f(oe,ve),f(oe,ee);for(let pe=0;pe<Z.length;pe+=1)Z[pe]&&Z[pe].m(ee,null);ye=!0,q||(ue=[D(S,"input",t[9]),D(O,"input",t[10]),D(X,"input",t[11])],q=!0)},p(L,[re]){if((!ye||re&2)&&te(a,L[1]),(!ye||re&8)&&te(r,L[3]),L[3]<0?ie||(ie=Xa(),ie.c(),ie.m(b.parentNode,b)):ie&&(ie.d(1),ie=null),re&4&&Be(S.value)!==L[2].gold&&he(S,L[2].gold),re&4&&Be(O.value)!==L[2].silver&&he(O,L[2].silver),re&4&&Be(X.value)!==L[2].copper&&he(X,L[2].copper),re&225){j=L[0];let pe;for(pe=0;pe<j.length;pe+=1){const Ie=Ka(L,j,pe);H[pe]?H[pe].p(Ie,re):(H[pe]=Qa(Ie),H[pe].c(),H[pe].m(fe,null))}for(;pe<H.length;pe+=1)H[pe].d(1);H.length=j.length}if(re&208){ae=L[4];let pe;for(pe=0;pe<ae.length;pe+=1){const Ie=ja(L,ae,pe);Z[pe]?Z[pe].p(Ie,re):(Z[pe]=ei(Ie),Z[pe].c(),Z[pe].m(ee,null))}for(;pe<Z.length;pe+=1)Z[pe].d(1);Z.length=ae.length}},i(L){ye||(P(d.$$.fragment,L),P(y.$$.fragment,L),ye=!0)},o(L){W(d.$$.fragment,L),W(y.$$.fragment,L),ye=!1},d(L){L&&T(e),se(d),se(y),L&&T(_),ie&&ie.d(L),L&&T(b),L&&T(g),L&&T(J),L&&T(oe),Te(H,L),Te(Z,L),q=!1,Ye(ue)}}}const sl="額外錢幣";function ol(t){return!0}function ip(t,e,n){let l,s,o,a,u,r;Oe(t,$e,k=>n(2,r=k));function c(k){if(k.name===sl)return Math.ceil(k.quantity/100);const S=Ve(k.name);return Math.ceil(k.quantity/S.slots.perSlot)*S.slots.slotsUsed}function i(k){const S=r.gear.findIndex(R=>R.name===k),E=r.gear[S];E.quantity>1?E.quantity-=1:r.gear.splice(S,1),$e.set(r)}function d(k){k.equipped=!k.equipped,$e.set(r)}function h(){r.gold=Be(this.value),$e.set(r)}function y(){r.silver=Be(this.value),$e.set(r)}function _(){r.copper=Be(this.value),$e.set(r)}const b=k=>d(k),g=k=>i(k.name),C=k=>d(k),A=k=>i(k.name);return t.$$.update=()=>{t.$$.dirty&4&&n(0,l=r.gear.filter(k=>{var S;return((S=Ve(k.name))==null?void 0:S.slots.freeCarry)===0}).sort((k,S)=>yn(k.name,S.name))),t.$$.dirty&4&&n(8,s=r.gold+r.silver+r.copper),t.$$.dirty&257&&l&&s>100&&l.push({name:sl,quantity:s-100}),t.$$.dirty&4&&n(4,o=r.gear.filter(k=>{var S;return(S=Ve(k.name))==null?void 0:S.slots.freeCarry}).sort((k,S)=>yn(k.name,S.name))),t.$$.dirty&4&&n(1,a=Kr(r)),t.$$.dirty&3&&n(3,u=a-l.reduce((k,S)=>k+c(S),0))},[l,a,r,u,o,c,i,d,s,h,y,_,b,g,C,A]}class rp extends Ce{constructor(e){super(),Ae(this,e,ip,ap,ke,{})}}const{Boolean:up}=Ei;function ti(t,e,n){const l=t.slice();return l[5]=e[n],l}function ni(t,e,n){const l=t.slice();l[8]=e[n];const s=On(l[0],l[8]);l[9]=s;const o=l[9]!==0?Sn(l[9]):"";l[10]=o;const a={Close:"貼身",Near:"近距",Far:"遠距",Self:"自身"};return l[11]=a,l}function Sl(t){const e=t.slice(),n=Ii(e[0],e[8],"twoHanded");return e[14]=n,e}function Bl(t){const e=t.slice(),n=Ii(e[0],e[8],"oneHanded");return e[14]=n,e}function li(t){let e,n;return e=new $n({props:{diceType:t[14],numDice:t[8].damage.oneHanded.numDice,modifier:On(t[0],t[8]),$$slots:{default:[cp]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&5&&(o.diceType=l[14]),s&4&&(o.numDice=l[8].damage.oneHanded.numDice),s&5&&(o.modifier=On(l[0],l[8])),s&32773&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function cp(t){let e,n,l=`${t[8].damage.oneHanded.numDice}${t[14]}${t[10]}`,s,o,a;return{c(){e=p("div"),n=p("span"),s=G(l),o=v(),a=p("i"),a.textContent="back_hand",m(a,"class","material-icons"),m(e,"class","bg-black text-white p-1 px-2 rounded-md flex flex-col items-center text-xs")},m(u,r){w(u,e,r),f(e,n),f(n,s),f(e,o),f(e,a)},p(u,r){r&5&&l!==(l=`${u[8].damage.oneHanded.numDice}${u[14]}${u[10]}`)&&te(s,l)},d(u){u&&T(e)}}}function si(t){let e,n;return e=new $n({props:{diceType:t[14],numDice:t[8].damage.twoHanded.numDice,modifier:On(t[0],t[8]),$$slots:{default:[fp]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&5&&(o.diceType=l[14]),s&4&&(o.numDice=l[8].damage.twoHanded.numDice),s&5&&(o.modifier=On(l[0],l[8])),s&32773&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function fp(t){let e,n,l=`${t[8].damage.twoHanded.numDice}${t[14]}${t[10]}`,s,o,a;return{c(){e=p("div"),n=p("span"),s=G(l),o=v(),a=p("i"),a.textContent="sign_language",m(a,"class","material-icons"),m(e,"class","bg-black text-white rounded-md p-1 px-2 flex flex-col items-center")},m(u,r){w(u,e,r),f(e,n),f(n,s),f(e,o),f(e,a)},p(u,r){r&5&&l!==(l=`${u[8].damage.twoHanded.numDice}${u[14]}${u[10]}`)&&te(s,l)},d(u){u&&T(e)}}}function oi(t){var k;let e,n,l=(((k=t[8].l10n)==null?void 0:k.name)??t[8].name)+"",s,o,a,u=(Array.isArray(t[8].range)?t[8].range.map(g).join("/"):t[11][t[8].range]??t[8].range)+"",r,c,i,d,h,y,_,b;function g(...S){return t[4](t[11],...S)}d=new $n({props:{modifier:qs(t[0],t[8])}});let C=t[8].damage.oneHanded&&li(Bl(t)),A=t[8].damage.twoHanded&&si(Sl(t));return{c(){e=p("tr"),n=p("td"),s=G(l),o=v(),a=p("td"),r=G(u),c=v(),i=p("td"),ne(d.$$.fragment),h=v(),y=p("td"),C&&C.c(),_=v(),A&&A.c(),m(y,"class","flex gap-1"),m(e,"class","border-b")},m(S,E){w(S,e,E),f(e,n),f(n,s),f(e,o),f(e,a),f(a,r),f(e,c),f(e,i),le(d,i,null),f(e,h),f(e,y),C&&C.m(y,null),f(y,_),A&&A.m(y,null),b=!0},p(S,E){var $;t=S,(!b||E&4)&&l!==(l=((($=t[8].l10n)==null?void 0:$.name)??t[8].name)+"")&&te(s,l),(!b||E&4)&&u!==(u=(Array.isArray(t[8].range)?t[8].range.map(g).join("/"):t[11][t[8].range]??t[8].range)+"")&&te(r,u);const R={};E&5&&(R.modifier=qs(t[0],t[8])),d.$set(R),t[8].damage.oneHanded?C?(C.p(Bl(t),E),E&4&&P(C,1)):(C=li(Bl(t)),C.c(),P(C,1),C.m(y,_)):C&&(Ue(),W(C,1,1,()=>{C=null}),qe()),t[8].damage.twoHanded?A?(A.p(Sl(t),E),E&4&&P(A,1)):(A=si(Sl(t)),A.c(),P(A,1),A.m(y,null)):A&&(Ue(),W(A,1,1,()=>{A=null}),qe())},i(S){b||(P(d.$$.fragment,S),P(C),P(A),b=!0)},o(S){W(d.$$.fragment,S),W(C),W(A),b=!1},d(S){S&&T(e),se(d),C&&C.d(),A&&A.d()}}}function ai(t){var s;let e,n=(((s=t[5].l10n)==null?void 0:s.name)??t[5].name)+"",l;return{c(){e=p("div"),l=G(n),m(e,"class","py-1")},m(o,a){w(o,e,a),f(e,l)},p(o,a){var u;a&2&&n!==(n=(((u=o[5].l10n)==null?void 0:u.name)??o[5].name)+"")&&te(l,n)},d(o){o&&T(e)}}}function dp(t){let e,n,l,s,o,a,u,r,c=t[2],i=[];for(let _=0;_<c.length;_+=1)i[_]=oi(ni(t,c,_));const d=_=>W(i[_],1,1,()=>{i[_]=null});let h=t[1],y=[];for(let _=0;_<h.length;_+=1)y[_]=ai(ti(t,h,_));return{c(){e=p("h2"),e.textContent="攻擊",n=v(),l=p("div"),s=p("table"),o=p("tr"),o.innerHTML=`<th>攻擊</th> 
      <th>距離</th> 
      <th>命中/DC</th> 
      <th>傷害</th>`,a=v();for(let _=0;_<i.length;_+=1)i[_].c();u=v();for(let _=0;_<y.length;_+=1)y[_].c();m(o,"class","border-b"),m(s,"class","table-auto text-left text-sm w-full"),m(l,"class","overflow-y-auto")},m(_,b){w(_,e,b),w(_,n,b),w(_,l,b),f(l,s),f(s,o),f(s,a);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(s,null);f(s,u);for(let g=0;g<y.length;g+=1)y[g]&&y[g].m(s,null);r=!0},p(_,[b]){if(b&5){c=_[2];let g;for(g=0;g<c.length;g+=1){const C=ni(_,c,g);i[g]?(i[g].p(C,b),P(i[g],1)):(i[g]=oi(C),i[g].c(),P(i[g],1),i[g].m(s,u))}for(Ue(),g=c.length;g<i.length;g+=1)d(g);qe()}if(b&2){h=_[1];let g;for(g=0;g<h.length;g+=1){const C=ti(_,h,g);y[g]?y[g].p(C,b):(y[g]=ai(C),y[g].c(),y[g].m(s,null))}for(;g<y.length;g+=1)y[g].d(1);y.length=h.length}},i(_){if(!r){for(let b=0;b<c.length;b+=1)P(i[b]);r=!0}},o(_){i=i.filter(up);for(let b=0;b<i.length;b+=1)W(i[b]);r=!1},d(_){_&&T(e),_&&T(n),_&&T(l),Te(i,_),Te(y,_)}}}function pp(t,e,n){let l,s,o,a;Oe(t,be,r=>n(0,a=r));const u=(r,c)=>r[c]??c;return t.$$.update=()=>{t.$$.dirty&1&&n(3,l=a.gear.filter(r=>r.equipped)),t.$$.dirty&8&&n(2,s=l.map(r=>Bi(r.name)).filter(Boolean)),t.$$.dirty&8&&n(1,o=l.map(r=>Oi(r.name)).filter(Boolean).filter(r=>{var c;return r.canBeEquipped&&((c=r.properties)==null?void 0:c.includes("Attackable"))}))},[a,o,s,l,u]}class mp extends Ce{constructor(e){super(),Ae(this,e,pp,dp,ke,{})}}function hp(t){let e,n,l,s,o,a,u,r,c,i=Ys(t[0])+"",d,h,y,_,b,g,C,A,k,S;return{c(){e=p("h2"),e.textContent="生命值",n=v(),l=p("label"),s=v(),o=p("input"),a=v(),u=p("div"),r=p("div"),c=G("最大值: "),d=G(i),h=v(),y=p("div"),_=p("button"),_.innerHTML='<i class="material-icons text-base align-middle">remove</i>',b=v(),g=p("button"),g.innerHTML='<i class="material-icons text-base align-middle">add</i>',C=v(),A=p("button"),A.textContent="長休",m(l,"for","hitpoints"),m(o,"id","hitpoints"),m(o,"type","number"),m(o,"inputmode","numeric"),m(o,"class","pirata text-5xl text-center"),m(o,"min","0"),m(r,"class","whitespace-nowrap"),m(_,"class","hover:bg-gray-700 rounded"),m(g,"class","hover:bg-gray-700 rounded"),m(y,"class","flex items-center"),m(u,"class","flex gap-1 justify-between items-center text-sm mt-1"),m(A,"class","bg-black text-white rounded-md text-sm self-center px-2")},m(E,R){w(E,e,R),w(E,n,R),w(E,l,R),w(E,s,R),w(E,o,R),he(o,t[0].hitPoints),w(E,a,R),w(E,u,R),f(u,r),f(r,c),f(r,d),f(u,h),f(u,y),f(y,_),f(y,b),f(y,g),w(E,C,R),w(E,A,R),k||(S=[D(o,"input",t[4]),D(_,"click",t[2]),D(g,"click",t[1]),D(A,"click",t[3])],k=!0)},p(E,[R]){R&1&&Be(o.value)!==E[0].hitPoints&&he(o,E[0].hitPoints),R&1&&i!==(i=Ys(E[0])+"")&&te(d,i)},i:K,o:K,d(E){E&&T(e),E&&T(n),E&&T(l),E&&T(s),E&&T(o),E&&T(a),E&&T(u),E&&T(C),E&&T(A),k=!1,Ye(S)}}}function _p(t,e,n){let l;Oe(t,be,r=>n(0,l=r));function s(){Fe(be,l.maxHitPoints+=1,l)}function o(){Fe(be,l.maxHitPoints=Math.max(1,l.maxHitPoints-1),l),l.hitPoints>l.maxHitPoints&&Fe(be,l.hitPoints=l.maxHitPoints,l)}function a(){Fe(be,l.hitPoints=l.maxHitPoints,l),Fe(be,l.spells=l.spells.map(r=>({name:r.name,failed:!1})),l)}function u(){l.hitPoints=Be(this.value),be.set(l)}return[l,s,o,a,u]}class gp extends Ce{constructor(e){super(),Ae(this,e,_p,hp,ke,{})}}function bp(t){let e;return{c(){e=p("div"),e.innerHTML=`<div>這是一個非官方的 Shadowdark 角色追蹤工具！
      <a target="_blank" href="https://www.thearcanelibrary.com/pages/shadowdark" class="svelte-1a204e">購買 Shadowdark</a></div> 

    <h2>匯入</h2> 
    <div>本工具可直接從 <a href="https://www.shadowdarklings.net" target="_blank" class="svelte-1a204e">Shadowdarkling Character Creator</a> 匯入您的角色。也能匯入先前匯出的 JSON 檔案。</div> 

    <h2>儲存</h2> 
    <div>本工具會自動將您的角色卡儲存於瀏覽器的 Local
      Storage。若您刪除本網站的儲存資料，請務必先匯出角色 JSON 檔。</div> 

    <h2>聯絡</h2> 
    <div>您可以透過 <a href="mailto:maxpaulus43@gmail.com" target="_blank" class="svelte-1a204e">maxpaulus43@gmail.com</a> 聯絡我（英文），我也會出沒在 Shadowdark 官方 Discord 頻道。</div> 

    <h2>問題回報</h2> 
    <div>本專案為免費且開源！歡迎提交 Pull Request 或
      <a href="https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet" target="_blank" class="svelte-1a204e">建立 Issue</a></div> 

    <h2>致謝</h2> 
    <div>看看其他很棒的 Shadowdark 工具！</div> 
    <div><a href="https://shadowdarklings.net" target="_blank" class="svelte-1a204e">https://shadowdarklings.net</a></div> 
    <div><a href="https://www.shadowdork.com" target="_blank" class="svelte-1a204e">https://www.shadowdork.com</a></div> 

    <h2>授權</h2> 
    <div>本工具為獨立產品，依據 Shadowdark RPG Third-Party License 發布，與 The
      Arcane Library, LLC 無關。 Shadowdark RPG © 2023 The Arcane Library, LLC.</div> 
    <hr/> 
    <div>免責聲明：我已獲得 The Arcane Library
      明確許可，可於本工具轉載角色創建資料（如天賦表）。</div> 

    <a href="https://www.buymeacoffee.com/tKsqTr4ABl" target="_blank" class="pirata text-xl rounded-md p-2 self-center svelte-1a204e">請我吃份口糧 🍖</a>`,m(e,"class","flex flex-col")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function yp(t){let e;return{c(){e=p("h1"),e.textContent="資訊",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function vp(t){let e,n,l,s,o,a,u;function r(i){t[2](i)}let c={$$slots:{header:[yp],default:[bp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ot({props:c}),We.push(()=>je(l,"showModal",r)),{c(){e=p("button"),e.innerHTML='<i class="material-icons">help</i>',n=v(),ne(l.$$.fragment)},m(i,d){w(i,e,d),w(i,n,d),le(l,i,d),o=!0,a||(u=D(e,"click",t[1]),a=!0)},p(i,[d]){const h={};d&8&&(h.$$scope={dirty:d,ctx:i}),!s&&d&1&&(s=!0,h.showModal=i[0],Ke(()=>s=!1)),l.$set(h)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(e),i&&T(n),se(l,i),a=!1,u()}}}function wp(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function o(a){l=a,n(0,l)}return[l,s,o]}class Tp extends Ce{constructor(e){super(),Ae(this,e,wp,vp,ke,{})}}async function kp(t){const e=t.name;t=JSON.parse(JSON.stringify(t)),t.schemaVersion=Rr,t.schemaType=Ri;const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});if("showSaveFilePicker"in window&&(()=>{try{return window.self===window.top}catch{return!1}})())try{const u=await(await window.showSaveFilePicker({suggestedName:e,types:[{description:"json files",accept:{"application/json":[".json"]}}]})).createWritable();await u.write(n),await u.close();return}catch(a){if(a.name!=="AbortError"){console.error(a.name,a.message);return}}const s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=e,o.style.display="none",document.body.append(o),o.click(),setTimeout(()=>{URL.revokeObjectURL(s),o.remove()},1e3)}function ii(t,e,n){const l=t.slice();return l[17]=e[n],l[19]=n,l}function ri(t){let e,n=t[19]+1+"",l,s,o;function a(){return t[9](t[19])}return{c(){e=p("button"),l=G(n),m(e,"class","svelte-1bwcddv"),Re(e,"green",t[3]===t[19]+1)},m(u,r){w(u,e,r),f(e,l),s||(o=D(e,"click",a),s=!0)},p(u,r){t=u,r&8&&Re(e,"green",t[3]===t[19]+1)},d(u){u&&T(e),s=!1,o()}}}function Cp(t){let e,n,l,s,o,a,u,r,c;return{c(){e=p("label"),n=p("div"),l=p("div"),l.textContent="通知持續時間:",s=v(),o=p("input"),a=v(),u=p("div"),u.textContent="秒",m(o,"class","w-16 text-right"),m(o,"id","notificationDuration"),m(o,"type","number"),m(o,"inputmode","numeric"),m(o,"min","0"),m(n,"class","flex flex-row gap-1 items-center"),m(e,"for","notificationDuration")},m(i,d){w(i,e,d),f(e,n),f(n,l),f(n,s),f(n,o),he(o,t[4].popoverDuration),f(n,a),f(n,u),r||(c=D(o,"input",t[10]),r=!0)},p(i,d){d&16&&Be(o.value)!==i[4].popoverDuration&&he(o,i[4].popoverDuration)},d(i){i&&T(e),r=!1,c()}}}function ui(t){let e,n,l,s,o,a,u;return{c(){e=p("div"),e.textContent="進階選項（請謹慎操作）",n=v(),l=p("button"),l.textContent="清除目前欄位資料",s=v(),o=p("button"),o.textContent="清除所有暫存資料（請謹慎操作）",m(l,"class","svelte-1bwcddv"),m(o,"class","svelte-1bwcddv")},m(r,c){w(r,e,c),w(r,n,c),w(r,l,c),w(r,s,c),w(r,o,c),a||(u=[D(l,"click",t[14]),D(o,"click",t[15])],a=!0)},p:K,d(r){r&&T(e),r&&T(n),r&&T(l),r&&T(s),r&&T(o),a=!1,Ye(u)}}}function Ap(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b,g,C,A,k,S={length:ll},E=[];for(let I=0;I<S.length;I+=1)E[I]=ri(ii(t,S,I));let R=ze.isAvailable&&Cp(t),$=!t[2]&&ui(t);return{c(){e=p("div"),n=p("div"),l=p("h2"),l.textContent="選擇存檔欄位",s=v(),o=p("div");for(let I=0;I<E.length;I+=1)E[I].c();a=v(),R&&R.c(),u=v(),r=p("label"),c=p("div"),c.textContent="匯入 JSON",i=v(),d=p("input"),y=v(),_=p("button"),_.textContent="匯出 JSON",b=v(),g=p("a"),g.textContent="回報問題",C=v(),$&&$.c(),m(o,"class","flex gap-1 w-full justify-stretch"),m(c,"class","text-center"),m(d,"id","jsonImport"),m(d,"type","file"),m(d,"class","hidden"),m(d,"accept","application/json"),d.disabled=t[2],m(r,"for","jsonImport"),m(r,"class",h=Ps(t[2]?"btn-disabled":"btn")+" svelte-1bwcddv"),m(_,"class","svelte-1bwcddv"),m(g,"class","btn svelte-1bwcddv"),m(g,"href","https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet/issues/new"),m(g,"target","_blank"),m(e,"class","flex flex-col gap-1 min-w-[200px] svelte-1bwcddv"),m(e,"id","options")},m(I,O){w(I,e,O),f(e,n),f(n,l),f(n,s),f(n,o);for(let B=0;B<E.length;B+=1)E[B]&&E[B].m(o,null);f(e,a),R&&R.m(e,null),f(e,u),f(e,r),f(r,c),f(r,i),f(r,d),f(e,y),f(e,_),f(e,b),f(e,g),f(e,C),$&&$.m(e,null),A||(k=[D(d,"change",t[11]),D(d,"click",t[12]),D(_,"click",t[13])],A=!0)},p(I,O){if(O&8){S={length:ll};let B;for(B=0;B<S.length;B+=1){const M=ii(I,S,B);E[B]?E[B].p(M,O):(E[B]=ri(M),E[B].c(),E[B].m(o,null))}for(;B<E.length;B+=1)E[B].d(1);E.length=S.length}ze.isAvailable&&R.p(I,O),O&4&&(d.disabled=I[2]),O&4&&h!==(h=Ps(I[2]?"btn-disabled":"btn")+" svelte-1bwcddv")&&m(r,"class",h),I[2]?$&&($.d(1),$=null):$?$.p(I,O):($=ui(I),$.c(),$.m(e,null))},d(I){I&&T(e),Te(E,I),R&&R.d(),$&&$.d(),A=!1,Ye(k)}}}function Ep(t){let e;return{c(){e=p("h1"),e.textContent="選項",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function Sp(t){let e,n,l,s,o,a,u;function r(i){t[16](i)}let c={$$slots:{header:[Ep],default:[Ap]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ot({props:c}),We.push(()=>je(l,"showModal",r)),{c(){e=p("button"),e.innerHTML='<i class="material-icons translate-y-[1px]">settings</i>',n=v(),ne(l.$$.fragment),m(e,"class","bg-black text-white rounded-md px-1 text-xs svelte-1bwcddv")},m(i,d){w(i,e,d),w(i,n,d),le(l,i,d),o=!0,a||(u=D(e,"click",t[8]),a=!0)},p(i,[d]){const h={};d&1048637&&(h.$$scope={dirty:d,ctx:i}),!s&&d&2&&(s=!0,h.showModal=i[1],Ke(()=>s=!1)),l.$set(h)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(e),i&&T(n),se(l,i),a=!1,u()}}}function Bp(t,e,n){let l,s,o,a,u,r;Oe(t,sn,S=>n(6,s=S)),Oe(t,Mt,S=>n(7,o=S)),Oe(t,rt,S=>n(3,a=S)),Oe(t,on,S=>n(4,u=S)),Oe(t,be,S=>n(5,r=S));let{files:c}=e,i=!1;const d=()=>n(1,i=!0),h=S=>{Fe(rt,a=S+1,a)};function y(){u.popoverDuration=Be(this.value),on.set(u)}function _(){c=this.files,n(0,c)}const b=S=>{S.currentTarget.value="",n(0,c=void 0)},g=()=>{kp(r)},C=()=>{Fe(be,r=Rt(),r)},A=()=>{Fe(be,r=Rt(),r),Wf()};function k(S){i=S,n(1,i)}return t.$$set=S=>{"files"in S&&n(0,c=S.files)},t.$$.update=()=>{t.$$.dirty&192&&n(2,l=o&&!s)},[c,i,l,a,u,r,s,o,d,h,y,_,b,g,C,A,k]}class Op extends Ce{constructor(e){super(),Ae(this,e,Bp,Sp,ke,{files:0})}}function ci(t,e,n){const l=t.slice();return l[4]=e[n],l}function fi(t){let e;return{c(){e=p("div"),e.textContent="(必須至少達到 1 等級)"},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Rp(t){let e,n,l,s,o,a=an,u=[];for(let r=0;r<a.length;r+=1)u[r]=di(ci(t,a,r));return{c(){e=p("select");for(let r=0;r<u.length;r+=1)u[r].c();e.disabled=l=!t[1]},m(r,c){w(r,e,c);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(e,null);de(e,t[0].class),s||(o=D(e,"change",t[2]),s=!0)},p(r,c){if(c&0){a=an;let i;for(i=0;i<a.length;i+=1){const d=ci(r,a,i);u[i]?u[i].p(d,c):(u[i]=di(d),u[i].c(),u[i].m(e,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=a.length}c&1&&n!==(n=r[0].class)&&de(e,r[0].class),c&2&&l!==(l=!r[1])&&(e.disabled=l)},d(r){r&&T(e),Te(u,r),s=!1,o()}}}function Mp(t){let e,n,l,s,o;return{c(){e=p("input"),m(e,"type","text"),e.value=n=t[0].class,e.disabled=l=!t[1]},m(a,u){w(a,e,u),s||(o=D(e,"input",t[2]),s=!0)},p(a,u){u&1&&n!==(n=a[0].class)&&e.value!==n&&(e.value=n),u&2&&l!==(l=!a[1])&&(e.disabled=l)},d(a){a&&T(e),s=!1,o()}}}function di(t){let e,n=$l(t[4])+"",l,s;return{c(){e=p("option"),l=G(n),s=v(),e.__value=t[4],e.value=e.__value},m(o,a){w(o,e,a),f(e,l),f(e,s)},p:K,d(o){o&&T(e)}}}function Ip(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b=!t[1]&&fi();function g(k,S){return k[0].hasCustomClass?Mp:Rp}let C=g(t),A=C(t);return{c(){e=p("div"),n=p("h2"),n.textContent="職業",l=v(),b&&b.c(),s=v(),o=p("div"),a=p("input"),c=v(),i=p("label"),i.textContent="自訂",d=v(),A.c(),h=_t(),m(a,"id","customClass"),m(a,"type","checkbox"),a.disabled=u=!t[1],a.checked=r=t[0].hasCustomClass,m(i,"for","customClass"),m(o,"class","flex items-center gap-1"),m(e,"class","flex justify-between")},m(k,S){w(k,e,S),f(e,n),f(e,l),b&&b.m(e,null),f(e,s),f(e,o),f(o,a),f(o,c),f(o,i),w(k,d,S),A.m(k,S),w(k,h,S),y||(_=D(a,"input",t[3]),y=!0)},p(k,[S]){k[1]?b&&(b.d(1),b=null):b||(b=fi(),b.c(),b.m(e,s)),S&2&&u!==(u=!k[1])&&(a.disabled=u),S&1&&r!==(r=k[0].hasCustomClass)&&(a.checked=r),C===(C=g(k))&&A?A.p(k,S):(A.d(1),A=C(k),A&&(A.c(),A.m(h.parentNode,h)))},i:K,o:K,d(k){k&&T(e),b&&b.d(),k&&T(d),A.d(k),k&&T(h),y=!1,_()}}}function $p(t,e,n){let l,s;Oe(t,be,u=>n(0,s=u));function o(u){const r=u.target.value;qr(s,r),be.set(s)}function a(u){Fe(be,s.hasCustomClass=u.target.checked,s),al(s),il(s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=s.level>=1)},[s,l,o,a]}class Np extends Ce{constructor(e){super(),Ae(this,e,$p,Ip,ke,{})}}function Dp(t){let e,n,l,s,o,a,u,r,c=t[0].armorClass+"",i,d,h,y,_,b,g;return{c(){e=p("h2"),e.textContent="防禦等級",n=v(),l=p("div"),s=G(t[1]),o=v(),a=p("div"),u=p("span"),r=G("基礎 AC: "),i=G(c),d=v(),h=p("button"),h.innerHTML='<i class="material-icons">remove</i>',y=v(),_=p("button"),_.innerHTML='<i class="material-icons">add</i>',m(l,"class","flex w-full h-full justify-center items-center text-7xl pirata text-center"),m(u,"class","text-sm"),m(a,"class","flex items-center")},m(C,A){w(C,e,A),w(C,n,A),w(C,l,A),f(l,s),w(C,o,A),w(C,a,A),f(a,u),f(u,r),f(u,i),f(a,d),f(a,h),f(a,y),f(a,_),b||(g=[D(h,"click",t[3]),D(_,"click",t[2])],b=!0)},p(C,[A]){A&2&&te(s,C[1]),A&1&&c!==(c=C[0].armorClass+"")&&te(i,c)},i:K,o:K,d(C){C&&T(e),C&&T(n),C&&T(l),C&&T(o),C&&T(a),b=!1,Ye(g)}}}function Lp(t,e,n){let l,s;Oe(t,be,u=>n(0,s=u));function o(){Fe(be,s.armorClass+=1,s),be.set(s)}function a(){Fe(be,s.armorClass-=1,s),be.set(s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=zr(s))},[s,l,o,a]}class Pp extends Ce{constructor(e){super(),Ae(this,e,Lp,Dp,ke,{})}}function Hp(t){let e,n,l;return{c(){e=p("textarea"),m(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(s,o){w(s,e,o),he(e,t[1].notes),n||(l=D(e,"input",t[3]),n=!0)},p(s,o){o&2&&he(e,s[1].notes)},d(s){s&&T(e),n=!1,l()}}}function Gp(t){let e;return{c(){e=p("h1"),e.textContent="筆記",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function Wp(t){let e,n,l,s,o,a,u;function r(i){t[4](i)}let c={$$slots:{header:[Gp],default:[Hp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ot({props:c}),We.push(()=>je(l,"showModal",r)),{c(){e=p("button"),e.innerHTML='<i class="material-icons translate-y-1">notes</i>',n=v(),ne(l.$$.fragment),m(e,"class","bg-black text-white px-1")},m(i,d){w(i,e,d),w(i,n,d),le(l,i,d),o=!0,a||(u=D(e,"click",t[2]),a=!0)},p(i,[d]){const h={};d&34&&(h.$$scope={dirty:d,ctx:i}),!s&&d&1&&(s=!0,h.showModal=i[0],Ke(()=>s=!1)),l.$set(h)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(e),i&&T(n),se(l,i),a=!1,u()}}}function Fp(t,e,n){let l;Oe(t,be,r=>n(1,l=r));let s=!1;const o=()=>n(0,s=!0);function a(){l.notes=this.value,be.set(l)}function u(r){s=r,n(0,s)}return[s,l,o,a,u]}class Up extends Ce{constructor(e){super(),Ae(this,e,Fp,Wp,ke,{})}}function pi(t,e,n){const l=t.slice();return l[12]=e[n],l}function mi(t){let e,n,l,s,o;return{c(){e=p("button"),n=p("i"),n.textContent="group",m(n,"class","material-icons translate-y-1"),m(e,"class",l=(t[5]?"bg-black":"bg-green-600")+" text-white px-1")},m(a,u){w(a,e,u),f(e,n),s||(o=D(e,"click",t[9]),s=!0)},p(a,u){u&32&&l!==(l=(a[5]?"bg-black":"bg-green-600")+" text-white px-1")&&m(e,"class",l)},d(a){a&&T(e),s=!1,o()}}}function qp(t){let e;return{c(){e=p("div"),e.textContent="同步中"},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function Yp(t){let e,n,l;function s(){return t[10](t[12])}return{c(){e=p("button"),e.textContent="載入",m(e,"class","bg-black text-white p-1 rounded-md px-1")},m(o,a){w(o,e,a),n||(l=D(e,"click",s),n=!0)},p(o,a){t=o},d(o){o&&T(e),n=!1,l()}}}function hi(t){let e,n,l=t[12].name+"",s,o=t[12].id==t[1]?"（你）":"",a,u,r;function c(h,y){if(h[3]!==h[12].id)return Yp;if(!h[5])return qp}let i=c(t),d=i&&i(t);return{c(){e=p("div"),n=p("div"),s=G(l),a=G(o),u=v(),d&&d.c(),r=v(),m(e,"class","flex gap-1 justify-between items-center p-1 rounded-md w-full"),Re(e,"bg-yellow-300",t[3]===t[12].id)},m(h,y){w(h,e,y),f(e,n),f(n,s),f(n,a),f(e,u),d&&d.m(e,null),f(e,r)},p(h,y){y&1&&l!==(l=h[12].name+"")&&te(s,l),y&3&&o!==(o=h[12].id==h[1]?"（你）":"")&&te(a,o),i===(i=c(h))&&d?d.p(h,y):(d&&d.d(1),d=i&&i(h),d&&(d.c(),d.m(e,r))),y&9&&Re(e,"bg-yellow-300",h[3]===h[12].id)},d(h){h&&T(e),d&&d.d()}}}function zp(t){let e,n,l,s=t[0],o=[];for(let a=0;a<s.length;a+=1)o[a]=hi(pi(t,s,a));return{c(){e=p("div"),e.textContent="注意：載入其他玩家僅載入其數據。這是玩家角色卡的唯讀預覽。",n=v(),l=p("div");for(let a=0;a<o.length;a+=1)o[a].c();m(e,"class","w-72 mt-4 mb-4"),m(l,"class","flex flex-col gap-1 w-full")},m(a,u){w(a,e,u),w(a,n,u),w(a,l,u);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(l,null)},p(a,u){if(u&107){s=a[0];let r;for(r=0;r<s.length;r+=1){const c=pi(a,s,r);o[r]?o[r].p(c,u):(o[r]=hi(c),o[r].c(),o[r].m(l,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=s.length}},d(a){a&&T(e),a&&T(n),a&&T(l),Te(o,a)}}}function Vp(t){let e;return{c(){e=p("h1"),e.textContent="玩家",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function jp(t){let e,n,l,s,o=t[4]&&mi(t);function a(r){t[11](r)}let u={$$slots:{header:[Vp],default:[zp]},$$scope:{ctx:t}};return t[2]!==void 0&&(u.showModal=t[2]),n=new ot({props:u}),We.push(()=>je(n,"showModal",a)),{c(){o&&o.c(),e=v(),ne(n.$$.fragment)},m(r,c){o&&o.m(r,c),w(r,e,c),le(n,r,c),s=!0},p(r,[c]){r[4]?o?o.p(r,c):(o=mi(r),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null);const i={};c&32811&&(i.$$scope={dirty:c,ctx:r}),!l&&c&4&&(l=!0,i.showModal=r[2],Ke(()=>l=!1)),n.$set(i)},i(r){s||(P(n.$$.fragment,r),s=!0)},o(r){W(n.$$.fragment,r),s=!1},d(r){o&&o.d(r),r&&T(e),se(n,r)}}}function Kp(t,e,n){let l,s,o,a,u,r;Oe(t,vt,b=>n(3,l=b)),Oe(t,ps,b=>n(7,s=b)),Oe(t,In,b=>n(1,o=b)),Oe(t,Tn,b=>n(8,a=b)),Oe(t,Mt,b=>n(4,u=b)),Oe(t,sn,b=>n(5,r=b));let c=!1,i;function d(b){Fe(vt,l=b.id,l)}const h=()=>n(2,c=!0),y=b=>d(b);function _(b){c=b,n(2,c)}return t.$$.update=()=>{t.$$.dirty&387&&(n(0,i=a.map(b=>({id:b.id,name:b.name}))),i.unshift({id:o,name:(s==null?void 0:s.name)??"GM"}))},[i,o,c,l,u,r,d,s,a,h,y,_]}class Xp extends Ce{constructor(e){super(),Ae(this,e,Kp,jp,ke,{})}}function _i(t,e,n){const l=t.slice();return l[3]=e[n],l}function Jp(t){let e,n,l,s,o=Il,a=[];for(let u=0;u<o.length;u+=1)a[u]=gi(_i(t,o,u));return{c(){e=p("select");for(let u=0;u<a.length;u+=1)a[u].c()},m(u,r){w(u,e,r);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);de(e,t[0].ancestry),l||(s=D(e,"change",t[2]),l=!0)},p(u,r){if(r&0){o=Il;let c;for(c=0;c<o.length;c+=1){const i=_i(u,o,c);a[c]?a[c].p(i,r):(a[c]=gi(i),a[c].c(),a[c].m(e,null))}for(;c<a.length;c+=1)a[c].d(1);a.length=o.length}r&1&&n!==(n=u[0].ancestry)&&de(e,u[0].ancestry)},d(u){u&&T(e),Te(a,u),l=!1,s()}}}function Zp(t){let e,n,l,s;return{c(){e=p("input"),m(e,"type","text"),e.value=n=t[0].ancestry},m(o,a){w(o,e,a),l||(s=D(e,"input",t[2]),l=!0)},p(o,a){a&1&&n!==(n=o[0].ancestry)&&e.value!==n&&(e.value=n)},d(o){o&&T(e),l=!1,s()}}}function gi(t){let e,n=iu(t[3])+"",l,s;return{c(){e=p("option"),l=G(n),s=v(),e.__value=t[3],e.value=e.__value},m(o,a){w(o,e,a),f(e,l),f(e,s)},p:K,d(o){o&&T(e)}}}function Qp(t){let e,n,l,s,o,a,u,r,c,i,d,h;function y(g,C){return g[0].hasCustomAncestry?Zp:Jp}let _=y(t),b=_(t);return{c(){e=p("div"),n=p("h2"),n.textContent="種族",l=v(),s=p("div"),o=p("input"),u=v(),r=p("label"),r.textContent="自訂",c=v(),b.c(),i=_t(),m(o,"id","customAncestry"),m(o,"type","checkbox"),o.checked=a=t[0].hasCustomAncestry,m(r,"for","customAncestry"),m(s,"class","flex items-center gap-1"),m(e,"class","flex justify-between")},m(g,C){w(g,e,C),f(e,n),f(e,l),f(e,s),f(s,o),f(s,u),f(s,r),w(g,c,C),b.m(g,C),w(g,i,C),d||(h=D(o,"input",t[1]),d=!0)},p(g,[C]){C&1&&a!==(a=g[0].hasCustomAncestry)&&(o.checked=a),_===(_=y(g))&&b?b.p(g,C):(b.d(1),b=_(g),b&&(b.c(),b.m(i.parentNode,i)))},i:K,o:K,d(g){g&&T(e),g&&T(c),b.d(g),g&&T(i),d=!1,h()}}}function xp(t,e,n){let l;Oe(t,be,a=>n(0,l=a));function s(a){Fe(be,l.hasCustomAncestry=a.target.checked,l)}function o(a){const u=a.target.value;Yr(l,u),be.set(l)}return[l,s,o]}class em extends Ce{constructor(e){super(),Ae(this,e,xp,Qp,ke,{})}}function bi(t,e,n){const l=t.slice();return l[5]=e[n],l}function yi(t){let e,n,l=t[5].msg+"",s,o,a,u=t[2].format(t[5].timestamp)+"",r;return{c(){e=p("div"),n=p("span"),s=G(l),o=v(),a=p("span"),r=G(u),m(a,"class","text-gray-400"),m(e,"class","shadow-sm rounded-md border border-gray-200 p-2 flex flex-col md:flex-row justify-between")},m(c,i){w(c,e,i),f(e,n),f(n,s),f(e,o),f(e,a),f(a,r)},p(c,i){i&2&&l!==(l=c[5].msg+"")&&te(s,l),i&2&&u!==(u=c[2].format(c[5].timestamp)+"")&&te(r,u)},d(c){c&&T(e)}}}function vi(t){let e,n,l;return{c(){e=p("button"),e.innerHTML=`<i class="material-icons translate-y-1">delete</i>
          清除通知`,m(e,"class","p-2 bg-white")},m(s,o){w(s,e,o),n||(l=D(e,"click",Df),n=!0)},p:K,d(s){s&&T(e),n=!1,l()}}}function tm(t){let e,n,l,s=t[1],o=[];for(let u=0;u<s.length;u+=1)o[u]=yi(bi(t,s,u));let a=t[1].length&&vi();return{c(){e=p("div"),n=p("div");for(let u=0;u<o.length;u+=1)o[u].c();l=v(),a&&a.c(),m(n,"class","flex flex-col gap-1"),m(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(u,r){w(u,e,r),f(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);f(n,l),a&&a.m(n,null)},p(u,r){if(r&6){s=u[1];let c;for(c=0;c<s.length;c+=1){const i=bi(u,s,c);o[c]?o[c].p(i,r):(o[c]=yi(i),o[c].c(),o[c].m(n,l))}for(;c<o.length;c+=1)o[c].d(1);o.length=s.length}u[1].length?a?a.p(u,r):(a=vi(),a.c(),a.m(n,null)):a&&(a.d(1),a=null)},d(u){u&&T(e),Te(o,u),a&&a.d()}}}function nm(t){let e;return{c(){e=p("h1"),e.textContent="通知",m(e,"slot","header")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function lm(t){let e,n,l,s,o,a,u;function r(i){t[4](i)}let c={$$slots:{header:[nm],default:[tm]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ot({props:c}),We.push(()=>je(l,"showModal",r)),{c(){e=p("button"),e.innerHTML='<i class="material-icons translate-y-1">history</i>',n=v(),ne(l.$$.fragment),m(e,"class","bg-black text-white px-1")},m(i,d){w(i,e,d),w(i,n,d),le(l,i,d),o=!0,a||(u=D(e,"click",t[3]),a=!0)},p(i,[d]){const h={};d&258&&(h.$$scope={dirty:d,ctx:i}),!s&&d&1&&(s=!0,h.showModal=i[0],Ke(()=>s=!1)),l.$set(h)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(e),i&&T(n),se(l,i),a=!1,u()}}}function sm(t,e,n){let l;Oe(t,ds,r=>n(1,l=r));let s=!1;const o=new Intl.DateTimeFormat("zh-TW",{timeStyle:"medium"}),a=()=>n(0,s=!0);function u(r){s=r,n(0,s)}return[s,l,o,a,u]}class om extends Ce{constructor(e){super(),Ae(this,e,sm,lm,ke,{})}}function wi(t,e,n){const l=t.slice();return l[23]=e[n],l}function Ti(t){let e;return{c(){e=p("div"),e.innerHTML='<i class="material-icons">save</i>...',m(e,"title","save in progress..."),m(e,"class","absolute top-0 left-0 opacity-20 bg-black text-white p-1 rounded-md flex items-center")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function ki(t){let e,n,l,s,o,a,u,r,c;return{c(){e=p("button"),n=p("i"),n.textContent="undo",s=v(),o=p("button"),a=p("i"),a.textContent="redo",m(n,"class","material-icons translate-y-1 px-1"),e.disabled=l=!t[7],m(e,"class","bg-black text-white rounded-md"),Re(e,"opacity-50",!t[7]),m(a,"class","material-icons translate-y-1 px-1"),o.disabled=u=!t[8],m(o,"class","bg-black text-white rounded-md"),Re(o,"opacity-50",!t[8])},m(i,d){w(i,e,d),f(e,n),w(i,s,d),w(i,o,d),f(o,a),r||(c=[D(e,"click",t[13]),D(o,"click",t[14])],r=!0)},p(i,d){d&128&&l!==(l=!i[7])&&(e.disabled=l),d&128&&Re(e,"opacity-50",!i[7]),d&256&&u!==(u=!i[8])&&(o.disabled=u),d&256&&Re(o,"opacity-50",!i[8])},d(i){i&&T(e),i&&T(s),i&&T(o),r=!1,Ye(c)}}}function am(t){let e,n;return e=new om({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function im(t){let e;return{c(){e=G("最高等級")},m(n,l){w(n,e,l)},p:K,d(n){n&&T(e)}}}function rm(t){let e,n,l,s,o,a;return{c(){e=p("input"),n=G(`
              /
              `),l=p("div"),s=G(t[1]),m(e,"id","xp"),m(e,"type","number"),m(e,"inputmode","numeric"),m(e,"min","0"),m(e,"class","svelte-z687v8")},m(u,r){w(u,e,r),he(e,t[2].xp),w(u,n,r),w(u,l,r),f(l,s),o||(a=D(e,"input",t[18]),o=!0)},p(u,r){r&4&&Be(e.value)!==u[2].xp&&he(e,u[2].xp),r&2&&te(s,u[1])},d(u){u&&T(e),u&&T(n),u&&T(l),o=!1,a()}}}function um(t){let e,n=zs(t[4]??t[2].title,t[2].class,t[2].alignment)+"",l;return{c(){e=p("div"),l=G(n)},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&20&&n!==(n=zs(s[4]??s[2].title,s[2].class,s[2].alignment)+"")&&te(l,n)},d(s){s&&T(e)}}}function cm(t){let e,n,l,s;return{c(){e=p("input"),m(e,"type","text"),e.value=n=t[4]??t[2].title,m(e,"class","svelte-z687v8")},m(o,a){w(o,e,a),l||(s=D(e,"input",t[12]),l=!0)},p(o,a){a&20&&n!==(n=o[4]??o[2].title)&&e.value!==n&&(e.value=n)},d(o){o&&T(e),l=!1,s()}}}function Ci(t){let e,n=ru(t[23])+"",l,s;return{c(){e=p("option"),l=G(n),s=v(),e.__value=t[23],e.value=e.__value},m(o,a){w(o,e,a),f(e,l),f(e,s)},p:K,d(o){o&&T(e)}}}function fm(t){let e,n,l,s,o,a,u,r,c,i,d,h,y,_,b,g,C,A,k,S,E,R,$,I,O,B,M,Y,x,X,J,oe,fe,ce,V,ve,ee,ye,q,ue,ie,j,H,ae,Z,L,re,pe,Ie,me,_e,ge,Ee,Q,Se,U,N,F,Ne,pt,we,Xe,dn,Me,Le,dl,ms,mt,hs,Et,pl,_s,ml,gs,Lt,hl,Ct,bs,Nn,ys,Pt,_l,vs,ws,qt,gl,Ts,At,ks,Yt,bl,Cs,St,As,zt,yl,Es,Ht,Ss,Vt,Dn,jt,Bs,Ln,Kt,Xt,vl,Os;d=new Tp({});let it=t[5]&&Ti(),at=!t[6]&&ki(t);function ir(z){t[15](z)}let Rs={};t[0]!==void 0&&(Rs.files=t[0]),g=new Op({props:Rs}),We.push(()=>je(g,"files",ir)),k=new Up({});let Bt=ze.isAvailable&&am();R=new Xp({}),O=new nn({props:{forStat:"STR"}}),Y=new nn({props:{forStat:"INT"}}),J=new nn({props:{forStat:"DEX"}}),ce=new nn({props:{forStat:"WIS"}}),ee=new nn({props:{forStat:"CON"}}),ue=new nn({props:{forStat:"CHA"}}),H=new gp({}),L=new Pp({}),Ie=new mp({}),Ne=new em({}),Xe=new Np({});function Ms(z,Ze){return z[2].level<10?rm:im}let Pn=Ms(t),gt=Pn(t);function Is(z,Ze){return z[2].hasCustomClass?cm:um}let Hn=Is(t),bt=Hn(t),Jt=Rl,et=[];for(let z=0;z<Jt.length;z+=1)et[z]=Ci(wi(t,Jt,z));return jt=new Od({}),Kt=new rp({}),{c(){e=p("div"),n=p("main"),l=p("div"),s=p("div"),o=p("div"),a=p("div"),u=p("div"),r=p("div"),c=p("h1"),c.textContent="Shadowdark",i=v(),ne(d.$$.fragment),h=v(),it&&it.c(),y=v(),_=p("div"),at&&at.c(),b=v(),ne(g.$$.fragment),A=v(),ne(k.$$.fragment),S=v(),Bt&&Bt.c(),E=v(),ne(R.$$.fragment),$=v(),I=p("div"),ne(O.$$.fragment),B=v(),M=p("div"),ne(Y.$$.fragment),x=v(),X=p("div"),ne(J.$$.fragment),oe=v(),fe=p("div"),ne(ce.$$.fragment),V=v(),ve=p("div"),ne(ee.$$.fragment),ye=v(),q=p("div"),ne(ue.$$.fragment),ie=v(),j=p("div"),ne(H.$$.fragment),ae=v(),Z=p("div"),ne(L.$$.fragment),re=v(),pe=p("div"),ne(Ie.$$.fragment),me=v(),_e=p("div"),ge=p("div"),Ee=p("label"),Q=p("h2"),Q.textContent="姓名",Se=v(),U=p("input"),N=v(),F=p("div"),ne(Ne.$$.fragment),pt=v(),we=p("div"),ne(Xe.$$.fragment),dn=v(),Me=p("div"),Le=p("label"),dl=p("h2"),dl.textContent="等級",ms=v(),mt=p("input"),hs=v(),Et=p("div"),pl=p("h2"),pl.textContent="經驗值",_s=v(),ml=p("label"),gs=v(),Lt=p("div"),gt.c(),hl=v(),Ct=p("button"),bs=G("🆙"),ys=v(),Pt=p("div"),_l=p("h2"),_l.textContent="稱號",vs=v(),bt.c(),ws=v(),qt=p("div"),gl=p("h2"),gl.textContent="陣營",Ts=v(),At=p("select");for(let z=0;z<et.length;z+=1)et[z].c();ks=v(),Yt=p("div"),bl=p("h2"),bl.textContent="背景",Cs=v(),St=p("input"),As=v(),zt=p("div"),yl=p("h2"),yl.textContent="神祇",Es=v(),Ht=p("input"),Ss=v(),Vt=p("div"),Dn=p("div"),ne(jt.$$.fragment),Bs=v(),Ln=p("div"),ne(Kt.$$.fragment),m(c,"class",""),m(r,"class","flex items-center gap-1"),m(_,"class","-translate-y-2 flex gap-1"),m(u,"class","flex flex-col items-center"),m(a,"class","flex gap-1 justify-around"),m(o,"class","col-span-full cell svelte-z687v8"),m(I,"class","cell svelte-z687v8"),m(M,"class","cell svelte-z687v8"),m(X,"class","cell svelte-z687v8"),m(fe,"class","cell svelte-z687v8"),m(ve,"class","cell svelte-z687v8"),m(q,"class","cell svelte-z687v8"),m(j,"class","row-span-2 cell svelte-z687v8"),m(Z,"class","row-span-2 cell svelte-z687v8"),m(pe,"class","col-span-full row-span-2 cell svelte-z687v8"),m(s,"class","flex-[2] min-w-[257px] h-[700px] grid grid-rows-8 grid-cols-2 gap-2"),m(U,"type","text"),m(U,"class","svelte-z687v8"),m(ge,"class","col-span-full cell svelte-z687v8"),m(F,"class","col-span-full cell svelte-z687v8"),m(we,"class","col-span-full cell svelte-z687v8"),m(mt,"type","number"),m(mt,"inputmode","numeric"),m(mt,"max","10"),m(mt,"min","1"),m(mt,"class","svelte-z687v8"),m(Me,"class","cell svelte-z687v8"),m(ml,"for","xp"),m(Ct,"class","text-2xl"),Ct.disabled=Nn=!t[3],Re(Ct,"opacity-20",!t[3]),m(Lt,"class","sheet-stat flex gap-1"),m(Et,"class","cell svelte-z687v8"),m(Pt,"class","col-span-full cell svelte-z687v8"),m(At,"class","svelte-z687v8"),t[2].alignment===void 0&&Pe(()=>t[20].call(At)),m(qt,"class","col-span-full cell svelte-z687v8"),m(St,"type","text"),m(St,"class","svelte-z687v8"),m(Yt,"class","col-span-full cell svelte-z687v8"),m(Ht,"class","svelte-z687v8"),m(zt,"class","col-span-full cell svelte-z687v8"),m(_e,"class","flex-[2] min-w-[257px] h-[700px] grid grid-rows-8 grid-cols-2 gap-2"),m(Dn,"class","cell svelte-z687v8"),m(Ln,"class","cell svelte-z687v8"),m(Vt,"class","flex-[3] min-w-[257px] min-[805px]:h-[700px] grid grid-rows-2 gap-2"),m(l,"id","sheet"),m(l,"class","bg-black min-w-[277px] max-w-[1000px] p-2 flex flex-wrap gap-2"),m(e,"class","flex items-center justify-center bg-black")},m(z,Ze){w(z,e,Ze),f(e,n),f(n,l),f(l,s),f(s,o),f(o,a),f(a,u),f(u,r),f(r,c),f(r,i),le(d,r,null),f(u,h),it&&it.m(u,null),f(u,y),f(u,_),at&&at.m(_,null),f(_,b),le(g,_,null),f(_,A),le(k,_,null),f(_,S),Bt&&Bt.m(_,null),f(_,E),le(R,_,null),f(s,$),f(s,I),le(O,I,null),f(s,B),f(s,M),le(Y,M,null),f(s,x),f(s,X),le(J,X,null),f(s,oe),f(s,fe),le(ce,fe,null),f(s,V),f(s,ve),le(ee,ve,null),f(s,ye),f(s,q),le(ue,q,null),f(s,ie),f(s,j),le(H,j,null),f(s,ae),f(s,Z),le(L,Z,null),f(s,re),f(s,pe),le(Ie,pe,null),f(l,me),f(l,_e),f(_e,ge),f(ge,Ee),f(Ee,Q),f(Ee,Se),f(Ee,U),he(U,t[2].name),f(_e,N),f(_e,F),le(Ne,F,null),f(_e,pt),f(_e,we),le(Xe,we,null),f(_e,dn),f(_e,Me),f(Me,Le),f(Le,dl),f(Le,ms),f(Le,mt),he(mt,t[2].level),f(_e,hs),f(_e,Et),f(Et,pl),f(Et,_s),f(Et,ml),f(Et,gs),f(Et,Lt),gt.m(Lt,null),f(Lt,hl),f(Lt,Ct),f(Ct,bs),f(_e,ys),f(_e,Pt),f(Pt,_l),f(Pt,vs),bt.m(Pt,null),f(_e,ws),f(_e,qt),f(qt,gl),f(qt,Ts),f(qt,At);for(let Gt=0;Gt<et.length;Gt+=1)et[Gt]&&et[Gt].m(At,null);de(At,t[2].alignment,!0),f(_e,ks),f(_e,Yt),f(Yt,bl),f(Yt,Cs),f(Yt,St),he(St,t[2].background),f(_e,As),f(_e,zt),f(zt,yl),f(zt,Es),f(zt,Ht),he(Ht,t[2].deity),f(l,Ss),f(l,Vt),f(Vt,Dn),le(jt,Dn,null),f(Vt,Bs),f(Vt,Ln),le(Kt,Ln,null),Xt=!0,vl||(Os=[D(U,"input",t[16]),D(mt,"input",t[17]),D(Ct,"click",t[19]),D(At,"change",t[20]),D(St,"input",t[21]),D(Ht,"input",t[22])],vl=!0)},p(z,[Ze]){z[5]?it||(it=Ti(),it.c(),it.m(u,y)):it&&(it.d(1),it=null),z[6]?at&&(at.d(1),at=null):at?at.p(z,Ze):(at=ki(z),at.c(),at.m(_,b));const Gt={};if(!C&&Ze&1&&(C=!0,Gt.files=z[0],Ke(()=>C=!1)),g.$set(Gt),Ze&4&&U.value!==z[2].name&&he(U,z[2].name),Ze&4&&Be(mt.value)!==z[2].level&&he(mt,z[2].level),Pn===(Pn=Ms(z))&&gt?gt.p(z,Ze):(gt.d(1),gt=Pn(z),gt&&(gt.c(),gt.m(Lt,hl))),(!Xt||Ze&8&&Nn!==(Nn=!z[3]))&&(Ct.disabled=Nn),(!Xt||Ze&8)&&Re(Ct,"opacity-20",!z[3]),Hn===(Hn=Is(z))&&bt?bt.p(z,Ze):(bt.d(1),bt=Hn(z),bt&&(bt.c(),bt.m(Pt,null))),Ze&0){Jt=Rl;let dt;for(dt=0;dt<Jt.length;dt+=1){const $s=wi(z,Jt,dt);et[dt]?et[dt].p($s,Ze):(et[dt]=Ci($s),et[dt].c(),et[dt].m(At,null))}for(;dt<et.length;dt+=1)et[dt].d(1);et.length=Jt.length}Ze&4&&de(At,z[2].alignment),Ze&4&&St.value!==z[2].background&&he(St,z[2].background),Ze&4&&Ht.value!==z[2].deity&&he(Ht,z[2].deity)},i(z){Xt||(P(d.$$.fragment,z),P(g.$$.fragment,z),P(k.$$.fragment,z),P(Bt),P(R.$$.fragment,z),P(O.$$.fragment,z),P(Y.$$.fragment,z),P(J.$$.fragment,z),P(ce.$$.fragment,z),P(ee.$$.fragment,z),P(ue.$$.fragment,z),P(H.$$.fragment,z),P(L.$$.fragment,z),P(Ie.$$.fragment,z),P(Ne.$$.fragment,z),P(Xe.$$.fragment,z),P(jt.$$.fragment,z),P(Kt.$$.fragment,z),Xt=!0)},o(z){W(d.$$.fragment,z),W(g.$$.fragment,z),W(k.$$.fragment,z),W(Bt),W(R.$$.fragment,z),W(O.$$.fragment,z),W(Y.$$.fragment,z),W(J.$$.fragment,z),W(ce.$$.fragment,z),W(ee.$$.fragment,z),W(ue.$$.fragment,z),W(H.$$.fragment,z),W(L.$$.fragment,z),W(Ie.$$.fragment,z),W(Ne.$$.fragment,z),W(Xe.$$.fragment,z),W(jt.$$.fragment,z),W(Kt.$$.fragment,z),Xt=!1},d(z){z&&T(e),se(d),it&&it.d(),at&&at.d(),se(g),se(k),Bt&&Bt.d(),se(R),se(O),se(Y),se(J),se(ce),se(ee),se(ue),se(H),se(L),se(Ie),se(Ne),se(Xe),gt.d(),bt.d(),Te(et,z),se(jt),se(Kt),vl=!1,Ye(Os)}}}function dm(t,e,n){let l,s,o,a,u,r,c,i;Oe(t,be,B=>n(2,a=B)),Oe(t,Fl,B=>n(5,u=B));const{isGM:d}=Vf;Oe(t,d,B=>n(6,r=B)),vr(()=>{jf(),ze.isAvailable?tr():Ff()});const{canUndo:h,canRedo:y}=be;Oe(t,h,B=>n(7,c=B)),Oe(t,y,B=>n(8,i=B));let _;function b(B){Fe(be,a.title=B.target.value,a)}const g=()=>be.undo(),C=()=>be.redo();function A(B){_=B,n(0,_)}function k(){a.name=this.value,be.set(a)}function S(){a.level=Be(this.value),be.set(a)}function E(){a.xp=Be(this.value),be.set(a)}const R=()=>{Xr(a),be.set(a)};function $(){a.alignment=He(this),be.set(a)}function I(){a.background=this.value,be.set(a)}function O(){a.deity=this.value,be.set(a)}return t.$$.update=()=>{if(t.$$.dirty&1&&_)for(const B of _){B.text().then(M=>{Fe(be,a=Lf(M),a)}),n(0,_=void 0);break}t.$$.dirty&4&&Cr(a),t.$$.dirty&4&&n(4,l=Vr(a)),t.$$.dirty&4&&n(1,s=a.level===0?10:a.level*10),t.$$.dirty&6&&n(3,o=a.level<10&&a.xp>=s)},[_,s,a,o,l,u,r,c,i,d,h,y,b,g,C,A,k,S,E,R,$,I,O]}class pm extends Ce{constructor(e){super(),Ae(this,e,dm,fm,ke,{})}}new pm({target:document.getElementById("app")});
