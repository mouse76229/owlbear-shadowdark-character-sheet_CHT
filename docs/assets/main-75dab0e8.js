import{n as V,s as rr,r as Ue,a as ke,i as ur,g as We,S as Ce,b as Oe,e as m,c as y,t as G,d as p,f as w,h as f,l as I,j as ee,k as T,m as Be,o as Re,p as ze,q as Rn,u as cr,v as fr,w as $n,x as Dn,y as Nn,z as P,A as W,B as dr,C as Ve,D as Ye,E as ne,F as le,G as Ke,H as se,I as Ge,J as $e,K as pr,L as _e,M as Pe,N as vt,O as qe,P as Fe,Q as oe,R as yn,T as Me,U as mr,V as An,W as As,X as _r,Y as hr,Z as gr,_ as tl,$ as wa,a0 as vr,a1 as Bs,a2 as ks,a3 as br,a4 as yr,a5 as wr,a6 as Ta,a7 as Cs,a8 as Tr}from"./index-fd053ce9.js";const rn=[];function Er(t,e){return{subscribe:ct(t,e).subscribe}}function ct(t,e=V){let n;const l=new Set;function s(r){if(ke(t,r)&&(t=r,n)){const u=!rn.length;for(const c of l)c[1](),rn.push(c,t);if(u){for(let c=0;c<rn.length;c+=2)rn[c][0](rn[c+1]);rn.length=0}}}function o(r){s(r(t))}function i(r,u=V){const c=[r,u];return l.add(c),l.size===1&&(n=e(s)||V),r(t),()=>{l.delete(c),l.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:i}}function Ar(t,e,n){const l=!Array.isArray(t),s=l?[t]:t,o=e.length<2;return Er(n,i=>{let r=!1;const u=[];let c=0,a=V;const d=()=>{if(c)return;a();const v=e(l?u[0]:u,i);o?i(v):a=ur(v)?v:V},_=s.map((v,g)=>rr(v,h=>{u[g]=h,c&=~(1<<g),r&&d()},()=>{c|=1<<g}));return r=!0,d(),function(){Ue(_),a(),r=!1}})}const Ea=[{name:"Padded",type:"Armor",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:11,modifier:0,maxDex:void 0,stealthDisadvantage:!0},weight:8,l10n:{name:"甲冑"}},{name:"Leather Armor",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:11,modifier:0,maxDex:void 0},weight:10,l10n:{name:"皮甲"}},{name:"Studded Leather",type:"Armor",cost:{gp:45,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:12,modifier:0,maxDex:void 0},weight:13,l10n:{name:"鑲釘皮甲"}},{name:"Hide",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:12,modifier:0,maxDex:2},weight:12,l10n:{name:"獸皮甲"}},{name:"Chain Shirt",type:"Armor",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:13,modifier:0,maxDex:2},weight:20,l10n:{name:"鍊甲衫"}},{name:"Scale Mail",type:"Armor",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:14,modifier:0,maxDex:2,stealthDisadvantage:!0},weight:45,l10n:{name:"鱗甲"}},{name:"Breastplate",type:"Armor",cost:{gp:400,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:14,modifier:0,maxDex:2},weight:20,l10n:{name:"胸甲"}},{name:"Half Plate",type:"Armor",cost:{gp:750,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:15,modifier:0,maxDex:2,stealthDisadvantage:!0},weight:40,l10n:{name:"半身板甲"}},{name:"Ring Mail",type:"Armor",cost:{gp:30,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:14,modifier:0,maxDex:0,stealthDisadvantage:!0},weight:40,l10n:{name:"環甲"}},{name:"Chain Mail",type:"Armor",cost:{gp:75,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:16,modifier:0,maxDex:0,stealthDisadvantage:!0},minStr:13,weight:55,l10n:{name:"鎖子甲"}},{name:"Splint",type:"Armor",cost:{gp:200,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:17,modifier:0,maxDex:0,stealthDisadvantage:!0},minStr:15,weight:60,l10n:{name:"條板甲"}},{name:"Plate",type:"Armor",cost:{gp:1500,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:18,modifier:0,maxDex:0,stealthDisadvantage:!0},minStr:15,weight:65,l10n:{name:"全身板甲"}},{name:"Shield",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:2,modifier:0},properties:["Shield"],weight:6,l10n:{name:"盾牌"}}],Wl={};for(const t of Ea)Wl[t.name.toLowerCase()]=t;const Br=[{name:"Backpack",type:"Basic",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:5,l10n:{name:"背包"}},{name:"Bedroll",type:"Basic",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:7,l10n:{name:"睡袋"}},{name:"Crowbar",type:"Basic",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:5,l10n:{name:"撬棍"}},{name:"Hammer",type:"Basic",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:3,l10n:{name:"鐵鎚"}},{name:"Healer's Kit",type:"Basic",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:3,l10n:{name:"醫藥箱"}},{name:"Holy Water (flask)",type:"Basic",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"聖水 (瓶)"}},{name:"Lantern, bullseye",type:"Basic",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:2,l10n:{name:"靶心提燈"}},{name:"Lantern, hooded",type:"Basic",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:2,l10n:{name:"防風提燈"}},{name:"Lock",type:"Basic",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:1,l10n:{name:"鎖"}},{name:"Mess Kit",type:"Basic",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:1,l10n:{name:"餐具組"}},{name:"Oil (flask)",type:"Basic",cost:{gp:0,sp:1,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"油 (瓶)"}},{name:"Piton",type:"Basic",cost:{gp:0,sp:0,cp:5,ep:0,pp:0},canBeEquipped:!1,weight:.25,l10n:{name:"岩釘"}},{name:"Potion of Healing",type:"Basic",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:.5,l10n:{name:"治療藥水"}},{name:"Rations (1 day)",type:"Basic",cost:{gp:0,sp:5,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:2,l10n:{name:"口糧 (1天份)"}},{name:"Rope, hempen (50 feet)",type:"Basic",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:10,l10n:{name:"麻繩 (50呎)"}},{name:"Rope, silk (50 feet)",type:"Basic",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:5,l10n:{name:"絲繩 (50呎)"}},{name:"Tinderbox",type:"Basic",cost:{gp:0,sp:5,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:1,l10n:{name:"打火匣"}},{name:"Torch",type:"Basic",cost:{gp:0,sp:0,cp:1,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"火把"}},{name:"Waterskin",type:"Basic",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:5,l10n:{name:"水袋"}}],ql={};for(const t of Br)ql[t.name.toLowerCase()]=t;const Aa=[{name:"Eldritch Blast",range:"120 feet",class:"Warlock",tier:0,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"A beam of crackling energy streaks toward a creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 force damage.",l10n:{name:"魔能爆",desc:"一道裂能量光束射向射程內的生物。對目標進行遠程法術攻擊。命中時造成 1d10 力場傷害。"}},{name:"Fire Bolt",range:"120 feet",class:"Wizard",tier:0,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"You hurl a mote of fire at a creature or object within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 fire damage.",l10n:{name:"火焰箭",desc:"你向射程內的生物或物體投擲一團火焰。對目標進行遠程法術攻擊。命中時造成 1d10 火焰傷害。"}},{name:"Light",range:"Touch",class:"Cleric",tier:0,duration:"1 hour",components:{verbal:!0,material:!0,materialDesc:"a firefly or phosphorescent moss"},desc:"You touch one object that is no larger than 10 feet in any dimension. Until the spell ends, the object sheds bright light in a 20-foot radius and dim light for an additional 20 feet.",l10n:{name:"光亮術",desc:"你觸碰一個長寬高不超過 10 呎的物體。在法術結束前，該物體發出半徑 20 呎的明亮光照，以及額外 20 呎的微光光照。"}},{name:"Mage Hand",range:"30 feet",class:"Wizard",tier:0,duration:"1 minute",components:{verbal:!0,somatic:!0},desc:"A spectral, floating hand appears at a point you choose within range. The hand lasts for the duration or until you dismiss it as an action. The hand vanishes if it is ever more than 30 feet away from you or if you cast this spell again.",l10n:{name:"法師之手",desc:"一隻幽靈般的漂浮手掌出現在射程內你選擇的點。手掌持續至持續時間結束，或直到你用一個動作解除它。若手掌距離你超過 30 呎或你再次施展此法術，它會消失。"}},{name:"Guidance",range:"Touch",class:"Cleric",tier:0,duration:"1 minute",components:{verbal:!0,somatic:!0},desc:"Concentration. You touch one willing creature. Once before the spell ends, the target can roll a d4 and add the number rolled to one ability check of its choice.",l10n:{name:"神導術",desc:"專注。你觸碰一名自願生物。在法術結束前，目標可以選擇在一次屬性檢定中擲一顆 d4 並將結果加到檢定值中。"}},{name:"Bless",range:"30 feet",class:"Cleric",tier:1,duration:"1 minute",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a sprinkling of holy water"},desc:"Concentration. You bless up to three creatures of your choice within range. Whenever a target makes an attack roll or a saving throw before the spell ends, the target can roll a d4 and add the number rolled to the attack roll or saving throw.",l10n:{name:"祝福術",desc:"專注。你祝福射程內最多三名生物。在法術結束前，每當目標進行攻擊檢定或豁免檢定時，可以擲一顆 d4 並將結果加到檢定值中。"}},{name:"Cure Wounds",range:"Touch",class:"Cleric",tier:1,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"A creature you touch regains a number of hit points equal to 1d8 + your spellcasting ability modifier.",l10n:{name:"治療傷口",desc:"你觸碰的生物回復 1d8 + 你施法屬性調整值的生命值。"}},{name:"Healing Word",range:"60 feet",class:"Cleric",tier:1,duration:"Instantaneous",components:{verbal:!0},desc:"A creature of your choice that you can see within range regains hit points equal to 1d4 + your spellcasting ability modifier.",l10n:{name:"治癒真言",desc:"射程內你可見的一名生物回復 1d4 + 你施法屬性調整值的生命值。"}},{name:"Magic Missile",range:"120 feet",class:"Wizard",tier:1,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"You create three glowing darts of magical force. Each dart hits a creature of your choice that you can see within range. A dart deals 1d4 + 1 force damage to its target. The darts all strike simultaneously, and you can direct them to hit one creature or several.",l10n:{name:"魔法飛彈",desc:"你創造三支發光的魔法力場飛鏢。每支飛鏢擊中射程內你可見的一個生物。每支飛鏢造成 1d4 + 1 力場傷害。飛鏢同時擊中，你可以指定它們攻擊同一生物或多個生物。"}},{name:"Shield",range:"Self",class:"Wizard",tier:1,duration:"1 round",components:{verbal:!0,somatic:!0},desc:"Reaction. An invisible barrier of magical force appears and protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from magic missile.",l10n:{name:"護盾術",desc:"反應。一道隱形魔法護盾出現保護你。直到你下回合開始，你的 AC 獲得 +5 加值（包含對觸發此反應的攻擊），且魔法飛彈無法對你造成傷害。"}},{name:"Invisibility",range:"Touch",class:"Wizard",tier:2,duration:"1 hour",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"an eyelash encased in gum arabic"},desc:"Concentration. A creature you touch becomes invisible until the spell ends. Anything the target is wearing or carrying is invisible as long as it is on the target's person. The spell ends for a target that attacks or casts a spell.",l10n:{name:"隱形術",desc:"專注。你觸碰的生物變為隱形，直到法術結束。目標穿戴或攜帶的物品也隨之隱形。若目標進行攻擊或施法，該目標的法術即解除。"}},{name:"Misty Step",range:"Self",class:"Wizard",tier:2,duration:"Instantaneous",components:{verbal:!0},desc:"Briefly surrounded by silvery mist, you teleport up to 30 feet to an unoccupied space that you can see.",l10n:{name:"迷蹤步",desc:"被銀色迷霧短暫環繞，你傳送最多 30 呎到你可見的未佔據空間。"}},{name:"Web",range:"60 feet",class:"Wizard",tier:2,duration:"1 hour",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a bit of spiderweb"},desc:"Concentration. You conjure a mass of thick, sticky webbing at a point of your choice within range. The webs fill a 20-foot cube and remain for the duration.",l10n:{name:"蛛網術",desc:"專注。你在射程內的一點召喚大量黏稠蛛網。蛛網填滿 20 呎立方區域，持續至法術結束。"}},{name:"Fireball",range:"150 feet",class:"Wizard",tier:3,duration:"Instantaneous",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a tiny ball of bat guano and sulfur"},desc:"A bright streak flashes from your pointing finger to a point you choose within range and then blossoms with a low roar into an explosion of flame. Each creature in a 20-foot-radius sphere centered on that point must make a Dexterity saving throw. A target takes 8d6 fire damage on a failed save, or half as much damage on a successful one.",l10n:{name:"火球術",desc:"一道亮光從你手指射出，擊中射程內你選擇的一點，隨即爆發出低沉轟鳴與烈焰。以該點為中心半徑 20 呎球形區域內的所有生物必須進行敏捷豁免。失敗者受到 8d6 火焰傷害，成功者傷害減半。"}},{name:"Fly",range:"Touch",class:"Wizard",tier:3,duration:"10 minutes",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a wing feather from any bird"},desc:"Concentration. You touch a willing creature. The target gains a flying speed of 60 feet for the duration. When the spell ends, the target falls if it is still aloft, unless it can stop the fall.",l10n:{name:"飛行術",desc:"專注。你觸碰一名自願生物。目標獲得 60 呎飛行速度，持續至法術結束。法術結束時，若目標仍在空中且無法阻止墜落，則跌落。"}},{name:"Counterspell",range:"60 feet",class:"Wizard",tier:3,duration:"Instantaneous",components:{somatic:!0},desc:"Reaction. You attempt to interrupt a creature in the process of casting a spell. If the creature is casting a spell of 3rd level or lower, its spell fails and has no effect.",l10n:{name:"法術反制",desc:"反應。你試圖打斷正在施法的生物。若該生物施展的是 3 環或更低階的法術，該法術失敗且無效。"}}],Fl={};for(const t of Aa)Fl[t.name.toLowerCase()]=t;const Ba=[{name:"Club",type:"Weapon",cost:{gp:0,sp:1,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light"],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"棍棒"}},{name:"Dagger",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Piercing"},weight:1,l10n:{name:"匕首"}},{name:"Greatclub",type:"Weapon",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Two-Handed"],range:"5 ft",weaponType:"Simple Melee",damage:{twoHanded:{diceType:"d8",numDice:1},damageType:"Bludgeoning"},weight:10,l10n:{name:"巨棒"}},{name:"Handaxe",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Slashing"},weight:2,l10n:{name:"手斧"}},{name:"Javelin",type:"Weapon",cost:{gp:0,sp:5,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Thrown"],range:"30/120",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"標槍"}},{name:"Light Hammer",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"輕鎚"}},{name:"Mace",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Bludgeoning"},weight:4,l10n:{name:"釘頭錘"}},{name:"Quarterstaff",type:"Weapon",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},twoHanded:{diceType:"d8",numDice:1},damageType:"Bludgeoning"},weight:4,l10n:{name:"長棍"}},{name:"Sickle",type:"Weapon",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light"],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Slashing"},weight:2,l10n:{name:"鐮刀"}},{name:"Spear",type:"Weapon",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Thrown","Versatile"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:3,l10n:{name:"矛"}},{name:"Crossbow, light",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Loading","Two-Handed"],range:"80/320",weaponType:"Simple Ranged",damage:{twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:5,l10n:{name:"輕型十字弓"}},{name:"Dart",type:"Weapon",cost:{gp:0,sp:0,cp:5,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Thrown"],range:"20/60",weaponType:"Simple Ranged",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Piercing"},weight:.25,l10n:{name:"飛鏢"}},{name:"Shortbow",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Two-Handed"],range:"80/320",weaponType:"Simple Ranged",damage:{twoHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"短弓"}},{name:"Sling",type:"Weapon",cost:{gp:0,sp:1,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition"],range:"30/120",weaponType:"Simple Ranged",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Bludgeoning"},weight:0,l10n:{name:"投石索"}},{name:"Battleaxe",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:4,l10n:{name:"戰斧"}},{name:"Flail",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"連枷"}},{name:"Glaive",type:"Weapon",cost:{gp:20,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Reach","Two-Handed"],range:"10 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:6,l10n:{name:"關刀"}},{name:"Greataxe",type:"Weapon",cost:{gp:30,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Two-Handed"],range:"5 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d12",numDice:1},damageType:"Slashing"},weight:7,l10n:{name:"巨斧"}},{name:"Greatsword",type:"Weapon",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Two-Handed"],range:"5 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d6",numDice:2},damageType:"Slashing"},weight:6,l10n:{name:"巨劍"}},{name:"Halberd",type:"Weapon",cost:{gp:20,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Reach","Two-Handed"],range:"10 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:6,l10n:{name:"長戟"}},{name:"Lance",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Reach","Special"],range:"10 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d12",numDice:1},damageType:"Piercing"},weight:6,l10n:{name:"騎槍"}},{name:"Longsword",type:"Weapon",cost:{gp:15,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:3,l10n:{name:"長劍"}},{name:"Maul",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Two-Handed"],range:"5 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d6",numDice:2},damageType:"Bludgeoning"},weight:10,l10n:{name:"巨鎚"}},{name:"Morningstar",type:"Weapon",cost:{gp:15,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:4,l10n:{name:"晨星鎚"}},{name:"Pike",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Reach","Two-Handed"],range:"10 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Piercing"},weight:18,l10n:{name:"長矛"}},{name:"Rapier",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"刺劍"}},{name:"Scimitar",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Slashing"},weight:3,l10n:{name:"彎刀"}},{name:"Shortsword",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"短劍"}},{name:"Trident",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Thrown","Versatile"],range:"20/60",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d6",numDice:1},twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:4,l10n:{name:"三叉戟"}},{name:"War Pick",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"戰鎬"}},{name:"Warhammer",type:"Weapon",cost:{gp:15,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"戰鎚"}},{name:"Whip",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Reach"],range:"10 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Slashing"},weight:3,l10n:{name:"鞭子"}},{name:"Blowgun",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Loading"],range:"25/100",weaponType:"Martial Ranged",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Piercing"},weight:1,l10n:{name:"吹箭筒"}},{name:"Crossbow, hand",type:"Weapon",cost:{gp:75,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Light","Loading"],range:"30/120",weaponType:"Martial Ranged",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:3,l10n:{name:"手弩"}},{name:"Crossbow, heavy",type:"Weapon",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Heavy","Loading","Two-Handed"],range:"100/400",weaponType:"Martial Ranged",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Piercing"},weight:18,l10n:{name:"重型十字弓"}},{name:"Longbow",type:"Weapon",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Heavy","Two-Handed"],range:"150/600",weaponType:"Martial Ranged",damage:{twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"長弓"}},{name:"Net",type:"Weapon",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Special","Thrown"],range:"5/15",weaponType:"Martial Ranged",damage:{oneHanded:{diceType:"d4",numDice:0}},weight:3,l10n:{name:"網"}}],Ul={};for(const t of Ba)Ul[t.name.toLowerCase()]=t;let Vl=[],ka=[];function kr(t){Vl=t.customGear??[],ka=t.customSpells??[]}function Ca(t){return Ul[t.toLowerCase()]??Mr(t)}function Cr(t){return Wl[t.toLowerCase()]}function Or(t){return ql[t.toLowerCase()]}function Sr(t){return ka.find(e=>e.name.toLowerCase()===t.toLowerCase())}function Oa(t){return Fl[t.toLowerCase()]||Sr(t)}function Sa(t){return Vl.find(e=>e.name.toLowerCase()===t.toLowerCase())}function Mr(t){return Vl.filter(e=>e.type==="Weapon").map(e=>e).find(e=>e.name.toLowerCase()===t.toLowerCase())}function xe(t){return Ca(t)||Cr(t)||Or(t)||Sa(t)}const Rr=["Shield","+1","+2","+3","Magic"],Os=["Self","Touch","5 ft","10 ft","30 ft","60 ft","120 ft","Sight"],Gt=["d4","d6","d8","d10","d12","d20","d100"],$r="1.0.0",Dr="dnd5e-char-sheet",qt=["STR","DEX","CON","INT","WIS","CHA"],Ss=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],Ms=["Simple Melee","Simple Ranged","Martial Melee","Martial Ranged"],Nr=["Ammunition","Finesse","Heavy","Light","Loading","Range","Reach","Special","Thrown","Two-Handed","Versatile","Silvered","Magical"],Ir=["armorClass","hp","proficiencyBonus","speed","initiative","passivePerception","stat","skill"],Ol=["attackRoll","damageRoll","savingThrow","skillCheck","abilityCheck","initiativeRoll"],Rs=[...Ir,...Ol],Ft=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard","Artificer"],$s=["Dragonborn","Dwarf","Elf","Gnome","Half-Elf","Half-Orc","Halfling","Human","Tiefling"],Ds=["Common","Dwarvish","Elvish","Giant","Gnomish","Goblin","Halfling","Orc","Abyssal","Celestial","Draconic","Deep Speech","Infernal","Primordial","Sylvan","Undercommon"],Lr={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100};function Ht(t,e=1){let n=0;for(let l=0;l<e;l++)n+=Math.floor(Math.random()*Lr[t])+1;return n}function In(t){return`${t>=0?"+":""}${t}`}function Qn(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),t<e?-1:t>e?1:0}function Ns(t){return xe(t.name)}function jl(t,e=500,n,l){let s;return(...o)=>(n==null||n(),new Promise(i=>{s&&clearTimeout(s),s=setTimeout(()=>{i(t(...o)),l==null||l()},e)}))}function Is(t,e){return Gt.findIndex(n=>n===t)-Gt.findIndex(n=>n===e)}const Pr=100;function Hr(t){const e=[We(t)];let n=0;const l=ct(!1),s=ct(!1),o=jl(i=>{if(i){for(n++,e[n]=JSON.parse(JSON.stringify(i));n<e.length-1;)e.pop();e.length>Pr&&(e.splice(0,1),n=Math.max(0,n-1)),l.set(!0),s.set(!1)}},1e3);return{subscribe:t.subscribe,canUndo:l,canRedo:s,set:i=>{o(i),t.set(i)},undo:()=>{n!==0&&(n--,n===0&&l.set(!1),s.set(!0),t.set(e[n]))},redo:()=>{n>=e.length-1||(n++,n>=e.length-1&&s.set(!1),l.set(!0),t.set(e[n]))}}}const Gr={Barbarian:"野蠻人",Bard:"吟遊詩人",Cleric:"牧師",Druid:"德魯伊",Fighter:"戰士",Monk:"武僧",Paladin:"聖騎士",Ranger:"巡林客",Rogue:"盜賊",Sorcerer:"術士",Warlock:"邪術師",Wizard:"法師",Artificer:"奇械師"},Wr={Dragonborn:"龍裔",Dwarf:"矮人",Elf:"精靈",Gnome:"地侏","Half-Elf":"半精靈","Half-Orc":"半獸人",Halfling:"哈比人",Human:"人類",Tiefling:"堤夫林"},qr={"Lawful Good":"守序善良","Neutral Good":"中立善良","Chaotic Good":"混沌善良","Lawful Neutral":"守序中立","True Neutral":"絕對中立","Chaotic Neutral":"混沌中立","Lawful Evil":"守序邪惡","Neutral Evil":"中立邪惡","Chaotic Evil":"混沌邪惡"},Fr={STR:"力量",DEX:"敏捷",CON:"體質",INT:"智力",WIS:"感知",CHA:"魅力"},Ur={Common:"通用語",Dwarvish:"矮人語",Elvish:"精靈語",Giant:"巨人語",Gnomish:"地侏語",Goblin:"哥布林語",Halfling:"哈比人語",Orc:"獸人語",Abyssal:"深淵語",Celestial:"天界語",Draconic:"龍語","Deep Speech":"地底語",Infernal:"煉獄語",Primordial:"原初語",Sylvan:"森林語",Undercommon:"地底通用語"};function Sl(t){return t?Gr[t]??t:""}function Vr(t){return t?Wr[t]??t:""}function Ma(t){return t?qr[t]??t:""}function gn(t){return t?Fr[t]??t:""}function Ml(t){return t?Ur[t]??t:""}const ye=Hr(ct(Ot())),De=ye;function Ot(){return{name:"",ancestry:"Human",class:"",level:1,title:"",alignment:"True Neutral",background:"Noble",deity:"",notes:"",gear:[],customGear:[],stats:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10},skills:{Acrobatics:0,"Animal Handling":0,Arcana:0,Athletics:0,Deception:0,History:0,Insight:0,Intimidation:0,Investigation:0,Medicine:0,Nature:0,Perception:0,Performance:0,Persuasion:0,Religion:0,"Sleight of Hand":0,Stealth:0,Survival:0},savingThrows:{STR:!1,DEX:!1,CON:!1,INT:!1,WIS:!1,CHA:!1},proficiencyBonus:2,passivePerception:10,speed:30,bonuses:[],customBonuses:[],customTalents:[],maxHitPoints:10,hitPoints:10,tempHitPoints:0,hitDice:{},deathSaves:{successes:0,failures:0},conditions:[],exhaustion:0,armorClass:10,carryingCapacity:150,currency:{cp:0,sp:0,ep:0,gp:0,pp:0},languages:["Common"],customLanguages:[],xp:0,spells:[],customSpells:[],spellSlots:{}}}function jr(t){const e=Ot();return t?{...e,...t,stats:{...e.stats,...t.stats||{}},skills:{...e.skills,...t.skills||{}},savingThrows:{...e.savingThrows,...t.savingThrows||{}},currency:{...e.currency,...t.currency||{}},hitDice:{...e.hitDice,...t.hitDice||{}},deathSaves:{...e.deathSaves,...t.deathSaves||{}},gear:Array.isArray(t.gear)?t.gear:[],customGear:Array.isArray(t.customGear)?t.customGear:[],spells:Array.isArray(t.spells)?t.spells:[],customSpells:Array.isArray(t.customSpells)?t.customSpells:[],bonuses:Array.isArray(t.bonuses)?t.bonuses:[],customBonuses:Array.isArray(t.customBonuses)?t.customBonuses:[],customTalents:Array.isArray(t.customTalents)?t.customTalents:[],conditions:Array.isArray(t.conditions)?t.conditions:[],languages:Array.isArray(t.languages)?t.languages:[],customLanguages:Array.isArray(t.customLanguages)?t.customLanguages:[],proficiencyBonus:t.proficiencyBonus??e.proficiencyBonus,armorClass:t.armorClass??e.armorClass,maxHitPoints:t.maxHitPoints??e.maxHitPoints,hitPoints:t.hitPoints??e.hitPoints}:e}function Ra(t){return t<=0?2:Math.ceil(t/4)+1}function Ut(t,e){const n=zl(t,e);return Math.floor((n-10)/2)}function zr(t,e){t.class=e}function Yr(t,e){t.ancestry=e}function rl(t){const e=(t.gear||[]).filter(o=>o.equipped).flatMap(o=>{const i=xe(o.name);return(i==null?void 0:i.playerBonuses)||[]}),n=(t.customGear||[]).filter(o=>o.equipped).flatMap(o=>o.playerBonuses||[]),l=t.bonuses||[],s=t.customBonuses||[];return[...l,...s,...e,...n]}function zl(t,e){return t.stats[e]+Da(t,e)}function Yl(t,e){var o,i;const n=!t.metadata,l=((o=t.metadata)==null?void 0:o.type)==="weaponType"&&e.weaponType.includes(t.metadata.weaponType),s=((i=t.metadata)==null?void 0:i.type)==="weapon"&&t.metadata.weapon===e.name;return n||l||s}function $a(t,e,n){var i;let l=((i=e.damage[n])==null?void 0:i.diceType)??"d4";const o=rl(t).filter(r=>r.type==="diceType"&&r.bonusTo==="damageRoll"&&Yl(r,e)).map(r=>r.diceType).sort(Is).reverse();return o[0]&&Is(o[0],l)>0&&(l=o[0]),l}function Da(t,e){return rl(t).filter(l=>{var s;return l.type==="modifyAmt"&&l.bonusTo==="stat"&&((s=l.metadata)==null?void 0:s.type)==="stat"&&l.metadata.stat===e}).reduce((l,s)=>l+Qt(t,s),0)}function Kr(t){let e=0;const n=t.gear.filter(r=>r.equipped).map(Ns).filter(r=>{var u;return r.type==="Armor"&&!((u=r.properties)!=null&&u.includes("Shield"))}),l=Ut(t,"DEX");if(n.length>0){const r=n[0],u=r.ac.base;let c=l;r.ac.maxDex!==void 0&&(r.ac.maxDex===0?c=0:c=Math.min(l,r.ac.maxDex)),e=u+c,e+=r.ac.modifier}else e=10+l;const s=t.gear.filter(r=>r.equipped).map(Ns).filter(r=>{var u;return r.type==="Armor"&&((u=r.properties)==null?void 0:u.includes("Shield"))});for(const r of s)e+=r.ac.base>0?r.ac.base:2,e+=r.ac.modifier;const i=rl(t).reduce((r,u)=>u.type==="modifyAmt"&&u.bonusTo==="armorClass"?r+Qt(t,u):r,0);return e+=i,t.armorClass!==10&&(e+=t.armorClass-10),e}function Xr(t){if(t.title)return t.title;const e=Ma(t.alignment),n=t.background||"",l=t.class||"",s=t.level;return`${[e,n,l].filter(i=>i).join(" ")} (Lv. ${s})`}function Na(t,e="Wizard"){const n=Ra(t.level);let l="INT";["Cleric","Druid","Ranger"].includes(t.class||"")&&(l="WIS"),["Bard","Paladin","Sorcerer","Warlock"].includes(t.class||"")&&(l="CHA");const s=Ut(t,l);return n+s}function Jr(t){return 8+Na(t)}function Ln(t,e){var i,r,u;let n=0;const l=Ut(t,"STR"),s=Ut(t,"DEX");(i=e.properties)!=null&&i.includes("Finesse")||e.weaponType&&e.weaponType.includes("Ranged")?e.weaponType.includes("Ranged")&&!((r=e.properties)!=null&&r.includes("Thrown"))?n+=s:(u=e.properties)!=null&&u.includes("Finesse")?n+=Math.max(l,s):n+=l:n+=l;const o=t.bonuses.filter(c=>c.type==="modifyAmt"&&c.bonusTo==="damageRoll").reduce((c,a)=>(Yl(a,e)&&(c+=Qt(t,a)),c),0);return n+=o,n}function Ls(t,e){var r,u;let n=0;const l=Ut(t,"STR"),s=Ut(t,"DEX");(r=e.properties)!=null&&r.includes("Finesse")?n+=Math.max(l,s):e.weaponType.includes("Ranged")&&!((u=e.properties)!=null&&u.includes("Thrown"))?n+=s:n+=l;const o=Ra(t.level);n+=o;const i=t.bonuses.filter(c=>c.type==="modifyAmt"&&c.bonusTo==="attackRoll").reduce((c,a)=>(Yl(a,e)&&(c+=Qt(t,a)),c),0);return n+=i,n}function Zr(t){return zl(t,"STR")*15}function Qr(t){return t.gear.reduce((e,n)=>{const l=xe(n.name);return e+((l==null?void 0:l.weight)||0)*n.quantity},0)}const xr=[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3,1e5,12e4,14e4,165e3,195e3,225e3,265e3,305e3,355e3];function eu(t){if(t.level>=20)return;const e=xr[t.level];t.xp>=e&&(t.level+=1)}function Ia(t,e){return t.spells.findIndex(n=>n.name===e.name)>-1}function tu(t,e){return!0}function nu(t,e){Ia(t,e)||t.spells.push({name:e.name})}function lu(t,e){t.spells=t.spells.filter(n=>n.name!==e.name)}function Bn(t,e){t.bonuses.push(e)}function su(t,e){t.bonuses=t.bonuses.filter(n=>n.name!==e.name)}function Ps(t){const e=t.maxHitPoints,l=rl(t).filter(s=>s.type==="modifyAmt"&&s.bonusTo==="hp").reduce((s,o)=>s+Qt(t,o),0);return e+l}function Qt(t,e){var s;let n=e.bonusAmount;e.bonusTo!=="stat"&&((s=e.metadata)==null?void 0:s.type)==="stat"&&(n=Math.max(n,Ut(t,e.metadata.stat)));const l=Math.floor(t.level*(e.bonusIncreaseRatePerLevel??0));return n+l}function iu(t,e){t.spells=t.spells.filter(n=>n.name!==e.name),t.bonuses=t.bonuses.filter(n=>{var l;return!(((l=n.metadata)==null?void 0:l.type)==="spell"&&n.metadata.spell===e.name)}),t.customSpells=t.customSpells.filter(n=>n.name!==e.name)}function ou(t,e){var s,o,i;const n=e.cost.gp*100+e.cost.sp*10+e.cost.cp;return(((s=t.currency)==null?void 0:s.gp)||0)*100+(((o=t.currency)==null?void 0:o.sp)||0)*10+(((i=t.currency)==null?void 0:i.cp)||0)>=n}function Hs(t,e,n){const l=t.slice();return l[8]=e[n],l}function Gs(t,e,n){const l=t.slice();return l[8]=e[n],l}function Ws(t){let e,n,l,s,o=Ds.filter(t[2]),i=[];for(let r=0;r<o.length;r+=1)i[r]=qs(Gs(t,o,r));return{c(){e=m("select"),n=m("option");for(let r=0;r<i.length;r+=1)i[r].c();n.__value="",n.value=n.__value,p(e,"class","flex-grow")},m(r,u){w(r,e,u),f(e,n);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);l||(s=I(e,"change",t[3]),l=!0)},p(r,u){if(u&4){o=Ds.filter(r[2]);let c;for(c=0;c<o.length;c+=1){const a=Gs(r,o,c);i[c]?i[c].p(a,u):(i[c]=qs(a),i[c].c(),i[c].m(e,null))}for(;c<i.length;c+=1)i[c].d(1);i.length=o.length}},d(r){r&&T(e),Be(i,r),l=!1,s()}}}function qs(t){let e,n=Ml(t[8])+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[8],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function Fs(t){let e,n,l=Ml(t[8])+"",s,o,i,r,u,c;function a(){return t[6](t[8])}return{c(){e=m("li"),n=m("div"),s=G(l),o=y(),i=m("button"),i.innerHTML='<i class="material-icons translate-y-1">delete</i>',r=y(),p(i,"class","text-white bg-black p-1 text-xs"),p(e,"class","border-b flex justify-between gap-4")},m(d,_){w(d,e,_),f(e,n),f(n,s),f(e,o),f(e,i),f(e,r),u||(c=I(i,"click",a),u=!0)},p(d,_){t=d,_&2&&l!==(l=Ml(t[8])+"")&&ee(s,l)},d(d){d&&T(e),u=!1,c()}}}function au(t){let e,n,l,s,o,i=t[0]?"do_not_disturb_on":"add_circle",r,u,c,a,d,_,v=t[0]&&Ws(t),g=t[1].languages,h=[];for(let b=0;b<g.length;b+=1)h[b]=Fs(Hs(t,g,b));return{c(){e=m("div"),n=m("h2"),n.textContent="語言",l=y(),s=m("button"),o=m("i"),r=G(i),u=y(),v&&v.c(),c=y(),a=m("ul");for(let b=0;b<h.length;b+=1)h[b].c();p(o,"class","material-icons translate-y-1"),p(s,"class","px-3 hover:bg-gray-400"),p(e,"class","flex justify-start")},m(b,A){w(b,e,A),f(e,n),f(e,l),f(e,s),f(s,o),f(o,r),f(e,u),v&&v.m(e,null),w(b,c,A),w(b,a,A);for(let E=0;E<h.length;E+=1)h[E]&&h[E].m(a,null);d||(_=I(s,"click",t[5]),d=!0)},p(b,[A]){if(A&1&&i!==(i=b[0]?"do_not_disturb_on":"add_circle")&&ee(r,i),b[0]?v?v.p(b,A):(v=Ws(b),v.c(),v.m(e,null)):v&&(v.d(1),v=null),A&18){g=b[1].languages;let E;for(E=0;E<g.length;E+=1){const B=Hs(b,g,E);h[E]?h[E].p(B,A):(h[E]=Fs(B),h[E].c(),h[E].m(a,null))}for(;E<h.length;E+=1)h[E].d(1);h.length=g.length}},i:V,o:V,d(b){b&&T(e),v&&v.d(),b&&T(c),b&&T(a),Be(h,b),d=!1,_()}}}function ru(t,e,n){let l;Re(t,ye,d=>n(1,l=d));let s=!1;function o(d){return!l.languages.includes(d)}function i(d){l.languages.push(d),n(0,s=!1),ye.set(l)}function r(d){i(d.target.value)}function u(d){ze(ye,l.languages=l.languages.filter(_=>_!==d),l)}return[s,l,o,r,u,()=>{n(0,s=!s)},d=>{u(d)}]}class uu extends Ce{constructor(e){super(),Oe(this,e,ru,au,ke,{})}}const cu=t=>({}),Us=t=>({});function fu(t){let e,n,l,s,o,i,r,u,c,a,d,_,v;const g=t[5].header,h=Rn(g,t,t[4],Us),b=t[5].default,A=Rn(b,t,t[4],null);return{c(){e=m("dialog"),n=m("div"),l=m("button"),l.innerHTML='<i class="material-icons">close</i>',s=y(),h&&h.c(),o=y(),i=m("hr"),r=y(),A&&A.c(),u=y(),c=m("hr"),p(l,"class","absolute top-0 right-0 p-4 hover:bg-gray-200 rounded-md"),p(n,"class","svelte-eyp6eo"),p(e,"class","max-w-3xl svelte-eyp6eo"),p(e,"style",a=`min-width: 20rem; width: ${t[1]}vw;`+t[2]?`height: ${t[2]}vh`:"")},m(E,B){w(E,e,B),f(e,n),f(n,l),f(n,s),h&&h.m(n,null),f(n,o),f(n,i),f(n,r),A&&A.m(n,null),f(n,u),f(n,c),t[8](e),d=!0,_||(v=[I(l,"click",t[7]),I(n,"click",cr(t[6])),I(e,"close",t[9]),I(e,"click",fr(t[10]))],_=!0)},p(E,[B]){h&&h.p&&(!d||B&16)&&$n(h,g,E,E[4],d?Nn(g,E[4],B,cu):Dn(E[4]),Us),A&&A.p&&(!d||B&16)&&$n(A,b,E,E[4],d?Nn(b,E[4],B,null):Dn(E[4]),null),(!d||B&6&&a!==(a=`min-width: 20rem; width: ${E[1]}vw;`+E[2]?`height: ${E[2]}vh`:""))&&p(e,"style",a)},i(E){d||(P(h,E),P(A,E),d=!0)},o(E){W(h,E),W(A,E),d=!1},d(E){E&&T(e),h&&h.d(E),A&&A.d(E),t[8](null),_=!1,Ue(v)}}}function du(t,e,n){let{$$slots:l={},$$scope:s}=e,{showModal:o=!0}=e,{vw:i=85}=e,{vh:r=void 0}=e,u;function c(g){dr.call(this,t,g)}const a=()=>{n(0,o=!1)};function d(g){Ve[g?"unshift":"push"](()=>{u=g,n(3,u)})}const _=()=>n(0,o=!1),v=()=>u.close();return t.$$set=g=>{"showModal"in g&&n(0,o=g.showModal),"vw"in g&&n(1,i=g.vw),"vh"in g&&n(2,r=g.vh),"$$scope"in g&&n(4,s=g.$$scope)},t.$$.update=()=>{t.$$.dirty&9&&u&&(o?u.showModal():u.close())},[o,i,r,u,s,l,c,a,d,_,v]}class ft extends Ce{constructor(e){super(),Oe(this,e,du,fu,ke,{showModal:0,vw:1,vh:2})}}const nl={};function Vs(t,e,n){const l=t.slice();return l[27]=e[n],l}function js(t,e,n){const l=t.slice();return l[30]=e[n],l}function zs(t,e,n){const l=t.slice();return l[33]=e[n],l[35]=n,l}function Ys(t,e,n){const l=t.slice();l[36]=e[n],l[35]=n;const s=nl[l[2].class][l[35]];return l[37]=s,l}function Ks(t){var c,a,d;let e,n,l=(t[36].min===t[36].max?t[36].min:`${t[36].min}-${t[36].max}`)+"",s,o,i,r=(((a=(c=t[37])==null?void 0:c.l10n)==null?void 0:a.name)??((d=t[37])==null?void 0:d.name))+"",u;return{c(){e=m("tr"),n=m("td"),s=G(l),o=y(),i=m("td"),u=G(r),p(e,"class","border-b border-black"),$e(e,"bg-yellow-300",t[1]===t[35])},m(_,v){w(_,e,v),f(e,n),f(n,s),f(e,o),f(e,i),f(i,u)},p(_,v){var g,h,b;v[0]&4&&r!==(r=(((h=(g=_[37])==null?void 0:g.l10n)==null?void 0:h.name)??((b=_[37])==null?void 0:b.name))+"")&&ee(u,r),v[0]&2&&$e(e,"bg-yellow-300",_[1]===_[35])},d(_){_&&T(e)}}}function Xs(t){let e,n,l;return{c(){e=m("button"),e.textContent="擲骰",p(e,"class","w-full bg-black text-white p-1")},m(s,o){w(s,e,o),n||(l=I(e,"click",t[11]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function Js(t){let e,n,l,s,o,i,r,u,c,a,d;return c=pr(t[18][0]),{c(){e=m("div"),n=m("label"),n.textContent="選擇天賦",l=y(),s=m("input"),o=y(),i=m("label"),i.textContent="分配屬性",r=y(),u=m("input"),p(n,"for","chooseTalentCheckBox"),p(s,"id","chooseTalentCheckBox"),p(s,"type","radio"),p(s,"name","pick"),s.__value="talent",s.value=s.__value,p(i,"for","distributeStatsCheckBox"),p(u,"id","distributeStatsCheckBox"),p(u,"type","radio"),p(u,"name","pick"),u.__value="stats",u.value=u.__value,p(e,"class","flex gap-5 items-center justify-center p-2"),c.p(s,u)},m(_,v){w(_,e,v),f(e,n),f(e,l),f(e,s),s.checked=s.__value===t[7],f(e,o),f(e,i),f(e,r),f(e,u),u.checked=u.__value===t[7],a||(d=[I(s,"change",t[17]),I(u,"change",t[19])],a=!0)},p(_,v){v[0]&128&&(s.checked=s.__value===_[7]),v[0]&128&&(u.checked=u.__value===_[7])},d(_){_&&T(e),c.r(),a=!1,Ue(d)}}}function Zs(t){let e,n,l,s=nl[t[2].class],o=[];for(let i=0;i<s.length;i+=1)o[i]=Qs(zs(t,s,i));return{c(){e=m("select");for(let i=0;i<o.length;i+=1)o[i].c();p(e,"class","w-full svelte-ox30w2")},m(i,r){w(i,e,r);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);_e(e,t[1]),n||(l=I(e,"change",t[13]),n=!0)},p(i,r){if(r[0]&4){s=nl[i[2].class];let u;for(u=0;u<s.length;u+=1){const c=zs(i,s,u);o[u]?o[u].p(c,r):(o[u]=Qs(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=s.length}r[0]&2&&_e(e,i[1])},d(i){i&&T(e),Be(o,i),n=!1,l()}}}function Qs(t){var s;let e,n=(((s=t[33].l10n)==null?void 0:s.name)??t[33].name)+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[35],e.value=e.__value},m(o,i){w(o,e,i),f(e,l)},p(o,i){var r;i[0]&4&&n!==(n=(((r=o[33].l10n)==null?void 0:r.name)??o[33].name)+"")&&ee(l,n)},d(o){o&&T(e)}}}function xs(t){let e,n,l,s,o,i=qt,r=[];for(let u=0;u<i.length;u+=1)r[u]=ei(js(t,i,u));return{c(){e=m("div"),n=G("剩餘屬性點數: "),l=G(t[8]),s=y(),o=m("div");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"class","self-center"),p(o,"class","flex flex-col gap-1 items-center")},m(u,c){w(u,e,c),f(e,n),f(e,l),w(u,s,c),w(u,o,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,null)},p(u,c){if(c[0]&256&&ee(l,u[8]),c[0]&49668){i=qt;let a;for(a=0;a<i.length;a+=1){const d=js(u,i,a);r[a]?r[a].p(d,c):(r[a]=ei(d),r[a].c(),r[a].m(o,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}},d(u){u&&T(e),u&&T(s),u&&T(o),Be(r,u)}}}function ei(t){let e,n,l=t[30]+"",s,o,i,r=t[9][t[30]]+"",u,c,a,d,_,v,g,h;function b(){return t[20](t[30])}function A(){return t[21](t[30])}return{c(){e=m("div"),n=m("div"),s=G(l),o=y(),i=m("div"),u=G(r),c=y(),a=m("button"),a.innerHTML='<i class="material-icons">remove</i>',d=y(),_=m("button"),_.innerHTML='<i class="material-icons">add</i>',v=y(),p(n,"class","w-12"),p(i,"class","p-1 bg-gray-200 rounded-md"),$e(i,"text-green-600",t[9][t[30]]>t[2].stats[t[30]]),p(e,"class","flex items-center")},m(E,B){w(E,e,B),f(e,n),f(n,s),f(e,o),f(e,i),f(i,u),f(e,c),f(e,a),f(e,d),f(e,_),f(e,v),g||(h=[I(a,"click",b),I(_,"click",A)],g=!0)},p(E,B){t=E,B[0]&512&&r!==(r=t[9][t[30]]+"")&&ee(u,r),B[0]&516&&$e(i,"text-green-600",t[9][t[30]]>t[2].stats[t[30]])},d(E){E&&T(e),g=!1,Ue(h)}}}function ti(t){let e,n,l,s=t[5],o=[];for(let i=0;i<s.length;i+=1)o[i]=ni(Vs(t,s,i));return{c(){e=m("select");for(let i=0;i<o.length;i+=1)o[i].c();p(e,"class","svelte-ox30w2"),t[6]===void 0&&Pe(()=>t[22].call(e))},m(i,r){w(i,e,r);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);_e(e,t[6],!0),n||(l=I(e,"change",t[22]),n=!0)},p(i,r){if(r[0]&32){s=i[5];let u;for(u=0;u<s.length;u+=1){const c=Vs(i,s,u);o[u]?o[u].p(c,r):(o[u]=ni(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=s.length}r[0]&96&&_e(e,i[6])},d(i){i&&T(e),Be(o,i),n=!1,l()}}}function ni(t){let e,n=si(t[27])+"",l,s;return{c(){e=m("option"),l=G(n),e.__value=s=t[27],e.value=e.__value},m(o,i){w(o,e,i),f(e,l)},p(o,i){i[0]&32&&n!==(n=si(o[27])+"")&&ee(l,n),i[0]&32&&s!==(s=o[27])&&(e.__value=s,e.value=e.__value)},d(o){o&&T(e)}}}function li(t){let e,n,l;return{c(){e=m("button"),e.textContent="更新角色卡",p(e,"class","w-full bg-black text-white p-1")},m(s,o){w(s,e,o),n||(l=I(e,"click",t[12]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function pu(t){let e,n,l,s,o,i,r,u,c,a,d,_,v=t[10],g=[];for(let O=0;O<v.length;O+=1)g[O]=Ks(Ys(t,v,O));let h=t[3]&&Xs(t),b=t[1]===4&&Js(t),A=t[7]==="talent"&&Zs(t),E=t[7]==="stats"&&xs(t),B=t[5].length&&ti(t),C=t[4]&&li(t);return{c(){e=m("table"),n=m("tr"),n.innerHTML=`<th class="w-20">2d6</th> 
      <th>效果</th>`,l=y();for(let O=0;O<g.length;O+=1)g[O].c();s=y(),o=m("tr"),o.innerHTML=`<td>12</td> 
      <td>選擇一項天賦或 +2 點數分配至屬性</td>`,i=y(),h&&h.c(),r=y(),u=m("div"),b&&b.c(),c=y(),A&&A.c(),a=y(),E&&E.c(),d=y(),B&&B.c(),_=y(),C&&C.c(),p(n,"class","text-left border-b border-black"),p(o,"class","border-b border-black"),$e(o,"bg-yellow-300",t[1]===4),p(u,"class","flex flex-col gap-1")},m(O,M){w(O,e,M),f(e,n),f(e,l);for(let N=0;N<g.length;N+=1)g[N]&&g[N].m(e,null);f(e,s),f(e,o),w(O,i,M),h&&h.m(O,M),w(O,r,M),w(O,u,M),b&&b.m(u,null),f(u,c),A&&A.m(u,null),f(u,a),E&&E.m(u,null),f(u,d),B&&B.m(u,null),f(u,_),C&&C.m(u,null)},p(O,M){if(M[0]&1030){v=O[10];let N;for(N=0;N<v.length;N+=1){const R=Ys(O,v,N);g[N]?g[N].p(R,M):(g[N]=Ks(R),g[N].c(),g[N].m(e,s))}for(;N<g.length;N+=1)g[N].d(1);g.length=v.length}M[0]&2&&$e(o,"bg-yellow-300",O[1]===4),O[3]?h?h.p(O,M):(h=Xs(O),h.c(),h.m(r.parentNode,r)):h&&(h.d(1),h=null),O[1]===4?b?b.p(O,M):(b=Js(O),b.c(),b.m(u,c)):b&&(b.d(1),b=null),O[7]==="talent"?A?A.p(O,M):(A=Zs(O),A.c(),A.m(u,a)):A&&(A.d(1),A=null),O[7]==="stats"?E?E.p(O,M):(E=xs(O),E.c(),E.m(u,d)):E&&(E.d(1),E=null),O[5].length?B?B.p(O,M):(B=ti(O),B.c(),B.m(u,_)):B&&(B.d(1),B=null),O[4]?C?C.p(O,M):(C=li(O),C.c(),C.m(u,null)):C&&(C.d(1),C=null)},d(O){O&&T(e),Be(g,O),O&&T(i),h&&h.d(O),O&&T(r),O&&T(u),b&&b.d(),A&&A.d(),E&&E.d(),B&&B.d(),C&&C.d()}}}function mu(t){let e;return{c(){e=m("h2"),e.textContent="擲新天賦",p(e,"slot","header"),p(e,"class","text-lg")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function _u(t){let e,n,l,s,o,i,r;function u(a){t[23](a)}let c={$$slots:{header:[mu],default:[pu]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=m("button"),e.textContent="擲新天賦",n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white w-full p-2")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=I(e,"click",t[16]),i=!0)},p(a,d){const _={};d[0]&1022|d[1]&256&&(_.$$scope={dirty:d,ctx:a}),!s&&d[0]&1&&(s=!0,_.showModal=a[0],Ke(()=>s=!1)),l.$set(_)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function si(t){var e;return Array.isArray(t)?t.map(n=>{var l;return((l=n.l10n)==null?void 0:l.name)??n.name}).join(" & "):((e=t.l10n)==null?void 0:e.name)??t.name}function hu(t,e,n){let l,s;Re(t,De,F=>n(2,s=F));let o=!1;const i=[{min:2,max:2},{min:3,max:7},{min:8,max:9},{min:10,max:11}];let r=!0,u=!1,c=-1;function a(){const F=Ht("d6")+Ht("d6");if(n(3,r=!1),F===12){n(1,c=4),n(4,u=!0);return}for(let Q=0;Q<i.length;Q++){const ve=i[Q];if(F>=ve.min&&F<=ve.max){n(1,c=Q),n(4,u=!0);break}}}let d=[],_,v=()=>{};function g(F){const Q=nl[s.class][F];switch(Q==null?void 0:Q.type){case"generic":v=()=>{Bn(s,{name:Q.name,desc:Q.name,type:"generic",editable:!0})};break;case"bonus":v=()=>{for(const re of Q.bonuses)Bn(s,re)};break;case"chooseBonus":const ve=Q.choices[0];!Array.isArray(ve)&&ve.metadata&&ve.metadata.type==="spell"?n(5,d=Q.choices.filter(re=>s.spells.find(de=>{var ae;return de.name===((ae=re.metadata)==null?void 0:ae.spell)}))):n(5,d=Q.choices);break}}function h(){n(3,r=!0),n(1,c=-1),n(4,u=!1),n(5,d=[]),n(6,_=void 0),n(7,A=void 0),n(8,E=2),n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})}function b(){if(A==="stats")ze(De,s.stats=l,s);else if(_)if(Array.isArray(_))for(const F of _)Bn(s,F);else Bn(s,_);else v();De.set(s),n(0,o=!1)}let A,E=2;function B(F){n(5,d=[]),g(parseInt(F.target.value))}function C(F){E<1||(n(9,l[F]+=1,l),n(8,E-=1))}function O(F){E===2||l[F]-1<s.stats[F]||(n(9,l[F]=Math.max(s.stats[F],l[F]-1),l),n(8,E+=1))}const M=[[]],N=()=>n(0,o=!0);function R(){A=this.__value,n(7,A)}function S(){A=this.__value,n(7,A)}const k=F=>O(F),$=F=>C(F);function D(){_=Ge(this),n(6,_),n(5,d)}function U(F){o=F,n(0,o)}return t.$$.update=()=>{t.$$.dirty[0]&1&&(o||h()),t.$$.dirty[0]&2&&c>-1&&g(c),t.$$.dirty[0]&4&&n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})},[o,c,s,r,u,d,_,A,E,l,i,a,b,B,C,O,N,R,M,S,k,$,D,U]}class gu extends Ce{constructor(e){super(),Oe(this,e,hu,_u,ke,{},null,[-1,-1])}}function vu(t){let e,n,l,s,o=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",i,r,u=t[1].diceType+"",c;return{c(){e=m("div"),n=G(t[3]),l=y(),s=m("div"),i=G(o),r=y(),c=G(u),p(e,"class","font-bold")},m(a,d){w(a,e,d),f(e,n),w(a,l,d),w(a,s,d),f(s,i),f(s,r),f(s,c)},p(a,d){d&8&&ee(n,a[3]),d&2&&o!==(o=(a[5][a[1].bonusTo]??a[1].bonusTo)+"")&&ee(i,o),d&2&&u!==(u=a[1].diceType+"")&&ee(c,u)},d(a){a&&T(e),a&&T(l),a&&T(s)}}}function bu(t){let e,n,l,s,o=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",i,r,u=t[1].type==="advantage"?"優勢":"劣勢",c;return{c(){e=m("div"),n=G(t[3]),l=y(),s=m("div"),i=G(o),r=y(),c=G(u),p(e,"class","font-bold")},m(a,d){w(a,e,d),f(e,n),w(a,l,d),w(a,s,d),f(s,i),f(s,r),f(s,c)},p(a,d){d&8&&ee(n,a[3]),d&2&&o!==(o=(a[5][a[1].bonusTo]??a[1].bonusTo)+"")&&ee(i,o),d&2&&u!==(u=a[1].type==="advantage"?"優勢":"劣勢")&&ee(c,u)},d(a){a&&T(e),a&&T(l),a&&T(s)}}}function yu(t){let e,n,l,s,o=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",i,r,u=In(Qt(t[4],t[1]))+"",c;return{c(){e=m("div"),n=G(t[3]),l=y(),s=m("div"),i=G(o),r=y(),c=G(u),p(e,"class","font-bold")},m(a,d){w(a,e,d),f(e,n),w(a,l,d),w(a,s,d),f(s,i),f(s,r),f(s,c)},p(a,d){d&8&&ee(n,a[3]),d&2&&o!==(o=(a[5][a[1].bonusTo]??a[1].bonusTo)+"")&&ee(i,o),d&18&&u!==(u=In(Qt(a[4],a[1]))+"")&&ee(c,u)},d(a){a&&T(e),a&&T(l),a&&T(s)}}}function wu(t){var s;let e,n=(((s=t[1].l10n)==null?void 0:s.desc)??t[1].desc)+"",l;return{c(){e=m("div"),l=G(n)},m(o,i){w(o,e,i),f(e,l)},p(o,i){var r;i&2&&n!==(n=(((r=o[1].l10n)==null?void 0:r.desc)??o[1].desc)+"")&&ee(l,n)},d(o){o&&T(e)}}}function ii(t){let e,n,l;return{c(){e=m("button"),e.innerHTML='<i class="material-icons">info</i>'},m(s,o){w(s,e,o),n||(l=I(e,"click",t[8]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function oi(t){let e,n,l,s;return{c(){e=m("div"),n=m("button"),n.innerHTML='<i class="material-icons">delete</i>',p(n,"class","pt-1 px-1 rounded-md bg-black text-white"),p(e,"class","flex gap-1")},m(o,i){w(o,e,i),f(e,n),l||(s=I(n,"click",t[9]),l=!0)},p:V,d(o){o&&T(e),l=!1,s()}}}function ai(t){let e,n,l;function s(i){t[10](i)}let o={$$slots:{header:[Eu],default:[Tu]},$$scope:{ctx:t}};return t[2]!==void 0&&(o.showModal=t[2]),e=new ft({props:o}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&2050&&(u.$$scope={dirty:r,ctx:i}),!n&&r&4&&(n=!0,u.showModal=i[2],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){W(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function Tu(t){let e,n,l=t[1].desc+"",s,o,i,r,u=(t[1].bonusSource??"none")+"",c,a,d,_,v=(t[1].editable??"no")+"",g;return{c(){e=m("div"),n=G("Description: "),s=G(l),o=y(),i=m("div"),r=G("Source: "),c=G(u),a=y(),d=m("div"),_=G("Editable: "),g=G(v)},m(h,b){w(h,e,b),f(e,n),f(e,s),w(h,o,b),w(h,i,b),f(i,r),f(i,c),w(h,a,b),w(h,d,b),f(d,_),f(d,g)},p(h,b){b&2&&l!==(l=h[1].desc+"")&&ee(s,l),b&2&&u!==(u=(h[1].bonusSource??"none")+"")&&ee(c,u),b&2&&v!==(v=(h[1].editable??"no")+"")&&ee(g,v)},d(h){h&&T(e),h&&T(o),h&&T(i),h&&T(a),h&&T(d)}}}function Eu(t){let e,n=t[1].name+"",l;return{c(){e=m("h2"),l=G(n),p(e,"slot","header")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&2&&n!==(n=s[1].name+"")&&ee(l,n)},d(s){s&&T(e)}}}function Au(t){let e,n,l,s,o,i,r;function u(g,h){if(g[1].type==="generic")return wu;if(g[1].type==="modifyAmt")return yu;if(g[1].type==="disadvantage"||g[1].type==="advantage")return bu;if(g[1].type==="diceType")return vu}let c=u(t),a=c&&c(t),d=t[0]&&ii(t),_=t[1].editable&&oi(t),v=t[2]&&ai(t);return{c(){e=m("div"),n=m("div"),a&&a.c(),l=y(),d&&d.c(),s=y(),_&&_.c(),o=y(),v&&v.c(),i=vt(),p(n,"class","flex gap-1"),p(e,"class","flex justify-between gap-3 items-center")},m(g,h){w(g,e,h),f(e,n),a&&a.m(n,null),f(n,l),d&&d.m(n,null),f(e,s),_&&_.m(e,null),w(g,o,h),v&&v.m(g,h),w(g,i,h),r=!0},p(g,[h]){c===(c=u(g))&&a?a.p(g,h):(a&&a.d(1),a=c&&c(g),a&&(a.c(),a.m(n,l))),g[0]?d?d.p(g,h):(d=ii(g),d.c(),d.m(n,null)):d&&(d.d(1),d=null),g[1].editable?_?_.p(g,h):(_=oi(g),_.c(),_.m(e,null)):_&&(_.d(1),_=null),g[2]?v?(v.p(g,h),h&4&&P(v,1)):(v=ai(g),v.c(),P(v,1),v.m(i.parentNode,i)):v&&(qe(),W(v,1,1,()=>{v=null}),Fe())},i(g){r||(P(v),r=!0)},o(g){W(v),r=!1},d(g){g&&T(e),a&&a.d(),d&&d.d(),_&&_.d(),g&&T(o),v&&v.d(g),g&&T(i)}}}function Bu(t,e,n){let l,s;Re(t,De,g=>n(4,s=g));let{bonus:o}=e,{showInfo:i=!0}=e,r=!1;const u={attackRoll:"攻擊檢定",damageRoll:"傷害",armorClass:"AC",hp:"生命值",gearSlots:"裝備格",spellcastRoll:"施法檢定",backstabDice:"背刺骰",initiativeRoll:"先攻",hpRoll:"生命值擲骰",stat:"屬性",statRoll:"屬性檢定"};let c="";function a(g){su(s,g),De.set(s)}const d=()=>{n(2,r=!0)},_=()=>a(l);function v(g){r=g,n(2,r)}return t.$$set=g=>{"bonus"in g&&n(7,o=g.bonus),"showInfo"in g&&n(0,i=g.showInfo)},t.$$.update=()=>{var g,h,b,A;if(t.$$.dirty&128&&n(1,l=o),t.$$.dirty&2)switch((g=l.metadata)==null?void 0:g.type){case"weapon":{const E=xe(l.metadata.weapon);n(3,c=(((h=E==null?void 0:E.l10n)==null?void 0:h.name)??l.metadata.weapon)+":");break}case"weaponType":{n(3,c=({Melee:"近戰",Ranged:"遠程",MeleeRanged:"近戰/遠程"}[l.metadata.weaponType]??l.metadata.weaponType)+":");break}case"armor":{const E=xe(l.metadata.armor);n(3,c=(((b=E==null?void 0:E.l10n)==null?void 0:b.name)??l.metadata.armor)+":");break}case"stat":{n(3,c=gn(l.metadata.stat)+":");break}case"spell":{const E=Oa(l.metadata.spell);n(3,c=(((A=E==null?void 0:E.l10n)==null?void 0:A.name)??l.metadata.spell)+":");break}default:n(3,c="")}},[i,l,r,c,s,u,a,o,d,_,v]}class Kl extends Ce{constructor(e){super(),Oe(this,e,Bu,Au,ke,{bonus:7,showInfo:0})}}function ri(t,e,n){const l=t.slice();return l[44]=e[n],l}function ui(t,e,n){const l=t.slice();return l[39]=e[n],l}function ci(t,e,n){const l=t.slice();return l[39]=e[n],l}function fi(t,e,n){const l=t.slice();return l[36]=e[n],l}function di(t,e,n){const l=t.slice();return l[33]=e[n],l}function pi(t,e,n){const l=t.slice();return l[47]=e[n],l}function mi(t,e,n){const l=t.slice();return l[50]=e[n],l}function _i(t,e,n){const l=t.slice();return l[50]=e[n],l}function hi(t){let e,n,l,s,o,i;function r(a,d){return a[10]==="diceType"||a[10]==="advantage"||a[10]==="disadvantage"?Cu:ku}let u=r(t),c=u(t);return{c(){e=m("div"),n=m("label"),n.textContent="加值對象:",l=y(),s=m("select"),c.c(),p(n,"for","bto"),p(n,"class","font-bold"),p(s,"id","bto"),p(s,"class","border p-1 rounded"),t[2]===void 0&&Pe(()=>t[23].call(s)),p(e,"class","flex flex-col")},m(a,d){w(a,e,d),f(e,n),f(e,l),f(e,s),c.m(s,null),_e(s,t[2],!0),o||(i=I(s,"change",t[23]),o=!0)},p(a,d){u===(u=r(a))&&c?c.p(a,d):(c.d(1),c=u(a),c&&(c.c(),c.m(s,null))),d[0]&4&&_e(s,a[2])},d(a){a&&T(e),c.d(),o=!1,i()}}}function ku(t){let e,n=Rs,l=[];for(let s=0;s<n.length;s+=1)l[s]=gi(mi(t,n,s));return{c(){for(let s=0;s<l.length;s+=1)l[s].c();e=vt()},m(s,o){for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(s,o);w(s,e,o)},p(s,o){if(o[0]&262144){n=Rs;let i;for(i=0;i<n.length;i+=1){const r=mi(s,n,i);l[i]?l[i].p(r,o):(l[i]=gi(r),l[i].c(),l[i].m(e.parentNode,e))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}},d(s){Be(l,s),s&&T(e)}}}function Cu(t){let e,n=Ol,l=[];for(let s=0;s<n.length;s+=1)l[s]=vi(_i(t,n,s));return{c(){for(let s=0;s<l.length;s+=1)l[s].c();e=vt()},m(s,o){for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(s,o);w(s,e,o)},p(s,o){if(o[0]&262144){n=Ol;let i;for(i=0;i<n.length;i+=1){const r=_i(s,n,i);l[i]?l[i].p(r,o):(l[i]=vi(r),l[i].c(),l[i].m(e.parentNode,e))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}},d(s){Be(l,s),s&&T(e)}}}function gi(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[50],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function vi(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[50],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function Ou(t){let e,n,l,s,o,i,r=Gt,u=[];for(let c=0;c<r.length;c+=1)u[c]=bi(pi(t,r,c));return{c(){e=m("div"),n=m("label"),n.textContent="骰子類型",l=y(),s=m("select");for(let c=0;c<u.length;c+=1)u[c].c();p(n,"for","diceType"),p(n,"class","font-bold"),p(s,"id","diceType"),p(s,"class","border p-1 rounded"),t[12]===void 0&&Pe(()=>t[25].call(s)),p(e,"class","flex flex-col")},m(c,a){w(c,e,a),f(e,n),f(e,l),f(e,s);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(s,null);_e(s,t[12],!0),o||(i=I(s,"change",t[25]),o=!0)},p(c,a){if(a&0){r=Gt;let d;for(d=0;d<r.length;d+=1){const _=pi(c,r,d);u[d]?u[d].p(_,a):(u[d]=bi(_),u[d].c(),u[d].m(s,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=r.length}a[0]&4096&&_e(s,c[12])},d(c){c&&T(e),Be(u,c),o=!1,i()}}}function Su(t){let e,n,l,s,o,i;return{c(){e=m("div"),n=m("label"),n.textContent="數值多少?",l=y(),s=m("input"),p(n,"for","modifyAmt"),p(n,"class","font-bold"),p(s,"id","modifyAmt"),p(s,"type","number"),p(s,"inputmode","numeric"),p(s,"class","border p-1 rounded"),p(e,"class","flex flex-col")},m(r,u){w(r,e,u),f(e,n),f(e,l),f(e,s),oe(s,t[11]),o||(i=I(s,"input",t[24]),o=!0)},p(r,u){u[0]&2048&&Me(s.value)!==r[11]&&oe(s,r[11])},d(r){r&&T(e),o=!1,i()}}}function bi(t){let e,n=t[47]+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[47],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function Mu(t){let e,n,l,s,o,i=Ms,r=[];for(let u=0;u<i.length;u+=1)r[u]=yi(ri(t,i,u));return{c(){e=m("label"),e.textContent="選擇武器類型",n=y(),l=m("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","weaponType"),p(l,"id","weaponType"),p(l,"class","border p-1 rounded w-full"),t[8]===void 0&&Pe(()=>t[31].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);_e(l,t[8],!0),s||(o=I(l,"change",t[31]),s=!0)},p(u,c){if(c&0){i=Ms;let a;for(a=0;a<i.length;a+=1){const d=ri(u,i,a);r[a]?r[a].p(d,c):(r[a]=yi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&256&&_e(l,u[8])},d(u){u&&T(e),u&&T(n),u&&T(l),Be(r,u),s=!1,o()}}}function Ru(t){let e,n,l,s,o,i=qt,r=[];for(let u=0;u<i.length;u+=1)r[u]=wi(ui(t,i,u));return{c(){e=m("label"),e.textContent="選擇屬性",n=y(),l=m("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","stat"),p(l,"id","stat"),p(l,"class","border p-1 rounded w-full"),t[7]===void 0&&Pe(()=>t[30].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);_e(l,t[7],!0),s||(o=I(l,"change",t[30]),s=!0)},p(u,c){if(c&0){i=qt;let a;for(a=0;a<i.length;a+=1){const d=ui(u,i,a);r[a]?r[a].p(d,c):(r[a]=wi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&128&&_e(l,u[7])},d(u){u&&T(e),u&&T(n),u&&T(l),Be(r,u),s=!1,o()}}}function $u(t){let e,n,l,s,o,i=t[14],r=[];for(let u=0;u<i.length;u+=1)r[u]=Ti(ci(t,i,u));return{c(){e=m("label"),e.textContent="選擇法術",n=y(),l=m("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","spell"),p(l,"id","spell"),p(l,"class","border p-1 rounded w-full"),t[6]===void 0&&Pe(()=>t[29].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);_e(l,t[6],!0),s||(o=I(l,"change",t[29]),s=!0)},p(u,c){if(c[0]&16384){i=u[14];let a;for(a=0;a<i.length;a+=1){const d=ci(u,i,a);r[a]?r[a].p(d,c):(r[a]=Ti(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&16448&&_e(l,u[6])},d(u){u&&T(e),u&&T(n),u&&T(l),Be(r,u),s=!1,o()}}}function Du(t){let e,n,l,s,o,i=t[15],r=[];for(let u=0;u<i.length;u+=1)r[u]=Ei(fi(t,i,u));return{c(){e=m("label"),e.textContent="選擇防具",n=y(),l=m("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","armor"),p(l,"id","armor"),p(l,"class","border p-1 rounded w-full"),t[5]===void 0&&Pe(()=>t[28].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);_e(l,t[5],!0),s||(o=I(l,"change",t[28]),s=!0)},p(u,c){if(c[0]&32768){i=u[15];let a;for(a=0;a<i.length;a+=1){const d=fi(u,i,a);r[a]?r[a].p(d,c):(r[a]=Ei(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&32800&&_e(l,u[5])},d(u){u&&T(e),u&&T(n),u&&T(l),Be(r,u),s=!1,o()}}}function Nu(t){let e,n,l,s,o,i=t[16],r=[];for(let u=0;u<i.length;u+=1)r[u]=Ai(di(t,i,u));return{c(){e=m("label"),e.textContent="選擇武器",n=y(),l=m("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","weapon"),p(l,"id","weapon"),p(l,"class","border p-1 rounded w-full"),t[4]===void 0&&Pe(()=>t[27].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);_e(l,t[4],!0),s||(o=I(l,"change",t[27]),s=!0)},p(u,c){if(c[0]&65536){i=u[16];let a;for(a=0;a<i.length;a+=1){const d=di(u,i,a);r[a]?r[a].p(d,c):(r[a]=Ai(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&65552&&_e(l,u[4])},d(u){u&&T(e),u&&T(n),u&&T(l),Be(r,u),s=!1,o()}}}function yi(t){let e,n=t[44]+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[44],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function wi(t){let e,n=gn(t[39])+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[39],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function Ti(t){var o;let e,n=(((o=t[39].l10n)==null?void 0:o.name)??t[39].name)+"",l,s;return{c(){e=m("option"),l=G(n),e.__value=s=t[39].name,e.value=e.__value},m(i,r){w(i,e,r),f(e,l)},p(i,r){var u;r[0]&16384&&n!==(n=(((u=i[39].l10n)==null?void 0:u.name)??i[39].name)+"")&&ee(l,n),r[0]&16384&&s!==(s=i[39].name)&&(e.__value=s,e.value=e.__value)},d(i){i&&T(e)}}}function Ei(t){var o;let e,n=(((o=t[36].l10n)==null?void 0:o.name)??t[36].name)+"",l,s;return{c(){e=m("option"),l=G(n),e.__value=s=t[36].name,e.value=e.__value},m(i,r){w(i,e,r),f(e,l)},p(i,r){var u;r[0]&32768&&n!==(n=(((u=i[36].l10n)==null?void 0:u.name)??i[36].name)+"")&&ee(l,n),r[0]&32768&&s!==(s=i[36].name)&&(e.__value=s,e.value=e.__value)},d(i){i&&T(e)}}}function Ai(t){var o;let e,n=(((o=t[33].l10n)==null?void 0:o.name)??t[33].name)+"",l,s;return{c(){e=m("option"),l=G(n),e.__value=s=t[33].name,e.value=e.__value},m(i,r){w(i,e,r),f(e,l)},p(i,r){var u;r[0]&65536&&n!==(n=(((u=i[33].l10n)==null?void 0:u.name)??i[33].name)+"")&&ee(l,n),r[0]&65536&&s!==(s=i[33].name)&&(e.__value=s,e.value=e.__value)},d(i){i&&T(e)}}}function Iu(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h,b,A,E,B,C,O,M,N,R,S,k,$,D,U,F,Q,ve,re,de,ae,j,q,K,we,Y,pe=t[10]!=="generic"&&hi(t);function be(ue,ce){if(ue[10]==="modifyAmt")return Su;if(ue[10]==="diceType")return Ou}let X=be(t),H=X&&X(t);function J(ue,ce){if(ue[3]==="weapon")return Nu;if(ue[3]==="armor")return Du;if(ue[3]==="spell")return $u;if(ue[3]==="stat")return Ru;if(ue[3]==="weaponType")return Mu}let he=J(t),me=he&&he(t);return{c(){e=m("div"),n=m("div"),l=m("label"),l.textContent="名稱",s=y(),o=m("input"),i=y(),r=m("div"),u=m("label"),u.textContent="描述",c=y(),a=m("input"),d=y(),_=m("div"),v=m("label"),v.textContent="加值類型",g=y(),h=m("select"),b=m("option"),b.textContent="一般 (純文字描述)",A=m("option"),A.textContent="數值修正 (例如 +1) ",E=m("option"),E.textContent="優勢 ",B=m("option"),B.textContent="劣勢 ",C=m("option"),C.textContent="更改骰子類型",O=y(),pe&&pe.c(),M=y(),H&&H.c(),N=y(),R=m("div"),S=m("label"),S.textContent="進階條件 (選填)",k=y(),$=m("select"),D=m("option"),D.textContent="無",U=m("option"),U.textContent="特定武器",F=m("option"),F.textContent="特定防具",Q=m("option"),Q.textContent="特定法術",ve=m("option"),ve.textContent="特定屬性",re=m("option"),re.textContent="特定武器類型",de=y(),me&&me.c(),ae=y(),j=m("button"),q=G(t[13]),p(l,"for","name"),p(l,"class","font-bold"),p(o,"id","name"),p(o,"type","text"),p(o,"placeholder","例如：力量藥水"),p(o,"class","border p-1 rounded"),p(n,"class","flex flex-col"),p(u,"for","desc"),p(u,"class","font-bold"),p(a,"id","desc"),p(a,"placeholder","例如：力量 +2"),p(a,"class","border p-1 rounded"),p(r,"class","flex flex-col"),p(v,"for","type"),p(v,"class","font-bold"),b.__value="generic",b.value=b.__value,A.__value="modifyAmt",A.value=A.__value,E.__value="advantage",E.value=E.__value,B.__value="disadvantage",B.value=B.__value,C.__value="diceType",C.value=C.__value,p(h,"id","type"),p(h,"class","border p-1 rounded"),t[10]===void 0&&Pe(()=>t[22].call(h)),p(_,"class","flex flex-col"),p(S,"for","metaDataType"),p(S,"class","font-bold text-sm block mb-1"),D.__value="",D.value=D.__value,U.__value="weapon",U.value=U.__value,F.__value="armor",F.value=F.__value,Q.__value="spell",Q.value=Q.__value,ve.__value="stat",ve.value=ve.__value,re.__value="weaponType",re.value=re.__value,p($,"id","metaDataType"),p($,"class","border p-1 rounded w-full mb-2"),t[3]===void 0&&Pe(()=>t[26].call($)),p(R,"class","border-t pt-2 mt-2"),p(j,"class","w-full p-2 bg-black text-white mt-4 rounded shadow font-bold disabled:opacity-50 disabled:cursor-not-allowed"),j.disabled=K=!t[9],p(e,"class","flex flex-col gap-2 w-full max-h-[80vh] overflow-y-auto p-1")},m(ue,ce){w(ue,e,ce),f(e,n),f(n,l),f(n,s),f(n,o),oe(o,t[0]),f(e,i),f(e,r),f(r,u),f(r,c),f(r,a),oe(a,t[1]),f(e,d),f(e,_),f(_,v),f(_,g),f(_,h),f(h,b),f(h,A),f(h,E),f(h,B),f(h,C),_e(h,t[10],!0),f(e,O),pe&&pe.m(e,null),f(e,M),H&&H.m(e,null),f(e,N),f(e,R),f(R,S),f(R,k),f(R,$),f($,D),f($,U),f($,F),f($,Q),f($,ve),f($,re),_e($,t[3],!0),f(R,de),me&&me.m(R,null),f(e,ae),f(e,j),f(j,q),we||(Y=[I(o,"input",t[20]),I(a,"input",t[21]),I(h,"change",t[22]),I($,"change",t[26]),I(j,"click",t[17])],we=!0)},p(ue,ce){ce[0]&1&&o.value!==ue[0]&&oe(o,ue[0]),ce[0]&2&&a.value!==ue[1]&&oe(a,ue[1]),ce[0]&1024&&_e(h,ue[10]),ue[10]!=="generic"?pe?pe.p(ue,ce):(pe=hi(ue),pe.c(),pe.m(e,M)):pe&&(pe.d(1),pe=null),X===(X=be(ue))&&H?H.p(ue,ce):(H&&H.d(1),H=X&&X(ue),H&&(H.c(),H.m(e,N))),ce[0]&8&&_e($,ue[3]),he===(he=J(ue))&&me?me.p(ue,ce):(me&&me.d(1),me=he&&he(ue),me&&(me.c(),me.m(R,null))),ce[0]&8192&&ee(q,ue[13]),ce[0]&512&&K!==(K=!ue[9])&&(j.disabled=K)},i:V,o:V,d(ue){ue&&T(e),pe&&pe.d(),H&&H.d(),me&&me.d(),we=!1,Ue(Y)}}}function Lu(t,e,n){let l,s,o,i;Re(t,De,j=>n(19,i=j));const r=yn();let u="",c="",a="generic",d="attackRoll",_=1,v="",g="d8",h="",b="",A="",E="",B="",C=!!u&&!!c,O="新增";function M(){let j;switch(a){case"generic":j={name:u,desc:c,type:a};break;case"modifyAmt":j={name:u,desc:c,type:a,bonusTo:d,bonusAmount:_};break;case"advantage":case"disadvantage":{j={name:u,desc:c,type:a,bonusTo:d};break}case"diceType":j={name:u,desc:c,type:a,bonusTo:d,diceType:g};break;default:return}v&&(v==="weapon"&&h?j.metadata={type:"weapon",weapon:h}:v==="weaponType"&&B?j.metadata={type:"weaponType",weaponType:B}:v==="armor"&&b?j.metadata={type:"armor",armor:b}:v==="stat"&&E?j.metadata={type:"stat",stat:E}:v==="spell"&&A&&(j.metadata={type:"spell",spell:A})),j.editable=!0,Bn(i,j),De.set(i),r("finish")}const N={attackRoll:"攻擊檢定 (Attack)",damageRoll:"傷害檢定 (Damage)",armorClass:"AC (防禦)",hp:"HP (生命)",proficiencyBonus:"熟練加值",speed:"速度",initiative:"先攻 (數值)",initiativeRoll:"先攻檢定 (Roll)",passivePerception:"被動感知",stat:"屬性值 (Score)",savingThrow:"豁免檢定",skillCheck:"技能檢定",abilityCheck:"屬性檢定 (Check)"};function R(){u=this.value,n(0,u)}function S(){c=this.value,n(1,c)}function k(){a=Ge(this),n(10,a)}function $(){d=Ge(this),n(2,d)}function D(){_=Me(this.value),n(11,_)}function U(){g=Ge(this),n(12,g)}function F(){v=Ge(this),n(3,v),n(2,d),n(0,u),n(1,c),n(7,E),n(4,h),n(5,b),n(6,A),n(8,B),n(9,C)}function Q(){h=Ge(this),n(4,h),n(2,d),n(16,l),n(19,i)}function ve(){b=Ge(this),n(5,b),n(2,d),n(15,s),n(19,i)}function re(){A=Ge(this),n(6,A),n(2,d),n(14,o),n(19,i)}function de(){E=Ge(this),n(7,E),n(2,d)}function ae(){B=Ge(this),n(8,B),n(2,d)}return t.$$.update=()=>{t.$$.dirty[0]&524288&&n(16,l=Ba.concat(i.customGear.filter(j=>j.type==="Weapon").map(j=>j)??[])),t.$$.dirty[0]&524288&&n(15,s=Ea.concat(i.customGear.filter(j=>j.type==="Armor").map(j=>j)??[])),t.$$.dirty[0]&524288&&n(14,o=Aa.concat(i.customSpells??[])),t.$$.dirty[0]&4&&d&&(n(4,h=""),n(5,b=""),n(6,A=""),n(7,E=""),n(8,B="")),t.$$.dirty[0]&1023&&(d==="stat"?(n(3,v="stat"),n(9,C=!!u&&!!c&&!!E)):n(9,C=!!u&&!!c),v==="stat"&&!E&&n(9,C=!1),v==="weapon"&&!h&&n(9,C=!1),v==="armor"&&!b&&n(9,C=!1),v==="spell"&&!A&&n(9,C=!1),v==="weaponType"&&!B&&n(9,C=!1),n(13,O=C?"新增":"請填寫必要欄位"))},[u,c,d,v,h,b,A,E,B,C,a,_,g,O,o,s,l,M,N,i,R,S,k,$,D,U,F,Q,ve,re,de,ae]}class Pu extends Ce{constructor(e){super(),Oe(this,e,Lu,Iu,ke,{},null,[-1,-1])}}function Bi(t){let e,n,l;function s(i){t[4](i)}let o={$$slots:{header:[Gu],default:[Hu]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ft({props:o}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&33&&(u.$$scope={dirty:r,ctx:i}),!n&&r&2&&(n=!0,u.showModal=i[1],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){W(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function Hu(t){let e,n;return e=new Pu({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:V,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Gu(t){let e;return{c(){e=m("h1"),e.textContent="自訂加值",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Wu(t){let e,n,l,s,o,i,r=t[0]&&Bi(t);return{c(){e=m("button"),e.textContent="自訂加值",n=y(),r&&r.c(),l=vt(),p(e,"class","w-full bg-black text-white p-2")},m(u,c){w(u,e,c),w(u,n,c),r&&r.m(u,c),w(u,l,c),s=!0,o||(i=I(e,"click",t[2]),o=!0)},p(u,[c]){u[0]?r?(r.p(u,c),c&1&&P(r,1)):(r=Bi(u),r.c(),P(r,1),r.m(l.parentNode,l)):r&&(qe(),W(r,1,1,()=>{r=null}),Fe())},i(u){s||(P(r),s=!0)},o(u){W(r),s=!1},d(u){u&&T(e),u&&T(n),r&&r.d(u),u&&T(l),o=!1,i()}}}function qu(t,e,n){let l=!1,s=!1;const o=()=>{n(0,l=!0),n(1,s=!0)},i=()=>{n(0,l=!1)};function r(u){s=u,n(1,s)}return[l,s,o,i,r]}class Fu extends Ce{constructor(e){super(),Oe(this,e,qu,Wu,ke,{})}}function ki(t,e,n){const l=t.slice();return l[6]=e[n],l}function Ci(t,e,n){const l=t.slice();return l[9]=e[n],l}function Oi(t,e,n){const l=t.slice();return l[6]=e[n],l}function Si(t,e,n){const l=t.slice();return l[9]=e[n],l}function Mi(t,e,n){const l=t.slice();return l[9]=e[n],l}function Ri(t){let e,n,l,s;return n=new Kl({props:{bonus:t[9]}}),{c(){e=m("li"),ne(n.$$.fragment),l=y(),p(e,"class","border-b")},m(o,i){w(o,e,i),le(n,e,null),f(e,l),s=!0},p(o,i){const r={};i&1&&(r.bonus=o[9]),n.$set(r)},i(o){s||(P(n.$$.fragment,o),s=!0)},o(o){W(n.$$.fragment,o),s=!1},d(o){o&&T(e),se(n)}}}function $i(t){let e,n,l,s;return l=new Kl({props:{bonus:t[9]}}),{c(){e=m("li"),n=G("* "),ne(l.$$.fragment),p(e,"class","border-b ps-8 flex gap-1")},m(o,i){w(o,e,i),f(e,n),le(l,e,null),s=!0},p(o,i){const r={};i&2&&(r.bonus=o[9]),l.$set(r)},i(o){s||(P(l.$$.fragment,o),s=!0)},o(o){W(l.$$.fragment,o),s=!1},d(o){o&&T(e),se(l)}}}function Di(t){var d;let e,n,l=(((d=t[6].l10n)==null?void 0:d.name)??t[6].name)+"",s,o,i,r,u=t[6].playerBonuses,c=[];for(let _=0;_<u.length;_+=1)c[_]=$i(Si(t,u,_));const a=_=>W(c[_],1,1,()=>{c[_]=null});return{c(){e=m("li"),n=m("div"),s=G(l),o=y(),i=m("ul");for(let _=0;_<c.length;_+=1)c[_].c();p(n,"class","font-bold bg-gray-300"),p(e,"class","border-b")},m(_,v){w(_,e,v),f(e,n),f(n,s),f(e,o),f(e,i);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(i,null);r=!0},p(_,v){var g;if((!r||v&2)&&l!==(l=(((g=_[6].l10n)==null?void 0:g.name)??_[6].name)+"")&&ee(s,l),v&2){u=_[6].playerBonuses;let h;for(h=0;h<u.length;h+=1){const b=Si(_,u,h);c[h]?(c[h].p(b,v),P(c[h],1)):(c[h]=$i(b),c[h].c(),P(c[h],1),c[h].m(i,null))}for(qe(),h=u.length;h<c.length;h+=1)a(h);Fe()}},i(_){if(!r){for(let v=0;v<u.length;v+=1)P(c[v]);r=!0}},o(_){c=c.filter(Boolean);for(let v=0;v<c.length;v+=1)W(c[v]);r=!1},d(_){_&&T(e),Be(c,_)}}}function Ni(t){let e,n,l,s,o;return l=new Kl({props:{bonus:t[9],showInfo:!1}}),{c(){e=m("li"),n=G("* "),ne(l.$$.fragment),s=y(),p(e,"class","border-b ps-8 flex gap-1")},m(i,r){w(i,e,r),f(e,n),le(l,e,null),f(e,s),o=!0},p(i,r){const u={};r&4&&(u.bonus=i[9]),l.$set(u)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(e),se(l)}}}function Ii(t){var _;let e,n,l=(((_=t[6].l10n)==null?void 0:_.name)??t[6].name)+"",s,o,i,r,u,c=t[6].playerBonuses,a=[];for(let v=0;v<c.length;v+=1)a[v]=Ni(Ci(t,c,v));const d=v=>W(a[v],1,1,()=>{a[v]=null});return{c(){e=m("li"),n=m("div"),s=G(l),o=y(),i=m("ul");for(let v=0;v<a.length;v+=1)a[v].c();r=y(),p(n,"class","font-bold bg-gray-300"),p(e,"class","border-b")},m(v,g){w(v,e,g),f(e,n),f(n,s),f(e,o),f(e,i);for(let h=0;h<a.length;h+=1)a[h]&&a[h].m(i,null);f(e,r),u=!0},p(v,g){var h;if((!u||g&4)&&l!==(l=(((h=v[6].l10n)==null?void 0:h.name)??v[6].name)+"")&&ee(s,l),g&4){c=v[6].playerBonuses;let b;for(b=0;b<c.length;b+=1){const A=Ci(v,c,b);a[b]?(a[b].p(A,g),P(a[b],1)):(a[b]=Ni(A),a[b].c(),P(a[b],1),a[b].m(i,null))}for(qe(),b=c.length;b<a.length;b+=1)d(b);Fe()}},i(v){if(!u){for(let g=0;g<c.length;g+=1)P(a[g]);u=!0}},o(v){a=a.filter(Boolean);for(let g=0;g<a.length;g+=1)W(a[g]);u=!1},d(v){v&&T(e),Be(a,v)}}}function Li(t){let e,n;return e=new gu({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Uu(t){let e,n,l,s,o,i,r,u,c,a,d=t[0].level>0&&t[0].class&&!t[0].hasCustomClass&&Ft.includes(t[0].class),_,v,g,h=t[0].bonuses.sort(t[3]),b=[];for(let S=0;S<h.length;S+=1)b[S]=Ri(Mi(t,h,S));const A=S=>W(b[S],1,1,()=>{b[S]=null});let E=t[1].sort(t[4]),B=[];for(let S=0;S<E.length;S+=1)B[S]=Di(Oi(t,E,S));const C=S=>W(B[S],1,1,()=>{B[S]=null});let O=t[2].sort(t[5]),M=[];for(let S=0;S<O.length;S+=1)M[S]=Ii(ki(t,O,S));const N=S=>W(M[S],1,1,()=>{M[S]=null});let R=d&&Li();return v=new Fu({}),{c(){e=m("h2"),e.textContent="加值",n=y(),l=m("ul");for(let S=0;S<b.length;S+=1)b[S].c();s=y(),o=m("h2"),o.textContent="裝備加值",i=y(),r=m("ul");for(let S=0;S<B.length;S+=1)B[S].c();u=y();for(let S=0;S<M.length;S+=1)M[S].c();c=y(),a=m("div"),R&&R.c(),_=y(),ne(v.$$.fragment),p(l,"class","px-1"),p(a,"class","flex gap-1")},m(S,k){w(S,e,k),w(S,n,k),w(S,l,k);for(let $=0;$<b.length;$+=1)b[$]&&b[$].m(l,null);w(S,s,k),w(S,o,k),w(S,i,k),w(S,r,k);for(let $=0;$<B.length;$+=1)B[$]&&B[$].m(r,null);f(r,u);for(let $=0;$<M.length;$+=1)M[$]&&M[$].m(r,null);w(S,c,k),w(S,a,k),R&&R.m(a,null),f(a,_),le(v,a,null),g=!0},p(S,[k]){if(k&1){h=S[0].bonuses.sort(S[3]);let $;for($=0;$<h.length;$+=1){const D=Mi(S,h,$);b[$]?(b[$].p(D,k),P(b[$],1)):(b[$]=Ri(D),b[$].c(),P(b[$],1),b[$].m(l,null))}for(qe(),$=h.length;$<b.length;$+=1)A($);Fe()}if(k&2){E=S[1].sort(S[4]);let $;for($=0;$<E.length;$+=1){const D=Oi(S,E,$);B[$]?(B[$].p(D,k),P(B[$],1)):(B[$]=Di(D),B[$].c(),P(B[$],1),B[$].m(r,u))}for(qe(),$=E.length;$<B.length;$+=1)C($);Fe()}if(k&4){O=S[2].sort(S[5]);let $;for($=0;$<O.length;$+=1){const D=ki(S,O,$);M[$]?(M[$].p(D,k),P(M[$],1)):(M[$]=Ii(D),M[$].c(),P(M[$],1),M[$].m(r,null))}for(qe(),$=O.length;$<M.length;$+=1)N($);Fe()}k&1&&(d=S[0].level>0&&S[0].class&&!S[0].hasCustomClass&&Ft.includes(S[0].class)),d?R?k&1&&P(R,1):(R=Li(),R.c(),P(R,1),R.m(a,_)):R&&(qe(),W(R,1,1,()=>{R=null}),Fe())},i(S){if(!g){for(let k=0;k<h.length;k+=1)P(b[k]);for(let k=0;k<E.length;k+=1)P(B[k]);for(let k=0;k<O.length;k+=1)P(M[k]);P(R),P(v.$$.fragment,S),g=!0}},o(S){b=b.filter(Boolean);for(let k=0;k<b.length;k+=1)W(b[k]);B=B.filter(Boolean);for(let k=0;k<B.length;k+=1)W(B[k]);M=M.filter(Boolean);for(let k=0;k<M.length;k+=1)W(M[k]);W(R),W(v.$$.fragment,S),g=!1},d(S){S&&T(e),S&&T(n),S&&T(l),Be(b,S),S&&T(s),S&&T(o),S&&T(i),S&&T(r),Be(B,S),Be(M,S),S&&T(c),S&&T(a),R&&R.d(),se(v)}}}function Vu(t,e,n){let l,s,o;Re(t,De,c=>n(0,o=c));const i=(c,a)=>Qn(c.desc,a.desc),r=(c,a)=>Qn(c.name,a.name),u=(c,a)=>Qn(c.name,a.name);return t.$$.update=()=>{t.$$.dirty&1&&n(2,l=o.gear.filter(c=>c.equipped).map(c=>xe(c.name)).filter(c=>{var a;return c&&c.canBeEquipped&&((a=c.playerBonuses)==null?void 0:a.length)>0})),t.$$.dirty&1&&n(1,s=o.gear.filter(c=>!c.equipped).map(c=>xe(c.name)).filter(c=>{var a;return c&&((a=c.playerBonuses)==null?void 0:a.length)>0&&!c.canBeEquipped}))},[o,s,l,i,r,u]}class ju extends Ce{constructor(e){super(),Oe(this,e,Vu,Uu,ke,{})}}function Pi(t,e,n){const l=t.slice();return l[31]=e[n],l}function zu(t,e,n){const l=t.slice();return l[34]=e[n],l[36]=n,l}function Hi(t,e,n){const l=t.slice();return l[37]=e[n],l}function Gi(t){let e,n=t[37]+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[37],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function Yu(t){let e,n;return{c(){e=m("option"),n=G(t[36]),e.__value=t[36],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:V,d(l){l&&T(e)}}}function Wi(t){let e,n=gn(t[31])+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[31],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function qi(t){let e,n,l;return{c(){e=m("input"),p(e,"type","text"),p(e,"placeholder","材料描述 (例如: 一根樹枝)"),p(e,"class","border p-1 rounded text-sm w-full mt-1")},m(s,o){w(s,e,o),oe(e,t[11]),n||(l=I(e,"input",t[24]),n=!0)},p(s,o){o[0]&2048&&e.value!==s[11]&&oe(e,s[11])},d(s){s&&T(e),n=!1,l()}}}function Ku(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h,b,A,E,B,C,O,M,N,R,S,k,$,D,U,F,Q,ve,re,de,ae,j,q,K,we,Y,pe,be,X,H,J,he,me,ue,ce,z,te,Ae,Ie,x,fe,Se,L,ge,Le,Te,lt,st,zt=t[0]?"更新法術":"建立法術",Dt,Tt,Yt,wn,Je=Ft,Ze=[];for(let ie=0;ie<Je.length;ie+=1)Ze[ie]=Gi(Hi(t,Je,ie));let bt=Array(10),yt=[];for(let ie=0;ie<bt.length;ie+=1)yt[ie]=Yu(zu(t,bt,ie));let Rt=qt,Xe=[];for(let ie=0;ie<Rt.length;ie+=1)Xe[ie]=Wi(Pi(t,Rt,ie));let tt=t[10]&&qi(t);return{c(){e=m("div"),n=m("div"),l=m("label"),l.innerHTML='法術名稱<span class="text-red-700">*</span>',s=y(),o=m("input"),i=y(),r=m("div"),u=m("div"),c=m("label"),c.textContent="職業列表",a=y(),d=m("select");for(let ie=0;ie<Ze.length;ie+=1)Ze[ie].c();_=m("option"),_.textContent="其他",v=y(),g=m("div"),h=m("label"),h.textContent="環階 (0=戲法)",b=y(),A=m("select");for(let ie=0;ie<yt.length;ie+=1)yt[ie].c();E=y(),B=m("div"),C=m("div"),O=m("label"),O.textContent="施法關鍵屬性",M=y(),N=m("select");for(let ie=0;ie<Xe.length;ie+=1)Xe[ie].c();R=y(),S=m("div"),k=m("label"),k.textContent="距離 (例如: 60 ft)",$=y(),D=m("input"),U=y(),F=m("div"),Q=m("label"),Q.textContent="持續時間 (例如: 1 Minute)",ve=y(),re=m("div"),de=m("input"),ae=y(),j=m("div"),q=m("span"),q.textContent="構材 (Components)",K=y(),we=m("div"),Y=m("label"),pe=m("input"),be=G(" Verbal (V)"),X=y(),H=m("label"),J=m("input"),he=G(" Somatic (S)"),me=y(),ue=m("label"),ce=m("input"),z=G(" Material (M)"),te=y(),tt&&tt.c(),Ae=y(),Ie=m("label"),x=m("input"),fe=G(" 儀式法術 (Ritual)"),Se=y(),L=m("div"),ge=m("label"),ge.innerHTML='描述<span class="text-red-700">*</span>',Le=y(),Te=m("textarea"),lt=y(),st=m("button"),Dt=G(zt),p(l,"for","spellName"),p(l,"class","font-bold"),p(o,"type","text"),p(o,"id","spellName"),p(o,"class","border p-1 rounded"),p(n,"class","flex flex-col gap-1"),p(c,"for","spellClass"),p(c,"class","font-bold"),_.__value="Other",_.value=_.__value,p(d,"id","spellClass"),p(d,"class","border p-1 rounded"),t[4]===void 0&&Pe(()=>t[16].call(d)),p(u,"class","flex flex-col w-1/2"),p(h,"for","spellTier"),p(h,"class","font-bold"),p(A,"id","spellTier"),p(A,"class","border p-1 rounded"),t[3]===void 0&&Pe(()=>t[17].call(A)),p(g,"class","flex flex-col w-1/2"),p(r,"class","flex gap-2"),p(O,"for","spellStat"),p(O,"class","font-bold"),p(N,"id","spellStat"),p(N,"class","border p-1 rounded"),t[5]===void 0&&Pe(()=>t[18].call(N)),p(C,"class","flex flex-col w-1/2"),p(k,"for","spellRange"),p(k,"class","font-bold"),p(D,"type","text"),p(D,"id","spellRange"),p(D,"class","border p-1 rounded"),p(S,"class","flex flex-col w-1/2"),p(B,"class","flex gap-2"),p(Q,"for","spellDuration"),p(Q,"class","font-bold"),p(de,"type","text"),p(de,"id","spellDuration"),p(de,"class","border p-1 rounded w-full"),p(re,"class","flex gap-2"),p(F,"class","flex flex-col gap-1"),p(q,"class","font-bold text-sm"),p(pe,"type","checkbox"),p(pe,"class","svelte-1ep1fgl"),p(Y,"class","flex items-center gap-1"),p(J,"type","checkbox"),p(J,"class","svelte-1ep1fgl"),p(H,"class","flex items-center gap-1"),p(ce,"type","checkbox"),p(ce,"class","svelte-1ep1fgl"),p(ue,"class","flex items-center gap-1"),p(we,"class","flex gap-4"),p(j,"class","flex flex-col gap-1 border p-2 rounded bg-gray-50"),p(x,"type","checkbox"),p(x,"class","svelte-1ep1fgl"),p(Ie,"class","flex items-center gap-1 font-bold"),p(ge,"for","spellDesc"),p(ge,"class","font-bold"),p(Te,"id","spellDesc"),p(Te,"rows","5"),p(Te,"class","border p-1 rounded"),p(L,"class","flex flex-col gap-1"),p(st,"class","bg-black text-white p-2 rounded font-bold shadow hover:bg-gray-800 transition-colors mt-2"),st.disabled=Tt=!t[13],$e(st,"opacity-50",!t[13]),p(e,"class","flex flex-col gap-2 max-h-[80vh] overflow-y-auto p-2")},m(ie,He){w(ie,e,He),f(e,n),f(n,l),f(n,s),f(n,o),oe(o,t[1]),f(e,i),f(e,r),f(r,u),f(u,c),f(u,a),f(u,d);for(let Ee=0;Ee<Ze.length;Ee+=1)Ze[Ee]&&Ze[Ee].m(d,null);f(d,_),_e(d,t[4],!0),f(r,v),f(r,g),f(g,h),f(g,b),f(g,A);for(let Ee=0;Ee<yt.length;Ee+=1)yt[Ee]&&yt[Ee].m(A,null);_e(A,t[3],!0),f(e,E),f(e,B),f(B,C),f(C,O),f(C,M),f(C,N);for(let Ee=0;Ee<Xe.length;Ee+=1)Xe[Ee]&&Xe[Ee].m(N,null);_e(N,t[5],!0),f(B,R),f(B,S),f(S,k),f(S,$),f(S,D),oe(D,t[6]),f(e,U),f(e,F),f(F,Q),f(F,ve),f(F,re),f(re,de),oe(de,t[7]),f(e,ae),f(e,j),f(j,q),f(j,K),f(j,we),f(we,Y),f(Y,pe),pe.checked=t[8],f(Y,be),f(we,X),f(we,H),f(H,J),J.checked=t[9],f(H,he),f(we,me),f(we,ue),f(ue,ce),ce.checked=t[10],f(ue,z),f(j,te),tt&&tt.m(j,null),f(e,Ae),f(e,Ie),f(Ie,x),x.checked=t[12],f(Ie,fe),f(e,Se),f(e,L),f(L,ge),f(L,Le),f(L,Te),oe(Te,t[2]),f(e,lt),f(e,st),f(st,Dt),Yt||(wn=[I(o,"input",t[15]),I(d,"change",t[16]),I(A,"change",t[17]),I(N,"change",t[18]),I(D,"input",t[19]),I(de,"input",t[20]),I(pe,"change",t[21]),I(J,"change",t[22]),I(ce,"change",t[23]),I(x,"change",t[25]),I(Te,"input",t[26]),I(st,"click",t[27])],Yt=!0)},p(ie,He){if(He[0]&2&&o.value!==ie[1]&&oe(o,ie[1]),He&0){Je=Ft;let Ee;for(Ee=0;Ee<Je.length;Ee+=1){const Nt=Hi(ie,Je,Ee);Ze[Ee]?Ze[Ee].p(Nt,He):(Ze[Ee]=Gi(Nt),Ze[Ee].c(),Ze[Ee].m(d,_))}for(;Ee<Ze.length;Ee+=1)Ze[Ee].d(1);Ze.length=Je.length}if(He[0]&16&&_e(d,ie[4]),He[0]&8&&_e(A,ie[3]),He&0){Rt=qt;let Ee;for(Ee=0;Ee<Rt.length;Ee+=1){const Nt=Pi(ie,Rt,Ee);Xe[Ee]?Xe[Ee].p(Nt,He):(Xe[Ee]=Wi(Nt),Xe[Ee].c(),Xe[Ee].m(N,null))}for(;Ee<Xe.length;Ee+=1)Xe[Ee].d(1);Xe.length=Rt.length}He[0]&32&&_e(N,ie[5]),He[0]&64&&D.value!==ie[6]&&oe(D,ie[6]),He[0]&128&&de.value!==ie[7]&&oe(de,ie[7]),He[0]&256&&(pe.checked=ie[8]),He[0]&512&&(J.checked=ie[9]),He[0]&1024&&(ce.checked=ie[10]),ie[10]?tt?tt.p(ie,He):(tt=qi(ie),tt.c(),tt.m(j,null)):tt&&(tt.d(1),tt=null),He[0]&4096&&(x.checked=ie[12]),He[0]&4&&oe(Te,ie[2]),He[0]&1&&zt!==(zt=ie[0]?"更新法術":"建立法術")&&ee(Dt,zt),He[0]&8192&&Tt!==(Tt=!ie[13])&&(st.disabled=Tt),He[0]&8192&&$e(st,"opacity-50",!ie[13])},i:V,o:V,d(ie){ie&&T(e),Be(Ze,ie),Be(yt,ie),Be(Xe,ie),tt&&tt.d(),Yt=!1,Ue(wn)}}}function Xu(t,e,n){var de,ae,j,q;let l,s;Re(t,De,K=>n(29,s=K));const o=yn();let{spellToEdit:i=void 0}=e,r=s.spells.find(K=>K.name===(i==null?void 0:i.name)),u=(i==null?void 0:i.name)??"",c=(i==null?void 0:i.desc)??"",a=(i==null?void 0:i.tier)??0,d=(i==null?void 0:i.class)??"Wizard",_=(i==null?void 0:i.stat)??"INT",v=(i==null?void 0:i.range)??"60 feet",g=(i==null?void 0:i.duration)??"Instantaneous",h=((de=i==null?void 0:i.components)==null?void 0:de.verbal)??!1,b=((ae=i==null?void 0:i.components)==null?void 0:ae.somatic)??!1,A=((j=i==null?void 0:i.components)==null?void 0:j.material)??!1,E=((q=i==null?void 0:i.components)==null?void 0:q.materialDesc)??"",B=(i==null?void 0:i.ritual)??!1;function C(){const K={editable:!0,name:u,class:d,stat:_,tier:a,range:v,duration:g,components:{verbal:h,somatic:b,material:A,materialDesc:E},ritual:B,desc:c};i?(Object.assign(i,K),r&&(r.name=K.name)):(s.spells.push({name:K.name}),s.customSpells.push(K)),De.set(s),o("finish")}function O(){u=this.value,n(1,u)}function M(){d=Ge(this),n(4,d)}function N(){a=Ge(this),n(3,a)}function R(){_=Ge(this),n(5,_)}function S(){v=this.value,n(6,v)}function k(){g=this.value,n(7,g)}function $(){h=this.checked,n(8,h)}function D(){b=this.checked,n(9,b)}function U(){A=this.checked,n(10,A)}function F(){E=this.value,n(11,E)}function Q(){B=this.checked,n(12,B)}function ve(){c=this.value,n(2,c)}const re=()=>C();return t.$$set=K=>{"spellToEdit"in K&&n(0,i=K.spellToEdit)},t.$$.update=()=>{t.$$.dirty[0]&6&&n(13,l=u.length>0&&c.length>0)},[i,u,c,a,d,_,v,g,h,b,A,E,B,l,C,O,M,N,R,S,k,$,D,U,F,Q,ve,re]}class La extends Ce{constructor(e){super(),Oe(this,e,Xu,Ku,ke,{spellToEdit:0},null,[-1,-1])}}function Fi(t){let e,n,l;function s(i){t[4](i)}let o={vw:50,$$slots:{header:[Zu],default:[Ju]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ft({props:o}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&33&&(u.$$scope={dirty:r,ctx:i}),!n&&r&2&&(n=!0,u.showModal=i[1],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){W(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function Ju(t){let e,n;return e=new La({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:V,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Zu(t){let e;return{c(){e=m("h1"),e.textContent="Custom Spell",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Qu(t){let e,n,l,s,o,i,r=t[0]&&Fi(t);return{c(){e=m("button"),e.textContent="Custom Spell",n=y(),r&&r.c(),l=vt(),p(e,"class","bg-black text-white w-full")},m(u,c){w(u,e,c),w(u,n,c),r&&r.m(u,c),w(u,l,c),s=!0,o||(i=I(e,"click",t[2]),o=!0)},p(u,[c]){u[0]?r?(r.p(u,c),c&1&&P(r,1)):(r=Fi(u),r.c(),P(r,1),r.m(l.parentNode,l)):r&&(qe(),W(r,1,1,()=>{r=null}),Fe())},i(u){s||(P(r),s=!0)},o(u){W(r),s=!1},d(u){u&&T(e),u&&T(n),r&&r.d(u),u&&T(l),o=!1,i()}}}function xu(t,e,n){let l=!1,s=!1;const o=()=>{n(0,l=!0),n(1,s=!0)},i=()=>n(0,l=!1);function r(u){s=u,n(1,s)}return[l,s,o,i,r]}class ec extends Ce{constructor(e){super(),Oe(this,e,xu,Qu,ke,{})}}function Ui(t,{delay:e=0,duration:n=400,easing:l=mr}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:l,css:o=>`opacity: ${o*s}`}}const Pa={};function tc(t){let e,n,l,s,o,i;const r=t[5].default,u=Rn(r,t,t[4],null);return{c(){e=y(),n=m("div"),u&&u.c(),An(n,"top",t[1]+"px"),An(n,"left",t[0]+"px"),p(n,"class","svelte-zimeji")},m(c,a){w(c,e,a),w(c,n,a),u&&u.m(n,null),t[6](n),s=!0,o||(i=I(document.body,"click",t[3]),o=!0)},p(c,[a]){u&&u.p&&(!s||a&16)&&$n(u,r,c,c[4],s?Nn(r,c[4],a,null):Dn(c[4]),null),(!s||a&2)&&An(n,"top",c[1]+"px"),(!s||a&1)&&An(n,"left",c[0]+"px")},i(c){s||(P(u,c),Pe(()=>{s&&(l||(l=As(n,Ui,{duration:100},!0)),l.run(1))}),s=!0)},o(c){W(u,c),l||(l=As(n,Ui,{duration:100},!1)),l.run(0),s=!1},d(c){c&&T(e),c&&T(n),u&&u.d(c),t[6](null),c&&l&&l.end(),o=!1,i()}}}function nc(t,e,n){let{$$slots:l={},$$scope:s}=e,{x:o}=e,{y:i}=e,r;const u=yn();_r(Pa,{dispatchClick:()=>u("click")});function c(d){d.target===r||r.contains(d.target)||u("clickoutside")}function a(d){Ve[d?"unshift":"push"](()=>{r=d,n(2,r)})}return t.$$set=d=>{"x"in d&&n(0,o=d.x),"y"in d&&n(1,i=d.y),"$$scope"in d&&n(4,s=d.$$scope)},t.$$.update=()=>{if(t.$$.dirty&7&&r){const d=r.getBoundingClientRect();n(0,o=Math.min(window.innerWidth-d.width,o)),n(1,i=Math.min(window.innerHeight-d.height,i))}},[o,i,r,c,s,l,a]}class lc extends Ce{constructor(e){super(),Oe(this,e,nc,tc,ke,{x:0,y:1})}}function sc(t){let e;const n=t[4].default,l=Rn(n,t,t[3],null);return{c(){l&&l.c()},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&8)&&$n(l,n,s,s[3],e?Nn(n,s[3],o,null):Dn(s[3]),null)},i(s){e||(P(l,s),e=!0)},o(s){W(l,s),e=!1},d(s){l&&l.d(s)}}}function ic(t){let e;return{c(){e=G(t[1])},m(n,l){w(n,e,l)},p(n,l){l&2&&ee(e,n[1])},i:V,o:V,d(n){n&&T(e)}}}function oc(t){let e,n,l,s,o,i;const r=[ic,sc],u=[];function c(a,d){return a[1]?0:1}return n=c(t),l=u[n]=r[n](t),{c(){e=m("div"),l.c(),p(e,"class","active:bg-gray-100 svelte-12ogry0"),$e(e,"disabled",t[0])},m(a,d){w(a,e,d),u[n].m(e,null),s=!0,o||(i=I(e,"click",t[2]),o=!0)},p(a,[d]){let _=n;n=c(a),n===_?u[n].p(a,d):(qe(),W(u[_],1,1,()=>{u[_]=null}),Fe(),l=u[n],l?l.p(a,d):(l=u[n]=r[n](a),l.c()),P(l,1),l.m(e,null)),(!s||d&1)&&$e(e,"disabled",a[0])},i(a){s||(P(l),s=!0)},o(a){W(l),s=!1},d(a){a&&T(e),u[n].d(),o=!1,i()}}}function ac(t,e,n){let{$$slots:l={},$$scope:s}=e,{isDisabled:o=!1}=e,{text:i=""}=e;const r=yn(),{dispatchClick:u}=hr(Pa),c=()=>{o||(r("click"),u())};return t.$$set=a=>{"isDisabled"in a&&n(0,o=a.isDisabled),"text"in a&&n(1,i=a.text),"$$scope"in a&&n(3,s=a.$$scope)},[o,i,c,s,l]}class jn extends Ce{constructor(e){super(),Oe(this,e,ac,oc,ke,{isDisabled:0,text:1})}}var at=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class rc{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return at(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,n){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:n})})}deselect(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return at(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return at(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return at(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return at(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return at(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return at(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return at(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:l}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return l.indexOf(e)>-1})}getConnectionId(){return at(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const n=l=>{e(l.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",n)}}}var wt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class uc{constructor(e){this.messageBus=e}reset(){return wt(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return wt(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return wt(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return wt(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return wt(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return wt(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return n})}inverseTransformPoint(e){return wt(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return n})}}function cc(t){return typeof t.id=="string"}var ll={},fc={get exports(){return ll},set exports(t){ll=t}},mn=typeof Reflect=="object"?Reflect:null,Vi=mn&&typeof mn.apply=="function"?mn.apply:function(e,n,l){return Function.prototype.apply.call(e,n,l)},xn;mn&&typeof mn.ownKeys=="function"?xn=mn.ownKeys:Object.getOwnPropertySymbols?xn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:xn=function(e){return Object.getOwnPropertyNames(e)};function dc(t){console&&console.warn&&console.warn(t)}var Ha=Number.isNaN||function(e){return e!==e};function Ne(){Ne.init.call(this)}fc.exports=Ne;ll.once=hc;Ne.EventEmitter=Ne;Ne.prototype._events=void 0;Ne.prototype._eventsCount=0;Ne.prototype._maxListeners=void 0;var ji=10;function ul(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Ne,"defaultMaxListeners",{enumerable:!0,get:function(){return ji},set:function(t){if(typeof t!="number"||t<0||Ha(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ji=t}});Ne.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ne.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ha(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Ga(t){return t._maxListeners===void 0?Ne.defaultMaxListeners:t._maxListeners}Ne.prototype.getMaxListeners=function(){return Ga(this)};Ne.prototype.emit=function(e){for(var n=[],l=1;l<arguments.length;l++)n.push(arguments[l]);var s=e==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var i;if(n.length>0&&(i=n[0]),i instanceof Error)throw i;var r=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw r.context=i,r}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")Vi(u,this,n);else for(var c=u.length,a=Va(u,c),l=0;l<c;++l)Vi(a[l],this,n);return!0};function Wa(t,e,n,l){var s,o,i;if(ul(n),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),i=o[e]),i===void 0)i=o[e]=n,++t._eventsCount;else if(typeof i=="function"?i=o[e]=l?[n,i]:[i,n]:l?i.unshift(n):i.push(n),s=Ga(t),s>0&&i.length>s&&!i.warned){i.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.emitter=t,r.type=e,r.count=i.length,dc(r)}return t}Ne.prototype.addListener=function(e,n){return Wa(this,e,n,!1)};Ne.prototype.on=Ne.prototype.addListener;Ne.prototype.prependListener=function(e,n){return Wa(this,e,n,!0)};function pc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qa(t,e,n){var l={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=pc.bind(l);return s.listener=n,l.wrapFn=s,s}Ne.prototype.once=function(e,n){return ul(n),this.on(e,qa(this,e,n)),this};Ne.prototype.prependOnceListener=function(e,n){return ul(n),this.prependListener(e,qa(this,e,n)),this};Ne.prototype.removeListener=function(e,n){var l,s,o,i,r;if(ul(n),s=this._events,s===void 0)return this;if(l=s[e],l===void 0)return this;if(l===n||l.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,l.listener||n));else if(typeof l!="function"){for(o=-1,i=l.length-1;i>=0;i--)if(l[i]===n||l[i].listener===n){r=l[i].listener,o=i;break}if(o<0)return this;o===0?l.shift():mc(l,o),l.length===1&&(s[e]=l[0]),s.removeListener!==void 0&&this.emit("removeListener",e,r||n)}return this};Ne.prototype.off=Ne.prototype.removeListener;Ne.prototype.removeAllListeners=function(e){var n,l,s;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[e]),this;if(arguments.length===0){var o=Object.keys(l),i;for(s=0;s<o.length;++s)i=o[s],i!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=l[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(e,n[s]);return this};function Fa(t,e,n){var l=t._events;if(l===void 0)return[];var s=l[e];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?_c(s):Va(s,s.length)}Ne.prototype.listeners=function(e){return Fa(this,e,!0)};Ne.prototype.rawListeners=function(e){return Fa(this,e,!1)};Ne.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ua.call(t,e)};Ne.prototype.listenerCount=Ua;function Ua(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Ne.prototype.eventNames=function(){return this._eventsCount>0?xn(this._events):[]};function Va(t,e){for(var n=new Array(e),l=0;l<e;++l)n[l]=t[l];return n}function mc(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function _c(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function hc(t,e){return new Promise(function(n,l){function s(i){t.removeListener(e,o),l(i)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",s),n([].slice.call(arguments))}ja(t,e,o,{once:!0}),e!=="error"&&gc(t,s,{once:!0})})}function gc(t,e,n){typeof t.on=="function"&&ja(t,"error",e,n)}function ja(t,e,n,l){if(typeof t.on=="function")l.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(o){l.once&&t.removeEventListener(e,s),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}let zn;const vc=new Uint8Array(16);function bc(){if(!zn&&(zn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!zn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return zn(vc)}const nt=[];for(let t=0;t<256;++t)nt.push((t+256).toString(16).slice(1));function yc(t,e=0){return(nt[t[e+0]]+nt[t[e+1]]+nt[t[e+2]]+nt[t[e+3]]+"-"+nt[t[e+4]]+nt[t[e+5]]+"-"+nt[t[e+6]]+nt[t[e+7]]+"-"+nt[t[e+8]]+nt[t[e+9]]+"-"+nt[t[e+10]]+nt[t[e+11]]+nt[t[e+12]]+nt[t[e+13]]+nt[t[e+14]]+nt[t[e+15]]).toLowerCase()}const wc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),zi={randomUUID:wc};function Tc(t,e,n){if(zi.randomUUID&&!e&&!t)return zi.randomUUID();t=t||{};const l=t.random||(t.rng||bc)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,e){n=n||0;for(let s=0;s<16;++s)e[n+s]=l[s];return e}return yc(l)}class Ec extends ll.EventEmitter{constructor(e,n){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=l=>{const s=l.data;if(l.origin===this.targetOrigin&&cc(s)){if(s.id==="OBR_READY"){this.ready=!0;const o=s.data;this.ref=o.ref,this.userId=o.userId}this.emit(s.id,s.data)}},this.send=(l,s,o)=>{var i;if(!this.ref)throw Error("Unable to send message: not ready");(i=window.parent)===null||i===void 0||i.postMessage({id:l,data:s,ref:this.ref,nonce:o},this.targetOrigin)},this.sendAsync=(l,s,o=5e3)=>{const i=`_${Tc()}`;return this.send(l,s,i),Promise.race([new Promise((r,u)=>{const c=this;function a(_){c.off(`${l}_RESPONSE${i}`,a),c.off(`${l}_ERROR${i}`,d),r(_)}function d(_){c.off(`${l}_RESPONSE${i}`,a),c.off(`${l}_ERROR${i}`,d),u(_)}this.on(`${l}_RESPONSE${i}`,a),this.on(`${l}_ERROR${i}`,d)}),...o>0?[new Promise((r,u)=>window.setTimeout(()=>u(new Error(`Message ${l} took longer than ${o}ms to get a result`)),o))]:[]])},this.roomId=n,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var Yi=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Ac{constructor(e){this.messageBus=e}show(e,n){return Yi(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:n});return l})}close(e){return Yi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var un=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Bc{constructor(e){this.messageBus=e}getColor(){return un(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return un(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return un(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const n=l=>{e(l.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",n)}}}var rt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class kc{constructor(e){this.messageBus=e}getDpi(){return rt(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return rt(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return rt(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return rt(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return rt(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return rt(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return rt(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,n,l,s){return rt(this,void 0,void 0,function*(){const{position:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:n,useCorners:l,useCenter:s});return o})}getDistance(e,n){return rt(this,void 0,void 0,function*(){const{distance:l}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:n});return l})}onChange(e){const n=l=>{e(l.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",n)}}}var Yn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Cc{constructor(e){this.messageBus=e}undo(){return Yn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Yn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Yn(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Yn(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function it(t){for(var e=arguments.length,n=Array(e>1?e-1:0),l=1;l<e;l++)n[l-1]=arguments[l];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(s){return"'"+s+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function xt(t){return!!t&&!!t[_t]}function Vt(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var l=Object.getPrototypeOf(n);if(l===null)return!0;var s=Object.hasOwnProperty.call(l,"constructor")&&l.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===Ic}(t)||Array.isArray(t)||!!t[On]||!!(!((e=t.constructor)===null||e===void 0)&&e[On])||cl(t)||fl(t))}function vn(t,e,n){n===void 0&&(n=!1),jt(t)===0?(n?Object.keys:ts)(t).forEach(function(l){n&&typeof l=="symbol"||e(l,t[l],t)}):t.forEach(function(l,s){return e(s,l,t)})}function jt(t){var e=t[_t];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:cl(t)?2:fl(t)?3:0}function Pn(t,e){return jt(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function el(t,e){return jt(t)===2?t.get(e):t[e]}function za(t,e,n){var l=jt(t);l===2?t.set(e,n):l===3?t.add(n):t[e]=n}function Oc(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function cl(t){return Dc&&t instanceof Map}function fl(t){return Nc&&t instanceof Set}function Jt(t){return t.o||t.t}function Xl(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=Lc(t);delete e[_t];for(var n=ts(e),l=0;l<n.length;l++){var s=n[l],o=e[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(e[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:t[s]})}return Object.create(Object.getPrototypeOf(t),e)}function Jl(t,e){return e===void 0&&(e=!1),Zl(t)||xt(t)||!Vt(t)||(jt(t)>1&&(t.set=t.add=t.clear=t.delete=Sc),Object.freeze(t),e&&vn(t,function(n,l){return Jl(l,!0)},!0)),t}function Sc(){it(2)}function Zl(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function St(t){var e=Nl[t];return e||it(18,t),e}function Mc(t,e){Nl[t]||(Nl[t]=e)}function Ki(){return Hn}function yl(t,e){e&&(St("Patches"),t.u=[],t.s=[],t.v=e)}function sl(t){Rl(t),t.p.forEach(Rc),t.p=null}function Rl(t){t===Hn&&(Hn=t.l)}function Xi(t){return Hn={p:[],l:Hn,h:t,m:!0,_:0}}function Rc(t){var e=t[_t];e.i===0||e.i===1?e.j():e.g=!0}function wl(t,e){e._=e.p.length;var n=e.p[0],l=t!==void 0&&t!==n;return e.h.O||St("ES5").S(e,t,l),l?(n[_t].P&&(sl(e),it(4)),Vt(t)&&(t=il(e,t),e.l||ol(e,t)),e.u&&St("Patches").M(n[_t].t,t,e.u,e.s)):t=il(e,n,[]),sl(e),e.u&&e.v(e.u,e.s),t!==es?t:void 0}function il(t,e,n){if(Zl(e))return e;var l=e[_t];if(!l)return vn(e,function(r,u){return Ji(t,l,e,r,u,n)},!0),e;if(l.A!==t)return e;if(!l.P)return ol(t,l.t,!0),l.t;if(!l.I){l.I=!0,l.A._--;var s=l.i===4||l.i===5?l.o=Xl(l.k):l.o,o=s,i=!1;l.i===3&&(o=new Set(s),s.clear(),i=!0),vn(o,function(r,u){return Ji(t,l,s,r,u,n,i)}),ol(t,s,!1),n&&t.u&&St("Patches").N(l,n,t.u,t.s)}return l.o}function Ji(t,e,n,l,s,o,i){if(xt(s)){var r=il(t,s,o&&e&&e.i!==3&&!Pn(e.R,l)?o.concat(l):void 0);if(za(n,l,r),!xt(r))return;t.m=!1}else i&&n.add(s);if(Vt(s)&&!Zl(s)){if(!t.h.D&&t._<1)return;il(t,s),e&&e.A.l||ol(t,s)}}function ol(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&Jl(e,n)}function Tl(t,e){var n=t[_t];return(n?Jt(n):t)[e]}function Zi(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var l=Object.getOwnPropertyDescriptor(n,e);if(l)return l;n=Object.getPrototypeOf(n)}}function $l(t){t.P||(t.P=!0,t.l&&$l(t.l))}function El(t){t.o||(t.o=Xl(t.t))}function Dl(t,e,n){var l=cl(e)?St("MapSet").F(e,n):fl(e)?St("MapSet").T(e,n):t.O?function(s,o){var i=Array.isArray(s),r={i:i?1:0,A:o?o.A:Ki(),P:!1,I:!1,R:{},l:o,t:s,k:null,o:null,j:null,C:!1},u=r,c=Il;i&&(u=[r],c=kn);var a=Proxy.revocable(u,c),d=a.revoke,_=a.proxy;return r.k=_,r.j=d,_}(e,n):St("ES5").J(e,n);return(n?n.A:Ki()).p.push(l),l}function $c(t){return xt(t)||it(22,t),function e(n){if(!Vt(n))return n;var l,s=n[_t],o=jt(n);if(s){if(!s.P&&(s.i<4||!St("ES5").K(s)))return s.t;s.I=!0,l=Qi(n,o),s.I=!1}else l=Qi(n,o);return vn(l,function(i,r){s&&el(s.t,i)===r||za(l,i,e(r))}),o===3?new Set(l):l}(t)}function Qi(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return Xl(t)}function Ql(){function t(l){if(!Vt(l))return l;if(Array.isArray(l))return l.map(t);if(cl(l))return new Map(Array.from(l.entries()).map(function(i){return[i[0],t(i[1])]}));if(fl(l))return new Set(Array.from(l).map(t));var s=Object.create(Object.getPrototypeOf(l));for(var o in l)s[o]=t(l[o]);return Pn(l,On)&&(s[On]=l[On]),s}function e(l){return xt(l)?t(l):l}var n="add";Mc("Patches",{$:function(l,s){return s.forEach(function(o){for(var i=o.path,r=o.op,u=l,c=0;c<i.length-1;c++){var a=jt(u),d=i[c];typeof d!="string"&&typeof d!="number"&&(d=""+d),a!==0&&a!==1||d!=="__proto__"&&d!=="constructor"||it(24),typeof u=="function"&&d==="prototype"&&it(24),typeof(u=el(u,d))!="object"&&it(15,i.join("/"))}var _=jt(u),v=t(o.value),g=i[i.length-1];switch(r){case"replace":switch(_){case 2:return u.set(g,v);case 3:it(16);default:return u[g]=v}case n:switch(_){case 1:return g==="-"?u.push(v):u.splice(g,0,v);case 2:return u.set(g,v);case 3:return u.add(v);default:return u[g]=v}case"remove":switch(_){case 1:return u.splice(g,1);case 2:return u.delete(g);case 3:return u.delete(o.value);default:return delete u[g]}default:it(17,r)}}),l},N:function(l,s,o,i){switch(l.i){case 0:case 4:case 2:return function(r,u,c,a){var d=r.t,_=r.o;vn(r.R,function(v,g){var h=el(d,v),b=el(_,v),A=g?Pn(d,v)?"replace":n:"remove";if(h!==b||A!=="replace"){var E=u.concat(v);c.push(A==="remove"?{op:A,path:E}:{op:A,path:E,value:b}),a.push(A===n?{op:"remove",path:E}:A==="remove"?{op:n,path:E,value:e(h)}:{op:"replace",path:E,value:e(h)})}})}(l,s,o,i);case 5:case 1:return function(r,u,c,a){var d=r.t,_=r.R,v=r.o;if(v.length<d.length){var g=[v,d];d=g[0],v=g[1];var h=[a,c];c=h[0],a=h[1]}for(var b=0;b<d.length;b++)if(_[b]&&v[b]!==d[b]){var A=u.concat([b]);c.push({op:"replace",path:A,value:e(v[b])}),a.push({op:"replace",path:A,value:e(d[b])})}for(var E=d.length;E<v.length;E++){var B=u.concat([E]);c.push({op:n,path:B,value:e(v[E])})}d.length<v.length&&a.push({op:"replace",path:u.concat(["length"]),value:d.length})}(l,s,o,i);case 3:return function(r,u,c,a){var d=r.t,_=r.o,v=0;d.forEach(function(g){if(!_.has(g)){var h=u.concat([v]);c.push({op:"remove",path:h,value:g}),a.unshift({op:n,path:h,value:g})}v++}),v=0,_.forEach(function(g){if(!d.has(g)){var h=u.concat([v]);c.push({op:n,path:h,value:g}),a.unshift({op:"remove",path:h,value:g})}v++})}(l,s,o,i)}},M:function(l,s,o,i){o.push({op:"replace",path:[],value:s===es?void 0:s}),i.push({op:"replace",path:[],value:l})}})}var xi,Hn,xl=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Dc=typeof Map<"u",Nc=typeof Set<"u",eo=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",es=xl?Symbol.for("immer-nothing"):((xi={})["immer-nothing"]=!0,xi),On=xl?Symbol.for("immer-draftable"):"__$immer_draftable",_t=xl?Symbol.for("immer-state"):"__$immer_state",Ic=""+Object.prototype.constructor,ts=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,Lc=Object.getOwnPropertyDescriptors||function(t){var e={};return ts(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},Nl={},Il={get:function(t,e){if(e===_t)return t;var n=Jt(t);if(!Pn(n,e))return function(s,o,i){var r,u=Zi(o,i);return u?"value"in u?u.value:(r=u.get)===null||r===void 0?void 0:r.call(s.k):void 0}(t,n,e);var l=n[e];return t.I||!Vt(l)?l:l===Tl(t.t,e)?(El(t),t.o[e]=Dl(t.A.h,l,t)):l},has:function(t,e){return e in Jt(t)},ownKeys:function(t){return Reflect.ownKeys(Jt(t))},set:function(t,e,n){var l=Zi(Jt(t),e);if(l!=null&&l.set)return l.set.call(t.k,n),!0;if(!t.P){var s=Tl(Jt(t),e),o=s==null?void 0:s[_t];if(o&&o.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(Oc(n,s)&&(n!==void 0||Pn(t.t,e)))return!0;El(t),$l(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return Tl(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,El(t),$l(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=Jt(t),l=Reflect.getOwnPropertyDescriptor(n,e);return l&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:l.enumerable,value:n[e]}},defineProperty:function(){it(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){it(12)}},kn={};vn(Il,function(t,e){kn[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),kn.deleteProperty=function(t,e){return kn.set.call(this,t,e,void 0)},kn.set=function(t,e,n){return Il.set.call(this,t[0],e,n,t[0])};var Pc=function(){function t(n){var l=this;this.O=eo,this.D=!0,this.produce=function(s,o,i){if(typeof s=="function"&&typeof o!="function"){var r=o;o=s;var u=l;return function(h){var b=this;h===void 0&&(h=r);for(var A=arguments.length,E=Array(A>1?A-1:0),B=1;B<A;B++)E[B-1]=arguments[B];return u.produce(h,function(C){var O;return(O=o).call.apply(O,[b,C].concat(E))})}}var c;if(typeof o!="function"&&it(6),i!==void 0&&typeof i!="function"&&it(7),Vt(s)){var a=Xi(l),d=Dl(l,s,void 0),_=!0;try{c=o(d),_=!1}finally{_?sl(a):Rl(a)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(h){return yl(a,i),wl(h,a)},function(h){throw sl(a),h}):(yl(a,i),wl(c,a))}if(!s||typeof s!="object"){if((c=o(s))===void 0&&(c=s),c===es&&(c=void 0),l.D&&Jl(c,!0),i){var v=[],g=[];St("Patches").M(s,c,v,g),i(v,g)}return c}it(21,s)},this.produceWithPatches=function(s,o){if(typeof s=="function")return function(c){for(var a=arguments.length,d=Array(a>1?a-1:0),_=1;_<a;_++)d[_-1]=arguments[_];return l.produceWithPatches(c,function(v){return s.apply(void 0,[v].concat(d))})};var i,r,u=l.produce(s,o,function(c,a){i=c,r=a});return typeof Promise<"u"&&u instanceof Promise?u.then(function(c){return[c,i,r]}):[u,i,r]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){Vt(n)||it(8),xt(n)&&(n=$c(n));var l=Xi(this),s=Dl(this,n,void 0);return s[_t].C=!0,Rl(l),s},e.finishDraft=function(n,l){var s=n&&n[_t],o=s.A;return yl(o,l),wl(void 0,o)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!eo&&it(20),this.O=n},e.applyPatches=function(n,l){var s;for(s=l.length-1;s>=0;s--){var o=l[s];if(o.path.length===0&&o.op==="replace"){n=o.value;break}}s>-1&&(l=l.slice(s+1));var i=St("Patches").$;return xt(n)?i(n,l):this.produce(n,function(r){return i(r,l)})},t}(),ht=new Pc;ht.produce;var ns=ht.produceWithPatches.bind(ht);ht.setAutoFreeze.bind(ht);ht.setUseProxies.bind(ht);ht.applyPatches.bind(ht);ht.createDraft.bind(ht);ht.finishDraft.bind(ht);var cn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};Ql();class Hc{constructor(e){this.messageBus=e}getItems(e){return cn(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n}})}isItemArray(e){return Array.isArray(e)&&e.every(n=>typeof n!="string")}updateItems(e,n,l=!0){return cn(this,void 0,void 0,function*(){let s;this.isItemArray(e)?s=e:s=yield this.getItems(e);const[o,i]=ns(s,n),r=o.map(c=>({id:c.id,type:c.type}));for(const c of i){const[a,d]=c.path;typeof a=="number"&&typeof d=="string"&&(r[a][d]=o[a][d])}const u=r.filter(c=>Object.keys(c).length>2);u.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:u,updateAttachments:l}))})}addItems(e){return cn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return cn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return cn(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return cn(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",n)}}}var fn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};Ql();class Gc{constructor(e){this.messageBus=e}getItems(e){return fn(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n}})}updateItems(e,n,l,s=!0){return fn(this,void 0,void 0,function*(){const o=yield this.getItems(e),[i,r]=ns(o,n),u=i.map(a=>({id:a.id,type:a.type}));for(const a of r){const[d,_]=a.path;typeof d=="number"&&typeof _=="string"&&(u[d][_]=i[d][_])}const c=u.filter(a=>Object.keys(a).length>2);c.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:c,fastUpdate:l,updateAttachments:s}))})}addItems(e){return fn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return fn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return fn(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return fn(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",n)}}}var Al=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Wc{constructor(e){this.messageBus=e,this.grid=new kc(e),this.fog=new Bc(e),this.history=new Cc(e),this.items=new Hc(e),this.local=new Gc(e)}isReady(){return Al(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const n=l=>{e(l.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",n)}}getMetadata(){return Al(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return Al(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",n)}}}function Ya(t){return t.startsWith("http")?t:`${window.location.origin}${t}`}function Sn(t){return t.map(e=>Object.assign(Object.assign({},e),{icon:Ya(e.icon)}))}function ls(t){return Object.assign(Object.assign({},t),{url:Ya(t.url)})}var to=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class qc{constructor(e){this.contextMenus={},this.handleClick=n=>{var l;const s=this.contextMenus[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return to(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:Sn(e.icons),embed:e.embed&&ls(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return to(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var kt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Fc{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=n=>{const l=this.tools[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(o=>{o&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})},this.handleToolActionClick=n=>{var l;const s=this.toolActions[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.handleToolModeClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(o=>{o&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})},this.handleToolModeToolClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolClick){const s=l.onToolClick(n.context,n.event);Promise.resolve(s).then(o=>{o&&n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDoubleClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolDoubleClick){const s=l.onToolDoubleClick(n.context,n.event);Promise.resolve(s).then(o=>{o&&n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragStart=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragStart)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragEnd=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragEnd)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragCancel=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragCancel)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeActivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onActivate)===null||l===void 0||l.call(s,n.context))},this.handleToolModeDeactivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onDeactivate)===null||l===void 0||l.call(s,n.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:Sn(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return kt(this,void 0,void 0,function*(){const{metadata:n}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return n})}setMetadata(e,n){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:n})})}createAction(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:Sn(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:Sn(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,n){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:n})})}}var dn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Uc{constructor(e){this.messageBus=e}open(e){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},ls(e)))})}close(e){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return dn(this,void 0,void 0,function*(){const{width:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return n})}setWidth(e,n){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:n})})}getHeight(e){return dn(this,void 0,void 0,function*(){const{height:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return n})}setHeight(e,n){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:n})})}}var no=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Vc{constructor(e){this.messageBus=e}open(e){return no(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},ls(e)))})}close(e){return no(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var ut=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class jc{constructor(e){this.messageBus=e}getWidth(){return ut(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return ut(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return ut(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return ut(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return ut(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return ut(this,void 0,void 0,function*(){const n=Sn([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:n[0].icon})})}getTitle(){return ut(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return ut(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const n=l=>{e(l.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n)}}}var zc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};Ql();class Yc{constructor(e){this.messageBus=e}startItemInteraction(e,n=!0){return zc(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:n});let s=e;return[r=>{const[u,c]=ns(s,r);return s=u,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:l,patches:c}),u},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:l})}]})}}var Kc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Xc{constructor(e){this.messageBus=e}getPlayers(){return Kc(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const n=l=>{e(l.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",n)}}}var Bl=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Jc{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return Bl(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return Bl(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return Bl(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",n)}}onPermissionsChange(e){const n=l=>{e(l.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n)}}}var Zc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Qc{constructor(e){this.messageBus=e}getTheme(){return Zc(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const n=l=>{e(l.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",n)}}}var Kn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class xc{constructor(e){this.messageBus=e}uploadImages(e,n){return Kn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e,typeHint:n})})}uploadScenes(e,n){return Kn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e,disableShowScenes:n})})}downloadImages(e,n,l){return Kn(this,void 0,void 0,function*(){const{images:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:e,defaultSearch:n,typeHint:l},-1);return s})}downloadScenes(e,n){return Kn(this,void 0,void 0,function*(){const{scenes:l}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:e,defaultSearch:n},-1);return l})}}var ef=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class tf{constructor(e){this.messageBus=e}sendMessage(e,n){return ef(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:e,data:n})})}onMessage(e,n){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:e}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${e}`,n),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:e}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${e}`,n)}}}const nf=typeof atob=="function",ss=typeof Buffer=="function",lo=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const lf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",sf=Array.prototype.slice.call(lf),Xn=(t=>{let e={};return t.forEach((n,l)=>e[n]=l),e})(sf),of=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Zt=String.fromCharCode.bind(String),so=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Ka=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),af=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,rf=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return Zt((n>>>10)+55296)+Zt((n&1023)+56320);case 3:return Zt((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Zt((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},uf=t=>t.replace(af,rf),cf=t=>{if(t=t.replace(/\s+/g,""),!of.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",l,s;for(let o=0;o<t.length;)e=Xn[t.charAt(o++)]<<18|Xn[t.charAt(o++)]<<12|(l=Xn[t.charAt(o++)])<<6|(s=Xn[t.charAt(o++)]),n+=l===64?Zt(e>>16&255):s===64?Zt(e>>16&255,e>>8&255):Zt(e>>16&255,e>>8&255,e&255);return n},Xa=nf?t=>atob(Ka(t)):ss?t=>Buffer.from(t,"base64").toString("binary"):cf,ff=ss?t=>so(Buffer.from(t,"base64")):t=>so(Xa(t).split("").map(e=>e.charCodeAt(0))),df=ss?t=>Buffer.from(t,"base64").toString("utf8"):lo?t=>lo.decode(ff(t)):t=>uf(Xa(t)),pf=t=>Ka(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),mf=t=>df(pf(t));function _f(){const e=new URLSearchParams(window.location.search).get("obrref");let n="",l="";if(e){const o=mf(e).split(" ");o.length===2&&(n=o[0],l=o[1])}return{origin:n,roomId:l}}var io;(function(t){t[t.MOVE=0]="MOVE",t[t.LINE=1]="LINE",t[t.QUAD=2]="QUAD",t[t.CONIC=3]="CONIC",t[t.CUBIC=4]="CUBIC",t[t.CLOSE=5]="CLOSE"})(io||(io={}));const Ll=_f(),et=new Ec(Ll.origin,Ll.roomId),hf=new uc(et),gf=new rc(et),vf=new Xc(et),bf=new Ac(et),yf=new Wc(et),wf=new qc(et),Tf=new Fc(et),Ef=new Uc(et),Af=new Vc(et),Bf=new jc(et),kf=new Yc(et),Cf=new Jc(et),Of=new Qc(et),Sf=new xc(et),Mf=new tf(et),je={onReady:t=>{et.ready?t():et.once("OBR_READY",()=>t())},get isReady(){return et.ready},viewport:hf,player:gf,party:vf,notification:bf,scene:yf,contextMenu:wf,tool:Tf,popover:Ef,modal:Af,action:Bf,interaction:kf,room:Cf,theme:Of,assets:Sf,broadcast:Mf,isAvailable:!!Ll.origin},Rf=50,is=ct([]);function $f(t){is.update(e=>(e.push({msg:t,timestamp:new Date}),e.length>Rf&&e.shift(),e))}function Df(){is.set([])}const al=8,mt=ct(1),Pl=ct(!1),oo=jl(Ja,2e3,()=>Pl.set(!0),()=>Pl.set(!1));async function Nf(){for(let t=0;t<al;t++)await Mt.removeItem(dl(t+1))}async function If(){mt.subscribe(t=>oo(We(ye),t)),ye.subscribe(t=>oo(t,We(mt))),mt.subscribe(async t=>{ye.set(await xa(t))}),mt.set(await Za()),mt.subscribe(Qa)}async function Ja(t,e){Mt.setItem(dl(e),JSON.stringify(t))}function dl(t){return`sd-character-sheet-slot-${t}`}async function Za(){return parseInt(await Mt.getItem("sd-character-sheet-chosen-slot")??"1")}async function Qa(t){Mt.setItem("sd-character-sheet-chosen-slot",`${t}`)}async function xa(t){await Lf(t);const e=await Mt.getItem(dl(t));if(!e)return Ot();try{const n=JSON.parse(e);return jr(n)}catch(n){return console.warn("Failed to parse save, resetting slot",n),Ot()}}async function Lf(t){const e="sd-character-sheet",n=await Mt.getItem(e);n&&(await Mt.setItem(dl(t),n),await Mt.removeItem(e))}const Mt={setItem:async function(t,e){return Promise.resolve().then(function(){window.localStorage.setItem(t,e)})},getItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.getItem(t)})},removeItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.removeItem(t)})}},Pf="com.maxpaulus.sd-character-sheet",Cn=ct({}),En=ct({});function bn(t){return`${Pf}/${t}`}const Wt=ct(!1),Mn=ct([]),Ct=ct(),Gn=ct(),os=ct(),_n=Ar(Ct,t=>t==We(Gn));async function er(){je.onReady(async()=>{Wt.set(await je.player.getRole()==="GM"),Hf(),We(Wt)&&Gf(),ao()})}function Hf(){je.broadcast.onMessage(nr,({data:t})=>{typeof t=="string"&&Gl(t)})}async function Gf(){Gn.set(je.player.id),Ct.set(je.player.id),je.player.onChange(t=>{os.set(t)}),je.party.onChange(t=>{Mn.set(t)}),Mn.subscribe(async t=>{const e={};e[je.player.id]=(await je.player.getMetadata())[bn("sheetData")];for(const l of t)e[l.id]=l.metadata[bn("sheetData")];Cn.set(e);const n=We(Ct);t.find(l=>l.id===n)||Ct.set(je.player.id)}),Cn.subscribe(t=>{var l;const e=We(mt),n=We(Ct);ye.set(((l=t[n])==null?void 0:l[`slot-${e}`])??Ot())}),mt.subscribe(t=>{var l;const e=We(Cn),n=We(Ct);ye.set(((l=e[n])==null?void 0:l[`slot-${t}`])??Ot())}),Ct.subscribe(t=>{var l;const e=We(Cn),n=We(mt);ye.set(((l=e[t])==null?void 0:l[`slot-${n}`])??Ot())}),Mn.set(await je.party.getPlayers())}async function ao(){mt.set(await Za());const t={};for(let e=1;e<=al;e++)t[`slot-${e}`]=await xa(e)??Ot();En.set(t),ye.subscribe(jl(e=>{if(We(Wt)&&!We(_n))return;const n=We(En),l=We(mt);Ja(e,l),n[`slot-${l}`]=e,En.set(n)},1e3)),mt.subscribe(e=>{if(We(Wt)&&!We(_n))return;Qa(e);const n=We(En);ye.set(n[`slot-${e}`])}),En.subscribe(e=>{if(We(Wt)){if(!We(_n))return;const n=We(Cn),l=We(Gn);n[l]=e}je.player.setMetadata({[bn("sheetData")]:e})})}const Wf=Object.freeze(Object.defineProperty({__proto__:null,GmId:Gn,GmPlayer:os,PartyStore:Mn,TrackedPlayer:Ct,init:er,isGM:Wt,isTrackedPlayerGM:_n,pluginId:bn},Symbol.toStringTag,{value:"Module"})),tr="sd-character-sheet-local-settings";function Hl(){return{popoverDuration:5}}const hn=ct(Hl());async function qf(){hn.set(await Ff()),hn.subscribe(t=>{if(t.popoverDuration<0){hn.set({...t,popoverDuration:0});return}Mt.setItem(tr,JSON.stringify(t))})}async function Ff(){try{const t=await Mt.getItem(tr);return JSON.parse(t)??Hl()}catch{return console.error("couldn't load settings from local storage"),Hl()}}const nr=bn("notification");async function Jn(t,e={}){if(!je.isAvailable){alert(t);return}const l=`${await je.player.getName()}: ${t}`;e.secret?Gl(`Secret: ${l}`):(je.broadcast.sendMessage(nr,l),Gl(l))}let Zn;async function Gl(t){$f(t);const e=bn("popover");Zn&&(clearTimeout(Zn),Zn=null);try{await je.popover.open({id:e,url:`/popover.html?msg=${encodeURIComponent(t)}`,height:100,width:400}),Zn=setTimeout(()=>{je.popover.close(e)},(We(hn).popoverDuration??5)*1e3)}catch{alert(t)}}function Uf(t){let e,n=In(t[0])+"",l;return{c(){e=m("div"),l=G(n),p(e,"class","rounded-md bg-black text-white p-1")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&1&&n!==(n=In(s[0])+"")&&ee(l,n)},d(s){s&&T(e)}}}function ro(t){let e,n;const l=[t[3]];let s={$$slots:{default:[Yf]},$$scope:{ctx:t}};for(let o=0;o<l.length;o+=1)s=tl(s,l[o]);return e=new lc({props:s}),e.$on("click",t[11]),e.$on("clickoutside",t[11]),{c(){ne(e.$$.fragment)},m(o,i){le(e,o,i),n=!0},p(o,i){const r=i&8?wa(l,[vr(o[3])]):{};i&32768&&(r.$$scope={dirty:i,ctx:o}),e.$set(r)},i(o){n||(P(e.$$.fragment,o),n=!0)},o(o){W(e.$$.fragment,o),n=!1},d(o){se(e,o)}}}function Vf(t){let e;return{c(){e=m("div"),e.textContent="秘密擲骰",p(e,"class","text-black")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function jf(t){let e;return{c(){e=m("div"),e.textContent="優勢擲骰",p(e,"class","text-green-700")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function zf(t){let e;return{c(){e=m("div"),e.textContent="劣勢擲骰",p(e,"class","text-red-700")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Yf(t){let e,n,l,s,o,i,r,u;return e=new jn({props:{text:"擲骰"}}),e.$on("click",t[6]),l=new jn({props:{$$slots:{default:[Vf]},$$scope:{ctx:t}}}),l.$on("click",t[9]),o=new jn({props:{$$slots:{default:[jf]},$$scope:{ctx:t}}}),o.$on("click",t[7]),r=new jn({props:{$$slots:{default:[zf]},$$scope:{ctx:t}}}),r.$on("click",t[8]),{c(){ne(e.$$.fragment),n=y(),ne(l.$$.fragment),s=y(),ne(o.$$.fragment),i=y(),ne(r.$$.fragment)},m(c,a){le(e,c,a),w(c,n,a),le(l,c,a),w(c,s,a),le(o,c,a),w(c,i,a),le(r,c,a),u=!0},p(c,a){const d={};a&32768&&(d.$$scope={dirty:a,ctx:c}),l.$set(d);const _={};a&32768&&(_.$$scope={dirty:a,ctx:c}),o.$set(_);const v={};a&32768&&(v.$$scope={dirty:a,ctx:c}),r.$set(v)},i(c){u||(P(e.$$.fragment,c),P(l.$$.fragment,c),P(o.$$.fragment,c),P(r.$$.fragment,c),u=!0)},o(c){W(e.$$.fragment,c),W(l.$$.fragment,c),W(o.$$.fragment,c),W(r.$$.fragment,c),u=!1},d(c){se(e,c),c&&T(n),se(l,c),c&&T(s),se(o,c),c&&T(i),se(r,c)}}}function Kf(t){let e,n,l,s,o,i;const r=t[14].default,u=Rn(r,t,t[15],null),c=u||Uf(t);let a=t[2]&&ro(t);return{c(){e=m("div"),n=m("button"),c&&c.c(),l=y(),a&&a.c(),n.disabled=t[1],p(n,"class","bg-black text-white pt-1 px-1 rounded-md"),$e(n,"opacity-50",t[1]),$e(n,"cursor-not-allowed",t[1])},m(d,_){w(d,e,_),f(e,n),c&&c.m(n,null),f(e,l),a&&a.m(e,null),s=!0,o||(i=[I(n,"click",t[6]),I(n,"contextmenu",gr(t[10])),I(n,"touchstart",t[4]),I(n,"touchend",t[5],{passive:!0})],o=!0)},p(d,[_]){u?u.p&&(!s||_&32768)&&$n(u,r,d,d[15],s?Nn(r,d[15],_,null):Dn(d[15]),null):c&&c.p&&(!s||_&1)&&c.p(d,s?_:-1),(!s||_&2)&&(n.disabled=d[1]),(!s||_&2)&&$e(n,"opacity-50",d[1]),(!s||_&2)&&$e(n,"cursor-not-allowed",d[1]),d[2]?a?(a.p(d,_),_&4&&P(a,1)):(a=ro(d),a.c(),P(a,1),a.m(e,null)):a&&(qe(),W(a,1,1,()=>{a=null}),Fe())},i(d){s||(P(c,d),P(a),s=!0)},o(d){W(c,d),W(a),s=!1},d(d){d&&T(e),c&&c.d(d),a&&a.d(),o=!1,Ue(i)}}}function Xf(t,e,n){let{$$slots:l={},$$scope:s}=e,{modifier:o=0}=e,{numDice:i=1}=e,{diceType:r="d20"}=e,{disabled:u=!1}=e,c=!1,a={x:0,y:0},d;function _(C){d=setTimeout(()=>{E(C),d=null},500)}function v(){d&&(clearTimeout(d),d=null)}function g(){const C=Ht(r,i),M=`擲出 ${i}${r}: ${C} + ${o} = ${C+o}`;Jn(M)}function h(){const C=Ht(r,i),O=Ht(r,i),M=Math.max(C,O),R=`擲出 ${i}${r}: ${C} 與 ${O};
 ${M} + ${o} = ${M+o}`;Jn(R)}function b(){const C=Ht(r,i),O=Ht(r,i),M=Math.min(C,O),R=`擲出 ${i}${r}: ${C} 與 ${O};
 ${M} + ${o} = ${M+o}`;Jn(R)}function A(){const C=Ht(r,i),M=`擲出 ${i}${r}: ${C} + ${o} = ${C+o}`;Jn(M,{secret:!0})}async function E(C){u||(c&&(n(2,c=!1),await new Promise(O=>setTimeout(O,100))),n(3,a={x:C.clientX,y:C.clientY}),n(2,c=!0))}function B(){n(2,c=!1)}return t.$$set=C=>{"modifier"in C&&n(0,o=C.modifier),"numDice"in C&&n(12,i=C.numDice),"diceType"in C&&n(13,r=C.diceType),"disabled"in C&&n(1,u=C.disabled),"$$scope"in C&&n(15,s=C.$$scope)},[o,u,c,a,_,v,g,h,b,A,E,B,i,r,l,s]}class Wn extends Ce{constructor(e){super(),Oe(this,e,Xf,Kf,ke,{modifier:0,numDice:12,diceType:13,disabled:1})}}function uo(t){let e,n,l;return{c(){e=m("button"),e.innerHTML='<i class="material-icons bg-gray-500 text-white rounded-full text-md p-1 scale-[60%]">close</i>',p(e,"class","absolute right-0")},m(s,o){w(s,e,o),n||(l=I(e,"click",t[3]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function Jf(t){let e,n,l,s,o,i=[{type:"text"},t[1]],r={};for(let c=0;c<i.length;c+=1)r=tl(r,i[c]);let u=t[0]&&uo(t);return{c(){e=m("div"),n=m("input"),l=y(),u&&u.c(),Bs(n,r),$e(n,"svelte-hnbmdk",!0),p(e,"class","relative")},m(c,a){w(c,e,a),f(e,n),n.autofocus&&n.focus(),oe(n,t[0]),f(e,l),u&&u.m(e,null),s||(o=I(n,"input",t[2]),s=!0)},p(c,[a]){Bs(n,r=wa(i,[{type:"text"},a&2&&c[1]])),a&1&&n.value!==c[0]&&oe(n,c[0]),$e(n,"svelte-hnbmdk",!0),c[0]?u?u.p(c,a):(u=uo(c),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i:V,o:V,d(c){c&&T(e),u&&u.d(),s=!1,o()}}}function Zf(t,e,n){const l=["value"];let s=ks(e,l),{value:o}=e;function i(){o=this.value,n(0,o)}const r=()=>{n(0,o="")};return t.$$set=u=>{e=tl(tl({},e),br(u)),n(1,s=ks(e,l)),"value"in u&&n(0,o=u.value)},[o,s,i,r]}class lr extends Ce{constructor(e){super(),Oe(this,e,Zf,Jf,ke,{value:0})}}function co(t){let e;return{c(){e=G("(儀式)")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function fo(t){let e,n=t[0].stat+"",l;return{c(){e=G("/ "),l=G(n)},m(s,o){w(s,e,o),w(s,l,o)},p(s,o){o&1&&n!==(n=s[0].stat+"")&&ee(l,n)},d(s){s&&T(e),s&&T(l)}}}function po(t){let e,n,l,s,o=[t[0].components.verbal?"V":null,t[0].components.somatic?"S":null,t[0].components.material?`M (${t[0].components.materialDesc??""})`:null].filter(Boolean).join(", ")+"",i;return{c(){e=m("div"),n=m("span"),n.textContent="構材 (Components)",l=y(),s=m("span"),i=G(o),p(n,"class","font-bold block text-xs text-gray-500"),p(e,"class","col-span-2")},m(r,u){w(r,e,u),f(e,n),f(e,l),f(e,s),f(s,i)},p(r,u){u&1&&o!==(o=[r[0].components.verbal?"V":null,r[0].components.somatic?"S":null,r[0].components.material?`M (${r[0].components.materialDesc??""})`:null].filter(Boolean).join(", ")+"")&&ee(i,o)},d(r){r&&T(e)}}}function Qf(t){let e;return{c(){e=m("button"),e.textContent="無法學習",p(e,"class","bg-gray-400 text-white w-full p-2 rounded cursor-not-allowed"),e.disabled=!0},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function xf(t){let e,n,l;return{c(){e=m("button"),e.textContent="學習",p(e,"class","bg-blue-800 text-white w-full p-2 rounded shadow hover:bg-blue-900 transition-colors font-bold")},m(s,o){w(s,e,o),n||(l=I(e,"click",t[9]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function ed(t){let e,n,l;return{c(){e=m("button"),e.textContent="遺忘",p(e,"class","bg-red-800 text-white w-full p-2 rounded shadow hover:bg-red-900 transition-colors font-bold")},m(s,o){w(s,e,o),n||(l=I(e,"click",t[8]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function mo(t){let e,n,l,s,o;return{c(){e=m("button"),e.innerHTML='<i class="material-icons text-sm">delete</i>',n=y(),l=m("button"),l.innerHTML='<i class="material-icons text-sm">edit</i>',p(e,"class","bg-gray-800 text-white p-2 rounded hover:bg-black"),p(l,"class","bg-gray-800 text-white p-2 rounded hover:bg-black")},m(i,r){w(i,e,r),w(i,n,r),w(i,l,r),s||(o=[I(e,"click",t[10]),I(l,"click",t[11])],s=!0)},p:V,d(i){i&&T(e),i&&T(n),i&&T(l),s=!1,Ue(o)}}}function _o(t){let e,n,l;function s(i){t[13](i)}let o={$$slots:{header:[nd],default:[td]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ft({props:o}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&65539&&(u.$$scope={dirty:r,ctx:i}),!n&&r&2&&(n=!0,u.showModal=i[1],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){W(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function td(t){let e,n;return e=new La({props:{spellToEdit:t[0]}}),e.$on("finish",t[12]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&1&&(o.spellToEdit=l[0]),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function nd(t){var o;let e,n,l=(((o=t[0].l10n)==null?void 0:o.name)??t[0].name)+"",s;return{c(){e=m("h2"),n=G("編輯法術: "),s=G(l),p(e,"slot","header")},m(i,r){w(i,e,r),f(e,n),f(e,s)},p(i,r){var u;r&1&&l!==(l=(((u=i[0].l10n)==null?void 0:u.name)??i[0].name)+"")&&ee(s,l)},d(i){i&&T(e)}}}function ld(t){var Ae,Ie;let e,n,l,s,o=(((Ae=t[0].l10n)==null?void 0:Ae.name)??t[0].name)+"",i,r,u,c=t[0].tier===0?"戲法":`${t[0].tier} 環`,a,d,_,v,g=(Sl(t[0].class)??t[0].class)+"",h,b,A,E,B,C,O,M,N,R,S,k,$,D,U=t[7](t[0].range)+"",F,Q,ve,re,de=(((Ie=t[0].l10n)==null?void 0:Ie.desc)??t[0].desc)+"",ae,j,q,K,we,Y,pe,be,X,H=t[0].ritual&&co(),J=t[0].stat&&fo(t),he=t[0].components&&po(t);function me(x,fe){return fe&9&&(K=null),fe&9&&(we=null),K==null&&(K=!!Ia(x[3],x[0])),K?ed:(we==null&&(we=!!tu(x[3],x[0])),we?xf:Qf)}let ue=me(t,-1),ce=ue(t),z=t[0].editable&&mo(t),te=t[1]&&_o(t);return{c(){e=m("div"),n=m("div"),l=m("div"),s=m("span"),i=G(o),r=y(),u=m("span"),a=G(c),d=y(),H&&H.c(),_=y(),v=m("div"),h=G(g),b=y(),J&&J.c(),A=y(),E=m("div"),B=m("div"),C=m("span"),C.textContent="持續時間",O=y(),M=m("span"),N=G(t[2]),R=y(),S=m("div"),k=m("span"),k.textContent="施法距離",$=y(),D=m("span"),F=G(U),Q=y(),he&&he.c(),ve=y(),re=m("div"),ae=G(de),j=y(),q=m("div"),ce.c(),Y=y(),z&&z.c(),pe=y(),te&&te.c(),be=vt(),p(s,"class","font-bold text-lg text-purple-900"),p(u,"class","text-sm font-bold text-gray-600"),p(l,"class","flex justify-between items-baseline"),p(v,"class","text-xs text-gray-500 italic"),p(n,"class","flex flex-col border-b pb-2 mb-2"),p(C,"class","font-bold block text-xs text-gray-500"),p(k,"class","font-bold block text-xs text-gray-500"),p(E,"class","grid grid-cols-2 gap-2 text-sm mb-3"),p(re,"class","text-sm leading-relaxed text-gray-800 border-t pt-2 mb-3"),p(q,"class","flex gap-2"),p(e,"class","shadow-md border border-gray-200 mb-3 p-3 rounded-md bg-white")},m(x,fe){w(x,e,fe),f(e,n),f(n,l),f(l,s),f(s,i),f(l,r),f(l,u),f(u,a),f(u,d),H&&H.m(u,null),f(n,_),f(n,v),f(v,h),f(v,b),J&&J.m(v,null),f(e,A),f(e,E),f(E,B),f(B,C),f(B,O),f(B,M),f(M,N),f(E,R),f(E,S),f(S,k),f(S,$),f(S,D),f(D,F),f(E,Q),he&&he.m(E,null),f(e,ve),f(e,re),f(re,ae),f(e,j),f(e,q),ce.m(q,null),f(q,Y),z&&z.m(q,null),w(x,pe,fe),te&&te.m(x,fe),w(x,be,fe),X=!0},p(x,[fe]){var Se,L;(!X||fe&1)&&o!==(o=(((Se=x[0].l10n)==null?void 0:Se.name)??x[0].name)+"")&&ee(i,o),(!X||fe&1)&&c!==(c=x[0].tier===0?"戲法":`${x[0].tier} 環`)&&ee(a,c),x[0].ritual?H||(H=co(),H.c(),H.m(u,null)):H&&(H.d(1),H=null),(!X||fe&1)&&g!==(g=(Sl(x[0].class)??x[0].class)+"")&&ee(h,g),x[0].stat?J?J.p(x,fe):(J=fo(x),J.c(),J.m(v,null)):J&&(J.d(1),J=null),(!X||fe&4)&&ee(N,x[2]),(!X||fe&1)&&U!==(U=x[7](x[0].range)+"")&&ee(F,U),x[0].components?he?he.p(x,fe):(he=po(x),he.c(),he.m(E,null)):he&&(he.d(1),he=null),(!X||fe&1)&&de!==(de=(((L=x[0].l10n)==null?void 0:L.desc)??x[0].desc)+"")&&ee(ae,de),ue===(ue=me(x,fe))&&ce?ce.p(x,fe):(ce.d(1),ce=ue(x),ce&&(ce.c(),ce.m(q,Y))),x[0].editable?z?z.p(x,fe):(z=mo(x),z.c(),z.m(q,null)):z&&(z.d(1),z=null),x[1]?te?(te.p(x,fe),fe&2&&P(te,1)):(te=_o(x),te.c(),P(te,1),te.m(be.parentNode,be)):te&&(qe(),W(te,1,1,()=>{te=null}),Fe())},i(x){X||(P(te),X=!0)},o(x){W(te),X=!1},d(x){x&&T(e),H&&H.d(),J&&J.d(),he&&he.d(),ce.d(),z&&z.d(),x&&T(pe),te&&te.d(x),x&&T(be)}}}function sd(t,e,n){let l,s;Re(t,De,B=>n(3,s=B));let{s:o}=e,i=yn(),r=!1;const u={Self:"自身",Touch:"觸碰",Sight:"視線"};function c(B){nu(s,B),De.set(s)}function a(B){lu(s,B),De.set(s),i("close")}function d(B){iu(s,B),De.set(s),i("close")}function _(B){return u[B]??B}const v=()=>a(o),g=()=>c(o),h=()=>d(o),b=()=>{n(1,r=!0)},A=()=>{n(1,r=!1),n(0,o)};function E(B){r=B,n(1,r)}return t.$$set=B=>{"s"in B&&n(0,o=B.s)},t.$$.update=()=>{t.$$.dirty&1&&n(2,l=o.duration)},[o,r,l,s,c,a,d,_,v,g,h,b,A,E]}class sr extends Ce{constructor(e){super(),Oe(this,e,sd,ld,ke,{s:0})}}function ho(t,e,n){const l=t.slice();return l[14]=e[n],l}function go(t,e,n){const l=t.slice();return l[17]=e[n],l}function id(t,e,n){const l=t.slice();return l[20]=e[n],l[22]=n,l}function od(t,e,n){const l=t.slice();return l[20]=e[n],l[22]=n,l}function vo(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h,b,A,E=Array(10),B=[];for(let R=0;R<E.length;R+=1)B[R]=ad(od(t,E,R));let C=Array(10),O=[];for(let R=0;R<C.length;R+=1)O[R]=rd(id(t,C,R));let M=Ft,N=[];for(let R=0;R<M.length;R+=1)N[R]=bo(go(t,M,R));return{c(){e=m("div"),n=m("div"),l=m("label"),l.textContent="環階:",s=y(),o=m("select");for(let R=0;R<B.length;R+=1)B[R].c();i=y(),r=m("span"),r.textContent="-",u=y(),c=m("select");for(let R=0;R<O.length;R+=1)O[R].c();a=y(),d=m("div"),_=m("label"),_.textContent="職業:",v=y(),g=m("select"),h=m("option"),h.textContent="全部";for(let R=0;R<N.length;R+=1)N[R].c();p(l,"for","minTier"),p(l,"class","font-bold"),p(o,"id","minTier"),p(o,"class","border rounded"),t[1]===void 0&&Pe(()=>t[11].call(o)),p(c,"id","maxTier"),p(c,"class","border rounded"),t[2]===void 0&&Pe(()=>t[12].call(c)),p(n,"class","flex gap-2 items-center"),p(_,"for","classFilter"),p(_,"class","font-bold"),h.__value="All",h.value=h.__value,p(g,"id","classFilter"),p(g,"class","border rounded max-w-[200px]"),t[3]===void 0&&Pe(()=>t[13].call(g)),p(d,"class","flex gap-2 items-center"),p(e,"class","flex flex-col gap-2 bg-gray-50 p-2 rounded text-sm")},m(R,S){w(R,e,S),f(e,n),f(n,l),f(n,s),f(n,o);for(let k=0;k<B.length;k+=1)B[k]&&B[k].m(o,null);_e(o,t[1],!0),f(n,i),f(n,r),f(n,u),f(n,c);for(let k=0;k<O.length;k+=1)O[k]&&O[k].m(c,null);_e(c,t[2],!0),f(e,a),f(e,d),f(d,_),f(d,v),f(d,g),f(g,h);for(let k=0;k<N.length;k+=1)N[k]&&N[k].m(g,null);_e(g,t[3],!0),b||(A=[I(o,"change",t[11]),I(c,"change",t[12]),I(g,"change",t[13])],b=!0)},p(R,S){if(S&2&&_e(o,R[1]),S&4&&_e(c,R[2]),S&0){M=Ft;let k;for(k=0;k<M.length;k+=1){const $=go(R,M,k);N[k]?N[k].p($,S):(N[k]=bo($),N[k].c(),N[k].m(g,null))}for(;k<N.length;k+=1)N[k].d(1);N.length=M.length}S&8&&_e(g,R[3])},d(R){R&&T(e),Be(B,R),Be(O,R),Be(N,R),b=!1,Ue(A)}}}function ad(t){let e,n;return{c(){e=m("option"),n=G(t[22]),e.__value=t[22],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:V,d(l){l&&T(e)}}}function rd(t){let e,n;return{c(){e=m("option"),n=G(t[22]),e.__value=t[22],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:V,d(l){l&&T(e)}}}function bo(t){let e,n=t[17]+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[17],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function ud(t){let e=[],n=new Map,l,s,o=t[6];const i=r=>r[14].name;for(let r=0;r<o.length;r+=1){let u=ho(t,o,r),c=i(u);n.set(c,e[r]=yo(c,u))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();l=vt()},m(r,u){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(r,u);w(r,l,u),s=!0},p(r,u){u&64&&(o=r[6],qe(),e=yr(e,u,i,1,r,o,n,l.parentNode,wr,yo,l,ho),Fe())},i(r){if(!s){for(let u=0;u<o.length;u+=1)P(e[u]);s=!0}},o(r){for(let u=0;u<e.length;u+=1)W(e[u]);s=!1},d(r){for(let u=0;u<e.length;u+=1)e[u].d(r);r&&T(l)}}}function cd(t){let e;return{c(){e=m("div"),e.textContent="沒有符合的法術",p(e,"class","text-center text-gray-500 mt-10")},m(n,l){w(n,e,l)},p:V,i:V,o:V,d(n){n&&T(e)}}}function yo(t,e){let n,l,s,o;return l=new sr({props:{s:e[14]}}),{key:t,first:null,c(){n=m("div"),ne(l.$$.fragment),s=y(),p(n,"class","mb-4 break-inside-avoid"),this.first=n},m(i,r){w(i,n,r),le(l,n,null),f(n,s),o=!0},p(i,r){e=i;const u={};r&64&&(u.s=e[14]),l.$set(u)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){W(l.$$.fragment,i),o=!1},d(i){i&&T(n),se(l)}}}function fd(t){let e,n,l,s,o,i,r,u=t[5]?"隱藏過濾":"顯示過濾",c,a,d,_,v,g,h,b,A,E,B,C,O;function M(D){t[8](D)}let N={placeholder:"搜尋法術...",class:"w-full mb-2"};t[0]!==void 0&&(N.value=t[0]),l=new lr({props:N}),Ve.push(()=>Ye(l,"value",M));let R=t[5]&&vo(t);const S=[cd,ud],k=[];function $(D,U){return D[6].length===0?0:1}return A=$(t),E=k[A]=S[A](t),{c(){e=m("div"),n=m("div"),ne(l.$$.fragment),o=y(),i=m("div"),r=m("button"),c=G(u),a=y(),d=m("label"),_=m("input"),v=G(" 只顯示自訂"),g=y(),R&&R.c(),h=y(),b=m("div"),E.c(),p(r,"class","text-blue-700 underline text-xs"),p(_,"type","checkbox"),p(_,"class","svelte-1ep1fgl"),p(d,"class","flex gap-1 items-center ml-auto"),p(i,"class","flex gap-2 items-center text-sm mb-2 flex-wrap"),p(n,"class","sticky top-0 bg-white p-2 border-b z-10"),p(b,"class","overflow-y-auto p-2 flex-1"),p(e,"class","flex flex-col gap-1 h-full overflow-hidden")},m(D,U){w(D,e,U),f(e,n),le(l,n,null),f(n,o),f(n,i),f(i,r),f(r,c),f(i,a),f(i,d),f(d,_),_.checked=t[4],f(d,v),f(n,g),R&&R.m(n,null),f(e,h),f(e,b),k[A].m(b,null),B=!0,C||(O=[I(r,"click",t[9]),I(_,"change",t[10])],C=!0)},p(D,[U]){const F={};!s&&U&1&&(s=!0,F.value=D[0],Ke(()=>s=!1)),l.$set(F),(!B||U&32)&&u!==(u=D[5]?"隱藏過濾":"顯示過濾")&&ee(c,u),U&16&&(_.checked=D[4]),D[5]?R?R.p(D,U):(R=vo(D),R.c(),R.m(n,null)):R&&(R.d(1),R=null);let Q=A;A=$(D),A===Q?k[A].p(D,U):(qe(),W(k[Q],1,1,()=>{k[Q]=null}),Fe(),E=k[A],E?E.p(D,U):(E=k[A]=S[A](D),E.c()),P(E,1),E.m(b,null))},i(D){B||(P(l.$$.fragment,D),P(E),B=!0)},o(D){W(l.$$.fragment,D),W(E),B=!1},d(D){D&&T(e),se(l),R&&R.d(),k[A].d(),C=!1,Ue(O)}}}function dd(t,e,n){let l,s;Re(t,De,A=>n(7,s=A));let o="",i=!0,r=0,u=9,c="All",a=!1;function d(A){o=A,n(0,o)}const _=()=>n(5,i=!i);function v(){a=this.checked,n(4,a)}function g(){r=Ge(this),n(1,r)}function h(){u=Ge(this),n(2,u)}function b(){c=Ge(this),n(3,c)}return t.$$.update=()=>{t.$$.dirty&159&&n(6,l=Object.values(Fl).concat(s.customSpells??[]).filter(A=>{var B,C;if(A.tier<r||A.tier>u||c!=="All"&&A.class!==c||a&&!s.customSpells.find(O=>O.name===A.name))return!1;const E=o.toLowerCase();return E?A.name.toLowerCase().includes(E)||A.desc.toLowerCase().includes(E)||(((C=(B=A.l10n)==null?void 0:B.name)==null?void 0:C.toLowerCase().includes(E))??!1):!0}).sort((A,E)=>A.tier!==E.tier?A.tier-E.tier:A.name.localeCompare(E.name)))},[o,r,u,c,a,i,l,s,d,_,v,g,h,b]}class pd extends Ce{constructor(e){super(),Oe(this,e,dd,fd,ke,{})}}function md(t){let e,n;return e=new pd({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function _d(t){let e;return{c(){e=m("h1"),e.textContent="法術",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function hd(t){let e,n,l,s,o,i,r;function u(a){t[2](a)}let c={vh:90,$$slots:{header:[_d],default:[md]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=m("button"),e.textContent="法術",n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white p-2 w-full")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=I(e,"click",t[1]),i=!0)},p(a,[d]){const _={};d&8&&(_.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,_.showModal=a[0],Ke(()=>s=!1)),l.$set(_)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function gd(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function o(i){l=i,n(0,l)}return[l,s,o]}class vd extends Ce{constructor(e){super(),Oe(this,e,gd,hd,ke,{})}}function bd(t){let e,n;return e=new sr({props:{s:t[0]}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&1&&(o.s=l[0]),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function yd(t){let e,n=t[0].name+"",l;return{c(){e=m("h2"),l=G(n),p(e,"slot","header")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&1&&n!==(n=s[0].name+"")&&ee(l,n)},d(s){s&&T(e)}}}function wd(t){let e,n,l,s,o,i,r;function u(a){t[4](a)}let c={$$slots:{header:[yd],default:[bd]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=m("button"),e.innerHTML='<i class="material-icons">info</i>',n=y(),ne(l.$$.fragment)},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=I(e,"click",t[2]),i=!0)},p(a,[d]){const _={};d&35&&(_.$$scope={dirty:d,ctx:a}),!s&&d&2&&(s=!0,_.showModal=a[1],Ke(()=>s=!1)),l.$set(_)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function Td(t,e,n){let{spell:l}=e,s=!1;const o=()=>{n(1,s=!0)},i=()=>{n(1,s=!1)};function r(u){s=u,n(1,s)}return t.$$set=u=>{"spell"in u&&n(0,l=u.spell)},[l,s,o,i,r]}class Ed extends Ce{constructor(e){super(),Oe(this,e,Td,wd,ke,{spell:0})}}const{Boolean:Ad}=Ta;function wo(t,e,n){const l=t.slice();return l[5]=e[n],l}function Bd(t){let e;return{c(){e=m("div"),e.textContent="尚未學習法術",p(e,"class","text-gray-500 text-center py-4")},m(n,l){w(n,e,l)},p:V,i:V,o:V,d(n){n&&T(e)}}}function kd(t){let e,n,l=t[0],s=[];for(let i=0;i<l.length;i+=1)s[i]=To(wo(t,l,i));const o=i=>W(s[i],1,1,()=>{s[i]=null});return{c(){e=m("ul");for(let i=0;i<s.length;i+=1)s[i].c();p(e,"class","flex flex-col gap-1")},m(i,r){w(i,e,r);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);n=!0},p(i,r){if(r&5){l=i[0];let u;for(u=0;u<l.length;u+=1){const c=wo(i,l,u);s[u]?(s[u].p(c,r),P(s[u],1)):(s[u]=To(c),s[u].c(),P(s[u],1),s[u].m(e,null))}for(qe(),u=l.length;u<s.length;u+=1)o(u);Fe()}},i(i){if(!n){for(let r=0;r<l.length;r+=1)P(s[r]);n=!0}},o(i){s=s.filter(Ad);for(let r=0;r<s.length;r+=1)W(s[r]);n=!1},d(i){i&&T(e),Be(s,i)}}}function Cd(t){let e;return{c(){e=m("span"),e.textContent="攻擊",p(e,"class","font-bold px-1")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function To(t){var O;let e,n,l,s,o,i,r,u=(((O=t[5].l10n)==null?void 0:O.name)??t[5].name)+"",c,a,d,_=t[5].tier===0?"戲法":`${t[5].tier} 環`,v,g,h,b,A,E,B,C;return s=new Ed({props:{spell:t[5]}}),A=new Wn({props:{modifier:t[2],$$slots:{default:[Cd]},$$scope:{ctx:t}}}),{c(){e=m("li"),n=m("div"),l=m("div"),ne(s.$$.fragment),o=y(),i=m("div"),r=m("span"),c=G(u),a=y(),d=m("span"),v=G(_),g=y(),h=m("div"),b=m("div"),ne(A.$$.fragment),B=y(),p(r,"class","font-bold"),p(d,"class","text-[10px] text-gray-500"),p(i,"class","flex flex-col"),p(l,"class","flex gap-2 items-center"),p(b,"title",E=`法術攻擊 (${t[2]>=0?"+":""}${t[2]})`),p(h,"class","flex items-center gap-2"),p(n,"class","flex justify-between border-b border-gray-300 items-center py-1")},m(M,N){w(M,e,N),f(e,n),f(n,l),le(s,l,null),f(l,o),f(l,i),f(i,r),f(r,c),f(i,a),f(i,d),f(d,v),f(n,g),f(n,h),f(h,b),le(A,b,null),f(e,B),C=!0},p(M,N){var k;const R={};N&1&&(R.spell=M[5]),s.$set(R),(!C||N&1)&&u!==(u=(((k=M[5].l10n)==null?void 0:k.name)??M[5].name)+"")&&ee(c,u),(!C||N&1)&&_!==(_=M[5].tier===0?"戲法":`${M[5].tier} 環`)&&ee(v,_);const S={};N&4&&(S.modifier=M[2]),N&256&&(S.$$scope={dirty:N,ctx:M}),A.$set(S),(!C||N&4&&E!==(E=`法術攻擊 (${M[2]>=0?"+":""}${M[2]})`))&&p(b,"title",E)},i(M){C||(P(s.$$.fragment,M),P(A.$$.fragment,M),C=!0)},o(M){W(s.$$.fragment,M),W(A.$$.fragment,M),C=!1},d(M){M&&T(e),se(s),se(A)}}}function Od(t){let e,n,l,s,o,i,r=t[2]>=0?"+":"",u,c,a,d,_,v,g,h,b,A,E,B,C,O,M,N,R;const S=[kd,Bd],k=[];function $(D,U){return D[3]?0:1}return A=$(t),E=k[A]=S[A](t),O=new vd({}),N=new ec({}),{c(){e=m("div"),n=m("div"),l=m("div"),s=m("span"),s.textContent="法術攻擊",o=y(),i=m("span"),u=G(r),c=G(t[2]),a=y(),d=m("div"),_=m("span"),_.textContent="法術 DC",v=y(),g=m("span"),h=G(t[1]),b=y(),E.c(),B=y(),C=m("div"),ne(O.$$.fragment),M=y(),ne(N.$$.fragment),p(s,"class","text-xs font-bold text-gray-500"),p(i,"class","text-xl font-bold"),p(l,"class","flex flex-col items-center"),p(_,"class","text-xs font-bold text-gray-500"),p(g,"class","text-xl font-bold"),p(d,"class","flex flex-col items-center"),p(n,"class","flex justify-between items-center bg-gray-100 p-2 rounded"),p(C,"class","flex gap-2 mt-2"),p(e,"class","flex flex-col gap-2")},m(D,U){w(D,e,U),f(e,n),f(n,l),f(l,s),f(l,o),f(l,i),f(i,u),f(i,c),f(n,a),f(n,d),f(d,_),f(d,v),f(d,g),f(g,h),f(e,b),k[A].m(e,null),f(e,B),f(e,C),le(O,C,null),f(C,M),le(N,C,null),R=!0},p(D,[U]){(!R||U&4)&&r!==(r=D[2]>=0?"+":"")&&ee(u,r),(!R||U&4)&&ee(c,D[2]),(!R||U&2)&&ee(h,D[1]);let F=A;A=$(D),A===F?k[A].p(D,U):(qe(),W(k[F],1,1,()=>{k[F]=null}),Fe(),E=k[A],E?E.p(D,U):(E=k[A]=S[A](D),E.c()),P(E,1),E.m(e,B))},i(D){R||(P(E),P(O.$$.fragment,D),P(N.$$.fragment,D),R=!0)},o(D){W(E),W(O.$$.fragment,D),W(N.$$.fragment,D),R=!1},d(D){D&&T(e),k[A].d(),se(O),se(N)}}}function Sd(t,e,n){let l,s,o,i,r;return Re(t,De,u=>n(4,r=u)),t.$$.update=()=>{t.$$.dirty&16&&n(0,l=r.spells.map(u=>Oa(u.name)).filter(Boolean)),t.$$.dirty&1&&n(3,s=(l==null?void 0:l.length)>0),t.$$.dirty&16&&n(2,o=Na(r)),t.$$.dirty&16&&n(1,i=Jr(r))},[l,i,o,s,r]}class Md extends Ce{constructor(e){super(),Oe(this,e,Sd,Od,ke,{})}}function Rd(t){let e,n,l,s,o,i,r,u,c;return s=new Md({}),i=new ju({}),u=new uu({}),{c(){e=m("h2"),e.textContent="法術 / 加值 / 語言",n=y(),l=m("div"),ne(s.$$.fragment),o=y(),ne(i.$$.fragment),r=y(),ne(u.$$.fragment),p(l,"class","overflow-y-auto")},m(a,d){w(a,e,d),w(a,n,d),w(a,l,d),le(s,l,null),f(l,o),le(i,l,null),f(l,r),le(u,l,null),c=!0},p:V,i(a){c||(P(s.$$.fragment,a),P(i.$$.fragment,a),P(u.$$.fragment,a),c=!0)},o(a){W(s.$$.fragment,a),W(i.$$.fragment,a),W(u.$$.fragment,a),c=!1},d(a){a&&T(e),a&&T(n),a&&T(l),se(s),se(i),se(u)}}}class $d extends Ce{constructor(e){super(),Oe(this,e,null,Rd,ke,{})}}function Dd(t){let e,n,l,s=gn(t[0])+"",o,i,r,u,c,a,d,_,v,g;return d=new Wn({props:{modifier:t[2]}}),{c(){e=m("div"),n=m("label"),l=m("h2"),o=G(s),i=y(),r=m("div"),u=m("input"),a=G(" / "),ne(d.$$.fragment),p(u,"id",c=`${t[0]}-input}`),p(u,"type","number"),p(u,"inputmode","numeric"),u.value=t[1],p(u,"min","1"),p(u,"max","20"),p(u,"class","w-1/2"),p(r,"class","sheet-stat flex gap-1"),p(e,"class","flex flex-col")},m(h,b){w(h,e,b),f(e,n),f(n,l),f(l,o),f(n,i),f(n,r),f(r,u),f(r,a),le(d,r,null),_=!0,v||(g=I(u,"input",t[4]),v=!0)},p(h,[b]){(!_||b&1)&&s!==(s=gn(h[0])+"")&&ee(o,s),(!_||b&1&&c!==(c=`${h[0]}-input}`))&&p(u,"id",c),(!_||b&2&&u.value!==h[1])&&(u.value=h[1]);const A={};b&4&&(A.modifier=h[2]),d.$set(A)},i(h){_||(P(d.$$.fragment,h),_=!0)},o(h){W(d.$$.fragment,h),_=!1},d(h){h&&T(e),se(d),v=!1,g()}}}function Nd(t,e,n){let l,s,o,i,{forStat:r}=e;const u=ye;Re(t,u,a=>n(5,i=a));function c(a){const d=parseInt(a.target.value)||10;ze(u,i.stats[r]=d-o,i)}return t.$$set=a=>{"forStat"in a&&n(0,r=a.forStat)},t.$$.update=()=>{t.$$.dirty&33&&n(2,l=Ut(i,r)),t.$$.dirty&33&&n(1,s=zl(i,r)),t.$$.dirty&33&&(o=Da(i,r))},[r,s,l,u,c,i]}class pn extends Ce{constructor(e){super(),Oe(this,e,Nd,Dd,ke,{forStat:0})}}function Eo(t,e,n){const l=t.slice();l[7]=e[n];const s=l[0].includes(l[7]);return l[8]=s,l}function Ao(t){let e,n,l=(t[3][t[7]]??t[7])+"",s,o,i,r,u;function c(){return t[6](t[7])}return{c(){e=m("button"),n=m("div"),s=G(l),i=y(),p(n,"class",o=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)},m(a,d){w(a,e,d),f(e,n),f(n,s),f(e,i),r||(u=I(e,"click",c),r=!0)},p(a,d){t=a,d&12&&l!==(l=(t[3][t[7]]??t[7])+"")&&ee(s,l),d&5&&o!==(o=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)&&p(n,"class",o)},d(a){a&&T(e),r=!1,u()}}}function Id(t){let e,n=t[2],l=[];for(let s=0;s<n.length;s+=1)l[s]=Ao(Eo(t,n,s));return{c(){e=m("div");for(let s=0;s<l.length;s+=1)l[s].c();p(e,"id",t[1]),p(e,"class","w-full flex flex-wrap gap-1")},m(s,o){w(s,e,o);for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(e,null)},p(s,[o]){if(o&29){n=s[2];let i;for(i=0;i<n.length;i+=1){const r=Eo(s,n,i);l[i]?l[i].p(r,o):(l[i]=Ao(r),l[i].c(),l[i].m(e,null))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}o&2&&p(e,"id",s[1])},i:V,o:V,d(s){s&&T(e),Be(l,s)}}}function Ld(t,e,n){let{id:l="multiSelect"}=e,{values:s=[]}=e,{minSelected:o=0}=e,{options:i=[]}=e,{labels:r={}}=e;function u(a){const d=s.findIndex(_=>_===a);d>=0?s.length>o&&s.splice(d,1):s.push(a),n(0,s)}const c=a=>u(a);return t.$$set=a=>{"id"in a&&n(1,l=a.id),"values"in a&&n(0,s=a.values),"minSelected"in a&&n(5,o=a.minSelected),"options"in a&&n(2,i=a.options),"labels"in a&&n(3,r=a.labels)},[s,l,i,r,u,o,c]}class ir extends Ce{constructor(e){super(),Oe(this,e,Ld,Id,ke,{id:1,values:0,minSelected:5,options:2,labels:3})}}function Bo(t,e,n){const l=t.slice();return l[44]=e[n],l}function ko(t,e,n){const l=t.slice();return l[36]=e[n],l}function Co(t,e,n){const l=t.slice();return l[36]=e[n],l}function Oo(t,e,n){const l=t.slice();return l[41]=e[n],l}function Pd(t,e,n){const l=t.slice();return l[47]=e[n],l}function Hd(t){let e,n;return{c(){e=m("option"),n=G(t[47]),e.__value=t[47],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:V,d(l){l&&T(e)}}}function So(t){let e,n,l,s,o,i,r,u,c,a,d,_,v;const g=[qd,Wd,Gd],h=[];function b(A,E){return A[1].gearType==="Basic"?0:A[1].gearType==="Weapon"?1:A[1].gearType==="Armor"?2:-1}return~(c=b(t))&&(a=h[c]=g[c](t)),{c(){e=m("div"),n=m("label"),n.textContent="裝備類型",l=y(),s=m("select"),o=m("option"),o.textContent="基礎",i=m("option"),i.textContent="武器",r=m("option"),r.textContent="防具",u=y(),a&&a.c(),p(n,"for","gearType"),p(n,"class","font-bold"),o.__value="Basic",o.value=o.__value,i.__value="Weapon",i.value=i.__value,r.__value="Armor",r.value=r.__value,p(s,"name","gearType"),p(s,"class","border p-1 rounded"),t[1].gearType===void 0&&Pe(()=>t[14].call(s)),p(e,"class","flex flex-col gap-2 bg-gray-50 p-2 rounded border")},m(A,E){w(A,e,E),f(e,n),f(e,l),f(e,s),f(s,o),f(s,i),f(s,r),_e(s,t[1].gearType,!0),f(e,u),~c&&h[c].m(e,null),d=!0,_||(v=I(s,"change",t[14]),_=!0)},p(A,E){E[0]&2&&_e(s,A[1].gearType);let B=c;c=b(A),c===B?~c&&h[c].p(A,E):(a&&(qe(),W(h[B],1,1,()=>{h[B]=null}),Fe()),~c?(a=h[c],a?a.p(A,E):(a=h[c]=g[c](A),a.c()),P(a,1),a.m(e,null)):a=null)},i(A){d||(P(a),d=!0)},o(A){W(a),d=!1},d(A){A&&T(e),~c&&h[c].d(),_=!1,v()}}}function Gd(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h,b,A,E,B,C,O,M,N,R,S,k,$,D,U,F,Q,ve;function re(q){t[27](q)}let de={id:"armorProperties",options:Rr,labels:t[6]};t[1].armorProperties!==void 0&&(de.values=t[1].armorProperties),l=new ir({props:de}),Ve.push(()=>Ye(l,"values",re));let ae=qt,j=[];for(let q=0;q<ae.length;q+=1)j[q]=Mo(Bo(t,ae,q));return{c(){e=m("label"),e.textContent="防具特性",n=y(),ne(l.$$.fragment),o=y(),i=m("div"),r=m("div"),u=m("label"),u.textContent="基礎 AC",c=y(),a=m("input"),d=y(),_=m("div"),v=m("label"),v.textContent="AC 修正 (+1等)",g=y(),h=m("input"),b=y(),A=m("label"),A.textContent="AC 屬性加成 (通常無或 Dex)",E=y(),B=m("select"),C=m("option"),O=G("無");for(let q=0;q<j.length;q+=1)j[q].c();M=y(),N=m("label"),N.textContent="最大敏捷加值 (Max Dex)",R=y(),S=m("select"),k=m("option"),$=G("無限制 (輕甲)"),D=m("option"),D.textContent="+2 (中甲)",U=m("option"),U.textContent="0 (重甲)",p(e,"for","armorProperties"),p(e,"class","font-bold"),p(u,"for","baseAC"),p(a,"id","baseAC"),p(a,"type","number"),p(a,"class","border p-1 rounded"),p(a,"inputmode","numeric"),p(r,"class","flex flex-col w-1/2"),p(v,"for","acModifier"),p(h,"id","acModifier"),p(h,"type","number"),p(h,"class","border p-1 rounded"),p(h,"inputmode","numeric"),p(_,"class","flex flex-col w-1/2"),p(i,"class","flex gap-2"),p(A,"for","armorStat"),C.__value=void 0,C.value=C.__value,p(B,"id","armorStat"),p(B,"class","border p-1 rounded"),t[1].armorStat===void 0&&Pe(()=>t[30].call(B)),p(N,"for","maxDex"),k.__value=void 0,k.value=k.__value,D.__value=2,D.value=D.__value,U.__value=0,U.value=U.__value,p(S,"id","maxDex"),p(S,"class","border p-1 rounded"),t[1].maxDex===void 0&&Pe(()=>t[31].call(S))},m(q,K){w(q,e,K),w(q,n,K),le(l,q,K),w(q,o,K),w(q,i,K),f(i,r),f(r,u),f(r,c),f(r,a),oe(a,t[1].baseAC),f(i,d),f(i,_),f(_,v),f(_,g),f(_,h),oe(h,t[1].acModifier),w(q,b,K),w(q,A,K),w(q,E,K),w(q,B,K),f(B,C),f(C,O);for(let we=0;we<j.length;we+=1)j[we]&&j[we].m(B,null);_e(B,t[1].armorStat,!0),w(q,M,K),w(q,N,K),w(q,R,K),w(q,S,K),f(S,k),f(k,$),f(S,D),f(S,U),_e(S,t[1].maxDex,!0),F=!0,Q||(ve=[I(a,"input",t[28]),I(h,"input",t[29]),I(B,"change",t[30]),I(S,"change",t[31])],Q=!0)},p(q,K){const we={};if(!s&&K[0]&2&&(s=!0,we.values=q[1].armorProperties,Ke(()=>s=!1)),l.$set(we),K[0]&2&&Me(a.value)!==q[1].baseAC&&oe(a,q[1].baseAC),K[0]&2&&Me(h.value)!==q[1].acModifier&&oe(h,q[1].acModifier),K&0){ae=qt;let Y;for(Y=0;Y<ae.length;Y+=1){const pe=Bo(q,ae,Y);j[Y]?j[Y].p(pe,K):(j[Y]=Mo(pe),j[Y].c(),j[Y].m(B,null))}for(;Y<j.length;Y+=1)j[Y].d(1);j.length=ae.length}K[0]&2&&_e(B,q[1].armorStat),K[0]&2&&_e(S,q[1].maxDex)},i(q){F||(P(l.$$.fragment,q),F=!0)},o(q){W(l.$$.fragment,q),F=!1},d(q){q&&T(e),q&&T(n),se(l,q),q&&T(o),q&&T(i),q&&T(b),q&&T(A),q&&T(E),q&&T(B),Be(j,q),q&&T(M),q&&T(N),q&&T(R),q&&T(S),Q=!1,Ue(ve)}}}function Wd(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g=t[1].weaponProperties.includes("Magical"),h,b,A,E,B,C,O,M,N,R,S,k,$,D,U,F,Q,ve,re,de,ae,j,q,K,we,Y,pe,be,X,H,J,he,me;function ue(L){t[18](L)}let ce={id:"weaponProperties",options:Nr,labels:t[4]};t[1].weaponProperties!==void 0&&(ce.values=t[1].weaponProperties),d=new ir({props:ce}),Ve.push(()=>Ye(d,"values",ue));let z=g&&Ro(t),te=Os,Ae=[];for(let L=0;L<te.length;L+=1)Ae[L]=$o(Oo(t,te,L));let Ie=Gt,x=[];for(let L=0;L<Ie.length;L+=1)x[L]=Do(Co(t,Ie,L));let fe=Gt,Se=[];for(let L=0;L<fe.length;L+=1)Se[L]=No(ko(t,fe,L));return{c(){e=m("label"),e.textContent="武器類型",n=y(),l=m("select"),s=m("option"),s.textContent="簡易近戰",o=m("option"),o.textContent="簡易遠程",i=m("option"),i.textContent="軍用近戰",r=m("option"),r.textContent="軍用遠程",u=y(),c=m("label"),c.textContent="武器特性",a=y(),ne(d.$$.fragment),v=y(),z&&z.c(),h=y(),b=m("label"),b.textContent="距離",A=y(),E=m("select");for(let L=0;L<Ae.length;L+=1)Ae[L].c();B=y(),C=m("label"),C.innerHTML='傷害<span class="text-red-700">*</span>',O=y(),M=m("div"),N=m("input"),R=y(),S=m("div"),k=m("div"),k.textContent="單手:",$=y(),D=m("input"),F=y(),Q=m("select");for(let L=0;L<x.length;L+=1)x[L].c();re=y(),de=m("div"),ae=m("input"),j=y(),q=m("div"),K=m("div"),K.textContent="雙手:",we=y(),Y=m("input"),be=y(),X=m("select");for(let L=0;L<Se.length;L+=1)Se[L].c();p(e,"for","weaponType"),p(e,"class","font-bold"),s.__value="Simple Melee",s.value=s.__value,o.__value="Simple Ranged",o.value=o.__value,i.__value="Martial Melee",i.value=i.__value,r.__value="Martial Ranged",r.value=r.__value,p(l,"name","weaponType"),p(l,"id","weaponType"),p(l,"class","border p-1 rounded"),t[1].weaponType===void 0&&Pe(()=>t[17].call(l)),p(c,"for","weaponProperties"),p(c,"class","font-bold"),p(b,"for","range"),p(b,"class","font-bold"),p(E,"id","range"),p(E,"class","border p-1 rounded"),t[1].weaponRange===void 0&&Pe(()=>t[20].call(E)),p(C,"for","damage"),p(C,"class","font-bold"),p(N,"type","checkbox"),p(N,"class","svelte-qhgyyp"),p(k,"class","whitespace-nowrap font-bold text-xs"),D.disabled=U=!t[1].hasOneHandedAttack,p(D,"type","number"),p(D,"inputmode","numeric"),p(D,"class","w-10 text-center border-b"),Q.disabled=ve=!t[1].hasOneHandedAttack,p(Q,"class","border-none bg-transparent"),t[1].oneHandedDiceType===void 0&&Pe(()=>t[23].call(Q)),p(S,"class","flex gap-1 items-center border p-1 rounded bg-white"),$e(S,"opacity-50",!t[1].hasOneHandedAttack),p(M,"class","flex gap-1 items-center"),p(ae,"type","checkbox"),p(ae,"class","svelte-qhgyyp"),p(K,"class","whitespace-nowrap font-bold text-xs"),Y.disabled=pe=!t[1].hasTwoHandedAttack,p(Y,"type","number"),p(Y,"inputmode","numeric"),p(Y,"class","w-10 text-center border-b"),X.disabled=H=!t[1].hasTwoHandedAttack,p(X,"class","border-none bg-transparent"),t[1].twoHandedDiceType===void 0&&Pe(()=>t[26].call(X)),p(q,"class","flex gap-1 items-center border p-1 rounded bg-white"),$e(q,"opacity-50",!t[1].hasTwoHandedAttack),p(de,"class","flex gap-1 items-center")},m(L,ge){w(L,e,ge),w(L,n,ge),w(L,l,ge),f(l,s),f(l,o),f(l,i),f(l,r),_e(l,t[1].weaponType,!0),w(L,u,ge),w(L,c,ge),w(L,a,ge),le(d,L,ge),w(L,v,ge),z&&z.m(L,ge),w(L,h,ge),w(L,b,ge),w(L,A,ge),w(L,E,ge);for(let Le=0;Le<Ae.length;Le+=1)Ae[Le]&&Ae[Le].m(E,null);_e(E,t[1].weaponRange,!0),w(L,B,ge),w(L,C,ge),w(L,O,ge),w(L,M,ge),f(M,N),N.checked=t[1].hasOneHandedAttack,f(M,R),f(M,S),f(S,k),f(S,$),f(S,D),oe(D,t[1].oneHandedNumDice),f(S,F),f(S,Q);for(let Le=0;Le<x.length;Le+=1)x[Le]&&x[Le].m(Q,null);_e(Q,t[1].oneHandedDiceType,!0),w(L,re,ge),w(L,de,ge),f(de,ae),ae.checked=t[1].hasTwoHandedAttack,f(de,j),f(de,q),f(q,K),f(q,we),f(q,Y),oe(Y,t[1].twoHandedNumDice),f(q,be),f(q,X);for(let Le=0;Le<Se.length;Le+=1)Se[Le]&&Se[Le].m(X,null);_e(X,t[1].twoHandedDiceType,!0),J=!0,he||(me=[I(l,"change",t[17]),I(E,"change",t[20]),I(N,"change",t[21]),I(D,"input",t[22]),I(Q,"change",t[23]),I(ae,"change",t[24]),I(Y,"input",t[25]),I(X,"change",t[26])],he=!0)},p(L,ge){ge[0]&2&&_e(l,L[1].weaponType);const Le={};if(!_&&ge[0]&2&&(_=!0,Le.values=L[1].weaponProperties,Ke(()=>_=!1)),d.$set(Le),ge[0]&2&&(g=L[1].weaponProperties.includes("Magical")),g?z?z.p(L,ge):(z=Ro(L),z.c(),z.m(h.parentNode,h)):z&&(z.d(1),z=null),ge[0]&32){te=Os;let Te;for(Te=0;Te<te.length;Te+=1){const lt=Oo(L,te,Te);Ae[Te]?Ae[Te].p(lt,ge):(Ae[Te]=$o(lt),Ae[Te].c(),Ae[Te].m(E,null))}for(;Te<Ae.length;Te+=1)Ae[Te].d(1);Ae.length=te.length}if(ge[0]&2&&_e(E,L[1].weaponRange),ge[0]&2&&(N.checked=L[1].hasOneHandedAttack),(!J||ge[0]&2&&U!==(U=!L[1].hasOneHandedAttack))&&(D.disabled=U),ge[0]&2&&Me(D.value)!==L[1].oneHandedNumDice&&oe(D,L[1].oneHandedNumDice),ge&0){Ie=Gt;let Te;for(Te=0;Te<Ie.length;Te+=1){const lt=Co(L,Ie,Te);x[Te]?x[Te].p(lt,ge):(x[Te]=Do(lt),x[Te].c(),x[Te].m(Q,null))}for(;Te<x.length;Te+=1)x[Te].d(1);x.length=Ie.length}if((!J||ge[0]&2&&ve!==(ve=!L[1].hasOneHandedAttack))&&(Q.disabled=ve),ge[0]&2&&_e(Q,L[1].oneHandedDiceType),(!J||ge[0]&2)&&$e(S,"opacity-50",!L[1].hasOneHandedAttack),ge[0]&2&&(ae.checked=L[1].hasTwoHandedAttack),(!J||ge[0]&2&&pe!==(pe=!L[1].hasTwoHandedAttack))&&(Y.disabled=pe),ge[0]&2&&Me(Y.value)!==L[1].twoHandedNumDice&&oe(Y,L[1].twoHandedNumDice),ge&0){fe=Gt;let Te;for(Te=0;Te<fe.length;Te+=1){const lt=ko(L,fe,Te);Se[Te]?Se[Te].p(lt,ge):(Se[Te]=No(lt),Se[Te].c(),Se[Te].m(X,null))}for(;Te<Se.length;Te+=1)Se[Te].d(1);Se.length=fe.length}(!J||ge[0]&2&&H!==(H=!L[1].hasTwoHandedAttack))&&(X.disabled=H),ge[0]&2&&_e(X,L[1].twoHandedDiceType),(!J||ge[0]&2)&&$e(q,"opacity-50",!L[1].hasTwoHandedAttack)},i(L){J||(P(d.$$.fragment,L),J=!0)},o(L){W(d.$$.fragment,L),J=!1},d(L){L&&T(e),L&&T(n),L&&T(l),L&&T(u),L&&T(c),L&&T(a),se(d,L),L&&T(v),z&&z.d(L),L&&T(h),L&&T(b),L&&T(A),L&&T(E),Be(Ae,L),L&&T(B),L&&T(C),L&&T(O),L&&T(M),Be(x,L),L&&T(re),L&&T(de),Be(Se,L),he=!1,Ue(me)}}}function qd(t){let e,n,l,s,o,i,r,u,c=t[1].canBeEquipped&&Io(t);return{c(){e=m("div"),n=m("input"),l=y(),s=m("label"),s.textContent="可裝備？",o=y(),c&&c.c(),i=vt(),p(n,"id","canBeEquipped"),p(n,"type","checkbox"),p(n,"class","svelte-qhgyyp"),p(s,"for","canBeEquipped"),p(e,"class","flex gap-1")},m(a,d){w(a,e,d),f(e,n),n.checked=t[1].canBeEquipped,f(e,l),f(e,s),w(a,o,d),c&&c.m(a,d),w(a,i,d),r||(u=I(n,"change",t[15]),r=!0)},p(a,d){d[0]&2&&(n.checked=a[1].canBeEquipped),a[1].canBeEquipped?c?c.p(a,d):(c=Io(a),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},i:V,o:V,d(a){a&&T(e),a&&T(o),c&&c.d(a),a&&T(i),r=!1,u()}}}function Mo(t){let e,n=gn(t[44])+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[44],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function Ro(t){let e,n,l,s,o,i;return{c(){e=m("div"),n=m("label"),n.textContent="魔法武器修正: +",l=y(),s=m("input"),p(n,"for","magicWeaponModifier"),p(s,"id","magicWeaponModifier"),p(s,"type","number"),p(s,"min","0"),p(s,"inputmode","numeric"),p(s,"class","w-10 text-center border p-1 rounded"),p(e,"class","flex flex-row gap-1 items-center")},m(r,u){w(r,e,u),f(e,n),f(e,l),f(e,s),oe(s,t[1].magicWeaponModifier),o||(i=I(s,"input",t[19]),o=!0)},p(r,u){u[0]&2&&Me(s.value)!==r[1].magicWeaponModifier&&oe(s,r[1].magicWeaponModifier)},d(r){r&&T(e),o=!1,i()}}}function $o(t){let e,n=(t[5][t[41]]??t[41])+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[41],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function Do(t){let e,n=t[36]+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[36],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function No(t){let e,n=t[36]+"",l;return{c(){e=m("option"),l=G(n),e.__value=t[36],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:V,d(s){s&&T(e)}}}function Io(t){let e,n,l,s,o,i;return{c(){e=m("div"),n=m("input"),l=y(),s=m("label"),s.innerHTML='裝備時顯示於 <span class="pirata text-lg">攻擊</span> 列表？',p(n,"id","attackable"),p(n,"type","checkbox"),p(n,"class","svelte-qhgyyp"),p(s,"for","attackable"),p(e,"class","flex gap-1 items-center")},m(r,u){w(r,e,u),f(e,n),n.checked=t[1].attackable,f(e,l),f(e,s),o||(i=I(n,"change",t[16]),o=!0)},p(r,u){u[0]&2&&(n.checked=r[1].attackable)},d(r){r&&T(e),o=!1,i()}}}function Fd(t){let e;return{c(){e=G("新增")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Ud(t){let e;return{c(){e=G("更新")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Vd(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h,b,A,E,B,C,O,M,N,R,S,k,$,D,U,F,Q,ve,re,de,ae,j,q,K=["gp","sp","cp"],we=[];for(let H=0;H<3;H+=1)we[H]=Hd(Pd(t,K,H));let Y=t[1].showAdvanced&&So(t);function pe(H,J){return H[0]?Ud:Fd}let be=pe(t),X=be(t);return{c(){e=m("div"),n=m("div"),l=m("label"),l.innerHTML='名稱<span class="text-red-700">*</span>',s=y(),o=m("input"),i=y(),r=m("div"),u=m("div"),c=m("label"),c.textContent="重量 (lb)",a=y(),d=m("input"),_=y(),v=m("div"),g=m("label"),g.innerHTML='數量<span class="text-red-700">*</span>',h=y(),b=m("input"),A=y(),E=m("div"),B=m("div"),C=m("label"),C.textContent="價格",O=y(),M=m("input"),N=y(),R=m("div"),S=m("select");for(let H=0;H<3;H+=1)we[H].c();k=y(),$=m("div"),D=m("input"),U=y(),F=m("label"),F.textContent="進階選項",Q=y(),Y&&Y.c(),ve=y(),re=m("button"),X.c(),p(l,"for","name"),p(l,"class","font-bold"),p(o,"id","name"),p(o,"type","text"),p(o,"class","border p-1 rounded"),p(n,"class","flex flex-col gap-1"),p(c,"for","weight"),p(c,"class","font-bold"),p(d,"id","weight"),p(d,"type","number"),p(d,"class","border p-1 rounded"),p(d,"inputmode","numeric"),p(d,"min","0"),p(d,"step","0.1"),p(u,"class","flex flex-col gap-1 w-1/2"),p(g,"for","quantity"),p(g,"class","font-bold"),p(b,"id","quantity"),p(b,"type","number"),p(b,"class","border p-1 rounded"),p(b,"inputmode","numeric"),p(b,"min","1"),p(v,"class","flex flex-col gap-1 w-1/2"),p(r,"class","flex gap-2"),p(C,"for","cost"),p(C,"class","font-bold"),p(M,"id","cost"),p(M,"type","number"),p(M,"class","border p-1 rounded"),p(M,"inputmode","numeric"),p(M,"min","0"),p(B,"class","flex flex-col gap-1 flex-grow"),p(S,"id","currency"),p(S,"class","border p-1 rounded h-[34px]"),t[1].currency===void 0&&Pe(()=>t[12].call(S)),p(R,"class","flex flex-col gap-1 w-16"),p(E,"class","flex gap-2 items-end"),p(D,"id","showAdvanced"),p(D,"type","checkbox"),p(D,"class","svelte-qhgyyp"),p(F,"for","showAdvanced"),p(F,"class","font-bold cursor-pointer"),p($,"class","flex gap-2 items-center mt-2 border-t pt-2"),p(re,"class","mt-4 px-3 hover:bg-gray-700 bg-black text-white p-2 rounded shadow font-bold"),re.disabled=de=!t[2],$e(re,"opacity-50",!t[2]),p(e,"class","flex flex-col gap-2 p-2 max-h-[80vh] overflow-y-auto")},m(H,J){w(H,e,J),f(e,n),f(n,l),f(n,s),f(n,o),oe(o,t[1].name),f(e,i),f(e,r),f(r,u),f(u,c),f(u,a),f(u,d),oe(d,t[1].weight),f(r,_),f(r,v),f(v,g),f(v,h),f(v,b),oe(b,t[1].quantity),f(e,A),f(e,E),f(E,B),f(B,C),f(B,O),f(B,M),oe(M,t[1].cost),f(E,N),f(E,R),f(R,S);for(let he=0;he<3;he+=1)we[he]&&we[he].m(S,null);_e(S,t[1].currency,!0),f(e,k),f(e,$),f($,D),D.checked=t[1].showAdvanced,f($,U),f($,F),f(e,Q),Y&&Y.m(e,null),f(e,ve),f(e,re),X.m(re,null),ae=!0,j||(q=[I(o,"input",t[8]),I(d,"input",t[9]),I(b,"input",t[10]),I(M,"input",t[11]),I(S,"change",t[12]),I(D,"change",t[13]),I(re,"click",t[3])],j=!0)},p(H,J){J[0]&2&&o.value!==H[1].name&&oe(o,H[1].name),J[0]&2&&Me(d.value)!==H[1].weight&&oe(d,H[1].weight),J[0]&2&&Me(b.value)!==H[1].quantity&&oe(b,H[1].quantity),J[0]&2&&Me(M.value)!==H[1].cost&&oe(M,H[1].cost),J[0]&2&&_e(S,H[1].currency),J[0]&2&&(D.checked=H[1].showAdvanced),H[1].showAdvanced?Y?(Y.p(H,J),J[0]&2&&P(Y,1)):(Y=So(H),Y.c(),P(Y,1),Y.m(e,ve)):Y&&(qe(),W(Y,1,1,()=>{Y=null}),Fe()),be!==(be=pe(H))&&(X.d(1),X=be(H),X&&(X.c(),X.m(re,null))),(!ae||J[0]&4&&de!==(de=!H[2]))&&(re.disabled=de),(!ae||J[0]&4)&&$e(re,"opacity-50",!H[2])},i(H){ae||(P(Y),ae=!0)},o(H){W(Y),ae=!1},d(H){H&&T(e),Be(we,H),Y&&Y.d(),X.d(),j=!1,Ue(q)}}}function jd(t){var n;if(!t)return 0;let e=(n=t==null?void 0:t.playerBonuses)==null?void 0:n.find(l=>l.type==="modifyAmt"&&l.bonusTo==="attackRoll");return(e==null?void 0:e.bonusAmount)??0}function zd(t){return t&&t.range||"5 ft"}function Yd(t,e,n){var we,Y,pe,be,X,H,J,he,me,ue,ce,z,te,Ae,Ie,x;let l,s,o;Re(t,De,fe=>n(33,o=fe));const i=yn();let{gear:r=void 0}=e;const u=o.gear.find(fe=>fe.name===(r==null?void 0:r.name)),c={name:(r==null?void 0:r.name)??void 0,weight:(r==null?void 0:r.weight)??0,cost:((we=r==null?void 0:r.cost)==null?void 0:we.gp)??0,currency:"gp",quantity:(u==null?void 0:u.quantity)??1,showAdvanced:(r==null?void 0:r.type)!==void 0&&(r==null?void 0:r.type)!=="Basic",gearType:(r==null?void 0:r.type)??"Basic",canBeEquipped:(r==null?void 0:r.canBeEquipped)??!1,attackable:((Y=r==null?void 0:r.properties)==null?void 0:Y.includes("Attackable"))??!1,weaponProperties:(r==null?void 0:r.properties)??[],magicWeaponModifier:jd(r),weaponType:(r==null?void 0:r.weaponType)??"Simple Melee",weaponRange:zd(r),hasOneHandedAttack:r?!!((pe=r==null?void 0:r.damage)!=null&&pe.oneHanded):!0,oneHandedNumDice:((X=(be=r==null?void 0:r.damage)==null?void 0:be.oneHanded)==null?void 0:X.numDice)??1,oneHandedDiceType:((J=(H=r==null?void 0:r.damage)==null?void 0:H.oneHanded)==null?void 0:J.diceType)??"d6",hasTwoHandedAttack:!!((he=r==null?void 0:r.damage)!=null&&he.twoHanded),twoHandedNumDice:((ue=(me=r==null?void 0:r.damage)==null?void 0:me.twoHanded)==null?void 0:ue.numDice)??1,twoHandedDiceType:((z=(ce=r==null?void 0:r.damage)==null?void 0:ce.twoHanded)==null?void 0:z.diceType)??"d8",baseAC:((te=r==null?void 0:r.ac)==null?void 0:te.base)??10,armorProperties:(r==null?void 0:r.properties)??[],acModifier:((Ae=r==null?void 0:r.ac)==null?void 0:Ae.modifier)??0,armorStat:(Ie=r==null?void 0:r.ac)==null?void 0:Ie.stat,maxDex:(x=r==null?void 0:r.ac)==null?void 0:x.maxDex};let a=JSON.parse(JSON.stringify(c));function d(){var Se;let fe={name:a.name,type:a.gearType,canBeEquipped:a.canBeEquipped,desc:a.name,weight:a.weight,editable:!0,playerBonuses:[],cost:{gp:0,sp:0,cp:0,ep:0,pp:0,[a.currency]:a.cost}};switch(a.gearType){case"Basic":{a.canBeEquipped&&a.attackable&&(fe.properties=["Attackable"]);break}case"Weapon":{let L=fe;L.properties=a.weaponProperties,L.weaponType=a.weaponType,L.range=a.weaponRange,L.canBeEquipped=!0,L.damage={},a.hasOneHandedAttack&&(L.damage.oneHanded={numDice:a.oneHandedNumDice,diceType:a.oneHandedDiceType}),a.hasTwoHandedAttack&&(L.damage.twoHanded={numDice:a.twoHandedNumDice,diceType:a.twoHandedDiceType}),a.weaponProperties.includes("Magical")&&a.magicWeaponModifier>0&&(L.playerBonuses.push({name:L.name+`: +${a.magicWeaponModifier} to atk`,desc:`+${a.magicWeaponModifier} to attack rolls when ${L.name} is equipped`,type:"modifyAmt",bonusAmount:a.magicWeaponModifier,bonusTo:"attackRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:L.name}}),L.playerBonuses.push({name:L.name+`: +${a.magicWeaponModifier} to dmg`,desc:`+${a.magicWeaponModifier} to damage rolls when ${L.name} is equipped`,type:"modifyAmt",bonusAmount:a.magicWeaponModifier,bonusTo:"damageRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:L.name}}));break}case"Armor":{let L=fe;L.properties=a.armorProperties,L.canBeEquipped=!0,L.ac={base:a.baseAC,modifier:a.acModifier,stat:a.armorStat,maxDex:a.maxDex};break}}if(r){for(let L in r)r.hasOwnProperty(L)&&delete r[L];fe.type!=="Basic"&&(fe.properties=(Se=fe.properties)==null?void 0:Se.filter(L=>L!=="Attackable")),Object.assign(r,fe),u&&(u.name=fe.name,u.quantity=a.quantity)}else o.customGear.push(fe),o.gear.push({name:fe.name,quantity:a.quantity});De.set(o),i("finish")}const _={Ammunition:"彈藥",Finesse:"靈巧",Heavy:"重型",Light:"輕型",Loading:"裝填",Range:"射程",Reach:"長觸",Special:"特殊",Thrown:"投擲","Two-Handed":"雙手",Versatile:"靈活",Silvered:"鍍銀",Magical:"魔法"},v={"5 ft":"5 尺","10 ft":"10 尺","30 ft":"30 尺","60 ft":"60 尺","120 ft":"120 尺",Touch:"觸碰",Sight:"視線",Self:"自身"},g={Shield:"盾牌","+1":"+1","+2":"+2","+3":"+3",Magic:"魔法"};function h(){a.name=this.value,n(1,a)}function b(){a.weight=Me(this.value),n(1,a)}function A(){a.quantity=Me(this.value),n(1,a)}function E(){a.cost=Me(this.value),n(1,a)}function B(){a.currency=Ge(this),n(1,a)}function C(){a.showAdvanced=this.checked,n(1,a)}function O(){a.gearType=Ge(this),n(1,a)}function M(){a.canBeEquipped=this.checked,n(1,a)}function N(){a.attackable=this.checked,n(1,a)}function R(){a.weaponType=Ge(this),n(1,a)}function S(fe){t.$$.not_equal(a.weaponProperties,fe)&&(a.weaponProperties=fe,n(1,a))}function k(){a.magicWeaponModifier=Me(this.value),n(1,a)}function $(){a.weaponRange=Ge(this),n(1,a)}function D(){a.hasOneHandedAttack=this.checked,n(1,a)}function U(){a.oneHandedNumDice=Me(this.value),n(1,a)}function F(){a.oneHandedDiceType=Ge(this),n(1,a)}function Q(){a.hasTwoHandedAttack=this.checked,n(1,a)}function ve(){a.twoHandedNumDice=Me(this.value),n(1,a)}function re(){a.twoHandedDiceType=Ge(this),n(1,a)}function de(fe){t.$$.not_equal(a.armorProperties,fe)&&(a.armorProperties=fe,n(1,a))}function ae(){a.baseAC=Me(this.value),n(1,a)}function j(){a.acModifier=Me(this.value),n(1,a)}function q(){a.armorStat=Ge(this),n(1,a)}function K(){a.maxDex=Ge(this),n(1,a)}return t.$$set=fe=>{"gear"in fe&&n(0,r=fe.gear)},t.$$.update=()=>{var fe;if(t.$$.dirty[0]&2&&(a.showAdvanced||(n(1,a.gearType="Basic",a),n(1,a.canBeEquipped=!1,a),n(1,a.attackable=!1,a))),t.$$.dirty[0]&2&&n(7,l=a.gearType!=="Weapon"||a.hasOneHandedAttack||a.hasTwoHandedAttack),t.$$.dirty[0]&130&&n(2,s=((fe=a.name)==null?void 0:fe.length)>0&&a.quantity>0&&l),t.$$.dirty[0]&2)if(a.hasOneHandedAttack&&a.hasTwoHandedAttack)a.weaponProperties.includes("Versatile")||a.weaponProperties.push("Versatile");else{const Se=a.weaponProperties.findIndex(L=>L==="Versatile");Se>=0&&a.weaponProperties.splice(Se,1)}},[r,a,s,d,_,v,g,l,h,b,A,E,B,C,O,M,N,R,S,k,$,D,U,F,Q,ve,re,de,ae,j,q,K]}class or extends Ce{constructor(e){super(),Oe(this,e,Yd,Vd,ke,{gear:0},null,[-1,-1])}}function Lo(t){let e,n,l;function s(i){t[4](i)}let o={vw:50,$$slots:{header:[Xd],default:[Kd]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ft({props:o}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&33&&(u.$$scope={dirty:r,ctx:i}),!n&&r&2&&(n=!0,u.showModal=i[1],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){W(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function Kd(t){let e,n;return e=new or({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:V,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Xd(t){let e;return{c(){e=m("h1"),e.textContent="Custom Gear",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Jd(t){let e,n,l,s,o,i,r=t[0]&&Lo(t);return{c(){e=m("button"),e.textContent="Custom Gear",n=y(),r&&r.c(),l=vt(),p(e,"class","bg-black text-white px-2")},m(u,c){w(u,e,c),w(u,n,c),r&&r.m(u,c),w(u,l,c),s=!0,o||(i=I(e,"click",t[2]),o=!0)},p(u,[c]){u[0]?r?(r.p(u,c),c&1&&P(r,1)):(r=Lo(u),r.c(),P(r,1),r.m(l.parentNode,l)):r&&(qe(),W(r,1,1,()=>{r=null}),Fe())},i(u){s||(P(r),s=!0)},o(u){W(r),s=!1},d(u){u&&T(e),u&&T(n),r&&r.d(u),u&&T(l),o=!1,i()}}}function Zd(t,e,n){let l=!1,s=!1;const o=()=>{n(0,l=!0),n(1,s=!0)},i=()=>{n(0,l=!1)};function r(u){s=u,n(1,s)}return[l,s,o,i,r]}class Qd extends Ce{constructor(e){super(),Oe(this,e,Zd,Jd,ke,{})}}function Po(t,e,n){const l=t.slice();return l[23]=e[n],l[25]=n,l}function Ho(t){let e,n=t[23].desc+"",l;return{c(){e=m("div"),l=G(n),p(e,"class","text-gray-500 truncate max-w-[120px]")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&256&&n!==(n=s[23].desc+"")&&ee(l,n)},d(s){s&&T(e)}}}function Go(t){let e,n,l,s,o;function i(){return t[18](t[23])}function r(){return t[19](t[23])}return{c(){e=m("button"),e.innerHTML='<i class="material-icons text-sm">delete</i>',n=y(),l=m("button"),l.innerHTML='<i class="material-icons text-sm">edit</i>',p(e,"class","bg-gray-800 rounded text-white px-1 py-0.5"),p(e,"title","刪除"),p(l,"class","bg-gray-800 rounded text-white px-1 py-0.5"),p(l,"title","編輯")},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c),s||(o=[I(e,"click",i),I(l,"click",r)],s=!0)},p(u,c){t=u},d(u){u&&T(e),u&&T(n),u&&T(l),s=!1,Ue(o)}}}function Wo(t){var k;let e,n,l,s=(((k=t[23].l10n)==null?void 0:k.name)??t[23].name)+"",o,i,r,u,c=Fo(t[23])+"",a,d,_,v=(t[23].weight??0)+"",g,h,b,A,E,B,C,O,M,N=t[23].desc&&Ho(t),R=t[23].editable&&Go(t);function S(){return t[20](t[23])}return{c(){e=m("tr"),n=m("td"),l=m("div"),o=G(s),i=y(),N&&N.c(),r=y(),u=m("td"),a=G(c),d=y(),_=m("td"),g=G(v),h=G(" lb"),b=y(),A=m("td"),R&&R.c(),E=y(),B=m("button"),B.innerHTML='<i class="material-icons">add_circle</i>',C=y(),p(l,"class","font-bold"),p(n,"class","pl-2 py-2"),p(u,"class","whitespace-nowrap"),p(B,"class","text-green-700 hover:text-green-900"),p(B,"title","購買/加入"),p(A,"class","flex justify-end gap-1 pr-2 py-2 items-center"),p(e,"class","border-b hover:bg-gray-50 text-xs"),$e(e,"bg-gray-50",t[25]%2==0)},m($,D){w($,e,D),f(e,n),f(n,l),f(l,o),f(n,i),N&&N.m(n,null),f(e,r),f(e,u),f(u,a),f(e,d),f(e,_),f(_,g),f(_,h),f(e,b),f(e,A),R&&R.m(A,null),f(A,E),f(A,B),f(e,C),O||(M=I(B,"click",S),O=!0)},p($,D){var U;t=$,D&256&&s!==(s=(((U=t[23].l10n)==null?void 0:U.name)??t[23].name)+"")&&ee(o,s),t[23].desc?N?N.p(t,D):(N=Ho(t),N.c(),N.m(n,null)):N&&(N.d(1),N=null),D&256&&c!==(c=Fo(t[23])+"")&&ee(a,c),D&256&&v!==(v=(t[23].weight??0)+"")&&ee(g,v),t[23].editable?R?R.p(t,D):(R=Go(t),R.c(),R.m(A,E)):R&&(R.d(1),R=null)},d($){$&&T(e),N&&N.d(),R&&R.d(),O=!1,M()}}}function qo(t){let e,n,l;function s(i){t[22](i)}let o={$$slots:{header:[ep],default:[xd]},$$scope:{ctx:t}};return t[7]!==void 0&&(o.showModal=t[7]),e=new ft({props:o}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&67109056&&(u.$$scope={dirty:r,ctx:i}),!n&&r&128&&(n=!0,u.showModal=i[7],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){W(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function xd(t){let e,n;return e=new or({props:{gear:t[6]}}),e.$on("finish",t[21]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&64&&(o.gear=l[6]),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function ep(t){let e;return{c(){e=m("h2"),e.textContent="自訂裝備",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function tp(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h,b,A,E,B,C,O,M,N,R,S,k,$,D,U,F,Q,ve,re,de,ae,j,q,K;function we(H){t[12](H)}let Y={placeholder:"搜尋 例如: 長劍",class:"w-full"};t[5]!==void 0&&(Y.value=t[5]),l=new lr({props:Y}),Ve.push(()=>Ye(l,"value",we));let pe=t[8],be=[];for(let H=0;H<pe.length;H+=1)be[H]=Wo(Po(t,pe,H));let X=t[7]&&t[6]&&qo(t);return{c(){e=m("div"),n=m("div"),ne(l.$$.fragment),o=y(),i=m("div"),r=m("div"),r.textContent="過濾:",u=y(),c=m("label"),a=m("input"),d=G(" 武器"),_=y(),v=m("label"),g=m("input"),h=G(" 防具"),b=y(),A=m("label"),E=m("input"),B=G(" 基礎"),C=y(),O=m("label"),M=m("input"),N=G(" 自訂"),R=y(),S=m("label"),k=m("input"),$=G(" 買得起"),D=y(),U=m("div"),F=m("table"),Q=m("thead"),Q.innerHTML=`<tr><th class="pl-2 py-1">名稱</th> 
          <th class="py-1">價格</th> 
          <th class="py-1">重量</th> 
          <th class="pr-2 py-1"></th></tr>`,ve=y(),re=m("tbody");for(let H=0;H<be.length;H+=1)be[H].c();de=y(),X&&X.c(),ae=vt(),p(r,"class","font-bold"),p(a,"type","checkbox"),p(c,"class","flex gap-1 items-center"),p(g,"type","checkbox"),p(v,"class","flex gap-1 items-center"),p(E,"type","checkbox"),p(A,"class","flex gap-1 items-center"),p(M,"type","checkbox"),p(O,"class","flex gap-1 items-center"),p(k,"type","checkbox"),p(S,"class","flex gap-1 items-center border-l pl-1 ml-1 border-gray-400"),p(i,"class","flex gap-1 items-center flex-wrap text-sm mt-1"),p(n,"class","p-2 border-b"),p(Q,"class","text-left sticky top-0 bg-white shadow-sm z-10"),p(F,"class","w-full text-sm"),p(U,"class","overflow-auto flex-1"),p(e,"class","border-b flex flex-col gap-1 h-full overflow-hidden")},m(H,J){w(H,e,J),f(e,n),le(l,n,null),f(n,o),f(n,i),f(i,r),f(i,u),f(i,c),f(c,a),a.checked=t[1],f(c,d),f(i,_),f(i,v),f(v,g),g.checked=t[2],f(v,h),f(i,b),f(i,A),f(A,E),E.checked=t[3],f(A,B),f(i,C),f(i,O),f(O,M),M.checked=t[4],f(O,N),f(i,R),f(i,S),f(S,k),k.checked=t[0],f(S,$),f(e,D),f(e,U),f(U,F),f(F,Q),f(F,ve),f(F,re);for(let he=0;he<be.length;he+=1)be[he]&&be[he].m(re,null);w(H,de,J),X&&X.m(H,J),w(H,ae,J),j=!0,q||(K=[I(a,"change",t[13]),I(g,"change",t[14]),I(E,"change",t[15]),I(M,"change",t[16]),I(k,"change",t[17])],q=!0)},p(H,[J]){const he={};if(!s&&J&32&&(s=!0,he.value=H[5],Ke(()=>s=!1)),l.$set(he),J&2&&(a.checked=H[1]),J&4&&(g.checked=H[2]),J&8&&(E.checked=H[3]),J&16&&(M.checked=H[4]),J&1&&(k.checked=H[0]),J&1984){pe=H[8];let me;for(me=0;me<pe.length;me+=1){const ue=Po(H,pe,me);be[me]?be[me].p(ue,J):(be[me]=Wo(ue),be[me].c(),be[me].m(re,null))}for(;me<be.length;me+=1)be[me].d(1);be.length=pe.length}H[7]&&H[6]?X?(X.p(H,J),J&192&&P(X,1)):(X=qo(H),X.c(),P(X,1),X.m(ae.parentNode,ae)):X&&(qe(),W(X,1,1,()=>{X=null}),Fe())},i(H){j||(P(l.$$.fragment,H),P(X),j=!0)},o(H){W(l.$$.fragment,H),W(X),j=!1},d(H){H&&T(e),se(l),Be(be,H),H&&T(de),X&&X.d(H),H&&T(ae),q=!1,Ue(K)}}}function Fo(t){const{gp:e,sp:n,cp:l}=t.cost;let s=[];return e&&s.push(`${e}gp`),n&&s.push(`${n}sp`),l&&s.push(`${l}cp`),s.length>0?s.join(" "):"0cp"}function np(t,e,n){let l,s;Re(t,De,k=>n(11,s=k));let o,i=!1,r=!1,u=!0,c=!0,a=!0,d=!1,_="";function v(k){const $=s.gear.find(D=>D.name===k.name);if($)$.quantity++;else{const D={name:k.name,quantity:1};s.gear.push(D)}De.set(s)}function g(k){ze(De,s.gear=s.gear.filter($=>$.name!==k.name),s),ze(De,s.bonuses=s.bonuses.filter($=>{var D,U;return!(((D=$.metadata)==null?void 0:D.type)==="weapon"&&$.metadata.weapon===k.name||((U=$.metadata)==null?void 0:U.type)==="armor"&&$.metadata.armor===k.name)}),s),ze(De,s.customGear=s.customGear.filter($=>$.name!==k.name),s)}function h(k){_=k,n(5,_)}function b(){u=this.checked,n(1,u)}function A(){c=this.checked,n(2,c)}function E(){a=this.checked,n(3,a)}function B(){d=this.checked,n(4,d)}function C(){r=this.checked,n(0,r)}const O=k=>g(k),M=k=>{n(6,o=k),n(7,i=!0)},N=k=>v(k),R=()=>{n(7,i=!1),n(6,o=void 0)};function S(k){i=k,n(7,i)}return t.$$.update=()=>{t.$$.dirty&2111&&n(8,l=Object.values(ql).concat(Object.values(Wl)).concat(Object.values(Ul)).concat(s.customGear??[]).filter(k=>d&&!s.customGear.find($=>$.name===k.name)||!u&&k.type==="Weapon"||!c&&k.type==="Armor"||!a&&k.type==="Basic"||r&&!ou(s,k)?!1:k.name.toLowerCase().includes(_.toLowerCase())))},[r,u,c,a,d,_,o,i,l,v,g,s,h,b,A,E,B,C,O,M,N,R,S]}class lp extends Ce{constructor(e){super(),Oe(this,e,np,tp,ke,{})}}function sp(t){let e,n;return e=new lp({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function ip(t){let e;return{c(){e=m("h1"),e.textContent="裝備",p(e,"slot","header"),p(e,"class","min-w-[300px]")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function op(t){let e,n,l,s,o,i,r;function u(a){t[2](a)}let c={vh:90,$$slots:{header:[ip],default:[sp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=m("button"),e.textContent="裝備",n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white px-3 rounded-md")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=I(e,"click",t[1]),i=!0)},p(a,[d]){const _={};d&8&&(_.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,_.showModal=a[0],Ke(()=>s=!1)),l.$set(_)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function ap(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function o(i){l=i,n(0,l)}return[l,s,o]}class rp extends Ce{constructor(e){super(),Oe(this,e,ap,op,ke,{})}}function Uo(t){const e=xe(t.name);return e?(e.weight||0)*t.quantity:(console.log("Cannot find gear: "+t.name),0)}function Vo(t,e,n){const l=t.slice();return l[16]=e[n],l[18]=n,l}function jo(t){let e;return{c(){e=G("(超重)")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function zo(t){let e,n=t[16].quantity+"",l;return{c(){e=G("x "),l=G(n)},m(s,o){w(s,e,o),w(s,l,o)},p(s,o){o&16&&n!==(n=s[16].quantity+"")&&ee(l,n)},d(s){s&&T(e),s&&T(l)}}}function Yo(t){var s;let e,n=((s=xe(t[16].name))==null?void 0:s.desc)+"",l;return{c(){e=m("div"),l=G(n),p(e,"class","text-xs text-gray-600 truncate max-w-[200px]")},m(o,i){w(o,e,i),f(e,l)},p(o,i){var r;i&16&&n!==(n=((r=xe(o[16].name))==null?void 0:r.desc)+"")&&ee(l,n)},d(o){o&&T(e)}}}function Ko(t){let e,n,l,s,o,i,r;function u(){return t[13](t[16])}return{c(){e=m("label"),n=m("input"),s=y(),o=m("span"),o.textContent="裝備",p(n,"title","Equipped"),p(n,"type","checkbox"),p(n,"class","w-5 h-5"),n.checked=l=t[16].equipped,p(o,"class","text-[10px]"),p(e,"class","flex flex-col items-center")},m(c,a){w(c,e,a),f(e,n),f(e,s),f(e,o),i||(r=I(n,"click",u),i=!0)},p(c,a){t=c,a&16&&l!==(l=t[16].equipped)&&(n.checked=l)},d(c){c&&T(e),i=!1,r()}}}function Xo(t){let e,n,l,s,o,i,r;function u(){return t[14](t[16])}return{c(){e=m("label"),n=m("input"),s=y(),o=m("span"),o.textContent="同調",p(n,"title","Attuned"),p(n,"type","checkbox"),p(n,"class","w-5 h-5 accent-purple-600"),n.checked=l=t[16].attuned,p(o,"class","text-[10px]"),p(e,"class","flex flex-col items-center text-purple-700")},m(c,a){w(c,e,a),f(e,n),f(e,s),f(e,o),i||(r=I(n,"click",u),i=!0)},p(c,a){t=c,a&16&&l!==(l=t[16].attuned)&&(n.checked=l)},d(c){c&&T(e),i=!1,r()}}}function Jo(t){var Q,ve,re,de,ae,j;let e,n,l,s,o,i=(((ve=(Q=xe(t[16].name))==null?void 0:Q.l10n)==null?void 0:ve.name)??t[16].name)+"",r,u,c,a,d=Uo(t[16])+"",_,v,g,h=(re=xe(t[16].name))==null?void 0:re.desc,b,A,E=(de=xe(t[16].name))==null?void 0:de.canBeEquipped,B,C=(j=(ae=xe(t[16].name))==null?void 0:ae.properties)==null?void 0:j.includes("Attunement"),O,M,N,R,S,k=t[16].quantity>1&&zo(t),$=h&&Yo(t),D=E&&Ko(t),U=C&&Xo(t);function F(){return t[15](t[16])}return{c(){e=m("li"),n=m("div"),l=m("div"),s=m("div"),o=m("span"),r=G(i),u=y(),k&&k.c(),c=y(),a=m("span"),_=G(d),v=G(" lb"),g=y(),$&&$.c(),b=y(),A=m("div"),D&&D.c(),B=y(),U&&U.c(),O=y(),M=m("button"),M.innerHTML='<i class="material-icons text-sm">delete</i>',N=y(),p(o,"class","font-bold"),p(a,"class","text-xs text-gray-500"),p(s,"class","flex justify-between items-center w-full"),p(l,"class","flex flex-col w-full"),p(M,"class","p-1 rounded bg-black text-white hover:bg-gray-700"),p(M,"title","Delete"),p(A,"class","flex gap-2 items-center flex-shrink-0"),p(n,"class","flex gap-1 items-center justify-between"),p(e,"class","border-b border-gray-300 pb-1")},m(q,K){w(q,e,K),f(e,n),f(n,l),f(l,s),f(s,o),f(o,r),f(o,u),k&&k.m(o,null),f(s,c),f(s,a),f(a,_),f(a,v),f(l,g),$&&$.m(l,null),f(n,b),f(n,A),D&&D.m(A,null),f(A,B),U&&U.m(A,null),f(A,O),f(A,M),f(e,N),R||(S=I(M,"click",F),R=!0)},p(q,K){var we,Y,pe,be,X,H;t=q,K&16&&i!==(i=(((Y=(we=xe(t[16].name))==null?void 0:we.l10n)==null?void 0:Y.name)??t[16].name)+"")&&ee(r,i),t[16].quantity>1?k?k.p(t,K):(k=zo(t),k.c(),k.m(o,null)):k&&(k.d(1),k=null),K&16&&d!==(d=Uo(t[16])+"")&&ee(_,d),K&16&&(h=(pe=xe(t[16].name))==null?void 0:pe.desc),h?$?$.p(t,K):($=Yo(t),$.c(),$.m(l,null)):$&&($.d(1),$=null),K&16&&(E=(be=xe(t[16].name))==null?void 0:be.canBeEquipped),E?D?D.p(t,K):(D=Ko(t),D.c(),D.m(A,B)):D&&(D.d(1),D=null),K&16&&(C=(H=(X=xe(t[16].name))==null?void 0:X.properties)==null?void 0:H.includes("Attunement")),C?U?U.p(t,K):(U=Xo(t),U.c(),U.m(A,O)):U&&(U.d(1),U=null)},d(q){q&&T(e),k&&k.d(),$&&$.d(),D&&D.d(),U&&U.d(),R=!1,S()}}}function up(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h,b,A,E,B,C,O,M,N,R,S,k,$,D,U,F,Q,ve,re,de,ae,j,q,K,we,Y,pe,be,X,H,J,he,me=t[3]&&jo();_=new rp({}),g=new Qd({});let ue=t[4],ce=[];for(let z=0;z<ue.length;z+=1)ce[z]=Jo(Vo(t,ue,z));return{c(){e=m("div"),n=m("div"),l=m("h2"),l.textContent="裝備",s=y(),o=m("span"),i=G(t[1]),r=G(" / "),u=G(t[0]),c=G(` lb
      `),me&&me.c(),a=y(),d=m("div"),ne(_.$$.fragment),v=y(),ne(g.$$.fragment),h=y(),b=m("div"),A=m("div"),E=m("label"),E.textContent="PP",B=y(),C=m("input"),O=y(),M=m("div"),N=m("label"),N.textContent="GP",R=y(),S=m("input"),k=y(),$=m("div"),D=m("label"),D.textContent="EP",U=y(),F=m("input"),Q=y(),ve=m("div"),re=m("label"),re.textContent="SP",de=y(),ae=m("input"),j=y(),q=m("div"),K=m("label"),K.textContent="CP",we=y(),Y=m("input"),pe=y(),be=m("div"),X=m("ul");for(let z=0;z<ce.length;z+=1)ce[z].c();$e(o,"text-red-600",t[3]),p(n,"class","flex gap-2 items-center"),p(d,"class","flex gap-1"),p(e,"class","flex gap-1 p-1 items-center justify-between"),p(E,"for","pp"),p(C,"type","number"),p(C,"id","pp"),p(C,"class","w-12 border rounded px-1"),p(A,"class","flex items-center gap-1"),p(N,"for","gp"),p(S,"type","number"),p(S,"id","gp"),p(S,"class","w-12 border rounded px-1"),p(M,"class","flex items-center gap-1"),p(D,"for","ep"),p(F,"type","number"),p(F,"id","ep"),p(F,"class","w-12 border rounded px-1"),p($,"class","flex items-center gap-1"),p(re,"for","sp"),p(ae,"type","number"),p(ae,"id","sp"),p(ae,"class","w-12 border rounded px-1"),p(ve,"class","flex items-center gap-1"),p(K,"for","cp"),p(Y,"type","number"),p(Y,"id","cp"),p(Y,"class","w-12 border rounded px-1"),p(q,"class","flex items-center gap-1"),p(b,"class","flex gap-2 p-1 border-b border-gray-300 pb-2 mb-2 flex-wrap text-sm"),p(X,"class","flex flex-col gap-1"),p(be,"class","overflow-scroll flex flex-col gap-1 p-2 h-full"),An(be,"box-shadow","inset 0 0 5px #000")},m(z,te){w(z,e,te),f(e,n),f(n,l),f(n,s),f(n,o),f(o,i),f(o,r),f(o,u),f(o,c),me&&me.m(o,null),f(e,a),f(e,d),le(_,d,null),f(d,v),le(g,d,null),w(z,h,te),w(z,b,te),f(b,A),f(A,E),f(A,B),f(A,C),oe(C,t[2].currency.pp),f(b,O),f(b,M),f(M,N),f(M,R),f(M,S),oe(S,t[2].currency.gp),f(b,k),f(b,$),f($,D),f($,U),f($,F),oe(F,t[2].currency.ep),f(b,Q),f(b,ve),f(ve,re),f(ve,de),f(ve,ae),oe(ae,t[2].currency.sp),f(b,j),f(b,q),f(q,K),f(q,we),f(q,Y),oe(Y,t[2].currency.cp),w(z,pe,te),w(z,be,te),f(be,X);for(let Ae=0;Ae<ce.length;Ae+=1)ce[Ae]&&ce[Ae].m(X,null);H=!0,J||(he=[I(C,"input",t[8]),I(S,"input",t[9]),I(F,"input",t[10]),I(ae,"input",t[11]),I(Y,"input",t[12])],J=!0)},p(z,[te]){if((!H||te&2)&&ee(i,z[1]),(!H||te&1)&&ee(u,z[0]),z[3]?me||(me=jo(),me.c(),me.m(o,null)):me&&(me.d(1),me=null),(!H||te&8)&&$e(o,"text-red-600",z[3]),te&4&&Me(C.value)!==z[2].currency.pp&&oe(C,z[2].currency.pp),te&4&&Me(S.value)!==z[2].currency.gp&&oe(S,z[2].currency.gp),te&4&&Me(F.value)!==z[2].currency.ep&&oe(F,z[2].currency.ep),te&4&&Me(ae.value)!==z[2].currency.sp&&oe(ae,z[2].currency.sp),te&4&&Me(Y.value)!==z[2].currency.cp&&oe(Y,z[2].currency.cp),te&240){ue=z[4];let Ae;for(Ae=0;Ae<ue.length;Ae+=1){const Ie=Vo(z,ue,Ae);ce[Ae]?ce[Ae].p(Ie,te):(ce[Ae]=Jo(Ie),ce[Ae].c(),ce[Ae].m(X,null))}for(;Ae<ce.length;Ae+=1)ce[Ae].d(1);ce.length=ue.length}},i(z){H||(P(_.$$.fragment,z),P(g.$$.fragment,z),H=!0)},o(z){W(_.$$.fragment,z),W(g.$$.fragment,z),H=!1},d(z){z&&T(e),me&&me.d(),se(_),se(g),z&&T(h),z&&T(b),z&&T(pe),z&&T(be),Be(ce,z),J=!1,Ue(he)}}}function cp(t,e,n){let l,s,o,i,r;Re(t,De,B=>n(2,r=B));function u(B){const C=r.gear.findIndex(M=>M.name===B),O=r.gear[C];O.quantity>1?O.quantity-=1:r.gear.splice(C,1),De.set(r)}function c(B){B.equipped=!B.equipped,De.set(r)}function a(B){B.attuned=!B.attuned,De.set(r)}function d(){r.currency.pp=Me(this.value),De.set(r)}function _(){r.currency.gp=Me(this.value),De.set(r)}function v(){r.currency.ep=Me(this.value),De.set(r)}function g(){r.currency.sp=Me(this.value),De.set(r)}function h(){r.currency.cp=Me(this.value),De.set(r)}const b=B=>c(B),A=B=>a(B),E=B=>u(B.name);return t.$$.update=()=>{t.$$.dirty&4&&n(4,l=r.gear.sort((B,C)=>Qn(B.name,C.name))),t.$$.dirty&4&&n(1,s=Qr(r)),t.$$.dirty&4&&n(0,o=Zr(r)),t.$$.dirty&3&&n(3,i=s>o)},[o,s,r,i,l,u,c,a,d,_,v,g,h,b,A,E]}class fp extends Ce{constructor(e){super(),Oe(this,e,cp,up,ke,{})}}const{Boolean:dp}=Ta;function Zo(t,e,n){const l=t.slice();return l[5]=e[n],l}function Qo(t,e,n){const l=t.slice();l[8]=e[n];const s=Ln(l[0],l[8]);l[9]=s;const o=l[9]!==0?In(l[9]):"";l[10]=o;const i={Close:"貼身",Near:"近距",Far:"遠距",Self:"自身"};return l[11]=i,l}function kl(t){const e=t.slice(),n=$a(e[0],e[8],"twoHanded");return e[14]=n,e}function Cl(t){const e=t.slice(),n=$a(e[0],e[8],"oneHanded");return e[14]=n,e}function xo(t){let e,n;return e=new Wn({props:{diceType:t[14],numDice:t[8].damage.oneHanded.numDice,modifier:Ln(t[0],t[8]),$$slots:{default:[pp]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&5&&(o.diceType=l[14]),s&4&&(o.numDice=l[8].damage.oneHanded.numDice),s&5&&(o.modifier=Ln(l[0],l[8])),s&32773&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function pp(t){let e,n,l=`${t[8].damage.oneHanded.numDice}${t[14]}${t[10]}`,s,o,i;return{c(){e=m("div"),n=m("span"),s=G(l),o=y(),i=m("i"),i.textContent="back_hand",p(i,"class","material-icons"),p(e,"class","bg-black text-white p-1 px-2 rounded-md flex flex-col items-center text-xs")},m(r,u){w(r,e,u),f(e,n),f(n,s),f(e,o),f(e,i)},p(r,u){u&5&&l!==(l=`${r[8].damage.oneHanded.numDice}${r[14]}${r[10]}`)&&ee(s,l)},d(r){r&&T(e)}}}function ea(t){let e,n;return e=new Wn({props:{diceType:t[14],numDice:t[8].damage.twoHanded.numDice,modifier:Ln(t[0],t[8]),$$slots:{default:[mp]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&5&&(o.diceType=l[14]),s&4&&(o.numDice=l[8].damage.twoHanded.numDice),s&5&&(o.modifier=Ln(l[0],l[8])),s&32773&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function mp(t){let e,n,l=`${t[8].damage.twoHanded.numDice}${t[14]}${t[10]}`,s,o,i;return{c(){e=m("div"),n=m("span"),s=G(l),o=y(),i=m("i"),i.textContent="sign_language",p(i,"class","material-icons"),p(e,"class","bg-black text-white rounded-md p-1 px-2 flex flex-col items-center")},m(r,u){w(r,e,u),f(e,n),f(n,s),f(e,o),f(e,i)},p(r,u){u&5&&l!==(l=`${r[8].damage.twoHanded.numDice}${r[14]}${r[10]}`)&&ee(s,l)},d(r){r&&T(e)}}}function ta(t){var B;let e,n,l=(((B=t[8].l10n)==null?void 0:B.name)??t[8].name)+"",s,o,i,r=(Array.isArray(t[8].range)?t[8].range.map(b).join("/"):t[11][t[8].range]??t[8].range)+"",u,c,a,d,_,v,g,h;function b(...C){return t[4](t[11],...C)}d=new Wn({props:{modifier:Ls(t[0],t[8])}});let A=t[8].damage.oneHanded&&xo(Cl(t)),E=t[8].damage.twoHanded&&ea(kl(t));return{c(){e=m("tr"),n=m("td"),s=G(l),o=y(),i=m("td"),u=G(r),c=y(),a=m("td"),ne(d.$$.fragment),_=y(),v=m("td"),A&&A.c(),g=y(),E&&E.c(),p(v,"class","flex gap-1"),p(e,"class","border-b")},m(C,O){w(C,e,O),f(e,n),f(n,s),f(e,o),f(e,i),f(i,u),f(e,c),f(e,a),le(d,a,null),f(e,_),f(e,v),A&&A.m(v,null),f(v,g),E&&E.m(v,null),h=!0},p(C,O){var N;t=C,(!h||O&4)&&l!==(l=(((N=t[8].l10n)==null?void 0:N.name)??t[8].name)+"")&&ee(s,l),(!h||O&4)&&r!==(r=(Array.isArray(t[8].range)?t[8].range.map(b).join("/"):t[11][t[8].range]??t[8].range)+"")&&ee(u,r);const M={};O&5&&(M.modifier=Ls(t[0],t[8])),d.$set(M),t[8].damage.oneHanded?A?(A.p(Cl(t),O),O&4&&P(A,1)):(A=xo(Cl(t)),A.c(),P(A,1),A.m(v,g)):A&&(qe(),W(A,1,1,()=>{A=null}),Fe()),t[8].damage.twoHanded?E?(E.p(kl(t),O),O&4&&P(E,1)):(E=ea(kl(t)),E.c(),P(E,1),E.m(v,null)):E&&(qe(),W(E,1,1,()=>{E=null}),Fe())},i(C){h||(P(d.$$.fragment,C),P(A),P(E),h=!0)},o(C){W(d.$$.fragment,C),W(A),W(E),h=!1},d(C){C&&T(e),se(d),A&&A.d(),E&&E.d()}}}function na(t){var s;let e,n=(((s=t[5].l10n)==null?void 0:s.name)??t[5].name)+"",l;return{c(){e=m("div"),l=G(n),p(e,"class","py-1")},m(o,i){w(o,e,i),f(e,l)},p(o,i){var r;i&2&&n!==(n=(((r=o[5].l10n)==null?void 0:r.name)??o[5].name)+"")&&ee(l,n)},d(o){o&&T(e)}}}function _p(t){let e,n,l,s,o,i,r,u,c=t[2],a=[];for(let g=0;g<c.length;g+=1)a[g]=ta(Qo(t,c,g));const d=g=>W(a[g],1,1,()=>{a[g]=null});let _=t[1],v=[];for(let g=0;g<_.length;g+=1)v[g]=na(Zo(t,_,g));return{c(){e=m("h2"),e.textContent="攻擊",n=y(),l=m("div"),s=m("table"),o=m("tr"),o.innerHTML=`<th>攻擊</th> 
      <th>距離</th> 
      <th>命中/DC</th> 
      <th>傷害</th>`,i=y();for(let g=0;g<a.length;g+=1)a[g].c();r=y();for(let g=0;g<v.length;g+=1)v[g].c();p(o,"class","border-b"),p(s,"class","table-auto text-left text-sm w-full"),p(l,"class","overflow-y-auto")},m(g,h){w(g,e,h),w(g,n,h),w(g,l,h),f(l,s),f(s,o),f(s,i);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(s,null);f(s,r);for(let b=0;b<v.length;b+=1)v[b]&&v[b].m(s,null);u=!0},p(g,[h]){if(h&5){c=g[2];let b;for(b=0;b<c.length;b+=1){const A=Qo(g,c,b);a[b]?(a[b].p(A,h),P(a[b],1)):(a[b]=ta(A),a[b].c(),P(a[b],1),a[b].m(s,r))}for(qe(),b=c.length;b<a.length;b+=1)d(b);Fe()}if(h&2){_=g[1];let b;for(b=0;b<_.length;b+=1){const A=Zo(g,_,b);v[b]?v[b].p(A,h):(v[b]=na(A),v[b].c(),v[b].m(s,null))}for(;b<v.length;b+=1)v[b].d(1);v.length=_.length}},i(g){if(!u){for(let h=0;h<c.length;h+=1)P(a[h]);u=!0}},o(g){a=a.filter(dp);for(let h=0;h<a.length;h+=1)W(a[h]);u=!1},d(g){g&&T(e),g&&T(n),g&&T(l),Be(a,g),Be(v,g)}}}function hp(t,e,n){let l,s,o,i;Re(t,ye,u=>n(0,i=u));const r=(u,c)=>u[c]??c;return t.$$.update=()=>{t.$$.dirty&1&&n(3,l=i.gear.filter(u=>u.equipped)),t.$$.dirty&8&&n(2,s=l.map(u=>Ca(u.name)).filter(Boolean)),t.$$.dirty&8&&n(1,o=l.map(u=>Sa(u.name)).filter(Boolean).filter(u=>{var c;return u.canBeEquipped&&((c=u.properties)==null?void 0:c.includes("Attackable"))}))},[i,o,s,l,r]}class gp extends Ce{constructor(e){super(),Oe(this,e,hp,_p,ke,{})}}function vp(t){return JSON.parse(t)}function bp(t){let e,n,l,s,o,i,r,u,c,a=Ps(t[0])+"",d,_,v,g,h,b,A,E,B,C;return{c(){e=m("h2"),e.textContent="生命值",n=y(),l=m("label"),s=y(),o=m("input"),i=y(),r=m("div"),u=m("div"),c=G("最大值: "),d=G(a),_=y(),v=m("div"),g=m("button"),g.innerHTML='<i class="material-icons text-base align-middle">remove</i>',h=y(),b=m("button"),b.innerHTML='<i class="material-icons text-base align-middle">add</i>',A=y(),E=m("button"),E.textContent="長休",p(l,"for","hitpoints"),p(o,"id","hitpoints"),p(o,"type","number"),p(o,"inputmode","numeric"),p(o,"class","pirata text-5xl text-center"),p(o,"min","0"),p(u,"class","whitespace-nowrap"),p(g,"class","hover:bg-gray-700 rounded"),p(b,"class","hover:bg-gray-700 rounded"),p(v,"class","flex items-center"),p(r,"class","flex gap-1 justify-between items-center text-sm mt-1"),p(E,"class","bg-black text-white rounded-md text-sm self-center px-2")},m(O,M){w(O,e,M),w(O,n,M),w(O,l,M),w(O,s,M),w(O,o,M),oe(o,t[0].hitPoints),w(O,i,M),w(O,r,M),f(r,u),f(u,c),f(u,d),f(r,_),f(r,v),f(v,g),f(v,h),f(v,b),w(O,A,M),w(O,E,M),B||(C=[I(o,"input",t[4]),I(g,"click",t[2]),I(b,"click",t[1]),I(E,"click",t[3])],B=!0)},p(O,[M]){M&1&&Me(o.value)!==O[0].hitPoints&&oe(o,O[0].hitPoints),M&1&&a!==(a=Ps(O[0])+"")&&ee(d,a)},i:V,o:V,d(O){O&&T(e),O&&T(n),O&&T(l),O&&T(s),O&&T(o),O&&T(i),O&&T(r),O&&T(A),O&&T(E),B=!1,Ue(C)}}}function yp(t,e,n){let l;Re(t,ye,u=>n(0,l=u));function s(){ze(ye,l.maxHitPoints+=1,l),ye.set(l)}function o(){ze(ye,l.maxHitPoints=Math.max(1,l.maxHitPoints-1),l),l.hitPoints>l.maxHitPoints&&ze(ye,l.hitPoints=l.maxHitPoints,l),ye.set(l)}function i(){ze(ye,l.hitPoints=l.maxHitPoints,l),ze(ye,l.spells=l.spells.map(u=>({...u})),l),ye.set(l)}function r(){l.hitPoints=Me(this.value),ye.set(l)}return[l,s,o,i,r]}class wp extends Ce{constructor(e){super(),Oe(this,e,yp,bp,ke,{})}}function Tp(t){let e;return{c(){e=m("div"),e.innerHTML=`<div>這是一個非官方的 Shadowdark 角色追蹤工具！
      <a target="_blank" href="https://www.thearcanelibrary.com/pages/shadowdark" class="svelte-1a204e">購買 Shadowdark</a></div> 

    <h2>匯入</h2> 
    <div>本工具可直接從 <a href="https://www.shadowdarklings.net" target="_blank" class="svelte-1a204e">Shadowdarkling Character Creator</a> 匯入您的角色。也能匯入先前匯出的 JSON 檔案。</div> 

    <h2>儲存</h2> 
    <div>本工具會自動將您的角色卡儲存於瀏覽器的 Local
      Storage。若您刪除本網站的儲存資料，請務必先匯出角色 JSON 檔。</div> 

    <h2>聯絡</h2> 
    <div>您可以透過 <a href="mailto:maxpaulus43@gmail.com" target="_blank" class="svelte-1a204e">maxpaulus43@gmail.com</a> 聯絡我（英文），我也會出沒在 Shadowdark 官方 Discord 頻道。</div> 

    <h2>問題回報</h2> 
    <div>本專案為免費且開源！歡迎提交 Pull Request 或
      <a href="https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet" target="_blank" class="svelte-1a204e">建立 Issue</a></div> 

    <h2>致謝</h2> 
    <div>看看其他很棒的 Shadowdark 工具！</div> 
    <div><a href="https://shadowdarklings.net" target="_blank" class="svelte-1a204e">https://shadowdarklings.net</a></div> 
    <div><a href="https://www.shadowdork.com" target="_blank" class="svelte-1a204e">https://www.shadowdork.com</a></div> 

    <h2>授權</h2> 
    <div>本工具為獨立產品，依據 Shadowdark RPG Third-Party License 發布，與 The
      Arcane Library, LLC 無關。 Shadowdark RPG © 2023 The Arcane Library, LLC.</div> 
    <hr/> 
    <div>免責聲明：我已獲得 The Arcane Library
      明確許可，可於本工具轉載角色創建資料（如天賦表）。</div> 

    <a href="https://www.buymeacoffee.com/tKsqTr4ABl" target="_blank" class="pirata text-xl rounded-md p-2 self-center svelte-1a204e">請我吃份口糧 🍖</a>`,p(e,"class","flex flex-col")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Ep(t){let e;return{c(){e=m("h1"),e.textContent="資訊",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Ap(t){let e,n,l,s,o,i,r;function u(a){t[2](a)}let c={$$slots:{header:[Ep],default:[Tp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=m("button"),e.innerHTML='<i class="material-icons">help</i>',n=y(),ne(l.$$.fragment)},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=I(e,"click",t[1]),i=!0)},p(a,[d]){const _={};d&8&&(_.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,_.showModal=a[0],Ke(()=>s=!1)),l.$set(_)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function Bp(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function o(i){l=i,n(0,l)}return[l,s,o]}class kp extends Ce{constructor(e){super(),Oe(this,e,Bp,Ap,ke,{})}}async function Cp(t){const e=t.name;t=JSON.parse(JSON.stringify(t)),t.schemaVersion=$r,t.schemaType=Dr;const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});if("showSaveFilePicker"in window&&(()=>{try{return window.self===window.top}catch{return!1}})())try{const r=await(await window.showSaveFilePicker({suggestedName:e,types:[{description:"json files",accept:{"application/json":[".json"]}}]})).createWritable();await r.write(n),await r.close();return}catch(i){if(i.name!=="AbortError"){console.error(i.name,i.message);return}}const s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=e,o.style.display="none",document.body.append(o),o.click(),setTimeout(()=>{URL.revokeObjectURL(s),o.remove()},1e3)}function la(t,e,n){const l=t.slice();return l[17]=e[n],l[19]=n,l}function sa(t){let e,n=t[19]+1+"",l,s,o;function i(){return t[9](t[19])}return{c(){e=m("button"),l=G(n),p(e,"class","svelte-1bwcddv"),$e(e,"green",t[3]===t[19]+1)},m(r,u){w(r,e,u),f(e,l),s||(o=I(e,"click",i),s=!0)},p(r,u){t=r,u&8&&$e(e,"green",t[3]===t[19]+1)},d(r){r&&T(e),s=!1,o()}}}function Op(t){let e,n,l,s,o,i,r,u,c;return{c(){e=m("label"),n=m("div"),l=m("div"),l.textContent="通知持續時間:",s=y(),o=m("input"),i=y(),r=m("div"),r.textContent="秒",p(o,"class","w-16 text-right"),p(o,"id","notificationDuration"),p(o,"type","number"),p(o,"inputmode","numeric"),p(o,"min","0"),p(n,"class","flex flex-row gap-1 items-center"),p(e,"for","notificationDuration")},m(a,d){w(a,e,d),f(e,n),f(n,l),f(n,s),f(n,o),oe(o,t[4].popoverDuration),f(n,i),f(n,r),u||(c=I(o,"input",t[10]),u=!0)},p(a,d){d&16&&Me(o.value)!==a[4].popoverDuration&&oe(o,a[4].popoverDuration)},d(a){a&&T(e),u=!1,c()}}}function ia(t){let e,n,l,s,o,i,r;return{c(){e=m("div"),e.textContent="進階選項（請謹慎操作）",n=y(),l=m("button"),l.textContent="清除目前欄位資料",s=y(),o=m("button"),o.textContent="清除所有暫存資料（請謹慎操作）",p(l,"class","svelte-1bwcddv"),p(o,"class","svelte-1bwcddv")},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c),w(u,s,c),w(u,o,c),i||(r=[I(l,"click",t[14]),I(o,"click",t[15])],i=!0)},p:V,d(u){u&&T(e),u&&T(n),u&&T(l),u&&T(s),u&&T(o),i=!1,Ue(r)}}}function Sp(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h,b,A,E,B,C={length:al},O=[];for(let R=0;R<C.length;R+=1)O[R]=sa(la(t,C,R));let M=je.isAvailable&&Op(t),N=!t[2]&&ia(t);return{c(){e=m("div"),n=m("div"),l=m("h2"),l.textContent="選擇存檔欄位",s=y(),o=m("div");for(let R=0;R<O.length;R+=1)O[R].c();i=y(),M&&M.c(),r=y(),u=m("label"),c=m("div"),c.textContent="匯入 JSON",a=y(),d=m("input"),v=y(),g=m("button"),g.textContent="匯出 JSON",h=y(),b=m("a"),b.textContent="回報問題",A=y(),N&&N.c(),p(o,"class","flex gap-1 w-full justify-stretch"),p(c,"class","text-center"),p(d,"id","jsonImport"),p(d,"type","file"),p(d,"class","hidden"),p(d,"accept","application/json"),d.disabled=t[2],p(u,"for","jsonImport"),p(u,"class",_=Cs(t[2]?"btn-disabled":"btn")+" svelte-1bwcddv"),p(g,"class","svelte-1bwcddv"),p(b,"class","btn svelte-1bwcddv"),p(b,"href","https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet/issues/new"),p(b,"target","_blank"),p(e,"class","flex flex-col gap-1 min-w-[200px] svelte-1bwcddv"),p(e,"id","options")},m(R,S){w(R,e,S),f(e,n),f(n,l),f(n,s),f(n,o);for(let k=0;k<O.length;k+=1)O[k]&&O[k].m(o,null);f(e,i),M&&M.m(e,null),f(e,r),f(e,u),f(u,c),f(u,a),f(u,d),f(e,v),f(e,g),f(e,h),f(e,b),f(e,A),N&&N.m(e,null),E||(B=[I(d,"change",t[11]),I(d,"click",t[12]),I(g,"click",t[13])],E=!0)},p(R,S){if(S&8){C={length:al};let k;for(k=0;k<C.length;k+=1){const $=la(R,C,k);O[k]?O[k].p($,S):(O[k]=sa($),O[k].c(),O[k].m(o,null))}for(;k<O.length;k+=1)O[k].d(1);O.length=C.length}je.isAvailable&&M.p(R,S),S&4&&(d.disabled=R[2]),S&4&&_!==(_=Cs(R[2]?"btn-disabled":"btn")+" svelte-1bwcddv")&&p(u,"class",_),R[2]?N&&(N.d(1),N=null):N?N.p(R,S):(N=ia(R),N.c(),N.m(e,null))},d(R){R&&T(e),Be(O,R),M&&M.d(),N&&N.d(),E=!1,Ue(B)}}}function Mp(t){let e;return{c(){e=m("h1"),e.textContent="選項",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Rp(t){let e,n,l,s,o,i,r;function u(a){t[16](a)}let c={$$slots:{header:[Mp],default:[Sp]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=m("button"),e.innerHTML='<i class="material-icons translate-y-[1px]">settings</i>',n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white rounded-md px-1 text-xs svelte-1bwcddv")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=I(e,"click",t[8]),i=!0)},p(a,[d]){const _={};d&1048637&&(_.$$scope={dirty:d,ctx:a}),!s&&d&2&&(s=!0,_.showModal=a[1],Ke(()=>s=!1)),l.$set(_)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function $p(t,e,n){let l,s,o,i,r,u;Re(t,_n,C=>n(6,s=C)),Re(t,Wt,C=>n(7,o=C)),Re(t,mt,C=>n(3,i=C)),Re(t,hn,C=>n(4,r=C)),Re(t,ye,C=>n(5,u=C));let{files:c}=e,a=!1;const d=()=>n(1,a=!0),_=C=>{ze(mt,i=C+1,i)};function v(){r.popoverDuration=Me(this.value),hn.set(r)}function g(){c=this.files,n(0,c)}const h=C=>{C.currentTarget.value="",n(0,c=void 0)},b=()=>{Cp(u)},A=()=>{ze(ye,u=Ot(),u)},E=()=>{ze(ye,u=Ot(),u),Nf()};function B(C){a=C,n(1,a)}return t.$$set=C=>{"files"in C&&n(0,c=C.files)},t.$$.update=()=>{t.$$.dirty&192&&n(2,l=o&&!s)},[c,a,l,i,r,u,s,o,d,_,v,g,h,b,A,E,B]}class Dp extends Ce{constructor(e){super(),Oe(this,e,$p,Rp,ke,{files:0})}}function oa(t,e,n){const l=t.slice();return l[4]=e[n],l}function aa(t){let e;return{c(){e=m("div"),e.textContent="(必須至少達到 1 等級)"},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Np(t){let e,n,l,s,o,i=Ft,r=[];for(let u=0;u<i.length;u+=1)r[u]=ra(oa(t,i,u));return{c(){e=m("select");for(let u=0;u<r.length;u+=1)r[u].c();e.disabled=l=!t[1]},m(u,c){w(u,e,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null);_e(e,t[0].class),s||(o=I(e,"change",t[2]),s=!0)},p(u,c){if(c&0){i=Ft;let a;for(a=0;a<i.length;a+=1){const d=oa(u,i,a);r[a]?r[a].p(d,c):(r[a]=ra(d),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c&1&&n!==(n=u[0].class)&&_e(e,u[0].class),c&2&&l!==(l=!u[1])&&(e.disabled=l)},d(u){u&&T(e),Be(r,u),s=!1,o()}}}function Ip(t){let e,n,l,s,o;return{c(){e=m("input"),p(e,"type","text"),e.value=n=t[0].class,e.disabled=l=!t[1]},m(i,r){w(i,e,r),s||(o=I(e,"input",t[2]),s=!0)},p(i,r){r&1&&n!==(n=i[0].class)&&e.value!==n&&(e.value=n),r&2&&l!==(l=!i[1])&&(e.disabled=l)},d(i){i&&T(e),s=!1,o()}}}function ra(t){let e,n=Sl(t[4])+"",l,s;return{c(){e=m("option"),l=G(n),s=y(),e.__value=t[4],e.value=e.__value},m(o,i){w(o,e,i),f(e,l),f(e,s)},p:V,d(o){o&&T(e)}}}function Lp(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h=!t[1]&&aa();function b(B,C){return B[0].hasCustomClass?Ip:Np}let A=b(t),E=A(t);return{c(){e=m("div"),n=m("h2"),n.textContent="職業",l=y(),h&&h.c(),s=y(),o=m("div"),i=m("input"),c=y(),a=m("label"),a.textContent="自訂",d=y(),E.c(),_=vt(),p(i,"id","customClass"),p(i,"type","checkbox"),i.disabled=r=!t[1],i.checked=u=t[0].hasCustomClass,p(a,"for","customClass"),p(o,"class","flex items-center gap-1"),p(e,"class","flex justify-between")},m(B,C){w(B,e,C),f(e,n),f(e,l),h&&h.m(e,null),f(e,s),f(e,o),f(o,i),f(o,c),f(o,a),w(B,d,C),E.m(B,C),w(B,_,C),v||(g=I(i,"input",t[3]),v=!0)},p(B,[C]){B[1]?h&&(h.d(1),h=null):h||(h=aa(),h.c(),h.m(e,s)),C&2&&r!==(r=!B[1])&&(i.disabled=r),C&1&&u!==(u=B[0].hasCustomClass)&&(i.checked=u),A===(A=b(B))&&E?E.p(B,C):(E.d(1),E=A(B),E&&(E.c(),E.m(_.parentNode,_)))},i:V,o:V,d(B){B&&T(e),h&&h.d(),B&&T(d),E.d(B),B&&T(_),v=!1,g()}}}function Pp(t,e,n){let l,s;Re(t,ye,r=>n(0,s=r));function o(r){const u=r.target.value;zr(s,u),ye.set(s)}function i(r){ze(ye,s.hasCustomClass=r.target.checked,s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=s.level>=1)},[s,l,o,i]}class Hp extends Ce{constructor(e){super(),Oe(this,e,Pp,Lp,ke,{})}}function Gp(t){let e,n,l,s,o,i,r,u,c=t[0].armorClass+"",a,d,_,v,g,h,b;return{c(){e=m("h2"),e.textContent="防禦等級",n=y(),l=m("div"),s=G(t[1]),o=y(),i=m("div"),r=m("span"),u=G("基礎 AC: "),a=G(c),d=y(),_=m("button"),_.innerHTML='<i class="material-icons">remove</i>',v=y(),g=m("button"),g.innerHTML='<i class="material-icons">add</i>',p(l,"class","flex w-full h-full justify-center items-center text-7xl pirata text-center"),p(r,"class","text-sm"),p(i,"class","flex items-center")},m(A,E){w(A,e,E),w(A,n,E),w(A,l,E),f(l,s),w(A,o,E),w(A,i,E),f(i,r),f(r,u),f(r,a),f(i,d),f(i,_),f(i,v),f(i,g),h||(b=[I(_,"click",t[3]),I(g,"click",t[2])],h=!0)},p(A,[E]){E&2&&ee(s,A[1]),E&1&&c!==(c=A[0].armorClass+"")&&ee(a,c)},i:V,o:V,d(A){A&&T(e),A&&T(n),A&&T(l),A&&T(o),A&&T(i),h=!1,Ue(b)}}}function Wp(t,e,n){let l,s;Re(t,ye,r=>n(0,s=r));function o(){ze(ye,s.armorClass+=1,s),ye.set(s)}function i(){ze(ye,s.armorClass-=1,s),ye.set(s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=Kr(s))},[s,l,o,i]}class qp extends Ce{constructor(e){super(),Oe(this,e,Wp,Gp,ke,{})}}function Fp(t){let e,n,l;return{c(){e=m("textarea"),p(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(s,o){w(s,e,o),oe(e,t[1].notes),n||(l=I(e,"input",t[3]),n=!0)},p(s,o){o&2&&oe(e,s[1].notes)},d(s){s&&T(e),n=!1,l()}}}function Up(t){let e;return{c(){e=m("h1"),e.textContent="筆記",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Vp(t){let e,n,l,s,o,i,r;function u(a){t[4](a)}let c={$$slots:{header:[Up],default:[Fp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=m("button"),e.innerHTML='<i class="material-icons translate-y-1">notes</i>',n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white px-1")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=I(e,"click",t[2]),i=!0)},p(a,[d]){const _={};d&34&&(_.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,_.showModal=a[0],Ke(()=>s=!1)),l.$set(_)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function jp(t,e,n){let l;Re(t,ye,u=>n(1,l=u));let s=!1;const o=()=>n(0,s=!0);function i(){l.notes=this.value,ye.set(l)}function r(u){s=u,n(0,s)}return[s,l,o,i,r]}class zp extends Ce{constructor(e){super(),Oe(this,e,jp,Vp,ke,{})}}function ua(t,e,n){const l=t.slice();return l[12]=e[n],l}function ca(t){let e,n,l,s,o;return{c(){e=m("button"),n=m("i"),n.textContent="group",p(n,"class","material-icons translate-y-1"),p(e,"class",l=(t[5]?"bg-black":"bg-green-600")+" text-white px-1")},m(i,r){w(i,e,r),f(e,n),s||(o=I(e,"click",t[9]),s=!0)},p(i,r){r&32&&l!==(l=(i[5]?"bg-black":"bg-green-600")+" text-white px-1")&&p(e,"class",l)},d(i){i&&T(e),s=!1,o()}}}function Yp(t){let e;return{c(){e=m("div"),e.textContent="同步中"},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Kp(t){let e,n,l;function s(){return t[10](t[12])}return{c(){e=m("button"),e.textContent="載入",p(e,"class","bg-black text-white p-1 rounded-md px-1")},m(o,i){w(o,e,i),n||(l=I(e,"click",s),n=!0)},p(o,i){t=o},d(o){o&&T(e),n=!1,l()}}}function fa(t){let e,n,l=t[12].name+"",s,o=t[12].id==t[1]?"（你）":"",i,r,u;function c(_,v){if(_[3]!==_[12].id)return Kp;if(!_[5])return Yp}let a=c(t),d=a&&a(t);return{c(){e=m("div"),n=m("div"),s=G(l),i=G(o),r=y(),d&&d.c(),u=y(),p(e,"class","flex gap-1 justify-between items-center p-1 rounded-md w-full"),$e(e,"bg-yellow-300",t[3]===t[12].id)},m(_,v){w(_,e,v),f(e,n),f(n,s),f(n,i),f(e,r),d&&d.m(e,null),f(e,u)},p(_,v){v&1&&l!==(l=_[12].name+"")&&ee(s,l),v&3&&o!==(o=_[12].id==_[1]?"（你）":"")&&ee(i,o),a===(a=c(_))&&d?d.p(_,v):(d&&d.d(1),d=a&&a(_),d&&(d.c(),d.m(e,u))),v&9&&$e(e,"bg-yellow-300",_[3]===_[12].id)},d(_){_&&T(e),d&&d.d()}}}function Xp(t){let e,n,l,s=t[0],o=[];for(let i=0;i<s.length;i+=1)o[i]=fa(ua(t,s,i));return{c(){e=m("div"),e.textContent="注意：載入其他玩家僅載入其數據。這是玩家角色卡的唯讀預覽。",n=y(),l=m("div");for(let i=0;i<o.length;i+=1)o[i].c();p(e,"class","w-72 mt-4 mb-4"),p(l,"class","flex flex-col gap-1 w-full")},m(i,r){w(i,e,r),w(i,n,r),w(i,l,r);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(l,null)},p(i,r){if(r&107){s=i[0];let u;for(u=0;u<s.length;u+=1){const c=ua(i,s,u);o[u]?o[u].p(c,r):(o[u]=fa(c),o[u].c(),o[u].m(l,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=s.length}},d(i){i&&T(e),i&&T(n),i&&T(l),Be(o,i)}}}function Jp(t){let e;return{c(){e=m("h1"),e.textContent="玩家",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Zp(t){let e,n,l,s,o=t[4]&&ca(t);function i(u){t[11](u)}let r={$$slots:{header:[Jp],default:[Xp]},$$scope:{ctx:t}};return t[2]!==void 0&&(r.showModal=t[2]),n=new ft({props:r}),Ve.push(()=>Ye(n,"showModal",i)),{c(){o&&o.c(),e=y(),ne(n.$$.fragment)},m(u,c){o&&o.m(u,c),w(u,e,c),le(n,u,c),s=!0},p(u,[c]){u[4]?o?o.p(u,c):(o=ca(u),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null);const a={};c&32811&&(a.$$scope={dirty:c,ctx:u}),!l&&c&4&&(l=!0,a.showModal=u[2],Ke(()=>l=!1)),n.$set(a)},i(u){s||(P(n.$$.fragment,u),s=!0)},o(u){W(n.$$.fragment,u),s=!1},d(u){o&&o.d(u),u&&T(e),se(n,u)}}}function Qp(t,e,n){let l,s,o,i,r,u;Re(t,Ct,h=>n(3,l=h)),Re(t,os,h=>n(7,s=h)),Re(t,Gn,h=>n(1,o=h)),Re(t,Mn,h=>n(8,i=h)),Re(t,Wt,h=>n(4,r=h)),Re(t,_n,h=>n(5,u=h));let c=!1,a;function d(h){ze(Ct,l=h.id,l)}const _=()=>n(2,c=!0),v=h=>d(h);function g(h){c=h,n(2,c)}return t.$$.update=()=>{t.$$.dirty&387&&(n(0,a=i.map(h=>({id:h.id,name:h.name}))),a.unshift({id:o,name:(s==null?void 0:s.name)??"GM"}))},[a,o,c,l,r,u,d,s,i,_,v,g]}class xp extends Ce{constructor(e){super(),Oe(this,e,Qp,Zp,ke,{})}}function da(t,e,n){const l=t.slice();return l[3]=e[n],l}function em(t){let e,n,l,s,o=$s,i=[];for(let r=0;r<o.length;r+=1)i[r]=pa(da(t,o,r));return{c(){e=m("select");for(let r=0;r<i.length;r+=1)i[r].c()},m(r,u){w(r,e,u);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);_e(e,t[0].ancestry),l||(s=I(e,"change",t[2]),l=!0)},p(r,u){if(u&0){o=$s;let c;for(c=0;c<o.length;c+=1){const a=da(r,o,c);i[c]?i[c].p(a,u):(i[c]=pa(a),i[c].c(),i[c].m(e,null))}for(;c<i.length;c+=1)i[c].d(1);i.length=o.length}u&1&&n!==(n=r[0].ancestry)&&_e(e,r[0].ancestry)},d(r){r&&T(e),Be(i,r),l=!1,s()}}}function tm(t){let e,n,l,s;return{c(){e=m("input"),p(e,"type","text"),e.value=n=t[0].ancestry},m(o,i){w(o,e,i),l||(s=I(e,"input",t[2]),l=!0)},p(o,i){i&1&&n!==(n=o[0].ancestry)&&e.value!==n&&(e.value=n)},d(o){o&&T(e),l=!1,s()}}}function pa(t){let e,n=Vr(t[3])+"",l,s;return{c(){e=m("option"),l=G(n),s=y(),e.__value=t[3],e.value=e.__value},m(o,i){w(o,e,i),f(e,l),f(e,s)},p:V,d(o){o&&T(e)}}}function nm(t){let e,n,l,s,o,i,r,u,c,a,d,_;function v(b,A){return b[0].hasCustomAncestry?tm:em}let g=v(t),h=g(t);return{c(){e=m("div"),n=m("h2"),n.textContent="種族",l=y(),s=m("div"),o=m("input"),r=y(),u=m("label"),u.textContent="自訂",c=y(),h.c(),a=vt(),p(o,"id","customAncestry"),p(o,"type","checkbox"),o.checked=i=t[0].hasCustomAncestry,p(u,"for","customAncestry"),p(s,"class","flex items-center gap-1"),p(e,"class","flex justify-between")},m(b,A){w(b,e,A),f(e,n),f(e,l),f(e,s),f(s,o),f(s,r),f(s,u),w(b,c,A),h.m(b,A),w(b,a,A),d||(_=I(o,"input",t[1]),d=!0)},p(b,[A]){A&1&&i!==(i=b[0].hasCustomAncestry)&&(o.checked=i),g===(g=v(b))&&h?h.p(b,A):(h.d(1),h=g(b),h&&(h.c(),h.m(a.parentNode,a)))},i:V,o:V,d(b){b&&T(e),b&&T(c),h.d(b),b&&T(a),d=!1,_()}}}function lm(t,e,n){let l;Re(t,ye,i=>n(0,l=i));function s(i){ze(ye,l.hasCustomAncestry=i.target.checked,l)}function o(i){const r=i.target.value;Yr(l,r),ye.set(l)}return[l,s,o]}class sm extends Ce{constructor(e){super(),Oe(this,e,lm,nm,ke,{})}}function ma(t,e,n){const l=t.slice();return l[5]=e[n],l}function _a(t){let e,n,l=t[5].msg+"",s,o,i,r=t[2].format(t[5].timestamp)+"",u;return{c(){e=m("div"),n=m("span"),s=G(l),o=y(),i=m("span"),u=G(r),p(i,"class","text-gray-400"),p(e,"class","shadow-sm rounded-md border border-gray-200 p-2 flex flex-col md:flex-row justify-between")},m(c,a){w(c,e,a),f(e,n),f(n,s),f(e,o),f(e,i),f(i,u)},p(c,a){a&2&&l!==(l=c[5].msg+"")&&ee(s,l),a&2&&r!==(r=c[2].format(c[5].timestamp)+"")&&ee(u,r)},d(c){c&&T(e)}}}function ha(t){let e,n,l;return{c(){e=m("button"),e.innerHTML=`<i class="material-icons translate-y-1">delete</i>
          清除通知`,p(e,"class","p-2 bg-white")},m(s,o){w(s,e,o),n||(l=I(e,"click",Df),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function im(t){let e,n,l,s=t[1],o=[];for(let r=0;r<s.length;r+=1)o[r]=_a(ma(t,s,r));let i=t[1].length&&ha();return{c(){e=m("div"),n=m("div");for(let r=0;r<o.length;r+=1)o[r].c();l=y(),i&&i.c(),p(n,"class","flex flex-col gap-1"),p(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(r,u){w(r,e,u),f(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);f(n,l),i&&i.m(n,null)},p(r,u){if(u&6){s=r[1];let c;for(c=0;c<s.length;c+=1){const a=ma(r,s,c);o[c]?o[c].p(a,u):(o[c]=_a(a),o[c].c(),o[c].m(n,l))}for(;c<o.length;c+=1)o[c].d(1);o.length=s.length}r[1].length?i?i.p(r,u):(i=ha(),i.c(),i.m(n,null)):i&&(i.d(1),i=null)},d(r){r&&T(e),Be(o,r),i&&i.d()}}}function om(t){let e;return{c(){e=m("h1"),e.textContent="通知",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function am(t){let e,n,l,s,o,i,r;function u(a){t[4](a)}let c={$$slots:{header:[om],default:[im]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=m("button"),e.innerHTML='<i class="material-icons translate-y-1">history</i>',n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white px-1")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=I(e,"click",t[3]),i=!0)},p(a,[d]){const _={};d&258&&(_.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,_.showModal=a[0],Ke(()=>s=!1)),l.$set(_)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){W(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function rm(t,e,n){let l;Re(t,is,u=>n(1,l=u));let s=!1;const o=new Intl.DateTimeFormat("zh-TW",{timeStyle:"medium"}),i=()=>n(0,s=!0);function r(u){s=u,n(0,s)}return[s,l,o,i,r]}class um extends Ce{constructor(e){super(),Oe(this,e,rm,am,ke,{})}}function ga(t,e,n){const l=t.slice();return l[24]=e[n],l}function va(t){let e;return{c(){e=m("div"),e.innerHTML='<i class="material-icons">save</i>...',p(e,"title","save in progress..."),p(e,"class","absolute top-0 left-0 opacity-20 bg-black text-white p-1 rounded-md flex items-center")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function ba(t){let e,n,l,s,o,i,r,u,c;return{c(){e=m("button"),n=m("i"),n.textContent="undo",s=y(),o=m("button"),i=m("i"),i.textContent="redo",p(n,"class","material-icons translate-y-1 px-1"),e.disabled=l=!t[7],p(e,"class","bg-black text-white rounded-md"),$e(e,"opacity-50",!t[7]),p(i,"class","material-icons translate-y-1 px-1"),o.disabled=r=!t[8],p(o,"class","bg-black text-white rounded-md"),$e(o,"opacity-50",!t[8])},m(a,d){w(a,e,d),f(e,n),w(a,s,d),w(a,o,d),f(o,i),u||(c=[I(e,"click",t[12]),I(o,"click",t[13])],u=!0)},p(a,d){d&128&&l!==(l=!a[7])&&(e.disabled=l),d&128&&$e(e,"opacity-50",!a[7]),d&256&&r!==(r=!a[8])&&(o.disabled=r),d&256&&$e(o,"opacity-50",!a[8])},d(a){a&&T(e),a&&T(s),a&&T(o),u=!1,Ue(c)}}}function cm(t){let e,n;return e=new um({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function fm(t){let e;return{c(){e=G("最高等級")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function dm(t){let e,n,l,s,o,i;return{c(){e=m("input"),n=G(`
              /
              `),l=m("div"),s=G(t[1]),p(e,"id","xp"),p(e,"type","number"),p(e,"inputmode","numeric"),p(e,"min","0"),p(e,"class","svelte-z687v8")},m(r,u){w(r,e,u),oe(e,t[2].xp),w(r,n,u),w(r,l,u),f(l,s),o||(i=I(e,"input",t[17]),o=!0)},p(r,u){u&4&&Me(e.value)!==r[2].xp&&oe(e,r[2].xp),u&2&&ee(s,r[1])},d(r){r&&T(e),r&&T(n),r&&T(l),o=!1,i()}}}function ya(t){let e,n=Ma(t[24])+"",l,s;return{c(){e=m("option"),l=G(n),s=y(),e.__value=t[24],e.value=e.__value},m(o,i){w(o,e,i),f(e,l),f(e,s)},p:V,d(o){o&&T(e)}}}function pm(t){let e,n,l,s,o,i,r,u,c,a,d,_,v,g,h,b,A,E,B,C,O,M,N,R,S,k,$,D,U,F,Q,ve,re,de,ae,j,q,K,we,Y,pe,be,X,H,J,he,me,ue,ce,z,te,Ae,Ie,x,fe,Se,L,ge,Le,Te,lt,st,zt,Dt,Tt,Yt,wn,Je,Ze,bt,yt,Rt,Xe,tt,ie,He,Ee,Nt,qn,as,Et,pl,rs,ml,us,At,cs,Tn,fs,_l,ds,en,hl,ps,$t,ms,tn,gl,_s,It,hs,nn,vl,gs,Kt,vs,ln,Fn,sn,bs,Un,on,Lt,bl,ys;d=new kp({});let pt=t[5]&&va(),dt=!t[6]&&ba(t);function ar(Z){t[14](Z)}let ws={};t[0]!==void 0&&(ws.files=t[0]),b=new Dp({props:ws}),Ve.push(()=>Ye(b,"files",ar)),B=new zp({});let Pt=je.isAvailable&&cm();M=new xp({}),S=new pn({props:{forStat:"STR"}}),D=new pn({props:{forStat:"INT"}}),Q=new pn({props:{forStat:"DEX"}}),de=new pn({props:{forStat:"WIS"}}),q=new pn({props:{forStat:"CON"}}),Y=new pn({props:{forStat:"CHA"}}),X=new wp({}),he=new qp({}),ce=new gp({}),Le=new sm({}),st=new Hp({});function Ts(Z,Qe){return Z[2].level<10?dm:fm}let Vn=Ts(t),Bt=Vn(t),an=Ss,ot=[];for(let Z=0;Z<an.length;Z+=1)ot[Z]=ya(ga(t,an,Z));return sn=new $d({}),on=new fp({}),{c(){e=m("div"),n=m("main"),l=m("div"),s=m("div"),o=m("div"),i=m("div"),r=m("div"),u=m("div"),c=m("h1"),c.textContent="Shadowdark",a=y(),ne(d.$$.fragment),_=y(),pt&&pt.c(),v=y(),g=m("div"),dt&&dt.c(),h=y(),ne(b.$$.fragment),E=y(),ne(B.$$.fragment),C=y(),Pt&&Pt.c(),O=y(),ne(M.$$.fragment),N=y(),R=m("div"),ne(S.$$.fragment),k=y(),$=m("div"),ne(D.$$.fragment),U=y(),F=m("div"),ne(Q.$$.fragment),ve=y(),re=m("div"),ne(de.$$.fragment),ae=y(),j=m("div"),ne(q.$$.fragment),K=y(),we=m("div"),ne(Y.$$.fragment),pe=y(),be=m("div"),ne(X.$$.fragment),H=y(),J=m("div"),ne(he.$$.fragment),me=y(),ue=m("div"),ne(ce.$$.fragment),z=y(),te=m("div"),Ae=m("div"),Ie=m("label"),x=m("h2"),x.textContent="姓名",fe=y(),Se=m("input"),L=y(),ge=m("div"),ne(Le.$$.fragment),Te=y(),lt=m("div"),ne(st.$$.fragment),zt=y(),Dt=m("div"),Tt=m("label"),Yt=m("h2"),Yt.textContent="等級",wn=y(),Je=m("input"),Ze=y(),bt=m("div"),yt=m("h2"),yt.textContent="經驗值",Rt=y(),Xe=m("label"),tt=y(),ie=m("div"),Bt.c(),He=y(),Ee=m("button"),Nt=G("🆙"),as=y(),Et=m("div"),pl=m("h2"),pl.textContent="稱號",rs=y(),ml=m("h2"),ml.textContent="稱號",us=y(),At=m("input"),cs=y(),Tn=m("div"),fs=G("預設: "),_l=G(t[4]),ds=y(),en=m("div"),hl=m("h2"),hl.textContent="陣營",ps=y(),$t=m("select");for(let Z=0;Z<ot.length;Z+=1)ot[Z].c();ms=y(),tn=m("div"),gl=m("h2"),gl.textContent="背景",_s=y(),It=m("input"),hs=y(),nn=m("div"),vl=m("h2"),vl.textContent="神祇",gs=y(),Kt=m("input"),vs=y(),ln=m("div"),Fn=m("div"),ne(sn.$$.fragment),bs=y(),Un=m("div"),ne(on.$$.fragment),p(c,"class",""),p(u,"class","flex items-center gap-1"),p(g,"class","-translate-y-2 flex gap-1"),p(r,"class","flex flex-col items-center"),p(i,"class","flex gap-1 justify-around"),p(o,"class","col-span-full cell svelte-z687v8"),p(R,"class","cell svelte-z687v8"),p($,"class","cell svelte-z687v8"),p(F,"class","cell svelte-z687v8"),p(re,"class","cell svelte-z687v8"),p(j,"class","cell svelte-z687v8"),p(we,"class","cell svelte-z687v8"),p(be,"class","row-span-2 cell svelte-z687v8"),p(J,"class","row-span-2 cell svelte-z687v8"),p(ue,"class","col-span-full row-span-2 cell svelte-z687v8"),p(s,"class","flex-[2] min-w-[257px] h-[700px] grid grid-rows-8 grid-cols-2 gap-2"),p(Se,"type","text"),p(Se,"class","svelte-z687v8"),p(Ae,"class","col-span-full cell svelte-z687v8"),p(ge,"class","col-span-full cell svelte-z687v8"),p(lt,"class","col-span-full cell svelte-z687v8"),p(Je,"type","number"),p(Je,"inputmode","numeric"),p(Je,"max","10"),p(Je,"min","1"),p(Je,"class","svelte-z687v8"),p(Dt,"class","cell svelte-z687v8"),p(Xe,"for","xp"),p(Ee,"class","text-2xl"),Ee.disabled=qn=!t[3],$e(Ee,"opacity-20",!t[3]),p(ie,"class","sheet-stat flex gap-1"),p(bt,"class","cell svelte-z687v8"),p(At,"type","text"),p(At,"placeholder",t[4]),p(At,"class","svelte-z687v8"),p(Tn,"class","text-xs text-gray-500 mt-1"),p(Et,"class","col-span-full cell svelte-z687v8"),p($t,"class","svelte-z687v8"),t[2].alignment===void 0&&Pe(()=>t[20].call($t)),p(en,"class","col-span-full cell svelte-z687v8"),p(It,"type","text"),p(It,"class","svelte-z687v8"),p(tn,"class","col-span-full cell svelte-z687v8"),p(Kt,"class","svelte-z687v8"),p(nn,"class","col-span-full cell svelte-z687v8"),p(te,"class","flex-[2] min-w-[257px] h-[700px] grid grid-rows-8 grid-cols-2 gap-2"),p(Fn,"class","cell svelte-z687v8"),p(Un,"class","cell svelte-z687v8"),p(ln,"class","flex-[3] min-w-[257px] min-[805px]:h-[700px] grid grid-rows-2 gap-2"),p(l,"id","sheet"),p(l,"class","bg-black min-w-[277px] max-w-[1000px] p-2 flex flex-wrap gap-2"),p(e,"class","flex items-center justify-center bg-black")},m(Z,Qe){w(Z,e,Qe),f(e,n),f(n,l),f(l,s),f(s,o),f(o,i),f(i,r),f(r,u),f(u,c),f(u,a),le(d,u,null),f(r,_),pt&&pt.m(r,null),f(r,v),f(r,g),dt&&dt.m(g,null),f(g,h),le(b,g,null),f(g,E),le(B,g,null),f(g,C),Pt&&Pt.m(g,null),f(g,O),le(M,g,null),f(s,N),f(s,R),le(S,R,null),f(s,k),f(s,$),le(D,$,null),f(s,U),f(s,F),le(Q,F,null),f(s,ve),f(s,re),le(de,re,null),f(s,ae),f(s,j),le(q,j,null),f(s,K),f(s,we),le(Y,we,null),f(s,pe),f(s,be),le(X,be,null),f(s,H),f(s,J),le(he,J,null),f(s,me),f(s,ue),le(ce,ue,null),f(l,z),f(l,te),f(te,Ae),f(Ae,Ie),f(Ie,x),f(Ie,fe),f(Ie,Se),oe(Se,t[2].name),f(te,L),f(te,ge),le(Le,ge,null),f(te,Te),f(te,lt),le(st,lt,null),f(te,zt),f(te,Dt),f(Dt,Tt),f(Tt,Yt),f(Tt,wn),f(Tt,Je),oe(Je,t[2].level),f(te,Ze),f(te,bt),f(bt,yt),f(bt,Rt),f(bt,Xe),f(bt,tt),f(bt,ie),Bt.m(ie,null),f(ie,He),f(ie,Ee),f(Ee,Nt),f(te,as),f(te,Et),f(Et,pl),f(Et,rs),f(Et,ml),f(Et,us),f(Et,At),oe(At,t[2].title),f(Et,cs),f(Et,Tn),f(Tn,fs),f(Tn,_l),f(te,ds),f(te,en),f(en,hl),f(en,ps),f(en,$t);for(let Xt=0;Xt<ot.length;Xt+=1)ot[Xt]&&ot[Xt].m($t,null);_e($t,t[2].alignment,!0),f(te,ms),f(te,tn),f(tn,gl),f(tn,_s),f(tn,It),oe(It,t[2].background),f(te,hs),f(te,nn),f(nn,vl),f(nn,gs),f(nn,Kt),oe(Kt,t[2].deity),f(l,vs),f(l,ln),f(ln,Fn),le(sn,Fn,null),f(ln,bs),f(ln,Un),le(on,Un,null),Lt=!0,bl||(ys=[I(Se,"input",t[15]),I(Je,"input",t[16]),I(Ee,"click",t[18]),I(At,"input",t[19]),I($t,"change",t[20]),I(It,"input",t[21]),I(Kt,"input",t[22])],bl=!0)},p(Z,[Qe]){Z[5]?pt||(pt=va(),pt.c(),pt.m(r,v)):pt&&(pt.d(1),pt=null),Z[6]?dt&&(dt.d(1),dt=null):dt?dt.p(Z,Qe):(dt=ba(Z),dt.c(),dt.m(g,h));const Xt={};if(!A&&Qe&1&&(A=!0,Xt.files=Z[0],Ke(()=>A=!1)),b.$set(Xt),Qe&4&&Se.value!==Z[2].name&&oe(Se,Z[2].name),Qe&4&&Me(Je.value)!==Z[2].level&&oe(Je,Z[2].level),Vn===(Vn=Ts(Z))&&Bt?Bt.p(Z,Qe):(Bt.d(1),Bt=Vn(Z),Bt&&(Bt.c(),Bt.m(ie,He))),(!Lt||Qe&8&&qn!==(qn=!Z[3]))&&(Ee.disabled=qn),(!Lt||Qe&8)&&$e(Ee,"opacity-20",!Z[3]),(!Lt||Qe&16)&&p(At,"placeholder",Z[4]),Qe&4&&At.value!==Z[2].title&&oe(At,Z[2].title),(!Lt||Qe&16)&&ee(_l,Z[4]),Qe&0){an=Ss;let gt;for(gt=0;gt<an.length;gt+=1){const Es=ga(Z,an,gt);ot[gt]?ot[gt].p(Es,Qe):(ot[gt]=ya(Es),ot[gt].c(),ot[gt].m($t,null))}for(;gt<ot.length;gt+=1)ot[gt].d(1);ot.length=an.length}Qe&4&&_e($t,Z[2].alignment),Qe&4&&It.value!==Z[2].background&&oe(It,Z[2].background),Qe&4&&Kt.value!==Z[2].deity&&oe(Kt,Z[2].deity)},i(Z){Lt||(P(d.$$.fragment,Z),P(b.$$.fragment,Z),P(B.$$.fragment,Z),P(Pt),P(M.$$.fragment,Z),P(S.$$.fragment,Z),P(D.$$.fragment,Z),P(Q.$$.fragment,Z),P(de.$$.fragment,Z),P(q.$$.fragment,Z),P(Y.$$.fragment,Z),P(X.$$.fragment,Z),P(he.$$.fragment,Z),P(ce.$$.fragment,Z),P(Le.$$.fragment,Z),P(st.$$.fragment,Z),P(sn.$$.fragment,Z),P(on.$$.fragment,Z),Lt=!0)},o(Z){W(d.$$.fragment,Z),W(b.$$.fragment,Z),W(B.$$.fragment,Z),W(Pt),W(M.$$.fragment,Z),W(S.$$.fragment,Z),W(D.$$.fragment,Z),W(Q.$$.fragment,Z),W(de.$$.fragment,Z),W(q.$$.fragment,Z),W(Y.$$.fragment,Z),W(X.$$.fragment,Z),W(he.$$.fragment,Z),W(ce.$$.fragment,Z),W(Le.$$.fragment,Z),W(st.$$.fragment,Z),W(sn.$$.fragment,Z),W(on.$$.fragment,Z),Lt=!1},d(Z){Z&&T(e),se(d),pt&&pt.d(),dt&&dt.d(),se(b),se(B),Pt&&Pt.d(),se(M),se(S),se(D),se(Q),se(de),se(q),se(Y),se(X),se(he),se(ce),se(Le),se(st),Bt.d(),Be(ot,Z),se(sn),se(on),bl=!1,Ue(ys)}}}function mm(t,e,n){let l,s,o,i,r,u,c,a;Re(t,ye,k=>n(2,i=k)),Re(t,Pl,k=>n(5,r=k));const{isGM:d}=Wf;Re(t,d,k=>n(6,u=k)),Tr(()=>{qf(),je.isAvailable?er():If()});const{canUndo:_,canRedo:v}=ye;Re(t,_,k=>n(7,c=k)),Re(t,v,k=>n(8,a=k));let g;const h=()=>ye.undo(),b=()=>ye.redo();function A(k){g=k,n(0,g)}function E(){i.name=this.value,ye.set(i)}function B(){i.level=Me(this.value),ye.set(i)}function C(){i.xp=Me(this.value),ye.set(i)}const O=()=>{eu(i),ye.set(i)};function M(){i.title=this.value,ye.set(i)}function N(){i.alignment=Ge(this),ye.set(i)}function R(){i.background=this.value,ye.set(i)}function S(){i.deity=this.value,ye.set(i)}return t.$$.update=()=>{if(t.$$.dirty&1&&g)for(const k of g){k.text().then($=>{ze(ye,i=vp($),i)}),n(0,g=void 0);break}t.$$.dirty&4&&kr(i),t.$$.dirty&4&&n(4,l=Xr(i)),t.$$.dirty&4&&n(1,s=i.level===0?10:i.level*10),t.$$.dirty&6&&n(3,o=i.level<10&&i.xp>=s)},[g,s,i,o,l,r,u,c,a,d,_,v,h,b,A,E,B,C,O,M,N,R,S]}class _m extends Ce{constructor(e){super(),Oe(this,e,mm,pm,ke,{})}}new _m({target:document.getElementById("app")});
