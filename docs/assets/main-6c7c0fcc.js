import{n as V,s as lr,r as Fe,a as Be,i as sr,g as We,S as Ce,b as Oe,e as _,c as y,t as G,d as p,f as w,h as f,l as I,j as ee,k as T,m as ke,o as Re,p as ze,q as Mn,u as ir,v as or,w as Rn,x as $n,y as Dn,z as P,A as W,B as ar,C as Ve,D as Ye,E as ne,F as le,G as Ke,H as se,I as Ge,J as $e,K as rr,L as me,M as Pe,N as vt,O as qe,P as Ue,Q as oe,R as yn,T as Me,U as ur,V as En,W as ys,X as cr,Y as fr,Z as dr,_ as el,$ as ga,a0 as pr,a1 as ws,a2 as Ts,a3 as _r,a4 as mr,a5 as hr,a6 as va,a7 as Es,a8 as gr}from"./index-fd053ce9.js";const rn=[];function vr(t,e){return{subscribe:ct(t,e).subscribe}}function ct(t,e=V){let n;const l=new Set;function s(r){if(Be(t,r)&&(t=r,n)){const u=!rn.length;for(const c of l)c[1](),rn.push(c,t);if(u){for(let c=0;c<rn.length;c+=2)rn[c][0](rn[c+1]);rn.length=0}}}function i(r){s(r(t))}function o(r,u=V){const c=[r,u];return l.add(c),l.size===1&&(n=e(s)||V),r(t),()=>{l.delete(c),l.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:o}}function br(t,e,n){const l=!Array.isArray(t),s=l?[t]:t,i=e.length<2;return vr(n,o=>{let r=!1;const u=[];let c=0,a=V;const d=()=>{if(c)return;a();const v=e(l?u[0]:u,o);i?o(v):a=sr(v)?v:V},m=s.map((v,g)=>lr(v,h=>{u[g]=h,c&=~(1<<g),r&&d()},()=>{c|=1<<g}));return r=!0,d(),function(){Fe(m),a(),r=!1}})}const ba=[{name:"Padded",type:"Armor",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:11,modifier:0,maxDex:void 0,stealthDisadvantage:!0},weight:8,l10n:{name:"甲冑"}},{name:"Leather Armor",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:11,modifier:0,maxDex:void 0},weight:10,l10n:{name:"皮甲"}},{name:"Studded Leather",type:"Armor",cost:{gp:45,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:12,modifier:0,maxDex:void 0},weight:13,l10n:{name:"鑲釘皮甲"}},{name:"Hide",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:12,modifier:0,maxDex:2},weight:12,l10n:{name:"獸皮甲"}},{name:"Chain Shirt",type:"Armor",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:13,modifier:0,maxDex:2},weight:20,l10n:{name:"鍊甲衫"}},{name:"Scale Mail",type:"Armor",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:14,modifier:0,maxDex:2,stealthDisadvantage:!0},weight:45,l10n:{name:"鱗甲"}},{name:"Breastplate",type:"Armor",cost:{gp:400,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:14,modifier:0,maxDex:2},weight:20,l10n:{name:"胸甲"}},{name:"Half Plate",type:"Armor",cost:{gp:750,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:15,modifier:0,maxDex:2,stealthDisadvantage:!0},weight:40,l10n:{name:"半身板甲"}},{name:"Ring Mail",type:"Armor",cost:{gp:30,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:14,modifier:0,maxDex:0,stealthDisadvantage:!0},weight:40,l10n:{name:"環甲"}},{name:"Chain Mail",type:"Armor",cost:{gp:75,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:16,modifier:0,maxDex:0,stealthDisadvantage:!0},minStr:13,weight:55,l10n:{name:"鎖子甲"}},{name:"Splint",type:"Armor",cost:{gp:200,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:17,modifier:0,maxDex:0,stealthDisadvantage:!0},minStr:15,weight:60,l10n:{name:"條板甲"}},{name:"Plate",type:"Armor",cost:{gp:1500,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:18,modifier:0,maxDex:0,stealthDisadvantage:!0},minStr:15,weight:65,l10n:{name:"全身板甲"}},{name:"Shield",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:2,modifier:0},properties:["Shield"],weight:6,l10n:{name:"盾牌"}}],Hl={};for(const t of ba)Hl[t.name.toLowerCase()]=t;const yr=[{name:"Backpack",type:"Basic",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:5,l10n:{name:"背包"}},{name:"Bedroll",type:"Basic",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:7,l10n:{name:"睡袋"}},{name:"Crowbar",type:"Basic",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:5,l10n:{name:"撬棍"}},{name:"Hammer",type:"Basic",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:3,l10n:{name:"鐵鎚"}},{name:"Healer's Kit",type:"Basic",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:3,l10n:{name:"醫藥箱"}},{name:"Holy Water (flask)",type:"Basic",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"聖水 (瓶)"}},{name:"Lantern, bullseye",type:"Basic",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:2,l10n:{name:"靶心提燈"}},{name:"Lantern, hooded",type:"Basic",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:2,l10n:{name:"防風提燈"}},{name:"Lock",type:"Basic",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:1,l10n:{name:"鎖"}},{name:"Mess Kit",type:"Basic",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:1,l10n:{name:"餐具組"}},{name:"Oil (flask)",type:"Basic",cost:{gp:0,sp:1,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"油 (瓶)"}},{name:"Piton",type:"Basic",cost:{gp:0,sp:0,cp:5,ep:0,pp:0},canBeEquipped:!1,weight:.25,l10n:{name:"岩釘"}},{name:"Potion of Healing",type:"Basic",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:.5,l10n:{name:"治療藥水"}},{name:"Rations (1 day)",type:"Basic",cost:{gp:0,sp:5,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:2,l10n:{name:"口糧 (1天份)"}},{name:"Rope, hempen (50 feet)",type:"Basic",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:10,l10n:{name:"麻繩 (50呎)"}},{name:"Rope, silk (50 feet)",type:"Basic",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:5,l10n:{name:"絲繩 (50呎)"}},{name:"Tinderbox",type:"Basic",cost:{gp:0,sp:5,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:1,l10n:{name:"打火匣"}},{name:"Torch",type:"Basic",cost:{gp:0,sp:0,cp:1,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"火把"}},{name:"Waterskin",type:"Basic",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:5,l10n:{name:"水袋"}}],Gl={};for(const t of yr)Gl[t.name.toLowerCase()]=t;const ya=[{name:"Eldritch Blast",range:"120 feet",class:"Warlock",tier:0,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"A beam of crackling energy streaks toward a creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 force damage.",l10n:{name:"魔能爆",desc:"一道裂能量光束射向射程內的生物。對目標進行遠程法術攻擊。命中時造成 1d10 力場傷害。"}},{name:"Fire Bolt",range:"120 feet",class:"Wizard",tier:0,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"You hurl a mote of fire at a creature or object within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 fire damage.",l10n:{name:"火焰箭",desc:"你向射程內的生物或物體投擲一團火焰。對目標進行遠程法術攻擊。命中時造成 1d10 火焰傷害。"}},{name:"Light",range:"Touch",class:"Cleric",tier:0,duration:"1 hour",components:{verbal:!0,material:!0,materialDesc:"a firefly or phosphorescent moss"},desc:"You touch one object that is no larger than 10 feet in any dimension. Until the spell ends, the object sheds bright light in a 20-foot radius and dim light for an additional 20 feet.",l10n:{name:"光亮術",desc:"你觸碰一個長寬高不超過 10 呎的物體。在法術結束前，該物體發出半徑 20 呎的明亮光照，以及額外 20 呎的微光光照。"}},{name:"Mage Hand",range:"30 feet",class:"Wizard",tier:0,duration:"1 minute",components:{verbal:!0,somatic:!0},desc:"A spectral, floating hand appears at a point you choose within range. The hand lasts for the duration or until you dismiss it as an action. The hand vanishes if it is ever more than 30 feet away from you or if you cast this spell again.",l10n:{name:"法師之手",desc:"一隻幽靈般的漂浮手掌出現在射程內你選擇的點。手掌持續至持續時間結束，或直到你用一個動作解除它。若手掌距離你超過 30 呎或你再次施展此法術，它會消失。"}},{name:"Guidance",range:"Touch",class:"Cleric",tier:0,duration:"1 minute",components:{verbal:!0,somatic:!0},desc:"Concentration. You touch one willing creature. Once before the spell ends, the target can roll a d4 and add the number rolled to one ability check of its choice.",l10n:{name:"神導術",desc:"專注。你觸碰一名自願生物。在法術結束前，目標可以選擇在一次屬性檢定中擲一顆 d4 並將結果加到檢定值中。"}},{name:"Bless",range:"30 feet",class:"Cleric",tier:1,duration:"1 minute",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a sprinkling of holy water"},desc:"Concentration. You bless up to three creatures of your choice within range. Whenever a target makes an attack roll or a saving throw before the spell ends, the target can roll a d4 and add the number rolled to the attack roll or saving throw.",l10n:{name:"祝福術",desc:"專注。你祝福射程內最多三名生物。在法術結束前，每當目標進行攻擊檢定或豁免檢定時，可以擲一顆 d4 並將結果加到檢定值中。"}},{name:"Cure Wounds",range:"Touch",class:"Cleric",tier:1,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"A creature you touch regains a number of hit points equal to 1d8 + your spellcasting ability modifier.",l10n:{name:"治療傷口",desc:"你觸碰的生物回復 1d8 + 你施法屬性調整值的生命值。"}},{name:"Healing Word",range:"60 feet",class:"Cleric",tier:1,duration:"Instantaneous",components:{verbal:!0},desc:"A creature of your choice that you can see within range regains hit points equal to 1d4 + your spellcasting ability modifier.",l10n:{name:"治癒真言",desc:"射程內你可見的一名生物回復 1d4 + 你施法屬性調整值的生命值。"}},{name:"Magic Missile",range:"120 feet",class:"Wizard",tier:1,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"You create three glowing darts of magical force. Each dart hits a creature of your choice that you can see within range. A dart deals 1d4 + 1 force damage to its target. The darts all strike simultaneously, and you can direct them to hit one creature or several.",l10n:{name:"魔法飛彈",desc:"你創造三支發光的魔法力場飛鏢。每支飛鏢擊中射程內你可見的一個生物。每支飛鏢造成 1d4 + 1 力場傷害。飛鏢同時擊中，你可以指定它們攻擊同一生物或多個生物。"}},{name:"Shield",range:"Self",class:"Wizard",tier:1,duration:"1 round",components:{verbal:!0,somatic:!0},desc:"Reaction. An invisible barrier of magical force appears and protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from magic missile.",l10n:{name:"護盾術",desc:"反應。一道隱形魔法護盾出現保護你。直到你下回合開始，你的 AC 獲得 +5 加值（包含對觸發此反應的攻擊），且魔法飛彈無法對你造成傷害。"}},{name:"Invisibility",range:"Touch",class:"Wizard",tier:2,duration:"1 hour",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"an eyelash encased in gum arabic"},desc:"Concentration. A creature you touch becomes invisible until the spell ends. Anything the target is wearing or carrying is invisible as long as it is on the target's person. The spell ends for a target that attacks or casts a spell.",l10n:{name:"隱形術",desc:"專注。你觸碰的生物變為隱形，直到法術結束。目標穿戴或攜帶的物品也隨之隱形。若目標進行攻擊或施法，該目標的法術即解除。"}},{name:"Misty Step",range:"Self",class:"Wizard",tier:2,duration:"Instantaneous",components:{verbal:!0},desc:"Briefly surrounded by silvery mist, you teleport up to 30 feet to an unoccupied space that you can see.",l10n:{name:"迷蹤步",desc:"被銀色迷霧短暫環繞，你傳送最多 30 呎到你可見的未佔據空間。"}},{name:"Web",range:"60 feet",class:"Wizard",tier:2,duration:"1 hour",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a bit of spiderweb"},desc:"Concentration. You conjure a mass of thick, sticky webbing at a point of your choice within range. The webs fill a 20-foot cube and remain for the duration.",l10n:{name:"蛛網術",desc:"專注。你在射程內的一點召喚大量黏稠蛛網。蛛網填滿 20 呎立方區域，持續至法術結束。"}},{name:"Fireball",range:"150 feet",class:"Wizard",tier:3,duration:"Instantaneous",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a tiny ball of bat guano and sulfur"},desc:"A bright streak flashes from your pointing finger to a point you choose within range and then blossoms with a low roar into an explosion of flame. Each creature in a 20-foot-radius sphere centered on that point must make a Dexterity saving throw. A target takes 8d6 fire damage on a failed save, or half as much damage on a successful one.",l10n:{name:"火球術",desc:"一道亮光從你手指射出，擊中射程內你選擇的一點，隨即爆發出低沉轟鳴與烈焰。以該點為中心半徑 20 呎球形區域內的所有生物必須進行敏捷豁免。失敗者受到 8d6 火焰傷害，成功者傷害減半。"}},{name:"Fly",range:"Touch",class:"Wizard",tier:3,duration:"10 minutes",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a wing feather from any bird"},desc:"Concentration. You touch a willing creature. The target gains a flying speed of 60 feet for the duration. When the spell ends, the target falls if it is still aloft, unless it can stop the fall.",l10n:{name:"飛行術",desc:"專注。你觸碰一名自願生物。目標獲得 60 呎飛行速度，持續至法術結束。法術結束時，若目標仍在空中且無法阻止墜落，則跌落。"}},{name:"Counterspell",range:"60 feet",class:"Wizard",tier:3,duration:"Instantaneous",components:{somatic:!0},desc:"Reaction. You attempt to interrupt a creature in the process of casting a spell. If the creature is casting a spell of 3rd level or lower, its spell fails and has no effect.",l10n:{name:"法術反制",desc:"反應。你試圖打斷正在施法的生物。若該生物施展的是 3 環或更低階的法術，該法術失敗且無效。"}}],Wl={};for(const t of ya)Wl[t.name.toLowerCase()]=t;const wa=[{name:"Club",type:"Weapon",cost:{gp:0,sp:1,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light"],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"棍棒"}},{name:"Dagger",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Piercing"},weight:1,l10n:{name:"匕首"}},{name:"Greatclub",type:"Weapon",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Two-Handed"],range:"5 ft",weaponType:"Simple Melee",damage:{twoHanded:{diceType:"d8",numDice:1},damageType:"Bludgeoning"},weight:10,l10n:{name:"巨棒"}},{name:"Handaxe",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Slashing"},weight:2,l10n:{name:"手斧"}},{name:"Javelin",type:"Weapon",cost:{gp:0,sp:5,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Thrown"],range:"30/120",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"標槍"}},{name:"Light Hammer",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"輕鎚"}},{name:"Mace",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Bludgeoning"},weight:4,l10n:{name:"釘頭錘"}},{name:"Quarterstaff",type:"Weapon",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},twoHanded:{diceType:"d8",numDice:1},damageType:"Bludgeoning"},weight:4,l10n:{name:"長棍"}},{name:"Sickle",type:"Weapon",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light"],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Slashing"},weight:2,l10n:{name:"鐮刀"}},{name:"Spear",type:"Weapon",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Thrown","Versatile"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:3,l10n:{name:"矛"}},{name:"Crossbow, light",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Loading","Two-Handed"],range:"80/320",weaponType:"Simple Ranged",damage:{twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:5,l10n:{name:"輕型十字弓"}},{name:"Dart",type:"Weapon",cost:{gp:0,sp:0,cp:5,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Thrown"],range:"20/60",weaponType:"Simple Ranged",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Piercing"},weight:.25,l10n:{name:"飛鏢"}},{name:"Shortbow",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Two-Handed"],range:"80/320",weaponType:"Simple Ranged",damage:{twoHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"短弓"}},{name:"Sling",type:"Weapon",cost:{gp:0,sp:1,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition"],range:"30/120",weaponType:"Simple Ranged",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Bludgeoning"},weight:0,l10n:{name:"投石索"}},{name:"Battleaxe",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:4,l10n:{name:"戰斧"}},{name:"Flail",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"連枷"}},{name:"Glaive",type:"Weapon",cost:{gp:20,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Reach","Two-Handed"],range:"10 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:6,l10n:{name:"關刀"}},{name:"Greataxe",type:"Weapon",cost:{gp:30,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Two-Handed"],range:"5 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d12",numDice:1},damageType:"Slashing"},weight:7,l10n:{name:"巨斧"}},{name:"Greatsword",type:"Weapon",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Two-Handed"],range:"5 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d6",numDice:2},damageType:"Slashing"},weight:6,l10n:{name:"巨劍"}},{name:"Halberd",type:"Weapon",cost:{gp:20,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Reach","Two-Handed"],range:"10 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:6,l10n:{name:"長戟"}},{name:"Lance",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Reach","Special"],range:"10 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d12",numDice:1},damageType:"Piercing"},weight:6,l10n:{name:"騎槍"}},{name:"Longsword",type:"Weapon",cost:{gp:15,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:3,l10n:{name:"長劍"}},{name:"Maul",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Two-Handed"],range:"5 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d6",numDice:2},damageType:"Bludgeoning"},weight:10,l10n:{name:"巨鎚"}},{name:"Morningstar",type:"Weapon",cost:{gp:15,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:4,l10n:{name:"晨星鎚"}},{name:"Pike",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Reach","Two-Handed"],range:"10 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Piercing"},weight:18,l10n:{name:"長矛"}},{name:"Rapier",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"刺劍"}},{name:"Scimitar",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Slashing"},weight:3,l10n:{name:"彎刀"}},{name:"Shortsword",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"短劍"}},{name:"Trident",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Thrown","Versatile"],range:"20/60",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d6",numDice:1},twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:4,l10n:{name:"三叉戟"}},{name:"War Pick",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"戰鎬"}},{name:"Warhammer",type:"Weapon",cost:{gp:15,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"戰鎚"}},{name:"Whip",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Reach"],range:"10 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Slashing"},weight:3,l10n:{name:"鞭子"}},{name:"Blowgun",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Loading"],range:"25/100",weaponType:"Martial Ranged",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Piercing"},weight:1,l10n:{name:"吹箭筒"}},{name:"Crossbow, hand",type:"Weapon",cost:{gp:75,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Light","Loading"],range:"30/120",weaponType:"Martial Ranged",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:3,l10n:{name:"手弩"}},{name:"Crossbow, heavy",type:"Weapon",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Heavy","Loading","Two-Handed"],range:"100/400",weaponType:"Martial Ranged",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Piercing"},weight:18,l10n:{name:"重型十字弓"}},{name:"Longbow",type:"Weapon",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Heavy","Two-Handed"],range:"150/600",weaponType:"Martial Ranged",damage:{twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"長弓"}},{name:"Net",type:"Weapon",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Special","Thrown"],range:"5/15",weaponType:"Martial Ranged",damage:{oneHanded:{diceType:"d4",numDice:0}},weight:3,l10n:{name:"網"}}],ql={};for(const t of wa)ql[t.name.toLowerCase()]=t;let Ul=[],Ta=[];function wr(t){Ul=t.customGear??[],Ta=t.customSpells??[]}function Ea(t){return ql[t.toLowerCase()]??kr(t)}function Tr(t){return Hl[t.toLowerCase()]}function Er(t){return Gl[t.toLowerCase()]}function Ar(t){return Ta.find(e=>e.name.toLowerCase()===t.toLowerCase())}function Aa(t){return Wl[t.toLowerCase()]||Ar(t)}function ka(t){return Ul.find(e=>e.name.toLowerCase()===t.toLowerCase())}function kr(t){return Ul.filter(e=>e.type==="Weapon").map(e=>e).find(e=>e.name.toLowerCase()===t.toLowerCase())}function Qe(t){return Ea(t)||Tr(t)||Er(t)||ka(t)}const Br=["Shield","+1","+2","+3","Magic"],As=["Self","Touch","5 ft","10 ft","30 ft","60 ft","120 ft","Sight"],Pt=["d4","d6","d8","d10","d12","d20","d100"],Cr="1.0.0",Or="dnd5e-char-sheet",Wt=["STR","DEX","CON","INT","WIS","CHA"],ks=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],Bs=["Simple Melee","Simple Ranged","Martial Melee","Martial Ranged"],Sr=["Ammunition","Finesse","Heavy","Light","Loading","Range","Reach","Special","Thrown","Two-Handed","Versatile","Silvered","Magical"],Mr=["armorClass","hp","proficiencyBonus","speed","initiative","passivePerception","stat","skill"],Bl=["attackRoll","damageRoll","savingThrow","skillCheck","abilityCheck","initiativeRoll"],Cs=[...Mr,...Bl],qt=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard","Artificer"],Os=["Dragonborn","Dwarf","Elf","Gnome","Half-Elf","Half-Orc","Halfling","Human","Tiefling"],Ss=["Common","Dwarvish","Elvish","Giant","Gnomish","Goblin","Halfling","Orc","Abyssal","Celestial","Draconic","Deep Speech","Infernal","Primordial","Sylvan","Undercommon"],Rr={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100};function Lt(t,e=1){let n=0;for(let l=0;l<e;l++)n+=Math.floor(Math.random()*Rr[t])+1;return n}function Nn(t){return`${t>=0?"+":""}${t}`}function Zn(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),t<e?-1:t>e?1:0}function Ms(t){return Qe(t.name)}function Fl(t,e=500,n,l){let s;return(...i)=>(n==null||n(),new Promise(o=>{s&&clearTimeout(s),s=setTimeout(()=>{o(t(...i)),l==null||l()},e)}))}function Rs(t,e){return Pt.findIndex(n=>n===t)-Pt.findIndex(n=>n===e)}const $r=100;function Dr(t){const e=[We(t)];let n=0;const l=ct(!1),s=ct(!1),i=Fl(o=>{if(o){for(n++,e[n]=JSON.parse(JSON.stringify(o));n<e.length-1;)e.pop();e.length>$r&&(e.splice(0,1),n=Math.max(0,n-1)),l.set(!0),s.set(!1)}},1e3);return{subscribe:t.subscribe,canUndo:l,canRedo:s,set:o=>{i(o),t.set(o)},undo:()=>{n!==0&&(n--,n===0&&l.set(!1),s.set(!0),t.set(e[n]))},redo:()=>{n>=e.length-1||(n++,n>=e.length-1&&s.set(!1),l.set(!0),t.set(e[n]))}}}const ye=Dr(ct(Ht())),De=ye;function Ht(){return{name:"",ancestry:"Human",class:"",level:1,title:"",alignment:"True Neutral",background:"Noble",deity:"",notes:"",gear:[],customGear:[],stats:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10},skills:{Acrobatics:0,"Animal Handling":0,Arcana:0,Athletics:0,Deception:0,History:0,Insight:0,Intimidation:0,Investigation:0,Medicine:0,Nature:0,Perception:0,Performance:0,Persuasion:0,Religion:0,"Sleight of Hand":0,Stealth:0,Survival:0},savingThrows:{STR:!1,DEX:!1,CON:!1,INT:!1,WIS:!1,CHA:!1},proficiencyBonus:2,passivePerception:10,speed:30,bonuses:[],customBonuses:[],customTalents:[],maxHitPoints:10,hitPoints:10,tempHitPoints:0,hitDice:{},deathSaves:{successes:0,failures:0},conditions:[],exhaustion:0,armorClass:10,carryingCapacity:150,currency:{cp:0,sp:0,ep:0,gp:0,pp:0},languages:["Common"],customLanguages:[],xp:0,spells:[],customSpells:[],spellSlots:{}}}function Ba(t){return t<=0?2:Math.ceil(t/4)+1}function Ut(t,e){const n=Vl(t,e);return Math.floor((n-10)/2)}function Nr(t,e){t.class=e}function Ir(t,e){t.ancestry=e}function al(t){const e=t.gear.filter(l=>l.equipped).flatMap(l=>{const s=Qe(l.name);return(s==null?void 0:s.playerBonuses)||[]}),n=t.customGear.filter(l=>l.equipped).flatMap(l=>l.playerBonuses||[]);return[...t.bonuses,...t.customBonuses,...e,...n]}function Vl(t,e){return t.stats[e]+Oa(t,e)}function jl(t,e){var i,o;const n=!t.metadata,l=((i=t.metadata)==null?void 0:i.type)==="weaponType"&&e.weaponType.includes(t.metadata.weaponType),s=((o=t.metadata)==null?void 0:o.type)==="weapon"&&t.metadata.weapon===e.name;return n||l||s}function Ca(t,e,n){var o;let l=((o=e.damage[n])==null?void 0:o.diceType)??"d4";const i=al(t).filter(r=>r.type==="diceType"&&r.bonusTo==="damageRoll"&&jl(r,e)).map(r=>r.diceType).sort(Rs).reverse();return i[0]&&Rs(i[0],l)>0&&(l=i[0]),l}function Oa(t,e){return al(t).filter(l=>{var s;return l.type==="modifyAmt"&&l.bonusTo==="stat"&&((s=l.metadata)==null?void 0:s.type)==="stat"&&l.metadata.stat===e}).reduce((l,s)=>l+Zt(t,s),0)}function Lr(t){let e=0;const n=t.gear.filter(r=>r.equipped).map(Ms).filter(r=>{var u;return r.type==="Armor"&&!((u=r.properties)!=null&&u.includes("Shield"))}),l=Ut(t,"DEX");if(n.length>0){const r=n[0],u=r.ac.base;let c=l;r.ac.maxDex!==void 0&&(r.ac.maxDex===0?c=0:c=Math.min(l,r.ac.maxDex)),e=u+c,e+=r.ac.modifier}else e=10+l;const s=t.gear.filter(r=>r.equipped).map(Ms).filter(r=>{var u;return r.type==="Armor"&&((u=r.properties)==null?void 0:u.includes("Shield"))});for(const r of s)e+=r.ac.base>0?r.ac.base:2,e+=r.ac.modifier;const o=al(t).reduce((r,u)=>u.type==="modifyAmt"&&u.bonusTo==="armorClass"?r+Zt(t,u):r,0);return e+=o,t.armorClass!==10&&(e+=t.armorClass-10),e}function Sa(t,e="Wizard"){const n=Ba(t.level);let l="INT";["Cleric","Druid","Ranger"].includes(t.class||"")&&(l="WIS"),["Bard","Paladin","Sorcerer","Warlock"].includes(t.class||"")&&(l="CHA");const s=Ut(t,l);return n+s}function Pr(t){return 8+Sa(t)}function In(t,e){var o,r,u;let n=0;const l=Ut(t,"STR"),s=Ut(t,"DEX");(o=e.properties)!=null&&o.includes("Finesse")||e.weaponType&&e.weaponType.includes("Ranged")?e.weaponType.includes("Ranged")&&!((r=e.properties)!=null&&r.includes("Thrown"))?n+=s:(u=e.properties)!=null&&u.includes("Finesse")?n+=Math.max(l,s):n+=l:n+=l;const i=t.bonuses.filter(c=>c.type==="modifyAmt"&&c.bonusTo==="damageRoll").reduce((c,a)=>(jl(a,e)&&(c+=Zt(t,a)),c),0);return n+=i,n}function $s(t,e){var r,u;let n=0;const l=Ut(t,"STR"),s=Ut(t,"DEX");(r=e.properties)!=null&&r.includes("Finesse")?n+=Math.max(l,s):e.weaponType.includes("Ranged")&&!((u=e.properties)!=null&&u.includes("Thrown"))?n+=s:n+=l;const i=Ba(t.level);n+=i;const o=t.bonuses.filter(c=>c.type==="modifyAmt"&&c.bonusTo==="attackRoll").reduce((c,a)=>(jl(a,e)&&(c+=Zt(t,a)),c),0);return n+=o,n}function Hr(t){return Vl(t,"STR")*15}function Gr(t){return t.gear.reduce((e,n)=>{const l=Qe(n.name);return e+((l==null?void 0:l.weight)||0)*n.quantity},0)}const Wr=[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3,1e5,12e4,14e4,165e3,195e3,225e3,265e3,305e3,355e3];function qr(t){if(t.level>=20)return;const e=Wr[t.level];t.xp>=e&&(t.level+=1)}function Ma(t,e){return t.spells.findIndex(n=>n.name===e.name)>-1}function Ur(t,e){return!0}function Fr(t,e){Ma(t,e)||t.spells.push({name:e.name})}function Vr(t,e){t.spells=t.spells.filter(n=>n.name!==e.name)}function An(t,e){t.bonuses.push(e)}function jr(t,e){t.bonuses=t.bonuses.filter(n=>n.name!==e.name)}function Ds(t){const e=t.maxHitPoints,l=al(t).filter(s=>s.type==="modifyAmt"&&s.bonusTo==="hp").reduce((s,i)=>s+Zt(t,i),0);return e+l}function Zt(t,e){var s;let n=e.bonusAmount;e.bonusTo!=="stat"&&((s=e.metadata)==null?void 0:s.type)==="stat"&&(n=Math.max(n,Ut(t,e.metadata.stat)));const l=Math.floor(t.level*(e.bonusIncreaseRatePerLevel??0));return n+l}function zr(t,e){t.spells=t.spells.filter(n=>n.name!==e.name),t.bonuses=t.bonuses.filter(n=>{var l;return!(((l=n.metadata)==null?void 0:l.type)==="spell"&&n.metadata.spell===e.name)}),t.customSpells=t.customSpells.filter(n=>n.name!==e.name)}function Yr(t,e){var s,i,o;const n=e.cost.gp*100+e.cost.sp*10+e.cost.cp;return(((s=t.currency)==null?void 0:s.gp)||0)*100+(((i=t.currency)==null?void 0:i.sp)||0)*10+(((o=t.currency)==null?void 0:o.cp)||0)>=n}const Kr={Barbarian:"野蠻人",Bard:"吟遊詩人",Cleric:"牧師",Druid:"德魯伊",Fighter:"戰士",Monk:"武僧",Paladin:"聖騎士",Ranger:"巡林客",Rogue:"盜賊",Sorcerer:"術士",Warlock:"邪術師",Wizard:"法師",Artificer:"奇械師"},Xr={Dragonborn:"龍裔",Dwarf:"矮人",Elf:"精靈",Gnome:"地侏","Half-Elf":"半精靈","Half-Orc":"半獸人",Halfling:"哈比人",Human:"人類",Tiefling:"堤夫林"},Jr={"Lawful Good":"守序善良","Neutral Good":"中立善良","Chaotic Good":"混沌善良","Lawful Neutral":"守序中立","True Neutral":"絕對中立","Chaotic Neutral":"混沌中立","Lawful Evil":"守序邪惡","Neutral Evil":"中立邪惡","Chaotic Evil":"混沌邪惡"},Zr={STR:"力量",DEX:"敏捷",CON:"體質",INT:"智力",WIS:"感知",CHA:"魅力"},Qr={Common:"通用語",Dwarvish:"矮人語",Elvish:"精靈語",Giant:"巨人語",Gnomish:"地侏語",Goblin:"哥布林語",Halfling:"哈比人語",Orc:"獸人語",Abyssal:"深淵語",Celestial:"天界語",Draconic:"龍語","Deep Speech":"地底語",Infernal:"煉獄語",Primordial:"原初語",Sylvan:"森林語",Undercommon:"地底通用語"};function Cl(t){return Kr[t]??t}function xr(t){return Xr[t]??t}function eu(t){return Jr[t]??t}function gn(t){return Zr[t]??t}function Ol(t){return Qr[t]??t}function Ns(t,e,n){const l=t.slice();return l[8]=e[n],l}function Is(t,e,n){const l=t.slice();return l[8]=e[n],l}function Ls(t){let e,n,l,s,i=Ss.filter(t[2]),o=[];for(let r=0;r<i.length;r+=1)o[r]=Ps(Is(t,i,r));return{c(){e=_("select"),n=_("option");for(let r=0;r<o.length;r+=1)o[r].c();n.__value="",n.value=n.__value,p(e,"class","flex-grow")},m(r,u){w(r,e,u),f(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);l||(s=I(e,"change",t[3]),l=!0)},p(r,u){if(u&4){i=Ss.filter(r[2]);let c;for(c=0;c<i.length;c+=1){const a=Is(r,i,c);o[c]?o[c].p(a,u):(o[c]=Ps(a),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=i.length}},d(r){r&&T(e),ke(o,r),l=!1,s()}}}function Ps(t){let e,n=Ol(t[8])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[8],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function Hs(t){let e,n,l=Ol(t[8])+"",s,i,o,r,u,c;function a(){return t[6](t[8])}return{c(){e=_("li"),n=_("div"),s=G(l),i=y(),o=_("button"),o.innerHTML='<i class="material-icons translate-y-1">delete</i>',r=y(),p(o,"class","text-white bg-black p-1 text-xs"),p(e,"class","border-b flex justify-between gap-4")},m(d,m){w(d,e,m),f(e,n),f(n,s),f(e,i),f(e,o),f(e,r),u||(c=I(o,"click",a),u=!0)},p(d,m){t=d,m&2&&l!==(l=Ol(t[8])+"")&&ee(s,l)},d(d){d&&T(e),u=!1,c()}}}function tu(t){let e,n,l,s,i,o=t[0]?"do_not_disturb_on":"add_circle",r,u,c,a,d,m,v=t[0]&&Ls(t),g=t[1].languages,h=[];for(let b=0;b<g.length;b+=1)h[b]=Hs(Ns(t,g,b));return{c(){e=_("div"),n=_("h2"),n.textContent="語言",l=y(),s=_("button"),i=_("i"),r=G(o),u=y(),v&&v.c(),c=y(),a=_("ul");for(let b=0;b<h.length;b+=1)h[b].c();p(i,"class","material-icons translate-y-1"),p(s,"class","px-3 hover:bg-gray-400"),p(e,"class","flex justify-start")},m(b,A){w(b,e,A),f(e,n),f(e,l),f(e,s),f(s,i),f(i,r),f(e,u),v&&v.m(e,null),w(b,c,A),w(b,a,A);for(let E=0;E<h.length;E+=1)h[E]&&h[E].m(a,null);d||(m=I(s,"click",t[5]),d=!0)},p(b,[A]){if(A&1&&o!==(o=b[0]?"do_not_disturb_on":"add_circle")&&ee(r,o),b[0]?v?v.p(b,A):(v=Ls(b),v.c(),v.m(e,null)):v&&(v.d(1),v=null),A&18){g=b[1].languages;let E;for(E=0;E<g.length;E+=1){const k=Ns(b,g,E);h[E]?h[E].p(k,A):(h[E]=Hs(k),h[E].c(),h[E].m(a,null))}for(;E<h.length;E+=1)h[E].d(1);h.length=g.length}},i:V,o:V,d(b){b&&T(e),v&&v.d(),b&&T(c),b&&T(a),ke(h,b),d=!1,m()}}}function nu(t,e,n){let l;Re(t,ye,d=>n(1,l=d));let s=!1;function i(d){return!l.languages.includes(d)}function o(d){l.languages.push(d),n(0,s=!1),ye.set(l)}function r(d){o(d.target.value)}function u(d){ze(ye,l.languages=l.languages.filter(m=>m!==d),l)}return[s,l,i,r,u,()=>{n(0,s=!s)},d=>{u(d)}]}class lu extends Ce{constructor(e){super(),Oe(this,e,nu,tu,Be,{})}}const su=t=>({}),Gs=t=>({});function iu(t){let e,n,l,s,i,o,r,u,c,a,d,m,v;const g=t[5].header,h=Mn(g,t,t[4],Gs),b=t[5].default,A=Mn(b,t,t[4],null);return{c(){e=_("dialog"),n=_("div"),l=_("button"),l.innerHTML='<i class="material-icons">close</i>',s=y(),h&&h.c(),i=y(),o=_("hr"),r=y(),A&&A.c(),u=y(),c=_("hr"),p(l,"class","absolute top-0 right-0 p-4 hover:bg-gray-200 rounded-md"),p(n,"class","svelte-eyp6eo"),p(e,"class","max-w-3xl svelte-eyp6eo"),p(e,"style",a=`min-width: 20rem; width: ${t[1]}vw;`+t[2]?`height: ${t[2]}vh`:"")},m(E,k){w(E,e,k),f(e,n),f(n,l),f(n,s),h&&h.m(n,null),f(n,i),f(n,o),f(n,r),A&&A.m(n,null),f(n,u),f(n,c),t[8](e),d=!0,m||(v=[I(l,"click",t[7]),I(n,"click",ir(t[6])),I(e,"close",t[9]),I(e,"click",or(t[10]))],m=!0)},p(E,[k]){h&&h.p&&(!d||k&16)&&Rn(h,g,E,E[4],d?Dn(g,E[4],k,su):$n(E[4]),Gs),A&&A.p&&(!d||k&16)&&Rn(A,b,E,E[4],d?Dn(b,E[4],k,null):$n(E[4]),null),(!d||k&6&&a!==(a=`min-width: 20rem; width: ${E[1]}vw;`+E[2]?`height: ${E[2]}vh`:""))&&p(e,"style",a)},i(E){d||(P(h,E),P(A,E),d=!0)},o(E){W(h,E),W(A,E),d=!1},d(E){E&&T(e),h&&h.d(E),A&&A.d(E),t[8](null),m=!1,Fe(v)}}}function ou(t,e,n){let{$$slots:l={},$$scope:s}=e,{showModal:i=!0}=e,{vw:o=85}=e,{vh:r=void 0}=e,u;function c(g){ar.call(this,t,g)}const a=()=>{n(0,i=!1)};function d(g){Ve[g?"unshift":"push"](()=>{u=g,n(3,u)})}const m=()=>n(0,i=!1),v=()=>u.close();return t.$$set=g=>{"showModal"in g&&n(0,i=g.showModal),"vw"in g&&n(1,o=g.vw),"vh"in g&&n(2,r=g.vh),"$$scope"in g&&n(4,s=g.$$scope)},t.$$.update=()=>{t.$$.dirty&9&&u&&(i?u.showModal():u.close())},[i,o,r,u,s,l,c,a,d,m,v]}class ft extends Ce{constructor(e){super(),Oe(this,e,ou,iu,Be,{showModal:0,vw:1,vh:2})}}const tl={};function Ws(t,e,n){const l=t.slice();return l[27]=e[n],l}function qs(t,e,n){const l=t.slice();return l[30]=e[n],l}function Us(t,e,n){const l=t.slice();return l[33]=e[n],l[35]=n,l}function Fs(t,e,n){const l=t.slice();l[36]=e[n],l[35]=n;const s=tl[l[2].class][l[35]];return l[37]=s,l}function Vs(t){var c,a,d;let e,n,l=(t[36].min===t[36].max?t[36].min:`${t[36].min}-${t[36].max}`)+"",s,i,o,r=(((a=(c=t[37])==null?void 0:c.l10n)==null?void 0:a.name)??((d=t[37])==null?void 0:d.name))+"",u;return{c(){e=_("tr"),n=_("td"),s=G(l),i=y(),o=_("td"),u=G(r),p(e,"class","border-b border-black"),$e(e,"bg-yellow-300",t[1]===t[35])},m(m,v){w(m,e,v),f(e,n),f(n,s),f(e,i),f(e,o),f(o,u)},p(m,v){var g,h,b;v[0]&4&&r!==(r=(((h=(g=m[37])==null?void 0:g.l10n)==null?void 0:h.name)??((b=m[37])==null?void 0:b.name))+"")&&ee(u,r),v[0]&2&&$e(e,"bg-yellow-300",m[1]===m[35])},d(m){m&&T(e)}}}function js(t){let e,n,l;return{c(){e=_("button"),e.textContent="擲骰",p(e,"class","w-full bg-black text-white p-1")},m(s,i){w(s,e,i),n||(l=I(e,"click",t[11]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function zs(t){let e,n,l,s,i,o,r,u,c,a,d;return c=rr(t[18][0]),{c(){e=_("div"),n=_("label"),n.textContent="選擇天賦",l=y(),s=_("input"),i=y(),o=_("label"),o.textContent="分配屬性",r=y(),u=_("input"),p(n,"for","chooseTalentCheckBox"),p(s,"id","chooseTalentCheckBox"),p(s,"type","radio"),p(s,"name","pick"),s.__value="talent",s.value=s.__value,p(o,"for","distributeStatsCheckBox"),p(u,"id","distributeStatsCheckBox"),p(u,"type","radio"),p(u,"name","pick"),u.__value="stats",u.value=u.__value,p(e,"class","flex gap-5 items-center justify-center p-2"),c.p(s,u)},m(m,v){w(m,e,v),f(e,n),f(e,l),f(e,s),s.checked=s.__value===t[7],f(e,i),f(e,o),f(e,r),f(e,u),u.checked=u.__value===t[7],a||(d=[I(s,"change",t[17]),I(u,"change",t[19])],a=!0)},p(m,v){v[0]&128&&(s.checked=s.__value===m[7]),v[0]&128&&(u.checked=u.__value===m[7])},d(m){m&&T(e),c.r(),a=!1,Fe(d)}}}function Ys(t){let e,n,l,s=tl[t[2].class],i=[];for(let o=0;o<s.length;o+=1)i[o]=Ks(Us(t,s,o));return{c(){e=_("select");for(let o=0;o<i.length;o+=1)i[o].c();p(e,"class","w-full svelte-ox30w2")},m(o,r){w(o,e,r);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);me(e,t[1]),n||(l=I(e,"change",t[13]),n=!0)},p(o,r){if(r[0]&4){s=tl[o[2].class];let u;for(u=0;u<s.length;u+=1){const c=Us(o,s,u);i[u]?i[u].p(c,r):(i[u]=Ks(c),i[u].c(),i[u].m(e,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=s.length}r[0]&2&&me(e,o[1])},d(o){o&&T(e),ke(i,o),n=!1,l()}}}function Ks(t){var s;let e,n=(((s=t[33].l10n)==null?void 0:s.name)??t[33].name)+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[35],e.value=e.__value},m(i,o){w(i,e,o),f(e,l)},p(i,o){var r;o[0]&4&&n!==(n=(((r=i[33].l10n)==null?void 0:r.name)??i[33].name)+"")&&ee(l,n)},d(i){i&&T(e)}}}function Xs(t){let e,n,l,s,i,o=Wt,r=[];for(let u=0;u<o.length;u+=1)r[u]=Js(qs(t,o,u));return{c(){e=_("div"),n=G("剩餘屬性點數: "),l=G(t[8]),s=y(),i=_("div");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"class","self-center"),p(i,"class","flex flex-col gap-1 items-center")},m(u,c){w(u,e,c),f(e,n),f(e,l),w(u,s,c),w(u,i,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(i,null)},p(u,c){if(c[0]&256&&ee(l,u[8]),c[0]&49668){o=Wt;let a;for(a=0;a<o.length;a+=1){const d=qs(u,o,a);r[a]?r[a].p(d,c):(r[a]=Js(d),r[a].c(),r[a].m(i,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=o.length}},d(u){u&&T(e),u&&T(s),u&&T(i),ke(r,u)}}}function Js(t){let e,n,l=t[30]+"",s,i,o,r=t[9][t[30]]+"",u,c,a,d,m,v,g,h;function b(){return t[20](t[30])}function A(){return t[21](t[30])}return{c(){e=_("div"),n=_("div"),s=G(l),i=y(),o=_("div"),u=G(r),c=y(),a=_("button"),a.innerHTML='<i class="material-icons">remove</i>',d=y(),m=_("button"),m.innerHTML='<i class="material-icons">add</i>',v=y(),p(n,"class","w-12"),p(o,"class","p-1 bg-gray-200 rounded-md"),$e(o,"text-green-600",t[9][t[30]]>t[2].stats[t[30]]),p(e,"class","flex items-center")},m(E,k){w(E,e,k),f(e,n),f(n,s),f(e,i),f(e,o),f(o,u),f(e,c),f(e,a),f(e,d),f(e,m),f(e,v),g||(h=[I(a,"click",b),I(m,"click",A)],g=!0)},p(E,k){t=E,k[0]&512&&r!==(r=t[9][t[30]]+"")&&ee(u,r),k[0]&516&&$e(o,"text-green-600",t[9][t[30]]>t[2].stats[t[30]])},d(E){E&&T(e),g=!1,Fe(h)}}}function Zs(t){let e,n,l,s=t[5],i=[];for(let o=0;o<s.length;o+=1)i[o]=Qs(Ws(t,s,o));return{c(){e=_("select");for(let o=0;o<i.length;o+=1)i[o].c();p(e,"class","svelte-ox30w2"),t[6]===void 0&&Pe(()=>t[22].call(e))},m(o,r){w(o,e,r);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);me(e,t[6],!0),n||(l=I(e,"change",t[22]),n=!0)},p(o,r){if(r[0]&32){s=o[5];let u;for(u=0;u<s.length;u+=1){const c=Ws(o,s,u);i[u]?i[u].p(c,r):(i[u]=Qs(c),i[u].c(),i[u].m(e,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=s.length}r[0]&96&&me(e,o[6])},d(o){o&&T(e),ke(i,o),n=!1,l()}}}function Qs(t){let e,n=ei(t[27])+"",l,s;return{c(){e=_("option"),l=G(n),e.__value=s=t[27],e.value=e.__value},m(i,o){w(i,e,o),f(e,l)},p(i,o){o[0]&32&&n!==(n=ei(i[27])+"")&&ee(l,n),o[0]&32&&s!==(s=i[27])&&(e.__value=s,e.value=e.__value)},d(i){i&&T(e)}}}function xs(t){let e,n,l;return{c(){e=_("button"),e.textContent="更新角色卡",p(e,"class","w-full bg-black text-white p-1")},m(s,i){w(s,e,i),n||(l=I(e,"click",t[12]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function au(t){let e,n,l,s,i,o,r,u,c,a,d,m,v=t[10],g=[];for(let S=0;S<v.length;S+=1)g[S]=Vs(Fs(t,v,S));let h=t[3]&&js(t),b=t[1]===4&&zs(t),A=t[7]==="talent"&&Ys(t),E=t[7]==="stats"&&Xs(t),k=t[5].length&&Zs(t),B=t[4]&&xs(t);return{c(){e=_("table"),n=_("tr"),n.innerHTML=`<th class="w-20">2d6</th> 
      <th>效果</th>`,l=y();for(let S=0;S<g.length;S+=1)g[S].c();s=y(),i=_("tr"),i.innerHTML=`<td>12</td> 
      <td>選擇一項天賦或 +2 點數分配至屬性</td>`,o=y(),h&&h.c(),r=y(),u=_("div"),b&&b.c(),c=y(),A&&A.c(),a=y(),E&&E.c(),d=y(),k&&k.c(),m=y(),B&&B.c(),p(n,"class","text-left border-b border-black"),p(i,"class","border-b border-black"),$e(i,"bg-yellow-300",t[1]===4),p(u,"class","flex flex-col gap-1")},m(S,M){w(S,e,M),f(e,n),f(e,l);for(let N=0;N<g.length;N+=1)g[N]&&g[N].m(e,null);f(e,s),f(e,i),w(S,o,M),h&&h.m(S,M),w(S,r,M),w(S,u,M),b&&b.m(u,null),f(u,c),A&&A.m(u,null),f(u,a),E&&E.m(u,null),f(u,d),k&&k.m(u,null),f(u,m),B&&B.m(u,null)},p(S,M){if(M[0]&1030){v=S[10];let N;for(N=0;N<v.length;N+=1){const R=Fs(S,v,N);g[N]?g[N].p(R,M):(g[N]=Vs(R),g[N].c(),g[N].m(e,s))}for(;N<g.length;N+=1)g[N].d(1);g.length=v.length}M[0]&2&&$e(i,"bg-yellow-300",S[1]===4),S[3]?h?h.p(S,M):(h=js(S),h.c(),h.m(r.parentNode,r)):h&&(h.d(1),h=null),S[1]===4?b?b.p(S,M):(b=zs(S),b.c(),b.m(u,c)):b&&(b.d(1),b=null),S[7]==="talent"?A?A.p(S,M):(A=Ys(S),A.c(),A.m(u,a)):A&&(A.d(1),A=null),S[7]==="stats"?E?E.p(S,M):(E=Xs(S),E.c(),E.m(u,d)):E&&(E.d(1),E=null),S[5].length?k?k.p(S,M):(k=Zs(S),k.c(),k.m(u,m)):k&&(k.d(1),k=null),S[4]?B?B.p(S,M):(B=xs(S),B.c(),B.m(u,null)):B&&(B.d(1),B=null)},d(S){S&&T(e),ke(g,S),S&&T(o),h&&h.d(S),S&&T(r),S&&T(u),b&&b.d(),A&&A.d(),E&&E.d(),k&&k.d(),B&&B.d()}}}function ru(t){let e;return{c(){e=_("h2"),e.textContent="擲新天賦",p(e,"slot","header"),p(e,"class","text-lg")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function uu(t){let e,n,l,s,i,o,r;function u(a){t[23](a)}let c={$$slots:{header:[ru],default:[au]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.textContent="擲新天賦",n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white w-full p-2")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),i=!0,o||(r=I(e,"click",t[16]),o=!0)},p(a,d){const m={};d[0]&1022|d[1]&256&&(m.$$scope={dirty:d,ctx:a}),!s&&d[0]&1&&(s=!0,m.showModal=a[0],Ke(()=>s=!1)),l.$set(m)},i(a){i||(P(l.$$.fragment,a),i=!0)},o(a){W(l.$$.fragment,a),i=!1},d(a){a&&T(e),a&&T(n),se(l,a),o=!1,r()}}}function ei(t){var e;return Array.isArray(t)?t.map(n=>{var l;return((l=n.l10n)==null?void 0:l.name)??n.name}).join(" & "):((e=t.l10n)==null?void 0:e.name)??t.name}function cu(t,e,n){let l,s;Re(t,De,U=>n(2,s=U));let i=!1;const o=[{min:2,max:2},{min:3,max:7},{min:8,max:9},{min:10,max:11}];let r=!0,u=!1,c=-1;function a(){const U=Lt("d6")+Lt("d6");if(n(3,r=!1),U===12){n(1,c=4),n(4,u=!0);return}for(let Z=0;Z<o.length;Z++){const ve=o[Z];if(U>=ve.min&&U<=ve.max){n(1,c=Z),n(4,u=!0);break}}}let d=[],m,v=()=>{};function g(U){const Z=tl[s.class][U];switch(Z==null?void 0:Z.type){case"generic":v=()=>{An(s,{name:Z.name,desc:Z.name,type:"generic",editable:!0})};break;case"bonus":v=()=>{for(const re of Z.bonuses)An(s,re)};break;case"chooseBonus":const ve=Z.choices[0];!Array.isArray(ve)&&ve.metadata&&ve.metadata.type==="spell"?n(5,d=Z.choices.filter(re=>s.spells.find(de=>{var ae;return de.name===((ae=re.metadata)==null?void 0:ae.spell)}))):n(5,d=Z.choices);break}}function h(){n(3,r=!0),n(1,c=-1),n(4,u=!1),n(5,d=[]),n(6,m=void 0),n(7,A=void 0),n(8,E=2),n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})}function b(){if(A==="stats")ze(De,s.stats=l,s);else if(m)if(Array.isArray(m))for(const U of m)An(s,U);else An(s,m);else v();De.set(s),n(0,i=!1)}let A,E=2;function k(U){n(5,d=[]),g(parseInt(U.target.value))}function B(U){E<1||(n(9,l[U]+=1,l),n(8,E-=1))}function S(U){E===2||l[U]-1<s.stats[U]||(n(9,l[U]=Math.max(s.stats[U],l[U]-1),l),n(8,E+=1))}const M=[[]],N=()=>n(0,i=!0);function R(){A=this.__value,n(7,A)}function C(){A=this.__value,n(7,A)}const O=U=>S(U),$=U=>B(U);function D(){m=Ge(this),n(6,m),n(5,d)}function F(U){i=U,n(0,i)}return t.$$.update=()=>{t.$$.dirty[0]&1&&(i||h()),t.$$.dirty[0]&2&&c>-1&&g(c),t.$$.dirty[0]&4&&n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})},[i,c,s,r,u,d,m,A,E,l,o,a,b,k,B,S,N,R,M,C,O,$,D,F]}class fu extends Ce{constructor(e){super(),Oe(this,e,cu,uu,Be,{},null,[-1,-1])}}function du(t){let e,n,l,s,i=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",o,r,u=t[1].diceType+"",c;return{c(){e=_("div"),n=G(t[3]),l=y(),s=_("div"),o=G(i),r=y(),c=G(u),p(e,"class","font-bold")},m(a,d){w(a,e,d),f(e,n),w(a,l,d),w(a,s,d),f(s,o),f(s,r),f(s,c)},p(a,d){d&8&&ee(n,a[3]),d&2&&i!==(i=(a[5][a[1].bonusTo]??a[1].bonusTo)+"")&&ee(o,i),d&2&&u!==(u=a[1].diceType+"")&&ee(c,u)},d(a){a&&T(e),a&&T(l),a&&T(s)}}}function pu(t){let e,n,l,s,i=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",o,r,u=t[1].type==="advantage"?"優勢":"劣勢",c;return{c(){e=_("div"),n=G(t[3]),l=y(),s=_("div"),o=G(i),r=y(),c=G(u),p(e,"class","font-bold")},m(a,d){w(a,e,d),f(e,n),w(a,l,d),w(a,s,d),f(s,o),f(s,r),f(s,c)},p(a,d){d&8&&ee(n,a[3]),d&2&&i!==(i=(a[5][a[1].bonusTo]??a[1].bonusTo)+"")&&ee(o,i),d&2&&u!==(u=a[1].type==="advantage"?"優勢":"劣勢")&&ee(c,u)},d(a){a&&T(e),a&&T(l),a&&T(s)}}}function _u(t){let e,n,l,s,i=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",o,r,u=Nn(Zt(t[4],t[1]))+"",c;return{c(){e=_("div"),n=G(t[3]),l=y(),s=_("div"),o=G(i),r=y(),c=G(u),p(e,"class","font-bold")},m(a,d){w(a,e,d),f(e,n),w(a,l,d),w(a,s,d),f(s,o),f(s,r),f(s,c)},p(a,d){d&8&&ee(n,a[3]),d&2&&i!==(i=(a[5][a[1].bonusTo]??a[1].bonusTo)+"")&&ee(o,i),d&18&&u!==(u=Nn(Zt(a[4],a[1]))+"")&&ee(c,u)},d(a){a&&T(e),a&&T(l),a&&T(s)}}}function mu(t){var s;let e,n=(((s=t[1].l10n)==null?void 0:s.desc)??t[1].desc)+"",l;return{c(){e=_("div"),l=G(n)},m(i,o){w(i,e,o),f(e,l)},p(i,o){var r;o&2&&n!==(n=(((r=i[1].l10n)==null?void 0:r.desc)??i[1].desc)+"")&&ee(l,n)},d(i){i&&T(e)}}}function ti(t){let e,n,l;return{c(){e=_("button"),e.innerHTML='<i class="material-icons">info</i>'},m(s,i){w(s,e,i),n||(l=I(e,"click",t[8]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function ni(t){let e,n,l,s;return{c(){e=_("div"),n=_("button"),n.innerHTML='<i class="material-icons">delete</i>',p(n,"class","pt-1 px-1 rounded-md bg-black text-white"),p(e,"class","flex gap-1")},m(i,o){w(i,e,o),f(e,n),l||(s=I(n,"click",t[9]),l=!0)},p:V,d(i){i&&T(e),l=!1,s()}}}function li(t){let e,n,l;function s(o){t[10](o)}let i={$$slots:{header:[gu],default:[hu]},$$scope:{ctx:t}};return t[2]!==void 0&&(i.showModal=t[2]),e=new ft({props:i}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(o,r){le(e,o,r),l=!0},p(o,r){const u={};r&2050&&(u.$$scope={dirty:r,ctx:o}),!n&&r&4&&(n=!0,u.showModal=o[2],Ke(()=>n=!1)),e.$set(u)},i(o){l||(P(e.$$.fragment,o),l=!0)},o(o){W(e.$$.fragment,o),l=!1},d(o){se(e,o)}}}function hu(t){let e,n,l=t[1].desc+"",s,i,o,r,u=(t[1].bonusSource??"none")+"",c,a,d,m,v=(t[1].editable??"no")+"",g;return{c(){e=_("div"),n=G("Description: "),s=G(l),i=y(),o=_("div"),r=G("Source: "),c=G(u),a=y(),d=_("div"),m=G("Editable: "),g=G(v)},m(h,b){w(h,e,b),f(e,n),f(e,s),w(h,i,b),w(h,o,b),f(o,r),f(o,c),w(h,a,b),w(h,d,b),f(d,m),f(d,g)},p(h,b){b&2&&l!==(l=h[1].desc+"")&&ee(s,l),b&2&&u!==(u=(h[1].bonusSource??"none")+"")&&ee(c,u),b&2&&v!==(v=(h[1].editable??"no")+"")&&ee(g,v)},d(h){h&&T(e),h&&T(i),h&&T(o),h&&T(a),h&&T(d)}}}function gu(t){let e,n=t[1].name+"",l;return{c(){e=_("h2"),l=G(n),p(e,"slot","header")},m(s,i){w(s,e,i),f(e,l)},p(s,i){i&2&&n!==(n=s[1].name+"")&&ee(l,n)},d(s){s&&T(e)}}}function vu(t){let e,n,l,s,i,o,r;function u(g,h){if(g[1].type==="generic")return mu;if(g[1].type==="modifyAmt")return _u;if(g[1].type==="disadvantage"||g[1].type==="advantage")return pu;if(g[1].type==="diceType")return du}let c=u(t),a=c&&c(t),d=t[0]&&ti(t),m=t[1].editable&&ni(t),v=t[2]&&li(t);return{c(){e=_("div"),n=_("div"),a&&a.c(),l=y(),d&&d.c(),s=y(),m&&m.c(),i=y(),v&&v.c(),o=vt(),p(n,"class","flex gap-1"),p(e,"class","flex justify-between gap-3 items-center")},m(g,h){w(g,e,h),f(e,n),a&&a.m(n,null),f(n,l),d&&d.m(n,null),f(e,s),m&&m.m(e,null),w(g,i,h),v&&v.m(g,h),w(g,o,h),r=!0},p(g,[h]){c===(c=u(g))&&a?a.p(g,h):(a&&a.d(1),a=c&&c(g),a&&(a.c(),a.m(n,l))),g[0]?d?d.p(g,h):(d=ti(g),d.c(),d.m(n,null)):d&&(d.d(1),d=null),g[1].editable?m?m.p(g,h):(m=ni(g),m.c(),m.m(e,null)):m&&(m.d(1),m=null),g[2]?v?(v.p(g,h),h&4&&P(v,1)):(v=li(g),v.c(),P(v,1),v.m(o.parentNode,o)):v&&(qe(),W(v,1,1,()=>{v=null}),Ue())},i(g){r||(P(v),r=!0)},o(g){W(v),r=!1},d(g){g&&T(e),a&&a.d(),d&&d.d(),m&&m.d(),g&&T(i),v&&v.d(g),g&&T(o)}}}function bu(t,e,n){let l,s;Re(t,De,g=>n(4,s=g));let{bonus:i}=e,{showInfo:o=!0}=e,r=!1;const u={attackRoll:"攻擊檢定",damageRoll:"傷害",armorClass:"AC",hp:"生命值",gearSlots:"裝備格",spellcastRoll:"施法檢定",backstabDice:"背刺骰",initiativeRoll:"先攻",hpRoll:"生命值擲骰",stat:"屬性",statRoll:"屬性檢定"};let c="";function a(g){jr(s,g),De.set(s)}const d=()=>{n(2,r=!0)},m=()=>a(l);function v(g){r=g,n(2,r)}return t.$$set=g=>{"bonus"in g&&n(7,i=g.bonus),"showInfo"in g&&n(0,o=g.showInfo)},t.$$.update=()=>{var g,h,b,A;if(t.$$.dirty&128&&n(1,l=i),t.$$.dirty&2)switch((g=l.metadata)==null?void 0:g.type){case"weapon":{const E=Qe(l.metadata.weapon);n(3,c=(((h=E==null?void 0:E.l10n)==null?void 0:h.name)??l.metadata.weapon)+":");break}case"weaponType":{n(3,c=({Melee:"近戰",Ranged:"遠程",MeleeRanged:"近戰/遠程"}[l.metadata.weaponType]??l.metadata.weaponType)+":");break}case"armor":{const E=Qe(l.metadata.armor);n(3,c=(((b=E==null?void 0:E.l10n)==null?void 0:b.name)??l.metadata.armor)+":");break}case"stat":{n(3,c=gn(l.metadata.stat)+":");break}case"spell":{const E=Aa(l.metadata.spell);n(3,c=(((A=E==null?void 0:E.l10n)==null?void 0:A.name)??l.metadata.spell)+":");break}default:n(3,c="")}},[o,l,r,c,s,u,a,i,d,m,v]}class zl extends Ce{constructor(e){super(),Oe(this,e,bu,vu,Be,{bonus:7,showInfo:0})}}function si(t,e,n){const l=t.slice();return l[44]=e[n],l}function ii(t,e,n){const l=t.slice();return l[39]=e[n],l}function oi(t,e,n){const l=t.slice();return l[39]=e[n],l}function ai(t,e,n){const l=t.slice();return l[36]=e[n],l}function ri(t,e,n){const l=t.slice();return l[33]=e[n],l}function ui(t,e,n){const l=t.slice();return l[47]=e[n],l}function ci(t,e,n){const l=t.slice();return l[50]=e[n],l}function fi(t,e,n){const l=t.slice();return l[50]=e[n],l}function di(t){let e,n,l,s,i,o;function r(a,d){return a[10]==="diceType"||a[10]==="advantage"||a[10]==="disadvantage"?wu:yu}let u=r(t),c=u(t);return{c(){e=_("div"),n=_("label"),n.textContent="加值對象:",l=y(),s=_("select"),c.c(),p(n,"for","bto"),p(n,"class","font-bold"),p(s,"id","bto"),p(s,"class","border p-1 rounded"),t[2]===void 0&&Pe(()=>t[23].call(s)),p(e,"class","flex flex-col")},m(a,d){w(a,e,d),f(e,n),f(e,l),f(e,s),c.m(s,null),me(s,t[2],!0),i||(o=I(s,"change",t[23]),i=!0)},p(a,d){u===(u=r(a))&&c?c.p(a,d):(c.d(1),c=u(a),c&&(c.c(),c.m(s,null))),d[0]&4&&me(s,a[2])},d(a){a&&T(e),c.d(),i=!1,o()}}}function yu(t){let e,n=Cs,l=[];for(let s=0;s<n.length;s+=1)l[s]=pi(ci(t,n,s));return{c(){for(let s=0;s<l.length;s+=1)l[s].c();e=vt()},m(s,i){for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(s,i);w(s,e,i)},p(s,i){if(i[0]&262144){n=Cs;let o;for(o=0;o<n.length;o+=1){const r=ci(s,n,o);l[o]?l[o].p(r,i):(l[o]=pi(r),l[o].c(),l[o].m(e.parentNode,e))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}},d(s){ke(l,s),s&&T(e)}}}function wu(t){let e,n=Bl,l=[];for(let s=0;s<n.length;s+=1)l[s]=_i(fi(t,n,s));return{c(){for(let s=0;s<l.length;s+=1)l[s].c();e=vt()},m(s,i){for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(s,i);w(s,e,i)},p(s,i){if(i[0]&262144){n=Bl;let o;for(o=0;o<n.length;o+=1){const r=fi(s,n,o);l[o]?l[o].p(r,i):(l[o]=_i(r),l[o].c(),l[o].m(e.parentNode,e))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}},d(s){ke(l,s),s&&T(e)}}}function pi(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[50],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function _i(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[50],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function Tu(t){let e,n,l,s,i,o,r=Pt,u=[];for(let c=0;c<r.length;c+=1)u[c]=mi(ui(t,r,c));return{c(){e=_("div"),n=_("label"),n.textContent="骰子類型",l=y(),s=_("select");for(let c=0;c<u.length;c+=1)u[c].c();p(n,"for","diceType"),p(n,"class","font-bold"),p(s,"id","diceType"),p(s,"class","border p-1 rounded"),t[12]===void 0&&Pe(()=>t[25].call(s)),p(e,"class","flex flex-col")},m(c,a){w(c,e,a),f(e,n),f(e,l),f(e,s);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(s,null);me(s,t[12],!0),i||(o=I(s,"change",t[25]),i=!0)},p(c,a){if(a&0){r=Pt;let d;for(d=0;d<r.length;d+=1){const m=ui(c,r,d);u[d]?u[d].p(m,a):(u[d]=mi(m),u[d].c(),u[d].m(s,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=r.length}a[0]&4096&&me(s,c[12])},d(c){c&&T(e),ke(u,c),i=!1,o()}}}function Eu(t){let e,n,l,s,i,o;return{c(){e=_("div"),n=_("label"),n.textContent="數值多少?",l=y(),s=_("input"),p(n,"for","modifyAmt"),p(n,"class","font-bold"),p(s,"id","modifyAmt"),p(s,"type","number"),p(s,"inputmode","numeric"),p(s,"class","border p-1 rounded"),p(e,"class","flex flex-col")},m(r,u){w(r,e,u),f(e,n),f(e,l),f(e,s),oe(s,t[11]),i||(o=I(s,"input",t[24]),i=!0)},p(r,u){u[0]&2048&&Me(s.value)!==r[11]&&oe(s,r[11])},d(r){r&&T(e),i=!1,o()}}}function mi(t){let e,n=t[47]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[47],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function Au(t){let e,n,l,s,i,o=Bs,r=[];for(let u=0;u<o.length;u+=1)r[u]=hi(si(t,o,u));return{c(){e=_("label"),e.textContent="選擇武器類型",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","weaponType"),p(l,"id","weaponType"),p(l,"class","border p-1 rounded w-full"),t[8]===void 0&&Pe(()=>t[31].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);me(l,t[8],!0),s||(i=I(l,"change",t[31]),s=!0)},p(u,c){if(c&0){o=Bs;let a;for(a=0;a<o.length;a+=1){const d=si(u,o,a);r[a]?r[a].p(d,c):(r[a]=hi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=o.length}c[0]&256&&me(l,u[8])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,i()}}}function ku(t){let e,n,l,s,i,o=Wt,r=[];for(let u=0;u<o.length;u+=1)r[u]=gi(ii(t,o,u));return{c(){e=_("label"),e.textContent="選擇屬性",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","stat"),p(l,"id","stat"),p(l,"class","border p-1 rounded w-full"),t[7]===void 0&&Pe(()=>t[30].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);me(l,t[7],!0),s||(i=I(l,"change",t[30]),s=!0)},p(u,c){if(c&0){o=Wt;let a;for(a=0;a<o.length;a+=1){const d=ii(u,o,a);r[a]?r[a].p(d,c):(r[a]=gi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=o.length}c[0]&128&&me(l,u[7])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,i()}}}function Bu(t){let e,n,l,s,i,o=t[14],r=[];for(let u=0;u<o.length;u+=1)r[u]=vi(oi(t,o,u));return{c(){e=_("label"),e.textContent="選擇法術",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","spell"),p(l,"id","spell"),p(l,"class","border p-1 rounded w-full"),t[6]===void 0&&Pe(()=>t[29].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);me(l,t[6],!0),s||(i=I(l,"change",t[29]),s=!0)},p(u,c){if(c[0]&16384){o=u[14];let a;for(a=0;a<o.length;a+=1){const d=oi(u,o,a);r[a]?r[a].p(d,c):(r[a]=vi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=o.length}c[0]&16448&&me(l,u[6])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,i()}}}function Cu(t){let e,n,l,s,i,o=t[15],r=[];for(let u=0;u<o.length;u+=1)r[u]=bi(ai(t,o,u));return{c(){e=_("label"),e.textContent="選擇防具",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","armor"),p(l,"id","armor"),p(l,"class","border p-1 rounded w-full"),t[5]===void 0&&Pe(()=>t[28].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);me(l,t[5],!0),s||(i=I(l,"change",t[28]),s=!0)},p(u,c){if(c[0]&32768){o=u[15];let a;for(a=0;a<o.length;a+=1){const d=ai(u,o,a);r[a]?r[a].p(d,c):(r[a]=bi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=o.length}c[0]&32800&&me(l,u[5])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,i()}}}function Ou(t){let e,n,l,s,i,o=t[16],r=[];for(let u=0;u<o.length;u+=1)r[u]=yi(ri(t,o,u));return{c(){e=_("label"),e.textContent="選擇武器",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","weapon"),p(l,"id","weapon"),p(l,"class","border p-1 rounded w-full"),t[4]===void 0&&Pe(()=>t[27].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);me(l,t[4],!0),s||(i=I(l,"change",t[27]),s=!0)},p(u,c){if(c[0]&65536){o=u[16];let a;for(a=0;a<o.length;a+=1){const d=ri(u,o,a);r[a]?r[a].p(d,c):(r[a]=yi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=o.length}c[0]&65552&&me(l,u[4])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,i()}}}function hi(t){let e,n=t[44]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[44],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function gi(t){let e,n=gn(t[39])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[39],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function vi(t){var i;let e,n=(((i=t[39].l10n)==null?void 0:i.name)??t[39].name)+"",l,s;return{c(){e=_("option"),l=G(n),e.__value=s=t[39].name,e.value=e.__value},m(o,r){w(o,e,r),f(e,l)},p(o,r){var u;r[0]&16384&&n!==(n=(((u=o[39].l10n)==null?void 0:u.name)??o[39].name)+"")&&ee(l,n),r[0]&16384&&s!==(s=o[39].name)&&(e.__value=s,e.value=e.__value)},d(o){o&&T(e)}}}function bi(t){var i;let e,n=(((i=t[36].l10n)==null?void 0:i.name)??t[36].name)+"",l,s;return{c(){e=_("option"),l=G(n),e.__value=s=t[36].name,e.value=e.__value},m(o,r){w(o,e,r),f(e,l)},p(o,r){var u;r[0]&32768&&n!==(n=(((u=o[36].l10n)==null?void 0:u.name)??o[36].name)+"")&&ee(l,n),r[0]&32768&&s!==(s=o[36].name)&&(e.__value=s,e.value=e.__value)},d(o){o&&T(e)}}}function yi(t){var i;let e,n=(((i=t[33].l10n)==null?void 0:i.name)??t[33].name)+"",l,s;return{c(){e=_("option"),l=G(n),e.__value=s=t[33].name,e.value=e.__value},m(o,r){w(o,e,r),f(e,l)},p(o,r){var u;r[0]&65536&&n!==(n=(((u=o[33].l10n)==null?void 0:u.name)??o[33].name)+"")&&ee(l,n),r[0]&65536&&s!==(s=o[33].name)&&(e.__value=s,e.value=e.__value)},d(o){o&&T(e)}}}function Su(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h,b,A,E,k,B,S,M,N,R,C,O,$,D,F,U,Z,ve,re,de,ae,j,q,K,we,Y,pe=t[10]!=="generic"&&di(t);function be(ue,ce){if(ue[10]==="modifyAmt")return Eu;if(ue[10]==="diceType")return Tu}let X=be(t),H=X&&X(t);function J(ue,ce){if(ue[3]==="weapon")return Ou;if(ue[3]==="armor")return Cu;if(ue[3]==="spell")return Bu;if(ue[3]==="stat")return ku;if(ue[3]==="weaponType")return Au}let he=J(t),_e=he&&he(t);return{c(){e=_("div"),n=_("div"),l=_("label"),l.textContent="名稱",s=y(),i=_("input"),o=y(),r=_("div"),u=_("label"),u.textContent="描述",c=y(),a=_("input"),d=y(),m=_("div"),v=_("label"),v.textContent="加值類型",g=y(),h=_("select"),b=_("option"),b.textContent="一般 (純文字描述)",A=_("option"),A.textContent="數值修正 (例如 +1) ",E=_("option"),E.textContent="優勢 ",k=_("option"),k.textContent="劣勢 ",B=_("option"),B.textContent="更改骰子類型",S=y(),pe&&pe.c(),M=y(),H&&H.c(),N=y(),R=_("div"),C=_("label"),C.textContent="進階條件 (選填)",O=y(),$=_("select"),D=_("option"),D.textContent="無",F=_("option"),F.textContent="特定武器",U=_("option"),U.textContent="特定防具",Z=_("option"),Z.textContent="特定法術",ve=_("option"),ve.textContent="特定屬性",re=_("option"),re.textContent="特定武器類型",de=y(),_e&&_e.c(),ae=y(),j=_("button"),q=G(t[13]),p(l,"for","name"),p(l,"class","font-bold"),p(i,"id","name"),p(i,"type","text"),p(i,"placeholder","例如：力量藥水"),p(i,"class","border p-1 rounded"),p(n,"class","flex flex-col"),p(u,"for","desc"),p(u,"class","font-bold"),p(a,"id","desc"),p(a,"placeholder","例如：力量 +2"),p(a,"class","border p-1 rounded"),p(r,"class","flex flex-col"),p(v,"for","type"),p(v,"class","font-bold"),b.__value="generic",b.value=b.__value,A.__value="modifyAmt",A.value=A.__value,E.__value="advantage",E.value=E.__value,k.__value="disadvantage",k.value=k.__value,B.__value="diceType",B.value=B.__value,p(h,"id","type"),p(h,"class","border p-1 rounded"),t[10]===void 0&&Pe(()=>t[22].call(h)),p(m,"class","flex flex-col"),p(C,"for","metaDataType"),p(C,"class","font-bold text-sm block mb-1"),D.__value="",D.value=D.__value,F.__value="weapon",F.value=F.__value,U.__value="armor",U.value=U.__value,Z.__value="spell",Z.value=Z.__value,ve.__value="stat",ve.value=ve.__value,re.__value="weaponType",re.value=re.__value,p($,"id","metaDataType"),p($,"class","border p-1 rounded w-full mb-2"),t[3]===void 0&&Pe(()=>t[26].call($)),p(R,"class","border-t pt-2 mt-2"),p(j,"class","w-full p-2 bg-black text-white mt-4 rounded shadow font-bold disabled:opacity-50 disabled:cursor-not-allowed"),j.disabled=K=!t[9],p(e,"class","flex flex-col gap-2 w-full max-h-[80vh] overflow-y-auto p-1")},m(ue,ce){w(ue,e,ce),f(e,n),f(n,l),f(n,s),f(n,i),oe(i,t[0]),f(e,o),f(e,r),f(r,u),f(r,c),f(r,a),oe(a,t[1]),f(e,d),f(e,m),f(m,v),f(m,g),f(m,h),f(h,b),f(h,A),f(h,E),f(h,k),f(h,B),me(h,t[10],!0),f(e,S),pe&&pe.m(e,null),f(e,M),H&&H.m(e,null),f(e,N),f(e,R),f(R,C),f(R,O),f(R,$),f($,D),f($,F),f($,U),f($,Z),f($,ve),f($,re),me($,t[3],!0),f(R,de),_e&&_e.m(R,null),f(e,ae),f(e,j),f(j,q),we||(Y=[I(i,"input",t[20]),I(a,"input",t[21]),I(h,"change",t[22]),I($,"change",t[26]),I(j,"click",t[17])],we=!0)},p(ue,ce){ce[0]&1&&i.value!==ue[0]&&oe(i,ue[0]),ce[0]&2&&a.value!==ue[1]&&oe(a,ue[1]),ce[0]&1024&&me(h,ue[10]),ue[10]!=="generic"?pe?pe.p(ue,ce):(pe=di(ue),pe.c(),pe.m(e,M)):pe&&(pe.d(1),pe=null),X===(X=be(ue))&&H?H.p(ue,ce):(H&&H.d(1),H=X&&X(ue),H&&(H.c(),H.m(e,N))),ce[0]&8&&me($,ue[3]),he===(he=J(ue))&&_e?_e.p(ue,ce):(_e&&_e.d(1),_e=he&&he(ue),_e&&(_e.c(),_e.m(R,null))),ce[0]&8192&&ee(q,ue[13]),ce[0]&512&&K!==(K=!ue[9])&&(j.disabled=K)},i:V,o:V,d(ue){ue&&T(e),pe&&pe.d(),H&&H.d(),_e&&_e.d(),we=!1,Fe(Y)}}}function Mu(t,e,n){let l,s,i,o;Re(t,De,j=>n(19,o=j));const r=yn();let u="",c="",a="generic",d="attackRoll",m=1,v="",g="d8",h="",b="",A="",E="",k="",B=!!u&&!!c,S="新增";function M(){let j;switch(a){case"generic":j={name:u,desc:c,type:a};break;case"modifyAmt":j={name:u,desc:c,type:a,bonusTo:d,bonusAmount:m};break;case"advantage":case"disadvantage":{j={name:u,desc:c,type:a,bonusTo:d};break}case"diceType":j={name:u,desc:c,type:a,bonusTo:d,diceType:g};break;default:return}v&&(v==="weapon"&&h?j.metadata={type:"weapon",weapon:h}:v==="weaponType"&&k?j.metadata={type:"weaponType",weaponType:k}:v==="armor"&&b?j.metadata={type:"armor",armor:b}:v==="stat"&&E?j.metadata={type:"stat",stat:E}:v==="spell"&&A&&(j.metadata={type:"spell",spell:A})),j.editable=!0,An(o,j),De.set(o),r("finish")}const N={attackRoll:"攻擊檢定 (Attack)",damageRoll:"傷害檢定 (Damage)",armorClass:"AC (防禦)",hp:"HP (生命)",proficiencyBonus:"熟練加值",speed:"速度",initiative:"先攻 (數值)",initiativeRoll:"先攻檢定 (Roll)",passivePerception:"被動感知",stat:"屬性值 (Score)",savingThrow:"豁免檢定",skillCheck:"技能檢定",abilityCheck:"屬性檢定 (Check)"};function R(){u=this.value,n(0,u)}function C(){c=this.value,n(1,c)}function O(){a=Ge(this),n(10,a)}function $(){d=Ge(this),n(2,d)}function D(){m=Me(this.value),n(11,m)}function F(){g=Ge(this),n(12,g)}function U(){v=Ge(this),n(3,v),n(2,d),n(0,u),n(1,c),n(7,E),n(4,h),n(5,b),n(6,A),n(8,k),n(9,B)}function Z(){h=Ge(this),n(4,h),n(2,d),n(16,l),n(19,o)}function ve(){b=Ge(this),n(5,b),n(2,d),n(15,s),n(19,o)}function re(){A=Ge(this),n(6,A),n(2,d),n(14,i),n(19,o)}function de(){E=Ge(this),n(7,E),n(2,d)}function ae(){k=Ge(this),n(8,k),n(2,d)}return t.$$.update=()=>{t.$$.dirty[0]&524288&&n(16,l=wa.concat(o.customGear.filter(j=>j.type==="Weapon").map(j=>j)??[])),t.$$.dirty[0]&524288&&n(15,s=ba.concat(o.customGear.filter(j=>j.type==="Armor").map(j=>j)??[])),t.$$.dirty[0]&524288&&n(14,i=ya.concat(o.customSpells??[])),t.$$.dirty[0]&4&&d&&(n(4,h=""),n(5,b=""),n(6,A=""),n(7,E=""),n(8,k="")),t.$$.dirty[0]&1023&&(d==="stat"?(n(3,v="stat"),n(9,B=!!u&&!!c&&!!E)):n(9,B=!!u&&!!c),v==="stat"&&!E&&n(9,B=!1),v==="weapon"&&!h&&n(9,B=!1),v==="armor"&&!b&&n(9,B=!1),v==="spell"&&!A&&n(9,B=!1),v==="weaponType"&&!k&&n(9,B=!1),n(13,S=B?"新增":"請填寫必要欄位"))},[u,c,d,v,h,b,A,E,k,B,a,m,g,S,i,s,l,M,N,o,R,C,O,$,D,F,U,Z,ve,re,de,ae]}class Ru extends Ce{constructor(e){super(),Oe(this,e,Mu,Su,Be,{},null,[-1,-1])}}function wi(t){let e,n,l;function s(o){t[4](o)}let i={$$slots:{header:[Du],default:[$u]},$$scope:{ctx:t}};return t[1]!==void 0&&(i.showModal=t[1]),e=new ft({props:i}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(o,r){le(e,o,r),l=!0},p(o,r){const u={};r&33&&(u.$$scope={dirty:r,ctx:o}),!n&&r&2&&(n=!0,u.showModal=o[1],Ke(()=>n=!1)),e.$set(u)},i(o){l||(P(e.$$.fragment,o),l=!0)},o(o){W(e.$$.fragment,o),l=!1},d(o){se(e,o)}}}function $u(t){let e,n;return e=new Ru({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:V,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Du(t){let e;return{c(){e=_("h1"),e.textContent="自訂加值",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Nu(t){let e,n,l,s,i,o,r=t[0]&&wi(t);return{c(){e=_("button"),e.textContent="自訂加值",n=y(),r&&r.c(),l=vt(),p(e,"class","w-full bg-black text-white p-2")},m(u,c){w(u,e,c),w(u,n,c),r&&r.m(u,c),w(u,l,c),s=!0,i||(o=I(e,"click",t[2]),i=!0)},p(u,[c]){u[0]?r?(r.p(u,c),c&1&&P(r,1)):(r=wi(u),r.c(),P(r,1),r.m(l.parentNode,l)):r&&(qe(),W(r,1,1,()=>{r=null}),Ue())},i(u){s||(P(r),s=!0)},o(u){W(r),s=!1},d(u){u&&T(e),u&&T(n),r&&r.d(u),u&&T(l),i=!1,o()}}}function Iu(t,e,n){let l=!1,s=!1;const i=()=>{n(0,l=!0),n(1,s=!0)},o=()=>{n(0,l=!1)};function r(u){s=u,n(1,s)}return[l,s,i,o,r]}class Lu extends Ce{constructor(e){super(),Oe(this,e,Iu,Nu,Be,{})}}function Ti(t,e,n){const l=t.slice();return l[6]=e[n],l}function Ei(t,e,n){const l=t.slice();return l[9]=e[n],l}function Ai(t,e,n){const l=t.slice();return l[6]=e[n],l}function ki(t,e,n){const l=t.slice();return l[9]=e[n],l}function Bi(t,e,n){const l=t.slice();return l[9]=e[n],l}function Ci(t){let e,n,l,s;return n=new zl({props:{bonus:t[9]}}),{c(){e=_("li"),ne(n.$$.fragment),l=y(),p(e,"class","border-b")},m(i,o){w(i,e,o),le(n,e,null),f(e,l),s=!0},p(i,o){const r={};o&1&&(r.bonus=i[9]),n.$set(r)},i(i){s||(P(n.$$.fragment,i),s=!0)},o(i){W(n.$$.fragment,i),s=!1},d(i){i&&T(e),se(n)}}}function Oi(t){let e,n,l,s;return l=new zl({props:{bonus:t[9]}}),{c(){e=_("li"),n=G("* "),ne(l.$$.fragment),p(e,"class","border-b ps-8 flex gap-1")},m(i,o){w(i,e,o),f(e,n),le(l,e,null),s=!0},p(i,o){const r={};o&2&&(r.bonus=i[9]),l.$set(r)},i(i){s||(P(l.$$.fragment,i),s=!0)},o(i){W(l.$$.fragment,i),s=!1},d(i){i&&T(e),se(l)}}}function Si(t){var d;let e,n,l=(((d=t[6].l10n)==null?void 0:d.name)??t[6].name)+"",s,i,o,r,u=t[6].playerBonuses,c=[];for(let m=0;m<u.length;m+=1)c[m]=Oi(ki(t,u,m));const a=m=>W(c[m],1,1,()=>{c[m]=null});return{c(){e=_("li"),n=_("div"),s=G(l),i=y(),o=_("ul");for(let m=0;m<c.length;m+=1)c[m].c();p(n,"class","font-bold bg-gray-300"),p(e,"class","border-b")},m(m,v){w(m,e,v),f(e,n),f(n,s),f(e,i),f(e,o);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(o,null);r=!0},p(m,v){var g;if((!r||v&2)&&l!==(l=(((g=m[6].l10n)==null?void 0:g.name)??m[6].name)+"")&&ee(s,l),v&2){u=m[6].playerBonuses;let h;for(h=0;h<u.length;h+=1){const b=ki(m,u,h);c[h]?(c[h].p(b,v),P(c[h],1)):(c[h]=Oi(b),c[h].c(),P(c[h],1),c[h].m(o,null))}for(qe(),h=u.length;h<c.length;h+=1)a(h);Ue()}},i(m){if(!r){for(let v=0;v<u.length;v+=1)P(c[v]);r=!0}},o(m){c=c.filter(Boolean);for(let v=0;v<c.length;v+=1)W(c[v]);r=!1},d(m){m&&T(e),ke(c,m)}}}function Mi(t){let e,n,l,s,i;return l=new zl({props:{bonus:t[9],showInfo:!1}}),{c(){e=_("li"),n=G("* "),ne(l.$$.fragment),s=y(),p(e,"class","border-b ps-8 flex gap-1")},m(o,r){w(o,e,r),f(e,n),le(l,e,null),f(e,s),i=!0},p(o,r){const u={};r&4&&(u.bonus=o[9]),l.$set(u)},i(o){i||(P(l.$$.fragment,o),i=!0)},o(o){W(l.$$.fragment,o),i=!1},d(o){o&&T(e),se(l)}}}function Ri(t){var m;let e,n,l=(((m=t[6].l10n)==null?void 0:m.name)??t[6].name)+"",s,i,o,r,u,c=t[6].playerBonuses,a=[];for(let v=0;v<c.length;v+=1)a[v]=Mi(Ei(t,c,v));const d=v=>W(a[v],1,1,()=>{a[v]=null});return{c(){e=_("li"),n=_("div"),s=G(l),i=y(),o=_("ul");for(let v=0;v<a.length;v+=1)a[v].c();r=y(),p(n,"class","font-bold bg-gray-300"),p(e,"class","border-b")},m(v,g){w(v,e,g),f(e,n),f(n,s),f(e,i),f(e,o);for(let h=0;h<a.length;h+=1)a[h]&&a[h].m(o,null);f(e,r),u=!0},p(v,g){var h;if((!u||g&4)&&l!==(l=(((h=v[6].l10n)==null?void 0:h.name)??v[6].name)+"")&&ee(s,l),g&4){c=v[6].playerBonuses;let b;for(b=0;b<c.length;b+=1){const A=Ei(v,c,b);a[b]?(a[b].p(A,g),P(a[b],1)):(a[b]=Mi(A),a[b].c(),P(a[b],1),a[b].m(o,null))}for(qe(),b=c.length;b<a.length;b+=1)d(b);Ue()}},i(v){if(!u){for(let g=0;g<c.length;g+=1)P(a[g]);u=!0}},o(v){a=a.filter(Boolean);for(let g=0;g<a.length;g+=1)W(a[g]);u=!1},d(v){v&&T(e),ke(a,v)}}}function $i(t){let e,n;return e=new fu({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Pu(t){let e,n,l,s,i,o,r,u,c,a,d=t[0].level>0&&t[0].class&&!t[0].hasCustomClass&&qt.includes(t[0].class),m,v,g,h=t[0].bonuses.sort(t[3]),b=[];for(let C=0;C<h.length;C+=1)b[C]=Ci(Bi(t,h,C));const A=C=>W(b[C],1,1,()=>{b[C]=null});let E=t[1].sort(t[4]),k=[];for(let C=0;C<E.length;C+=1)k[C]=Si(Ai(t,E,C));const B=C=>W(k[C],1,1,()=>{k[C]=null});let S=t[2].sort(t[5]),M=[];for(let C=0;C<S.length;C+=1)M[C]=Ri(Ti(t,S,C));const N=C=>W(M[C],1,1,()=>{M[C]=null});let R=d&&$i();return v=new Lu({}),{c(){e=_("h2"),e.textContent="加值",n=y(),l=_("ul");for(let C=0;C<b.length;C+=1)b[C].c();s=y(),i=_("h2"),i.textContent="裝備加值",o=y(),r=_("ul");for(let C=0;C<k.length;C+=1)k[C].c();u=y();for(let C=0;C<M.length;C+=1)M[C].c();c=y(),a=_("div"),R&&R.c(),m=y(),ne(v.$$.fragment),p(l,"class","px-1"),p(a,"class","flex gap-1")},m(C,O){w(C,e,O),w(C,n,O),w(C,l,O);for(let $=0;$<b.length;$+=1)b[$]&&b[$].m(l,null);w(C,s,O),w(C,i,O),w(C,o,O),w(C,r,O);for(let $=0;$<k.length;$+=1)k[$]&&k[$].m(r,null);f(r,u);for(let $=0;$<M.length;$+=1)M[$]&&M[$].m(r,null);w(C,c,O),w(C,a,O),R&&R.m(a,null),f(a,m),le(v,a,null),g=!0},p(C,[O]){if(O&1){h=C[0].bonuses.sort(C[3]);let $;for($=0;$<h.length;$+=1){const D=Bi(C,h,$);b[$]?(b[$].p(D,O),P(b[$],1)):(b[$]=Ci(D),b[$].c(),P(b[$],1),b[$].m(l,null))}for(qe(),$=h.length;$<b.length;$+=1)A($);Ue()}if(O&2){E=C[1].sort(C[4]);let $;for($=0;$<E.length;$+=1){const D=Ai(C,E,$);k[$]?(k[$].p(D,O),P(k[$],1)):(k[$]=Si(D),k[$].c(),P(k[$],1),k[$].m(r,u))}for(qe(),$=E.length;$<k.length;$+=1)B($);Ue()}if(O&4){S=C[2].sort(C[5]);let $;for($=0;$<S.length;$+=1){const D=Ti(C,S,$);M[$]?(M[$].p(D,O),P(M[$],1)):(M[$]=Ri(D),M[$].c(),P(M[$],1),M[$].m(r,null))}for(qe(),$=S.length;$<M.length;$+=1)N($);Ue()}O&1&&(d=C[0].level>0&&C[0].class&&!C[0].hasCustomClass&&qt.includes(C[0].class)),d?R?O&1&&P(R,1):(R=$i(),R.c(),P(R,1),R.m(a,m)):R&&(qe(),W(R,1,1,()=>{R=null}),Ue())},i(C){if(!g){for(let O=0;O<h.length;O+=1)P(b[O]);for(let O=0;O<E.length;O+=1)P(k[O]);for(let O=0;O<S.length;O+=1)P(M[O]);P(R),P(v.$$.fragment,C),g=!0}},o(C){b=b.filter(Boolean);for(let O=0;O<b.length;O+=1)W(b[O]);k=k.filter(Boolean);for(let O=0;O<k.length;O+=1)W(k[O]);M=M.filter(Boolean);for(let O=0;O<M.length;O+=1)W(M[O]);W(R),W(v.$$.fragment,C),g=!1},d(C){C&&T(e),C&&T(n),C&&T(l),ke(b,C),C&&T(s),C&&T(i),C&&T(o),C&&T(r),ke(k,C),ke(M,C),C&&T(c),C&&T(a),R&&R.d(),se(v)}}}function Hu(t,e,n){let l,s,i;Re(t,De,c=>n(0,i=c));const o=(c,a)=>Zn(c.desc,a.desc),r=(c,a)=>Zn(c.name,a.name),u=(c,a)=>Zn(c.name,a.name);return t.$$.update=()=>{t.$$.dirty&1&&n(2,l=i.gear.filter(c=>c.equipped).map(c=>Qe(c.name)).filter(c=>{var a;return c&&c.canBeEquipped&&((a=c.playerBonuses)==null?void 0:a.length)>0})),t.$$.dirty&1&&n(1,s=i.gear.filter(c=>!c.equipped).map(c=>Qe(c.name)).filter(c=>{var a;return c&&((a=c.playerBonuses)==null?void 0:a.length)>0&&!c.canBeEquipped}))},[i,s,l,o,r,u]}class Gu extends Ce{constructor(e){super(),Oe(this,e,Hu,Pu,Be,{})}}function Di(t,e,n){const l=t.slice();return l[31]=e[n],l}function Wu(t,e,n){const l=t.slice();return l[34]=e[n],l[36]=n,l}function Ni(t,e,n){const l=t.slice();return l[37]=e[n],l}function Ii(t){let e,n=t[37]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[37],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function qu(t){let e,n;return{c(){e=_("option"),n=G(t[36]),e.__value=t[36],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:V,d(l){l&&T(e)}}}function Li(t){let e,n=gn(t[31])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[31],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function Pi(t){let e,n,l;return{c(){e=_("input"),p(e,"type","text"),p(e,"placeholder","材料描述 (例如: 一根樹枝)"),p(e,"class","border p-1 rounded text-sm w-full mt-1")},m(s,i){w(s,e,i),oe(e,t[11]),n||(l=I(e,"input",t[24]),n=!0)},p(s,i){i[0]&2048&&e.value!==s[11]&&oe(e,s[11])},d(s){s&&T(e),n=!1,l()}}}function Uu(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h,b,A,E,k,B,S,M,N,R,C,O,$,D,F,U,Z,ve,re,de,ae,j,q,K,we,Y,pe,be,X,H,J,he,_e,ue,ce,z,te,Ae,Ie,x,fe,Se,L,ge,Le,Te,nt,lt,jt=t[0]?"更新法術":"建立法術",Mt,Tt,zt,wn,Je=qt,Ze=[];for(let ie=0;ie<Je.length;ie+=1)Ze[ie]=Ii(Ni(t,Je,ie));let bt=Array(10),yt=[];for(let ie=0;ie<bt.length;ie+=1)yt[ie]=qu(Wu(t,bt,ie));let Ot=Wt,Xe=[];for(let ie=0;ie<Ot.length;ie+=1)Xe[ie]=Li(Di(t,Ot,ie));let et=t[10]&&Pi(t);return{c(){e=_("div"),n=_("div"),l=_("label"),l.innerHTML='法術名稱<span class="text-red-700">*</span>',s=y(),i=_("input"),o=y(),r=_("div"),u=_("div"),c=_("label"),c.textContent="職業列表",a=y(),d=_("select");for(let ie=0;ie<Ze.length;ie+=1)Ze[ie].c();m=_("option"),m.textContent="其他",v=y(),g=_("div"),h=_("label"),h.textContent="環階 (0=戲法)",b=y(),A=_("select");for(let ie=0;ie<yt.length;ie+=1)yt[ie].c();E=y(),k=_("div"),B=_("div"),S=_("label"),S.textContent="施法關鍵屬性",M=y(),N=_("select");for(let ie=0;ie<Xe.length;ie+=1)Xe[ie].c();R=y(),C=_("div"),O=_("label"),O.textContent="距離 (例如: 60 ft)",$=y(),D=_("input"),F=y(),U=_("div"),Z=_("label"),Z.textContent="持續時間 (例如: 1 Minute)",ve=y(),re=_("div"),de=_("input"),ae=y(),j=_("div"),q=_("span"),q.textContent="構材 (Components)",K=y(),we=_("div"),Y=_("label"),pe=_("input"),be=G(" Verbal (V)"),X=y(),H=_("label"),J=_("input"),he=G(" Somatic (S)"),_e=y(),ue=_("label"),ce=_("input"),z=G(" Material (M)"),te=y(),et&&et.c(),Ae=y(),Ie=_("label"),x=_("input"),fe=G(" 儀式法術 (Ritual)"),Se=y(),L=_("div"),ge=_("label"),ge.innerHTML='描述<span class="text-red-700">*</span>',Le=y(),Te=_("textarea"),nt=y(),lt=_("button"),Mt=G(jt),p(l,"for","spellName"),p(l,"class","font-bold"),p(i,"type","text"),p(i,"id","spellName"),p(i,"class","border p-1 rounded"),p(n,"class","flex flex-col gap-1"),p(c,"for","spellClass"),p(c,"class","font-bold"),m.__value="Other",m.value=m.__value,p(d,"id","spellClass"),p(d,"class","border p-1 rounded"),t[4]===void 0&&Pe(()=>t[16].call(d)),p(u,"class","flex flex-col w-1/2"),p(h,"for","spellTier"),p(h,"class","font-bold"),p(A,"id","spellTier"),p(A,"class","border p-1 rounded"),t[3]===void 0&&Pe(()=>t[17].call(A)),p(g,"class","flex flex-col w-1/2"),p(r,"class","flex gap-2"),p(S,"for","spellStat"),p(S,"class","font-bold"),p(N,"id","spellStat"),p(N,"class","border p-1 rounded"),t[5]===void 0&&Pe(()=>t[18].call(N)),p(B,"class","flex flex-col w-1/2"),p(O,"for","spellRange"),p(O,"class","font-bold"),p(D,"type","text"),p(D,"id","spellRange"),p(D,"class","border p-1 rounded"),p(C,"class","flex flex-col w-1/2"),p(k,"class","flex gap-2"),p(Z,"for","spellDuration"),p(Z,"class","font-bold"),p(de,"type","text"),p(de,"id","spellDuration"),p(de,"class","border p-1 rounded w-full"),p(re,"class","flex gap-2"),p(U,"class","flex flex-col gap-1"),p(q,"class","font-bold text-sm"),p(pe,"type","checkbox"),p(pe,"class","svelte-1ep1fgl"),p(Y,"class","flex items-center gap-1"),p(J,"type","checkbox"),p(J,"class","svelte-1ep1fgl"),p(H,"class","flex items-center gap-1"),p(ce,"type","checkbox"),p(ce,"class","svelte-1ep1fgl"),p(ue,"class","flex items-center gap-1"),p(we,"class","flex gap-4"),p(j,"class","flex flex-col gap-1 border p-2 rounded bg-gray-50"),p(x,"type","checkbox"),p(x,"class","svelte-1ep1fgl"),p(Ie,"class","flex items-center gap-1 font-bold"),p(ge,"for","spellDesc"),p(ge,"class","font-bold"),p(Te,"id","spellDesc"),p(Te,"rows","5"),p(Te,"class","border p-1 rounded"),p(L,"class","flex flex-col gap-1"),p(lt,"class","bg-black text-white p-2 rounded font-bold shadow hover:bg-gray-800 transition-colors mt-2"),lt.disabled=Tt=!t[13],$e(lt,"opacity-50",!t[13]),p(e,"class","flex flex-col gap-2 max-h-[80vh] overflow-y-auto p-2")},m(ie,He){w(ie,e,He),f(e,n),f(n,l),f(n,s),f(n,i),oe(i,t[1]),f(e,o),f(e,r),f(r,u),f(u,c),f(u,a),f(u,d);for(let Ee=0;Ee<Ze.length;Ee+=1)Ze[Ee]&&Ze[Ee].m(d,null);f(d,m),me(d,t[4],!0),f(r,v),f(r,g),f(g,h),f(g,b),f(g,A);for(let Ee=0;Ee<yt.length;Ee+=1)yt[Ee]&&yt[Ee].m(A,null);me(A,t[3],!0),f(e,E),f(e,k),f(k,B),f(B,S),f(B,M),f(B,N);for(let Ee=0;Ee<Xe.length;Ee+=1)Xe[Ee]&&Xe[Ee].m(N,null);me(N,t[5],!0),f(k,R),f(k,C),f(C,O),f(C,$),f(C,D),oe(D,t[6]),f(e,F),f(e,U),f(U,Z),f(U,ve),f(U,re),f(re,de),oe(de,t[7]),f(e,ae),f(e,j),f(j,q),f(j,K),f(j,we),f(we,Y),f(Y,pe),pe.checked=t[8],f(Y,be),f(we,X),f(we,H),f(H,J),J.checked=t[9],f(H,he),f(we,_e),f(we,ue),f(ue,ce),ce.checked=t[10],f(ue,z),f(j,te),et&&et.m(j,null),f(e,Ae),f(e,Ie),f(Ie,x),x.checked=t[12],f(Ie,fe),f(e,Se),f(e,L),f(L,ge),f(L,Le),f(L,Te),oe(Te,t[2]),f(e,nt),f(e,lt),f(lt,Mt),zt||(wn=[I(i,"input",t[15]),I(d,"change",t[16]),I(A,"change",t[17]),I(N,"change",t[18]),I(D,"input",t[19]),I(de,"input",t[20]),I(pe,"change",t[21]),I(J,"change",t[22]),I(ce,"change",t[23]),I(x,"change",t[25]),I(Te,"input",t[26]),I(lt,"click",t[27])],zt=!0)},p(ie,He){if(He[0]&2&&i.value!==ie[1]&&oe(i,ie[1]),He&0){Je=qt;let Ee;for(Ee=0;Ee<Je.length;Ee+=1){const Rt=Ni(ie,Je,Ee);Ze[Ee]?Ze[Ee].p(Rt,He):(Ze[Ee]=Ii(Rt),Ze[Ee].c(),Ze[Ee].m(d,m))}for(;Ee<Ze.length;Ee+=1)Ze[Ee].d(1);Ze.length=Je.length}if(He[0]&16&&me(d,ie[4]),He[0]&8&&me(A,ie[3]),He&0){Ot=Wt;let Ee;for(Ee=0;Ee<Ot.length;Ee+=1){const Rt=Di(ie,Ot,Ee);Xe[Ee]?Xe[Ee].p(Rt,He):(Xe[Ee]=Li(Rt),Xe[Ee].c(),Xe[Ee].m(N,null))}for(;Ee<Xe.length;Ee+=1)Xe[Ee].d(1);Xe.length=Ot.length}He[0]&32&&me(N,ie[5]),He[0]&64&&D.value!==ie[6]&&oe(D,ie[6]),He[0]&128&&de.value!==ie[7]&&oe(de,ie[7]),He[0]&256&&(pe.checked=ie[8]),He[0]&512&&(J.checked=ie[9]),He[0]&1024&&(ce.checked=ie[10]),ie[10]?et?et.p(ie,He):(et=Pi(ie),et.c(),et.m(j,null)):et&&(et.d(1),et=null),He[0]&4096&&(x.checked=ie[12]),He[0]&4&&oe(Te,ie[2]),He[0]&1&&jt!==(jt=ie[0]?"更新法術":"建立法術")&&ee(Mt,jt),He[0]&8192&&Tt!==(Tt=!ie[13])&&(lt.disabled=Tt),He[0]&8192&&$e(lt,"opacity-50",!ie[13])},i:V,o:V,d(ie){ie&&T(e),ke(Ze,ie),ke(yt,ie),ke(Xe,ie),et&&et.d(),zt=!1,Fe(wn)}}}function Fu(t,e,n){var de,ae,j,q;let l,s;Re(t,De,K=>n(29,s=K));const i=yn();let{spellToEdit:o=void 0}=e,r=s.spells.find(K=>K.name===(o==null?void 0:o.name)),u=(o==null?void 0:o.name)??"",c=(o==null?void 0:o.desc)??"",a=(o==null?void 0:o.tier)??0,d=(o==null?void 0:o.class)??"Wizard",m=(o==null?void 0:o.stat)??"INT",v=(o==null?void 0:o.range)??"60 feet",g=(o==null?void 0:o.duration)??"Instantaneous",h=((de=o==null?void 0:o.components)==null?void 0:de.verbal)??!1,b=((ae=o==null?void 0:o.components)==null?void 0:ae.somatic)??!1,A=((j=o==null?void 0:o.components)==null?void 0:j.material)??!1,E=((q=o==null?void 0:o.components)==null?void 0:q.materialDesc)??"",k=(o==null?void 0:o.ritual)??!1;function B(){const K={editable:!0,name:u,class:d,stat:m,tier:a,range:v,duration:g,components:{verbal:h,somatic:b,material:A,materialDesc:E},ritual:k,desc:c};o?(Object.assign(o,K),r&&(r.name=K.name)):(s.spells.push({name:K.name}),s.customSpells.push(K)),De.set(s),i("finish")}function S(){u=this.value,n(1,u)}function M(){d=Ge(this),n(4,d)}function N(){a=Ge(this),n(3,a)}function R(){m=Ge(this),n(5,m)}function C(){v=this.value,n(6,v)}function O(){g=this.value,n(7,g)}function $(){h=this.checked,n(8,h)}function D(){b=this.checked,n(9,b)}function F(){A=this.checked,n(10,A)}function U(){E=this.value,n(11,E)}function Z(){k=this.checked,n(12,k)}function ve(){c=this.value,n(2,c)}const re=()=>B();return t.$$set=K=>{"spellToEdit"in K&&n(0,o=K.spellToEdit)},t.$$.update=()=>{t.$$.dirty[0]&6&&n(13,l=u.length>0&&c.length>0)},[o,u,c,a,d,m,v,g,h,b,A,E,k,l,B,S,M,N,R,C,O,$,D,F,U,Z,ve,re]}class Ra extends Ce{constructor(e){super(),Oe(this,e,Fu,Uu,Be,{spellToEdit:0},null,[-1,-1])}}function Hi(t){let e,n,l;function s(o){t[4](o)}let i={vw:50,$$slots:{header:[ju],default:[Vu]},$$scope:{ctx:t}};return t[1]!==void 0&&(i.showModal=t[1]),e=new ft({props:i}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(o,r){le(e,o,r),l=!0},p(o,r){const u={};r&33&&(u.$$scope={dirty:r,ctx:o}),!n&&r&2&&(n=!0,u.showModal=o[1],Ke(()=>n=!1)),e.$set(u)},i(o){l||(P(e.$$.fragment,o),l=!0)},o(o){W(e.$$.fragment,o),l=!1},d(o){se(e,o)}}}function Vu(t){let e,n;return e=new Ra({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:V,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function ju(t){let e;return{c(){e=_("h1"),e.textContent="Custom Spell",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function zu(t){let e,n,l,s,i,o,r=t[0]&&Hi(t);return{c(){e=_("button"),e.textContent="Custom Spell",n=y(),r&&r.c(),l=vt(),p(e,"class","bg-black text-white w-full")},m(u,c){w(u,e,c),w(u,n,c),r&&r.m(u,c),w(u,l,c),s=!0,i||(o=I(e,"click",t[2]),i=!0)},p(u,[c]){u[0]?r?(r.p(u,c),c&1&&P(r,1)):(r=Hi(u),r.c(),P(r,1),r.m(l.parentNode,l)):r&&(qe(),W(r,1,1,()=>{r=null}),Ue())},i(u){s||(P(r),s=!0)},o(u){W(r),s=!1},d(u){u&&T(e),u&&T(n),r&&r.d(u),u&&T(l),i=!1,o()}}}function Yu(t,e,n){let l=!1,s=!1;const i=()=>{n(0,l=!0),n(1,s=!0)},o=()=>n(0,l=!1);function r(u){s=u,n(1,s)}return[l,s,i,o,r]}class Ku extends Ce{constructor(e){super(),Oe(this,e,Yu,zu,Be,{})}}function Gi(t,{delay:e=0,duration:n=400,easing:l=ur}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:l,css:i=>`opacity: ${i*s}`}}const $a={};function Xu(t){let e,n,l,s,i,o;const r=t[5].default,u=Mn(r,t,t[4],null);return{c(){e=y(),n=_("div"),u&&u.c(),En(n,"top",t[1]+"px"),En(n,"left",t[0]+"px"),p(n,"class","svelte-zimeji")},m(c,a){w(c,e,a),w(c,n,a),u&&u.m(n,null),t[6](n),s=!0,i||(o=I(document.body,"click",t[3]),i=!0)},p(c,[a]){u&&u.p&&(!s||a&16)&&Rn(u,r,c,c[4],s?Dn(r,c[4],a,null):$n(c[4]),null),(!s||a&2)&&En(n,"top",c[1]+"px"),(!s||a&1)&&En(n,"left",c[0]+"px")},i(c){s||(P(u,c),Pe(()=>{s&&(l||(l=ys(n,Gi,{duration:100},!0)),l.run(1))}),s=!0)},o(c){W(u,c),l||(l=ys(n,Gi,{duration:100},!1)),l.run(0),s=!1},d(c){c&&T(e),c&&T(n),u&&u.d(c),t[6](null),c&&l&&l.end(),i=!1,o()}}}function Ju(t,e,n){let{$$slots:l={},$$scope:s}=e,{x:i}=e,{y:o}=e,r;const u=yn();cr($a,{dispatchClick:()=>u("click")});function c(d){d.target===r||r.contains(d.target)||u("clickoutside")}function a(d){Ve[d?"unshift":"push"](()=>{r=d,n(2,r)})}return t.$$set=d=>{"x"in d&&n(0,i=d.x),"y"in d&&n(1,o=d.y),"$$scope"in d&&n(4,s=d.$$scope)},t.$$.update=()=>{if(t.$$.dirty&7&&r){const d=r.getBoundingClientRect();n(0,i=Math.min(window.innerWidth-d.width,i)),n(1,o=Math.min(window.innerHeight-d.height,o))}},[i,o,r,c,s,l,a]}class Zu extends Ce{constructor(e){super(),Oe(this,e,Ju,Xu,Be,{x:0,y:1})}}function Qu(t){let e;const n=t[4].default,l=Mn(n,t,t[3],null);return{c(){l&&l.c()},m(s,i){l&&l.m(s,i),e=!0},p(s,i){l&&l.p&&(!e||i&8)&&Rn(l,n,s,s[3],e?Dn(n,s[3],i,null):$n(s[3]),null)},i(s){e||(P(l,s),e=!0)},o(s){W(l,s),e=!1},d(s){l&&l.d(s)}}}function xu(t){let e;return{c(){e=G(t[1])},m(n,l){w(n,e,l)},p(n,l){l&2&&ee(e,n[1])},i:V,o:V,d(n){n&&T(e)}}}function ec(t){let e,n,l,s,i,o;const r=[xu,Qu],u=[];function c(a,d){return a[1]?0:1}return n=c(t),l=u[n]=r[n](t),{c(){e=_("div"),l.c(),p(e,"class","active:bg-gray-100 svelte-12ogry0"),$e(e,"disabled",t[0])},m(a,d){w(a,e,d),u[n].m(e,null),s=!0,i||(o=I(e,"click",t[2]),i=!0)},p(a,[d]){let m=n;n=c(a),n===m?u[n].p(a,d):(qe(),W(u[m],1,1,()=>{u[m]=null}),Ue(),l=u[n],l?l.p(a,d):(l=u[n]=r[n](a),l.c()),P(l,1),l.m(e,null)),(!s||d&1)&&$e(e,"disabled",a[0])},i(a){s||(P(l),s=!0)},o(a){W(l),s=!1},d(a){a&&T(e),u[n].d(),i=!1,o()}}}function tc(t,e,n){let{$$slots:l={},$$scope:s}=e,{isDisabled:i=!1}=e,{text:o=""}=e;const r=yn(),{dispatchClick:u}=fr($a),c=()=>{i||(r("click"),u())};return t.$$set=a=>{"isDisabled"in a&&n(0,i=a.isDisabled),"text"in a&&n(1,o=a.text),"$$scope"in a&&n(3,s=a.$$scope)},[i,o,c,s,l]}class Vn extends Ce{constructor(e){super(),Oe(this,e,tc,ec,Be,{isDisabled:0,text:1})}}var at=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class nc{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return at(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,n){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:n})})}deselect(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return at(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return at(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return at(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return at(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return at(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return at(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return at(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:l}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return l.indexOf(e)>-1})}getConnectionId(){return at(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const n=l=>{e(l.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",n)}}}var wt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class lc{constructor(e){this.messageBus=e}reset(){return wt(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return wt(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return wt(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return wt(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return wt(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return wt(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return n})}inverseTransformPoint(e){return wt(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return n})}}function sc(t){return typeof t.id=="string"}var nl={},ic={get exports(){return nl},set exports(t){nl=t}},_n=typeof Reflect=="object"?Reflect:null,Wi=_n&&typeof _n.apply=="function"?_n.apply:function(e,n,l){return Function.prototype.apply.call(e,n,l)},Qn;_n&&typeof _n.ownKeys=="function"?Qn=_n.ownKeys:Object.getOwnPropertySymbols?Qn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Qn=function(e){return Object.getOwnPropertyNames(e)};function oc(t){console&&console.warn&&console.warn(t)}var Da=Number.isNaN||function(e){return e!==e};function Ne(){Ne.init.call(this)}ic.exports=Ne;nl.once=cc;Ne.EventEmitter=Ne;Ne.prototype._events=void 0;Ne.prototype._eventsCount=0;Ne.prototype._maxListeners=void 0;var qi=10;function rl(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Ne,"defaultMaxListeners",{enumerable:!0,get:function(){return qi},set:function(t){if(typeof t!="number"||t<0||Da(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");qi=t}});Ne.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ne.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Da(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Na(t){return t._maxListeners===void 0?Ne.defaultMaxListeners:t._maxListeners}Ne.prototype.getMaxListeners=function(){return Na(this)};Ne.prototype.emit=function(e){for(var n=[],l=1;l<arguments.length;l++)n.push(arguments[l]);var s=e==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var r=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw r.context=o,r}var u=i[e];if(u===void 0)return!1;if(typeof u=="function")Wi(u,this,n);else for(var c=u.length,a=Ga(u,c),l=0;l<c;++l)Wi(a[l],this,n);return!0};function Ia(t,e,n,l){var s,i,o;if(rl(n),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),o=i[e]),o===void 0)o=i[e]=n,++t._eventsCount;else if(typeof o=="function"?o=i[e]=l?[n,o]:[o,n]:l?o.unshift(n):o.push(n),s=Na(t),s>0&&o.length>s&&!o.warned){o.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.emitter=t,r.type=e,r.count=o.length,oc(r)}return t}Ne.prototype.addListener=function(e,n){return Ia(this,e,n,!1)};Ne.prototype.on=Ne.prototype.addListener;Ne.prototype.prependListener=function(e,n){return Ia(this,e,n,!0)};function ac(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function La(t,e,n){var l={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=ac.bind(l);return s.listener=n,l.wrapFn=s,s}Ne.prototype.once=function(e,n){return rl(n),this.on(e,La(this,e,n)),this};Ne.prototype.prependOnceListener=function(e,n){return rl(n),this.prependListener(e,La(this,e,n)),this};Ne.prototype.removeListener=function(e,n){var l,s,i,o,r;if(rl(n),s=this._events,s===void 0)return this;if(l=s[e],l===void 0)return this;if(l===n||l.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,l.listener||n));else if(typeof l!="function"){for(i=-1,o=l.length-1;o>=0;o--)if(l[o]===n||l[o].listener===n){r=l[o].listener,i=o;break}if(i<0)return this;i===0?l.shift():rc(l,i),l.length===1&&(s[e]=l[0]),s.removeListener!==void 0&&this.emit("removeListener",e,r||n)}return this};Ne.prototype.off=Ne.prototype.removeListener;Ne.prototype.removeAllListeners=function(e){var n,l,s;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[e]),this;if(arguments.length===0){var i=Object.keys(l),o;for(s=0;s<i.length;++s)o=i[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=l[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(e,n[s]);return this};function Pa(t,e,n){var l=t._events;if(l===void 0)return[];var s=l[e];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?uc(s):Ga(s,s.length)}Ne.prototype.listeners=function(e){return Pa(this,e,!0)};Ne.prototype.rawListeners=function(e){return Pa(this,e,!1)};Ne.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ha.call(t,e)};Ne.prototype.listenerCount=Ha;function Ha(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Ne.prototype.eventNames=function(){return this._eventsCount>0?Qn(this._events):[]};function Ga(t,e){for(var n=new Array(e),l=0;l<e;++l)n[l]=t[l];return n}function rc(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function uc(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function cc(t,e){return new Promise(function(n,l){function s(o){t.removeListener(e,i),l(o)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",s),n([].slice.call(arguments))}Wa(t,e,i,{once:!0}),e!=="error"&&fc(t,s,{once:!0})})}function fc(t,e,n){typeof t.on=="function"&&Wa(t,"error",e,n)}function Wa(t,e,n,l){if(typeof t.on=="function")l.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(i){l.once&&t.removeEventListener(e,s),n(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}let jn;const dc=new Uint8Array(16);function pc(){if(!jn&&(jn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!jn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return jn(dc)}const tt=[];for(let t=0;t<256;++t)tt.push((t+256).toString(16).slice(1));function _c(t,e=0){return(tt[t[e+0]]+tt[t[e+1]]+tt[t[e+2]]+tt[t[e+3]]+"-"+tt[t[e+4]]+tt[t[e+5]]+"-"+tt[t[e+6]]+tt[t[e+7]]+"-"+tt[t[e+8]]+tt[t[e+9]]+"-"+tt[t[e+10]]+tt[t[e+11]]+tt[t[e+12]]+tt[t[e+13]]+tt[t[e+14]]+tt[t[e+15]]).toLowerCase()}const mc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ui={randomUUID:mc};function hc(t,e,n){if(Ui.randomUUID&&!e&&!t)return Ui.randomUUID();t=t||{};const l=t.random||(t.rng||pc)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,e){n=n||0;for(let s=0;s<16;++s)e[n+s]=l[s];return e}return _c(l)}class gc extends nl.EventEmitter{constructor(e,n){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=l=>{const s=l.data;if(l.origin===this.targetOrigin&&sc(s)){if(s.id==="OBR_READY"){this.ready=!0;const i=s.data;this.ref=i.ref,this.userId=i.userId}this.emit(s.id,s.data)}},this.send=(l,s,i)=>{var o;if(!this.ref)throw Error("Unable to send message: not ready");(o=window.parent)===null||o===void 0||o.postMessage({id:l,data:s,ref:this.ref,nonce:i},this.targetOrigin)},this.sendAsync=(l,s,i=5e3)=>{const o=`_${hc()}`;return this.send(l,s,o),Promise.race([new Promise((r,u)=>{const c=this;function a(m){c.off(`${l}_RESPONSE${o}`,a),c.off(`${l}_ERROR${o}`,d),r(m)}function d(m){c.off(`${l}_RESPONSE${o}`,a),c.off(`${l}_ERROR${o}`,d),u(m)}this.on(`${l}_RESPONSE${o}`,a),this.on(`${l}_ERROR${o}`,d)}),...i>0?[new Promise((r,u)=>window.setTimeout(()=>u(new Error(`Message ${l} took longer than ${i}ms to get a result`)),i))]:[]])},this.roomId=n,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var Fi=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class vc{constructor(e){this.messageBus=e}show(e,n){return Fi(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:n});return l})}close(e){return Fi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var un=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class bc{constructor(e){this.messageBus=e}getColor(){return un(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return un(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return un(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const n=l=>{e(l.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",n)}}}var rt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class yc{constructor(e){this.messageBus=e}getDpi(){return rt(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return rt(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return rt(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return rt(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return rt(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return rt(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return rt(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,n,l,s){return rt(this,void 0,void 0,function*(){const{position:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:n,useCorners:l,useCenter:s});return i})}getDistance(e,n){return rt(this,void 0,void 0,function*(){const{distance:l}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:n});return l})}onChange(e){const n=l=>{e(l.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",n)}}}var zn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class wc{constructor(e){this.messageBus=e}undo(){return zn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return zn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return zn(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return zn(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function it(t){for(var e=arguments.length,n=Array(e>1?e-1:0),l=1;l<e;l++)n[l-1]=arguments[l];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(s){return"'"+s+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Qt(t){return!!t&&!!t[mt]}function Ft(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var l=Object.getPrototypeOf(n);if(l===null)return!0;var s=Object.hasOwnProperty.call(l,"constructor")&&l.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===Sc}(t)||Array.isArray(t)||!!t[Cn]||!!(!((e=t.constructor)===null||e===void 0)&&e[Cn])||ul(t)||cl(t))}function vn(t,e,n){n===void 0&&(n=!1),Vt(t)===0?(n?Object.keys:xl)(t).forEach(function(l){n&&typeof l=="symbol"||e(l,t[l],t)}):t.forEach(function(l,s){return e(s,l,t)})}function Vt(t){var e=t[mt];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:ul(t)?2:cl(t)?3:0}function Ln(t,e){return Vt(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function xn(t,e){return Vt(t)===2?t.get(e):t[e]}function qa(t,e,n){var l=Vt(t);l===2?t.set(e,n):l===3?t.add(n):t[e]=n}function Tc(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function ul(t){return Cc&&t instanceof Map}function cl(t){return Oc&&t instanceof Set}function Xt(t){return t.o||t.t}function Yl(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=Mc(t);delete e[mt];for(var n=xl(e),l=0;l<n.length;l++){var s=n[l],i=e[s];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(e[s]={configurable:!0,writable:!0,enumerable:i.enumerable,value:t[s]})}return Object.create(Object.getPrototypeOf(t),e)}function Kl(t,e){return e===void 0&&(e=!1),Xl(t)||Qt(t)||!Ft(t)||(Vt(t)>1&&(t.set=t.add=t.clear=t.delete=Ec),Object.freeze(t),e&&vn(t,function(n,l){return Kl(l,!0)},!0)),t}function Ec(){it(2)}function Xl(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function Bt(t){var e=$l[t];return e||it(18,t),e}function Ac(t,e){$l[t]||($l[t]=e)}function Vi(){return Pn}function vl(t,e){e&&(Bt("Patches"),t.u=[],t.s=[],t.v=e)}function ll(t){Sl(t),t.p.forEach(kc),t.p=null}function Sl(t){t===Pn&&(Pn=t.l)}function ji(t){return Pn={p:[],l:Pn,h:t,m:!0,_:0}}function kc(t){var e=t[mt];e.i===0||e.i===1?e.j():e.g=!0}function bl(t,e){e._=e.p.length;var n=e.p[0],l=t!==void 0&&t!==n;return e.h.O||Bt("ES5").S(e,t,l),l?(n[mt].P&&(ll(e),it(4)),Ft(t)&&(t=sl(e,t),e.l||il(e,t)),e.u&&Bt("Patches").M(n[mt].t,t,e.u,e.s)):t=sl(e,n,[]),ll(e),e.u&&e.v(e.u,e.s),t!==Ql?t:void 0}function sl(t,e,n){if(Xl(e))return e;var l=e[mt];if(!l)return vn(e,function(r,u){return zi(t,l,e,r,u,n)},!0),e;if(l.A!==t)return e;if(!l.P)return il(t,l.t,!0),l.t;if(!l.I){l.I=!0,l.A._--;var s=l.i===4||l.i===5?l.o=Yl(l.k):l.o,i=s,o=!1;l.i===3&&(i=new Set(s),s.clear(),o=!0),vn(i,function(r,u){return zi(t,l,s,r,u,n,o)}),il(t,s,!1),n&&t.u&&Bt("Patches").N(l,n,t.u,t.s)}return l.o}function zi(t,e,n,l,s,i,o){if(Qt(s)){var r=sl(t,s,i&&e&&e.i!==3&&!Ln(e.R,l)?i.concat(l):void 0);if(qa(n,l,r),!Qt(r))return;t.m=!1}else o&&n.add(s);if(Ft(s)&&!Xl(s)){if(!t.h.D&&t._<1)return;sl(t,s),e&&e.A.l||il(t,s)}}function il(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&Kl(e,n)}function yl(t,e){var n=t[mt];return(n?Xt(n):t)[e]}function Yi(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var l=Object.getOwnPropertyDescriptor(n,e);if(l)return l;n=Object.getPrototypeOf(n)}}function Ml(t){t.P||(t.P=!0,t.l&&Ml(t.l))}function wl(t){t.o||(t.o=Yl(t.t))}function Rl(t,e,n){var l=ul(e)?Bt("MapSet").F(e,n):cl(e)?Bt("MapSet").T(e,n):t.O?function(s,i){var o=Array.isArray(s),r={i:o?1:0,A:i?i.A:Vi(),P:!1,I:!1,R:{},l:i,t:s,k:null,o:null,j:null,C:!1},u=r,c=Dl;o&&(u=[r],c=kn);var a=Proxy.revocable(u,c),d=a.revoke,m=a.proxy;return r.k=m,r.j=d,m}(e,n):Bt("ES5").J(e,n);return(n?n.A:Vi()).p.push(l),l}function Bc(t){return Qt(t)||it(22,t),function e(n){if(!Ft(n))return n;var l,s=n[mt],i=Vt(n);if(s){if(!s.P&&(s.i<4||!Bt("ES5").K(s)))return s.t;s.I=!0,l=Ki(n,i),s.I=!1}else l=Ki(n,i);return vn(l,function(o,r){s&&xn(s.t,o)===r||qa(l,o,e(r))}),i===3?new Set(l):l}(t)}function Ki(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return Yl(t)}function Jl(){function t(l){if(!Ft(l))return l;if(Array.isArray(l))return l.map(t);if(ul(l))return new Map(Array.from(l.entries()).map(function(o){return[o[0],t(o[1])]}));if(cl(l))return new Set(Array.from(l).map(t));var s=Object.create(Object.getPrototypeOf(l));for(var i in l)s[i]=t(l[i]);return Ln(l,Cn)&&(s[Cn]=l[Cn]),s}function e(l){return Qt(l)?t(l):l}var n="add";Ac("Patches",{$:function(l,s){return s.forEach(function(i){for(var o=i.path,r=i.op,u=l,c=0;c<o.length-1;c++){var a=Vt(u),d=o[c];typeof d!="string"&&typeof d!="number"&&(d=""+d),a!==0&&a!==1||d!=="__proto__"&&d!=="constructor"||it(24),typeof u=="function"&&d==="prototype"&&it(24),typeof(u=xn(u,d))!="object"&&it(15,o.join("/"))}var m=Vt(u),v=t(i.value),g=o[o.length-1];switch(r){case"replace":switch(m){case 2:return u.set(g,v);case 3:it(16);default:return u[g]=v}case n:switch(m){case 1:return g==="-"?u.push(v):u.splice(g,0,v);case 2:return u.set(g,v);case 3:return u.add(v);default:return u[g]=v}case"remove":switch(m){case 1:return u.splice(g,1);case 2:return u.delete(g);case 3:return u.delete(i.value);default:return delete u[g]}default:it(17,r)}}),l},N:function(l,s,i,o){switch(l.i){case 0:case 4:case 2:return function(r,u,c,a){var d=r.t,m=r.o;vn(r.R,function(v,g){var h=xn(d,v),b=xn(m,v),A=g?Ln(d,v)?"replace":n:"remove";if(h!==b||A!=="replace"){var E=u.concat(v);c.push(A==="remove"?{op:A,path:E}:{op:A,path:E,value:b}),a.push(A===n?{op:"remove",path:E}:A==="remove"?{op:n,path:E,value:e(h)}:{op:"replace",path:E,value:e(h)})}})}(l,s,i,o);case 5:case 1:return function(r,u,c,a){var d=r.t,m=r.R,v=r.o;if(v.length<d.length){var g=[v,d];d=g[0],v=g[1];var h=[a,c];c=h[0],a=h[1]}for(var b=0;b<d.length;b++)if(m[b]&&v[b]!==d[b]){var A=u.concat([b]);c.push({op:"replace",path:A,value:e(v[b])}),a.push({op:"replace",path:A,value:e(d[b])})}for(var E=d.length;E<v.length;E++){var k=u.concat([E]);c.push({op:n,path:k,value:e(v[E])})}d.length<v.length&&a.push({op:"replace",path:u.concat(["length"]),value:d.length})}(l,s,i,o);case 3:return function(r,u,c,a){var d=r.t,m=r.o,v=0;d.forEach(function(g){if(!m.has(g)){var h=u.concat([v]);c.push({op:"remove",path:h,value:g}),a.unshift({op:n,path:h,value:g})}v++}),v=0,m.forEach(function(g){if(!d.has(g)){var h=u.concat([v]);c.push({op:n,path:h,value:g}),a.unshift({op:"remove",path:h,value:g})}v++})}(l,s,i,o)}},M:function(l,s,i,o){i.push({op:"replace",path:[],value:s===Ql?void 0:s}),o.push({op:"replace",path:[],value:l})}})}var Xi,Pn,Zl=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Cc=typeof Map<"u",Oc=typeof Set<"u",Ji=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Ql=Zl?Symbol.for("immer-nothing"):((Xi={})["immer-nothing"]=!0,Xi),Cn=Zl?Symbol.for("immer-draftable"):"__$immer_draftable",mt=Zl?Symbol.for("immer-state"):"__$immer_state",Sc=""+Object.prototype.constructor,xl=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,Mc=Object.getOwnPropertyDescriptors||function(t){var e={};return xl(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},$l={},Dl={get:function(t,e){if(e===mt)return t;var n=Xt(t);if(!Ln(n,e))return function(s,i,o){var r,u=Yi(i,o);return u?"value"in u?u.value:(r=u.get)===null||r===void 0?void 0:r.call(s.k):void 0}(t,n,e);var l=n[e];return t.I||!Ft(l)?l:l===yl(t.t,e)?(wl(t),t.o[e]=Rl(t.A.h,l,t)):l},has:function(t,e){return e in Xt(t)},ownKeys:function(t){return Reflect.ownKeys(Xt(t))},set:function(t,e,n){var l=Yi(Xt(t),e);if(l!=null&&l.set)return l.set.call(t.k,n),!0;if(!t.P){var s=yl(Xt(t),e),i=s==null?void 0:s[mt];if(i&&i.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(Tc(n,s)&&(n!==void 0||Ln(t.t,e)))return!0;wl(t),Ml(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return yl(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,wl(t),Ml(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=Xt(t),l=Reflect.getOwnPropertyDescriptor(n,e);return l&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:l.enumerable,value:n[e]}},defineProperty:function(){it(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){it(12)}},kn={};vn(Dl,function(t,e){kn[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),kn.deleteProperty=function(t,e){return kn.set.call(this,t,e,void 0)},kn.set=function(t,e,n){return Dl.set.call(this,t[0],e,n,t[0])};var Rc=function(){function t(n){var l=this;this.O=Ji,this.D=!0,this.produce=function(s,i,o){if(typeof s=="function"&&typeof i!="function"){var r=i;i=s;var u=l;return function(h){var b=this;h===void 0&&(h=r);for(var A=arguments.length,E=Array(A>1?A-1:0),k=1;k<A;k++)E[k-1]=arguments[k];return u.produce(h,function(B){var S;return(S=i).call.apply(S,[b,B].concat(E))})}}var c;if(typeof i!="function"&&it(6),o!==void 0&&typeof o!="function"&&it(7),Ft(s)){var a=ji(l),d=Rl(l,s,void 0),m=!0;try{c=i(d),m=!1}finally{m?ll(a):Sl(a)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(h){return vl(a,o),bl(h,a)},function(h){throw ll(a),h}):(vl(a,o),bl(c,a))}if(!s||typeof s!="object"){if((c=i(s))===void 0&&(c=s),c===Ql&&(c=void 0),l.D&&Kl(c,!0),o){var v=[],g=[];Bt("Patches").M(s,c,v,g),o(v,g)}return c}it(21,s)},this.produceWithPatches=function(s,i){if(typeof s=="function")return function(c){for(var a=arguments.length,d=Array(a>1?a-1:0),m=1;m<a;m++)d[m-1]=arguments[m];return l.produceWithPatches(c,function(v){return s.apply(void 0,[v].concat(d))})};var o,r,u=l.produce(s,i,function(c,a){o=c,r=a});return typeof Promise<"u"&&u instanceof Promise?u.then(function(c){return[c,o,r]}):[u,o,r]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){Ft(n)||it(8),Qt(n)&&(n=Bc(n));var l=ji(this),s=Rl(this,n,void 0);return s[mt].C=!0,Sl(l),s},e.finishDraft=function(n,l){var s=n&&n[mt],i=s.A;return vl(i,l),bl(void 0,i)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!Ji&&it(20),this.O=n},e.applyPatches=function(n,l){var s;for(s=l.length-1;s>=0;s--){var i=l[s];if(i.path.length===0&&i.op==="replace"){n=i.value;break}}s>-1&&(l=l.slice(s+1));var o=Bt("Patches").$;return Qt(n)?o(n,l):this.produce(n,function(r){return o(r,l)})},t}(),ht=new Rc;ht.produce;var es=ht.produceWithPatches.bind(ht);ht.setAutoFreeze.bind(ht);ht.setUseProxies.bind(ht);ht.applyPatches.bind(ht);ht.createDraft.bind(ht);ht.finishDraft.bind(ht);var cn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};Jl();class $c{constructor(e){this.messageBus=e}getItems(e){return cn(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n}})}isItemArray(e){return Array.isArray(e)&&e.every(n=>typeof n!="string")}updateItems(e,n,l=!0){return cn(this,void 0,void 0,function*(){let s;this.isItemArray(e)?s=e:s=yield this.getItems(e);const[i,o]=es(s,n),r=i.map(c=>({id:c.id,type:c.type}));for(const c of o){const[a,d]=c.path;typeof a=="number"&&typeof d=="string"&&(r[a][d]=i[a][d])}const u=r.filter(c=>Object.keys(c).length>2);u.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:u,updateAttachments:l}))})}addItems(e){return cn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return cn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return cn(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return cn(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",n)}}}var fn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};Jl();class Dc{constructor(e){this.messageBus=e}getItems(e){return fn(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n}})}updateItems(e,n,l,s=!0){return fn(this,void 0,void 0,function*(){const i=yield this.getItems(e),[o,r]=es(i,n),u=o.map(a=>({id:a.id,type:a.type}));for(const a of r){const[d,m]=a.path;typeof d=="number"&&typeof m=="string"&&(u[d][m]=o[d][m])}const c=u.filter(a=>Object.keys(a).length>2);c.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:c,fastUpdate:l,updateAttachments:s}))})}addItems(e){return fn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return fn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return fn(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return fn(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",n)}}}var Tl=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Nc{constructor(e){this.messageBus=e,this.grid=new yc(e),this.fog=new bc(e),this.history=new wc(e),this.items=new $c(e),this.local=new Dc(e)}isReady(){return Tl(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const n=l=>{e(l.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",n)}}getMetadata(){return Tl(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return Tl(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",n)}}}function Ua(t){return t.startsWith("http")?t:`${window.location.origin}${t}`}function On(t){return t.map(e=>Object.assign(Object.assign({},e),{icon:Ua(e.icon)}))}function ts(t){return Object.assign(Object.assign({},t),{url:Ua(t.url)})}var Zi=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Ic{constructor(e){this.contextMenus={},this.handleClick=n=>{var l;const s=this.contextMenus[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return Zi(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:On(e.icons),embed:e.embed&&ts(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return Zi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var At=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Lc{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=n=>{const l=this.tools[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(i=>{i&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})},this.handleToolActionClick=n=>{var l;const s=this.toolActions[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.handleToolModeClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(i=>{i&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})},this.handleToolModeToolClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolClick){const s=l.onToolClick(n.context,n.event);Promise.resolve(s).then(i=>{i&&n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDoubleClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolDoubleClick){const s=l.onToolDoubleClick(n.context,n.event);Promise.resolve(s).then(i=>{i&&n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragStart=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragStart)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragEnd=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragEnd)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragCancel=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragCancel)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeActivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onActivate)===null||l===void 0||l.call(s,n.context))},this.handleToolModeDeactivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onDeactivate)===null||l===void 0||l.call(s,n.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:On(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return At(this,void 0,void 0,function*(){const{metadata:n}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return n})}setMetadata(e,n){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:n})})}createAction(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:On(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:On(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,n){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:n})})}}var dn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Pc{constructor(e){this.messageBus=e}open(e){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},ts(e)))})}close(e){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return dn(this,void 0,void 0,function*(){const{width:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return n})}setWidth(e,n){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:n})})}getHeight(e){return dn(this,void 0,void 0,function*(){const{height:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return n})}setHeight(e,n){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:n})})}}var Qi=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Hc{constructor(e){this.messageBus=e}open(e){return Qi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},ts(e)))})}close(e){return Qi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var ut=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Gc{constructor(e){this.messageBus=e}getWidth(){return ut(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return ut(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return ut(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return ut(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return ut(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return ut(this,void 0,void 0,function*(){const n=On([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:n[0].icon})})}getTitle(){return ut(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return ut(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const n=l=>{e(l.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n)}}}var Wc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};Jl();class qc{constructor(e){this.messageBus=e}startItemInteraction(e,n=!0){return Wc(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:n});let s=e;return[r=>{const[u,c]=es(s,r);return s=u,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:l,patches:c}),u},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:l})}]})}}var Uc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Fc{constructor(e){this.messageBus=e}getPlayers(){return Uc(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const n=l=>{e(l.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",n)}}}var El=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Vc{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return El(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return El(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return El(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",n)}}onPermissionsChange(e){const n=l=>{e(l.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n)}}}var jc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class zc{constructor(e){this.messageBus=e}getTheme(){return jc(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const n=l=>{e(l.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",n)}}}var Yn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Yc{constructor(e){this.messageBus=e}uploadImages(e,n){return Yn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e,typeHint:n})})}uploadScenes(e,n){return Yn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e,disableShowScenes:n})})}downloadImages(e,n,l){return Yn(this,void 0,void 0,function*(){const{images:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:e,defaultSearch:n,typeHint:l},-1);return s})}downloadScenes(e,n){return Yn(this,void 0,void 0,function*(){const{scenes:l}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:e,defaultSearch:n},-1);return l})}}var Kc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function r(a){try{c(l.next(a))}catch(d){o(d)}}function u(a){try{c(l.throw(a))}catch(d){o(d)}}function c(a){a.done?i(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Xc{constructor(e){this.messageBus=e}sendMessage(e,n){return Kc(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:e,data:n})})}onMessage(e,n){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:e}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${e}`,n),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:e}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${e}`,n)}}}const Jc=typeof atob=="function",ns=typeof Buffer=="function",xi=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Zc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Qc=Array.prototype.slice.call(Zc),Kn=(t=>{let e={};return t.forEach((n,l)=>e[n]=l),e})(Qc),xc=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Jt=String.fromCharCode.bind(String),eo=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Fa=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),ef=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,tf=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return Jt((n>>>10)+55296)+Jt((n&1023)+56320);case 3:return Jt((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Jt((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},nf=t=>t.replace(ef,tf),lf=t=>{if(t=t.replace(/\s+/g,""),!xc.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",l,s;for(let i=0;i<t.length;)e=Kn[t.charAt(i++)]<<18|Kn[t.charAt(i++)]<<12|(l=Kn[t.charAt(i++)])<<6|(s=Kn[t.charAt(i++)]),n+=l===64?Jt(e>>16&255):s===64?Jt(e>>16&255,e>>8&255):Jt(e>>16&255,e>>8&255,e&255);return n},Va=Jc?t=>atob(Fa(t)):ns?t=>Buffer.from(t,"base64").toString("binary"):lf,sf=ns?t=>eo(Buffer.from(t,"base64")):t=>eo(Va(t).split("").map(e=>e.charCodeAt(0))),of=ns?t=>Buffer.from(t,"base64").toString("utf8"):xi?t=>xi.decode(sf(t)):t=>nf(Va(t)),af=t=>Fa(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),rf=t=>of(af(t));function uf(){const e=new URLSearchParams(window.location.search).get("obrref");let n="",l="";if(e){const i=rf(e).split(" ");i.length===2&&(n=i[0],l=i[1])}return{origin:n,roomId:l}}var to;(function(t){t[t.MOVE=0]="MOVE",t[t.LINE=1]="LINE",t[t.QUAD=2]="QUAD",t[t.CONIC=3]="CONIC",t[t.CUBIC=4]="CUBIC",t[t.CLOSE=5]="CLOSE"})(to||(to={}));const Nl=uf(),xe=new gc(Nl.origin,Nl.roomId),cf=new lc(xe),ff=new nc(xe),df=new Fc(xe),pf=new vc(xe),_f=new Nc(xe),mf=new Ic(xe),hf=new Lc(xe),gf=new Pc(xe),vf=new Hc(xe),bf=new Gc(xe),yf=new qc(xe),wf=new Vc(xe),Tf=new zc(xe),Ef=new Yc(xe),Af=new Xc(xe),je={onReady:t=>{xe.ready?t():xe.once("OBR_READY",()=>t())},get isReady(){return xe.ready},viewport:cf,player:ff,party:df,notification:pf,scene:_f,contextMenu:mf,tool:hf,popover:gf,modal:vf,action:bf,interaction:yf,room:wf,theme:Tf,assets:Ef,broadcast:Af,isAvailable:!!Nl.origin},kf=50,ls=ct([]);function Bf(t){ls.update(e=>(e.push({msg:t,timestamp:new Date}),e.length>kf&&e.shift(),e))}function Cf(){ls.set([])}const ol=8,_t=ct(1),Il=ct(!1),no=Fl(ja,2e3,()=>Il.set(!0),()=>Il.set(!1));async function Of(){for(let t=0;t<ol;t++)await Ct.removeItem(fl(t+1))}async function Sf(){_t.subscribe(t=>no(We(ye),t)),ye.subscribe(t=>no(t,We(_t))),_t.subscribe(async t=>{ye.set(await Ka(t))}),_t.set(await za()),_t.subscribe(Ya)}async function ja(t,e){Ct.setItem(fl(e),JSON.stringify(t))}function fl(t){return`sd-character-sheet-slot-${t}`}async function za(){return parseInt(await Ct.getItem("sd-character-sheet-chosen-slot")??"1")}async function Ya(t){Ct.setItem("sd-character-sheet-chosen-slot",`${t}`)}async function Ka(t){await Mf(t);const e=await Ct.getItem(fl(t));return e?JSON.parse(e):Ht()}async function Mf(t){const e="sd-character-sheet",n=await Ct.getItem(e);n&&(await Ct.setItem(fl(t),n),await Ct.removeItem(e))}const Ct={setItem:async function(t,e){return Promise.resolve().then(function(){window.localStorage.setItem(t,e)})},getItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.getItem(t)})},removeItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.removeItem(t)})}},Rf="com.maxpaulus.sd-character-sheet",Bn=ct({}),Tn=ct({});function bn(t){return`${Rf}/${t}`}const Gt=ct(!1),Sn=ct([]),kt=ct(),Hn=ct(),ss=ct(),mn=br(kt,t=>t==We(Hn));async function Xa(){je.onReady(async()=>{Gt.set(await je.player.getRole()==="GM"),$f(),We(Gt)&&Df(),lo()})}function $f(){je.broadcast.onMessage(Za,({data:t})=>{typeof t=="string"&&Pl(t)})}async function Df(){Hn.set(je.player.id),kt.set(je.player.id),je.player.onChange(t=>{ss.set(t)}),je.party.onChange(t=>{Sn.set(t)}),Sn.subscribe(async t=>{const e={};e[je.player.id]=(await je.player.getMetadata())[bn("sheetData")];for(const l of t)e[l.id]=l.metadata[bn("sheetData")];Bn.set(e);const n=We(kt);t.find(l=>l.id===n)||kt.set(je.player.id)}),Bn.subscribe(t=>{var l;const e=We(_t),n=We(kt);ye.set(((l=t[n])==null?void 0:l[`slot-${e}`])??Ht())}),_t.subscribe(t=>{var l;const e=We(Bn),n=We(kt);ye.set(((l=e[n])==null?void 0:l[`slot-${t}`])??Ht())}),kt.subscribe(t=>{var l;const e=We(Bn),n=We(_t);ye.set(((l=e[t])==null?void 0:l[`slot-${n}`])??Ht())}),Sn.set(await je.party.getPlayers())}async function lo(){_t.set(await za());const t={};for(let e=1;e<=ol;e++)t[`slot-${e}`]=await Ka(e)??Ht();Tn.set(t),ye.subscribe(Fl(e=>{if(We(Gt)&&!We(mn))return;const n=We(Tn),l=We(_t);ja(e,l),n[`slot-${l}`]=e,Tn.set(n)},1e3)),_t.subscribe(e=>{if(We(Gt)&&!We(mn))return;Ya(e);const n=We(Tn);ye.set(n[`slot-${e}`])}),Tn.subscribe(e=>{if(We(Gt)){if(!We(mn))return;const n=We(Bn),l=We(Hn);n[l]=e}je.player.setMetadata({[bn("sheetData")]:e})})}const Nf=Object.freeze(Object.defineProperty({__proto__:null,GmId:Hn,GmPlayer:ss,PartyStore:Sn,TrackedPlayer:kt,init:Xa,isGM:Gt,isTrackedPlayerGM:mn,pluginId:bn},Symbol.toStringTag,{value:"Module"})),Ja="sd-character-sheet-local-settings";function Ll(){return{popoverDuration:5}}const hn=ct(Ll());async function If(){hn.set(await Lf()),hn.subscribe(t=>{if(t.popoverDuration<0){hn.set({...t,popoverDuration:0});return}Ct.setItem(Ja,JSON.stringify(t))})}async function Lf(){try{const t=await Ct.getItem(Ja);return JSON.parse(t)??Ll()}catch{return console.error("couldn't load settings from local storage"),Ll()}}const Za=bn("notification");async function Xn(t,e={}){if(!je.isAvailable){alert(t);return}const l=`${await je.player.getName()}: ${t}`;e.secret?Pl(`Secret: ${l}`):(je.broadcast.sendMessage(Za,l),Pl(l))}let Jn;async function Pl(t){Bf(t);const e=bn("popover");Jn&&(clearTimeout(Jn),Jn=null);try{await je.popover.open({id:e,url:`/popover.html?msg=${encodeURIComponent(t)}`,height:100,width:400}),Jn=setTimeout(()=>{je.popover.close(e)},(We(hn).popoverDuration??5)*1e3)}catch{alert(t)}}function Pf(t){let e,n=Nn(t[0])+"",l;return{c(){e=_("div"),l=G(n),p(e,"class","rounded-md bg-black text-white p-1")},m(s,i){w(s,e,i),f(e,l)},p(s,i){i&1&&n!==(n=Nn(s[0])+"")&&ee(l,n)},d(s){s&&T(e)}}}function so(t){let e,n;const l=[t[3]];let s={$$slots:{default:[qf]},$$scope:{ctx:t}};for(let i=0;i<l.length;i+=1)s=el(s,l[i]);return e=new Zu({props:s}),e.$on("click",t[11]),e.$on("clickoutside",t[11]),{c(){ne(e.$$.fragment)},m(i,o){le(e,i,o),n=!0},p(i,o){const r=o&8?ga(l,[pr(i[3])]):{};o&32768&&(r.$$scope={dirty:o,ctx:i}),e.$set(r)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){W(e.$$.fragment,i),n=!1},d(i){se(e,i)}}}function Hf(t){let e;return{c(){e=_("div"),e.textContent="秘密擲骰",p(e,"class","text-black")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Gf(t){let e;return{c(){e=_("div"),e.textContent="優勢擲骰",p(e,"class","text-green-700")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Wf(t){let e;return{c(){e=_("div"),e.textContent="劣勢擲骰",p(e,"class","text-red-700")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function qf(t){let e,n,l,s,i,o,r,u;return e=new Vn({props:{text:"擲骰"}}),e.$on("click",t[6]),l=new Vn({props:{$$slots:{default:[Hf]},$$scope:{ctx:t}}}),l.$on("click",t[9]),i=new Vn({props:{$$slots:{default:[Gf]},$$scope:{ctx:t}}}),i.$on("click",t[7]),r=new Vn({props:{$$slots:{default:[Wf]},$$scope:{ctx:t}}}),r.$on("click",t[8]),{c(){ne(e.$$.fragment),n=y(),ne(l.$$.fragment),s=y(),ne(i.$$.fragment),o=y(),ne(r.$$.fragment)},m(c,a){le(e,c,a),w(c,n,a),le(l,c,a),w(c,s,a),le(i,c,a),w(c,o,a),le(r,c,a),u=!0},p(c,a){const d={};a&32768&&(d.$$scope={dirty:a,ctx:c}),l.$set(d);const m={};a&32768&&(m.$$scope={dirty:a,ctx:c}),i.$set(m);const v={};a&32768&&(v.$$scope={dirty:a,ctx:c}),r.$set(v)},i(c){u||(P(e.$$.fragment,c),P(l.$$.fragment,c),P(i.$$.fragment,c),P(r.$$.fragment,c),u=!0)},o(c){W(e.$$.fragment,c),W(l.$$.fragment,c),W(i.$$.fragment,c),W(r.$$.fragment,c),u=!1},d(c){se(e,c),c&&T(n),se(l,c),c&&T(s),se(i,c),c&&T(o),se(r,c)}}}function Uf(t){let e,n,l,s,i,o;const r=t[14].default,u=Mn(r,t,t[15],null),c=u||Pf(t);let a=t[2]&&so(t);return{c(){e=_("div"),n=_("button"),c&&c.c(),l=y(),a&&a.c(),n.disabled=t[1],p(n,"class","bg-black text-white pt-1 px-1 rounded-md"),$e(n,"opacity-50",t[1]),$e(n,"cursor-not-allowed",t[1])},m(d,m){w(d,e,m),f(e,n),c&&c.m(n,null),f(e,l),a&&a.m(e,null),s=!0,i||(o=[I(n,"click",t[6]),I(n,"contextmenu",dr(t[10])),I(n,"touchstart",t[4]),I(n,"touchend",t[5],{passive:!0})],i=!0)},p(d,[m]){u?u.p&&(!s||m&32768)&&Rn(u,r,d,d[15],s?Dn(r,d[15],m,null):$n(d[15]),null):c&&c.p&&(!s||m&1)&&c.p(d,s?m:-1),(!s||m&2)&&(n.disabled=d[1]),(!s||m&2)&&$e(n,"opacity-50",d[1]),(!s||m&2)&&$e(n,"cursor-not-allowed",d[1]),d[2]?a?(a.p(d,m),m&4&&P(a,1)):(a=so(d),a.c(),P(a,1),a.m(e,null)):a&&(qe(),W(a,1,1,()=>{a=null}),Ue())},i(d){s||(P(c,d),P(a),s=!0)},o(d){W(c,d),W(a),s=!1},d(d){d&&T(e),c&&c.d(d),a&&a.d(),i=!1,Fe(o)}}}function Ff(t,e,n){let{$$slots:l={},$$scope:s}=e,{modifier:i=0}=e,{numDice:o=1}=e,{diceType:r="d20"}=e,{disabled:u=!1}=e,c=!1,a={x:0,y:0},d;function m(B){d=setTimeout(()=>{E(B),d=null},500)}function v(){d&&(clearTimeout(d),d=null)}function g(){const B=Lt(r,o),M=`擲出 ${o}${r}: ${B} + ${i} = ${B+i}`;Xn(M)}function h(){const B=Lt(r,o),S=Lt(r,o),M=Math.max(B,S),R=`擲出 ${o}${r}: ${B} 與 ${S};
 ${M} + ${i} = ${M+i}`;Xn(R)}function b(){const B=Lt(r,o),S=Lt(r,o),M=Math.min(B,S),R=`擲出 ${o}${r}: ${B} 與 ${S};
 ${M} + ${i} = ${M+i}`;Xn(R)}function A(){const B=Lt(r,o),M=`擲出 ${o}${r}: ${B} + ${i} = ${B+i}`;Xn(M,{secret:!0})}async function E(B){u||(c&&(n(2,c=!1),await new Promise(S=>setTimeout(S,100))),n(3,a={x:B.clientX,y:B.clientY}),n(2,c=!0))}function k(){n(2,c=!1)}return t.$$set=B=>{"modifier"in B&&n(0,i=B.modifier),"numDice"in B&&n(12,o=B.numDice),"diceType"in B&&n(13,r=B.diceType),"disabled"in B&&n(1,u=B.disabled),"$$scope"in B&&n(15,s=B.$$scope)},[i,u,c,a,m,v,g,h,b,A,E,k,o,r,l,s]}class Gn extends Ce{constructor(e){super(),Oe(this,e,Ff,Uf,Be,{modifier:0,numDice:12,diceType:13,disabled:1})}}function io(t){let e,n,l;return{c(){e=_("button"),e.innerHTML='<i class="material-icons bg-gray-500 text-white rounded-full text-md p-1 scale-[60%]">close</i>',p(e,"class","absolute right-0")},m(s,i){w(s,e,i),n||(l=I(e,"click",t[3]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function Vf(t){let e,n,l,s,i,o=[{type:"text"},t[1]],r={};for(let c=0;c<o.length;c+=1)r=el(r,o[c]);let u=t[0]&&io(t);return{c(){e=_("div"),n=_("input"),l=y(),u&&u.c(),ws(n,r),$e(n,"svelte-hnbmdk",!0),p(e,"class","relative")},m(c,a){w(c,e,a),f(e,n),n.autofocus&&n.focus(),oe(n,t[0]),f(e,l),u&&u.m(e,null),s||(i=I(n,"input",t[2]),s=!0)},p(c,[a]){ws(n,r=ga(o,[{type:"text"},a&2&&c[1]])),a&1&&n.value!==c[0]&&oe(n,c[0]),$e(n,"svelte-hnbmdk",!0),c[0]?u?u.p(c,a):(u=io(c),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i:V,o:V,d(c){c&&T(e),u&&u.d(),s=!1,i()}}}function jf(t,e,n){const l=["value"];let s=Ts(e,l),{value:i}=e;function o(){i=this.value,n(0,i)}const r=()=>{n(0,i="")};return t.$$set=u=>{e=el(el({},e),_r(u)),n(1,s=Ts(e,l)),"value"in u&&n(0,i=u.value)},[i,s,o,r]}class Qa extends Ce{constructor(e){super(),Oe(this,e,jf,Vf,Be,{value:0})}}function oo(t){let e;return{c(){e=G("(儀式)")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function ao(t){let e,n=t[0].stat+"",l;return{c(){e=G("/ "),l=G(n)},m(s,i){w(s,e,i),w(s,l,i)},p(s,i){i&1&&n!==(n=s[0].stat+"")&&ee(l,n)},d(s){s&&T(e),s&&T(l)}}}function ro(t){let e,n,l,s,i=[t[0].components.verbal?"V":null,t[0].components.somatic?"S":null,t[0].components.material?`M (${t[0].components.materialDesc??""})`:null].filter(Boolean).join(", ")+"",o;return{c(){e=_("div"),n=_("span"),n.textContent="構材 (Components)",l=y(),s=_("span"),o=G(i),p(n,"class","font-bold block text-xs text-gray-500"),p(e,"class","col-span-2")},m(r,u){w(r,e,u),f(e,n),f(e,l),f(e,s),f(s,o)},p(r,u){u&1&&i!==(i=[r[0].components.verbal?"V":null,r[0].components.somatic?"S":null,r[0].components.material?`M (${r[0].components.materialDesc??""})`:null].filter(Boolean).join(", ")+"")&&ee(o,i)},d(r){r&&T(e)}}}function zf(t){let e;return{c(){e=_("button"),e.textContent="無法學習",p(e,"class","bg-gray-400 text-white w-full p-2 rounded cursor-not-allowed"),e.disabled=!0},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Yf(t){let e,n,l;return{c(){e=_("button"),e.textContent="學習",p(e,"class","bg-blue-800 text-white w-full p-2 rounded shadow hover:bg-blue-900 transition-colors font-bold")},m(s,i){w(s,e,i),n||(l=I(e,"click",t[9]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function Kf(t){let e,n,l;return{c(){e=_("button"),e.textContent="遺忘",p(e,"class","bg-red-800 text-white w-full p-2 rounded shadow hover:bg-red-900 transition-colors font-bold")},m(s,i){w(s,e,i),n||(l=I(e,"click",t[8]),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function uo(t){let e,n,l,s,i;return{c(){e=_("button"),e.innerHTML='<i class="material-icons text-sm">delete</i>',n=y(),l=_("button"),l.innerHTML='<i class="material-icons text-sm">edit</i>',p(e,"class","bg-gray-800 text-white p-2 rounded hover:bg-black"),p(l,"class","bg-gray-800 text-white p-2 rounded hover:bg-black")},m(o,r){w(o,e,r),w(o,n,r),w(o,l,r),s||(i=[I(e,"click",t[10]),I(l,"click",t[11])],s=!0)},p:V,d(o){o&&T(e),o&&T(n),o&&T(l),s=!1,Fe(i)}}}function co(t){let e,n,l;function s(o){t[13](o)}let i={$$slots:{header:[Jf],default:[Xf]},$$scope:{ctx:t}};return t[1]!==void 0&&(i.showModal=t[1]),e=new ft({props:i}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(o,r){le(e,o,r),l=!0},p(o,r){const u={};r&65539&&(u.$$scope={dirty:r,ctx:o}),!n&&r&2&&(n=!0,u.showModal=o[1],Ke(()=>n=!1)),e.$set(u)},i(o){l||(P(e.$$.fragment,o),l=!0)},o(o){W(e.$$.fragment,o),l=!1},d(o){se(e,o)}}}function Xf(t){let e,n;return e=new Ra({props:{spellToEdit:t[0]}}),e.$on("finish",t[12]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const i={};s&1&&(i.spellToEdit=l[0]),e.$set(i)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Jf(t){var i;let e,n,l=(((i=t[0].l10n)==null?void 0:i.name)??t[0].name)+"",s;return{c(){e=_("h2"),n=G("編輯法術: "),s=G(l),p(e,"slot","header")},m(o,r){w(o,e,r),f(e,n),f(e,s)},p(o,r){var u;r&1&&l!==(l=(((u=o[0].l10n)==null?void 0:u.name)??o[0].name)+"")&&ee(s,l)},d(o){o&&T(e)}}}function Zf(t){var Ae,Ie;let e,n,l,s,i=(((Ae=t[0].l10n)==null?void 0:Ae.name)??t[0].name)+"",o,r,u,c=t[0].tier===0?"戲法":`${t[0].tier} 環`,a,d,m,v,g=(Cl(t[0].class)??t[0].class)+"",h,b,A,E,k,B,S,M,N,R,C,O,$,D,F=t[7](t[0].range)+"",U,Z,ve,re,de=(((Ie=t[0].l10n)==null?void 0:Ie.desc)??t[0].desc)+"",ae,j,q,K,we,Y,pe,be,X,H=t[0].ritual&&oo(),J=t[0].stat&&ao(t),he=t[0].components&&ro(t);function _e(x,fe){return fe&9&&(K=null),fe&9&&(we=null),K==null&&(K=!!Ma(x[3],x[0])),K?Kf:(we==null&&(we=!!Ur(x[3],x[0])),we?Yf:zf)}let ue=_e(t,-1),ce=ue(t),z=t[0].editable&&uo(t),te=t[1]&&co(t);return{c(){e=_("div"),n=_("div"),l=_("div"),s=_("span"),o=G(i),r=y(),u=_("span"),a=G(c),d=y(),H&&H.c(),m=y(),v=_("div"),h=G(g),b=y(),J&&J.c(),A=y(),E=_("div"),k=_("div"),B=_("span"),B.textContent="持續時間",S=y(),M=_("span"),N=G(t[2]),R=y(),C=_("div"),O=_("span"),O.textContent="施法距離",$=y(),D=_("span"),U=G(F),Z=y(),he&&he.c(),ve=y(),re=_("div"),ae=G(de),j=y(),q=_("div"),ce.c(),Y=y(),z&&z.c(),pe=y(),te&&te.c(),be=vt(),p(s,"class","font-bold text-lg text-purple-900"),p(u,"class","text-sm font-bold text-gray-600"),p(l,"class","flex justify-between items-baseline"),p(v,"class","text-xs text-gray-500 italic"),p(n,"class","flex flex-col border-b pb-2 mb-2"),p(B,"class","font-bold block text-xs text-gray-500"),p(O,"class","font-bold block text-xs text-gray-500"),p(E,"class","grid grid-cols-2 gap-2 text-sm mb-3"),p(re,"class","text-sm leading-relaxed text-gray-800 border-t pt-2 mb-3"),p(q,"class","flex gap-2"),p(e,"class","shadow-md border border-gray-200 mb-3 p-3 rounded-md bg-white")},m(x,fe){w(x,e,fe),f(e,n),f(n,l),f(l,s),f(s,o),f(l,r),f(l,u),f(u,a),f(u,d),H&&H.m(u,null),f(n,m),f(n,v),f(v,h),f(v,b),J&&J.m(v,null),f(e,A),f(e,E),f(E,k),f(k,B),f(k,S),f(k,M),f(M,N),f(E,R),f(E,C),f(C,O),f(C,$),f(C,D),f(D,U),f(E,Z),he&&he.m(E,null),f(e,ve),f(e,re),f(re,ae),f(e,j),f(e,q),ce.m(q,null),f(q,Y),z&&z.m(q,null),w(x,pe,fe),te&&te.m(x,fe),w(x,be,fe),X=!0},p(x,[fe]){var Se,L;(!X||fe&1)&&i!==(i=(((Se=x[0].l10n)==null?void 0:Se.name)??x[0].name)+"")&&ee(o,i),(!X||fe&1)&&c!==(c=x[0].tier===0?"戲法":`${x[0].tier} 環`)&&ee(a,c),x[0].ritual?H||(H=oo(),H.c(),H.m(u,null)):H&&(H.d(1),H=null),(!X||fe&1)&&g!==(g=(Cl(x[0].class)??x[0].class)+"")&&ee(h,g),x[0].stat?J?J.p(x,fe):(J=ao(x),J.c(),J.m(v,null)):J&&(J.d(1),J=null),(!X||fe&4)&&ee(N,x[2]),(!X||fe&1)&&F!==(F=x[7](x[0].range)+"")&&ee(U,F),x[0].components?he?he.p(x,fe):(he=ro(x),he.c(),he.m(E,null)):he&&(he.d(1),he=null),(!X||fe&1)&&de!==(de=(((L=x[0].l10n)==null?void 0:L.desc)??x[0].desc)+"")&&ee(ae,de),ue===(ue=_e(x,fe))&&ce?ce.p(x,fe):(ce.d(1),ce=ue(x),ce&&(ce.c(),ce.m(q,Y))),x[0].editable?z?z.p(x,fe):(z=uo(x),z.c(),z.m(q,null)):z&&(z.d(1),z=null),x[1]?te?(te.p(x,fe),fe&2&&P(te,1)):(te=co(x),te.c(),P(te,1),te.m(be.parentNode,be)):te&&(qe(),W(te,1,1,()=>{te=null}),Ue())},i(x){X||(P(te),X=!0)},o(x){W(te),X=!1},d(x){x&&T(e),H&&H.d(),J&&J.d(),he&&he.d(),ce.d(),z&&z.d(),x&&T(pe),te&&te.d(x),x&&T(be)}}}function Qf(t,e,n){let l,s;Re(t,De,k=>n(3,s=k));let{s:i}=e,o=yn(),r=!1;const u={Self:"自身",Touch:"觸碰",Sight:"視線"};function c(k){Fr(s,k),De.set(s)}function a(k){Vr(s,k),De.set(s),o("close")}function d(k){zr(s,k),De.set(s),o("close")}function m(k){return u[k]??k}const v=()=>a(i),g=()=>c(i),h=()=>d(i),b=()=>{n(1,r=!0)},A=()=>{n(1,r=!1),n(0,i)};function E(k){r=k,n(1,r)}return t.$$set=k=>{"s"in k&&n(0,i=k.s)},t.$$.update=()=>{t.$$.dirty&1&&n(2,l=i.duration)},[i,r,l,s,c,a,d,m,v,g,h,b,A,E]}class xa extends Ce{constructor(e){super(),Oe(this,e,Qf,Zf,Be,{s:0})}}function fo(t,e,n){const l=t.slice();return l[14]=e[n],l}function po(t,e,n){const l=t.slice();return l[17]=e[n],l}function xf(t,e,n){const l=t.slice();return l[20]=e[n],l[22]=n,l}function ed(t,e,n){const l=t.slice();return l[20]=e[n],l[22]=n,l}function _o(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h,b,A,E=Array(10),k=[];for(let R=0;R<E.length;R+=1)k[R]=td(ed(t,E,R));let B=Array(10),S=[];for(let R=0;R<B.length;R+=1)S[R]=nd(xf(t,B,R));let M=qt,N=[];for(let R=0;R<M.length;R+=1)N[R]=mo(po(t,M,R));return{c(){e=_("div"),n=_("div"),l=_("label"),l.textContent="環階:",s=y(),i=_("select");for(let R=0;R<k.length;R+=1)k[R].c();o=y(),r=_("span"),r.textContent="-",u=y(),c=_("select");for(let R=0;R<S.length;R+=1)S[R].c();a=y(),d=_("div"),m=_("label"),m.textContent="職業:",v=y(),g=_("select"),h=_("option"),h.textContent="全部";for(let R=0;R<N.length;R+=1)N[R].c();p(l,"for","minTier"),p(l,"class","font-bold"),p(i,"id","minTier"),p(i,"class","border rounded"),t[1]===void 0&&Pe(()=>t[11].call(i)),p(c,"id","maxTier"),p(c,"class","border rounded"),t[2]===void 0&&Pe(()=>t[12].call(c)),p(n,"class","flex gap-2 items-center"),p(m,"for","classFilter"),p(m,"class","font-bold"),h.__value="All",h.value=h.__value,p(g,"id","classFilter"),p(g,"class","border rounded max-w-[200px]"),t[3]===void 0&&Pe(()=>t[13].call(g)),p(d,"class","flex gap-2 items-center"),p(e,"class","flex flex-col gap-2 bg-gray-50 p-2 rounded text-sm")},m(R,C){w(R,e,C),f(e,n),f(n,l),f(n,s),f(n,i);for(let O=0;O<k.length;O+=1)k[O]&&k[O].m(i,null);me(i,t[1],!0),f(n,o),f(n,r),f(n,u),f(n,c);for(let O=0;O<S.length;O+=1)S[O]&&S[O].m(c,null);me(c,t[2],!0),f(e,a),f(e,d),f(d,m),f(d,v),f(d,g),f(g,h);for(let O=0;O<N.length;O+=1)N[O]&&N[O].m(g,null);me(g,t[3],!0),b||(A=[I(i,"change",t[11]),I(c,"change",t[12]),I(g,"change",t[13])],b=!0)},p(R,C){if(C&2&&me(i,R[1]),C&4&&me(c,R[2]),C&0){M=qt;let O;for(O=0;O<M.length;O+=1){const $=po(R,M,O);N[O]?N[O].p($,C):(N[O]=mo($),N[O].c(),N[O].m(g,null))}for(;O<N.length;O+=1)N[O].d(1);N.length=M.length}C&8&&me(g,R[3])},d(R){R&&T(e),ke(k,R),ke(S,R),ke(N,R),b=!1,Fe(A)}}}function td(t){let e,n;return{c(){e=_("option"),n=G(t[22]),e.__value=t[22],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:V,d(l){l&&T(e)}}}function nd(t){let e,n;return{c(){e=_("option"),n=G(t[22]),e.__value=t[22],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:V,d(l){l&&T(e)}}}function mo(t){let e,n=t[17]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[17],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function ld(t){let e=[],n=new Map,l,s,i=t[6];const o=r=>r[14].name;for(let r=0;r<i.length;r+=1){let u=fo(t,i,r),c=o(u);n.set(c,e[r]=ho(c,u))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();l=vt()},m(r,u){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(r,u);w(r,l,u),s=!0},p(r,u){u&64&&(i=r[6],qe(),e=mr(e,u,o,1,r,i,n,l.parentNode,hr,ho,l,fo),Ue())},i(r){if(!s){for(let u=0;u<i.length;u+=1)P(e[u]);s=!0}},o(r){for(let u=0;u<e.length;u+=1)W(e[u]);s=!1},d(r){for(let u=0;u<e.length;u+=1)e[u].d(r);r&&T(l)}}}function sd(t){let e;return{c(){e=_("div"),e.textContent="沒有符合的法術",p(e,"class","text-center text-gray-500 mt-10")},m(n,l){w(n,e,l)},p:V,i:V,o:V,d(n){n&&T(e)}}}function ho(t,e){let n,l,s,i;return l=new xa({props:{s:e[14]}}),{key:t,first:null,c(){n=_("div"),ne(l.$$.fragment),s=y(),p(n,"class","mb-4 break-inside-avoid"),this.first=n},m(o,r){w(o,n,r),le(l,n,null),f(n,s),i=!0},p(o,r){e=o;const u={};r&64&&(u.s=e[14]),l.$set(u)},i(o){i||(P(l.$$.fragment,o),i=!0)},o(o){W(l.$$.fragment,o),i=!1},d(o){o&&T(n),se(l)}}}function id(t){let e,n,l,s,i,o,r,u=t[5]?"隱藏過濾":"顯示過濾",c,a,d,m,v,g,h,b,A,E,k,B,S;function M(D){t[8](D)}let N={placeholder:"搜尋法術...",class:"w-full mb-2"};t[0]!==void 0&&(N.value=t[0]),l=new Qa({props:N}),Ve.push(()=>Ye(l,"value",M));let R=t[5]&&_o(t);const C=[sd,ld],O=[];function $(D,F){return D[6].length===0?0:1}return A=$(t),E=O[A]=C[A](t),{c(){e=_("div"),n=_("div"),ne(l.$$.fragment),i=y(),o=_("div"),r=_("button"),c=G(u),a=y(),d=_("label"),m=_("input"),v=G(" 只顯示自訂"),g=y(),R&&R.c(),h=y(),b=_("div"),E.c(),p(r,"class","text-blue-700 underline text-xs"),p(m,"type","checkbox"),p(m,"class","svelte-1ep1fgl"),p(d,"class","flex gap-1 items-center ml-auto"),p(o,"class","flex gap-2 items-center text-sm mb-2 flex-wrap"),p(n,"class","sticky top-0 bg-white p-2 border-b z-10"),p(b,"class","overflow-y-auto p-2 flex-1"),p(e,"class","flex flex-col gap-1 h-full overflow-hidden")},m(D,F){w(D,e,F),f(e,n),le(l,n,null),f(n,i),f(n,o),f(o,r),f(r,c),f(o,a),f(o,d),f(d,m),m.checked=t[4],f(d,v),f(n,g),R&&R.m(n,null),f(e,h),f(e,b),O[A].m(b,null),k=!0,B||(S=[I(r,"click",t[9]),I(m,"change",t[10])],B=!0)},p(D,[F]){const U={};!s&&F&1&&(s=!0,U.value=D[0],Ke(()=>s=!1)),l.$set(U),(!k||F&32)&&u!==(u=D[5]?"隱藏過濾":"顯示過濾")&&ee(c,u),F&16&&(m.checked=D[4]),D[5]?R?R.p(D,F):(R=_o(D),R.c(),R.m(n,null)):R&&(R.d(1),R=null);let Z=A;A=$(D),A===Z?O[A].p(D,F):(qe(),W(O[Z],1,1,()=>{O[Z]=null}),Ue(),E=O[A],E?E.p(D,F):(E=O[A]=C[A](D),E.c()),P(E,1),E.m(b,null))},i(D){k||(P(l.$$.fragment,D),P(E),k=!0)},o(D){W(l.$$.fragment,D),W(E),k=!1},d(D){D&&T(e),se(l),R&&R.d(),O[A].d(),B=!1,Fe(S)}}}function od(t,e,n){let l,s;Re(t,De,A=>n(7,s=A));let i="",o=!0,r=0,u=9,c="All",a=!1;function d(A){i=A,n(0,i)}const m=()=>n(5,o=!o);function v(){a=this.checked,n(4,a)}function g(){r=Ge(this),n(1,r)}function h(){u=Ge(this),n(2,u)}function b(){c=Ge(this),n(3,c)}return t.$$.update=()=>{t.$$.dirty&159&&n(6,l=Object.values(Wl).concat(s.customSpells??[]).filter(A=>{var k,B;if(A.tier<r||A.tier>u||c!=="All"&&A.class!==c||a&&!s.customSpells.find(S=>S.name===A.name))return!1;const E=i.toLowerCase();return E?A.name.toLowerCase().includes(E)||A.desc.toLowerCase().includes(E)||(((B=(k=A.l10n)==null?void 0:k.name)==null?void 0:B.toLowerCase().includes(E))??!1):!0}).sort((A,E)=>A.tier!==E.tier?A.tier-E.tier:A.name.localeCompare(E.name)))},[i,r,u,c,a,o,l,s,d,m,v,g,h,b]}class ad extends Ce{constructor(e){super(),Oe(this,e,od,id,Be,{})}}function rd(t){let e,n;return e=new ad({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function ud(t){let e;return{c(){e=_("h1"),e.textContent="法術",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function cd(t){let e,n,l,s,i,o,r;function u(a){t[2](a)}let c={vh:90,$$slots:{header:[ud],default:[rd]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.textContent="法術",n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white p-2 w-full")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),i=!0,o||(r=I(e,"click",t[1]),o=!0)},p(a,[d]){const m={};d&8&&(m.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,m.showModal=a[0],Ke(()=>s=!1)),l.$set(m)},i(a){i||(P(l.$$.fragment,a),i=!0)},o(a){W(l.$$.fragment,a),i=!1},d(a){a&&T(e),a&&T(n),se(l,a),o=!1,r()}}}function fd(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function i(o){l=o,n(0,l)}return[l,s,i]}class dd extends Ce{constructor(e){super(),Oe(this,e,fd,cd,Be,{})}}function pd(t){let e,n;return e=new xa({props:{s:t[0]}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const i={};s&1&&(i.s=l[0]),e.$set(i)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function _d(t){let e,n=t[0].name+"",l;return{c(){e=_("h2"),l=G(n),p(e,"slot","header")},m(s,i){w(s,e,i),f(e,l)},p(s,i){i&1&&n!==(n=s[0].name+"")&&ee(l,n)},d(s){s&&T(e)}}}function md(t){let e,n,l,s,i,o,r;function u(a){t[4](a)}let c={$$slots:{header:[_d],default:[pd]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons">info</i>',n=y(),ne(l.$$.fragment)},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),i=!0,o||(r=I(e,"click",t[2]),o=!0)},p(a,[d]){const m={};d&35&&(m.$$scope={dirty:d,ctx:a}),!s&&d&2&&(s=!0,m.showModal=a[1],Ke(()=>s=!1)),l.$set(m)},i(a){i||(P(l.$$.fragment,a),i=!0)},o(a){W(l.$$.fragment,a),i=!1},d(a){a&&T(e),a&&T(n),se(l,a),o=!1,r()}}}function hd(t,e,n){let{spell:l}=e,s=!1;const i=()=>{n(1,s=!0)},o=()=>{n(1,s=!1)};function r(u){s=u,n(1,s)}return t.$$set=u=>{"spell"in u&&n(0,l=u.spell)},[l,s,i,o,r]}class gd extends Ce{constructor(e){super(),Oe(this,e,hd,md,Be,{spell:0})}}const{Boolean:vd}=va;function go(t,e,n){const l=t.slice();return l[5]=e[n],l}function bd(t){let e;return{c(){e=_("div"),e.textContent="尚未學習法術",p(e,"class","text-gray-500 text-center py-4")},m(n,l){w(n,e,l)},p:V,i:V,o:V,d(n){n&&T(e)}}}function yd(t){let e,n,l=t[0],s=[];for(let o=0;o<l.length;o+=1)s[o]=vo(go(t,l,o));const i=o=>W(s[o],1,1,()=>{s[o]=null});return{c(){e=_("ul");for(let o=0;o<s.length;o+=1)s[o].c();p(e,"class","flex flex-col gap-1")},m(o,r){w(o,e,r);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);n=!0},p(o,r){if(r&5){l=o[0];let u;for(u=0;u<l.length;u+=1){const c=go(o,l,u);s[u]?(s[u].p(c,r),P(s[u],1)):(s[u]=vo(c),s[u].c(),P(s[u],1),s[u].m(e,null))}for(qe(),u=l.length;u<s.length;u+=1)i(u);Ue()}},i(o){if(!n){for(let r=0;r<l.length;r+=1)P(s[r]);n=!0}},o(o){s=s.filter(vd);for(let r=0;r<s.length;r+=1)W(s[r]);n=!1},d(o){o&&T(e),ke(s,o)}}}function wd(t){let e;return{c(){e=_("span"),e.textContent="攻擊",p(e,"class","font-bold px-1")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function vo(t){var S;let e,n,l,s,i,o,r,u=(((S=t[5].l10n)==null?void 0:S.name)??t[5].name)+"",c,a,d,m=t[5].tier===0?"戲法":`${t[5].tier} 環`,v,g,h,b,A,E,k,B;return s=new gd({props:{spell:t[5]}}),A=new Gn({props:{modifier:t[2],$$slots:{default:[wd]},$$scope:{ctx:t}}}),{c(){e=_("li"),n=_("div"),l=_("div"),ne(s.$$.fragment),i=y(),o=_("div"),r=_("span"),c=G(u),a=y(),d=_("span"),v=G(m),g=y(),h=_("div"),b=_("div"),ne(A.$$.fragment),k=y(),p(r,"class","font-bold"),p(d,"class","text-[10px] text-gray-500"),p(o,"class","flex flex-col"),p(l,"class","flex gap-2 items-center"),p(b,"title",E=`法術攻擊 (${t[2]>=0?"+":""}${t[2]})`),p(h,"class","flex items-center gap-2"),p(n,"class","flex justify-between border-b border-gray-300 items-center py-1")},m(M,N){w(M,e,N),f(e,n),f(n,l),le(s,l,null),f(l,i),f(l,o),f(o,r),f(r,c),f(o,a),f(o,d),f(d,v),f(n,g),f(n,h),f(h,b),le(A,b,null),f(e,k),B=!0},p(M,N){var O;const R={};N&1&&(R.spell=M[5]),s.$set(R),(!B||N&1)&&u!==(u=(((O=M[5].l10n)==null?void 0:O.name)??M[5].name)+"")&&ee(c,u),(!B||N&1)&&m!==(m=M[5].tier===0?"戲法":`${M[5].tier} 環`)&&ee(v,m);const C={};N&4&&(C.modifier=M[2]),N&256&&(C.$$scope={dirty:N,ctx:M}),A.$set(C),(!B||N&4&&E!==(E=`法術攻擊 (${M[2]>=0?"+":""}${M[2]})`))&&p(b,"title",E)},i(M){B||(P(s.$$.fragment,M),P(A.$$.fragment,M),B=!0)},o(M){W(s.$$.fragment,M),W(A.$$.fragment,M),B=!1},d(M){M&&T(e),se(s),se(A)}}}function Td(t){let e,n,l,s,i,o,r=t[2]>=0?"+":"",u,c,a,d,m,v,g,h,b,A,E,k,B,S,M,N,R;const C=[yd,bd],O=[];function $(D,F){return D[3]?0:1}return A=$(t),E=O[A]=C[A](t),S=new dd({}),N=new Ku({}),{c(){e=_("div"),n=_("div"),l=_("div"),s=_("span"),s.textContent="法術攻擊",i=y(),o=_("span"),u=G(r),c=G(t[2]),a=y(),d=_("div"),m=_("span"),m.textContent="法術 DC",v=y(),g=_("span"),h=G(t[1]),b=y(),E.c(),k=y(),B=_("div"),ne(S.$$.fragment),M=y(),ne(N.$$.fragment),p(s,"class","text-xs font-bold text-gray-500"),p(o,"class","text-xl font-bold"),p(l,"class","flex flex-col items-center"),p(m,"class","text-xs font-bold text-gray-500"),p(g,"class","text-xl font-bold"),p(d,"class","flex flex-col items-center"),p(n,"class","flex justify-between items-center bg-gray-100 p-2 rounded"),p(B,"class","flex gap-2 mt-2"),p(e,"class","flex flex-col gap-2")},m(D,F){w(D,e,F),f(e,n),f(n,l),f(l,s),f(l,i),f(l,o),f(o,u),f(o,c),f(n,a),f(n,d),f(d,m),f(d,v),f(d,g),f(g,h),f(e,b),O[A].m(e,null),f(e,k),f(e,B),le(S,B,null),f(B,M),le(N,B,null),R=!0},p(D,[F]){(!R||F&4)&&r!==(r=D[2]>=0?"+":"")&&ee(u,r),(!R||F&4)&&ee(c,D[2]),(!R||F&2)&&ee(h,D[1]);let U=A;A=$(D),A===U?O[A].p(D,F):(qe(),W(O[U],1,1,()=>{O[U]=null}),Ue(),E=O[A],E?E.p(D,F):(E=O[A]=C[A](D),E.c()),P(E,1),E.m(e,k))},i(D){R||(P(E),P(S.$$.fragment,D),P(N.$$.fragment,D),R=!0)},o(D){W(E),W(S.$$.fragment,D),W(N.$$.fragment,D),R=!1},d(D){D&&T(e),O[A].d(),se(S),se(N)}}}function Ed(t,e,n){let l,s,i,o,r;return Re(t,De,u=>n(4,r=u)),t.$$.update=()=>{t.$$.dirty&16&&n(0,l=r.spells.map(u=>Aa(u.name)).filter(Boolean)),t.$$.dirty&1&&n(3,s=(l==null?void 0:l.length)>0),t.$$.dirty&16&&n(2,i=Sa(r)),t.$$.dirty&16&&n(1,o=Pr(r))},[l,o,i,s,r]}class Ad extends Ce{constructor(e){super(),Oe(this,e,Ed,Td,Be,{})}}function kd(t){let e,n,l,s,i,o,r,u,c;return s=new Ad({}),o=new Gu({}),u=new lu({}),{c(){e=_("h2"),e.textContent="法術 / 加值 / 語言",n=y(),l=_("div"),ne(s.$$.fragment),i=y(),ne(o.$$.fragment),r=y(),ne(u.$$.fragment),p(l,"class","overflow-y-auto")},m(a,d){w(a,e,d),w(a,n,d),w(a,l,d),le(s,l,null),f(l,i),le(o,l,null),f(l,r),le(u,l,null),c=!0},p:V,i(a){c||(P(s.$$.fragment,a),P(o.$$.fragment,a),P(u.$$.fragment,a),c=!0)},o(a){W(s.$$.fragment,a),W(o.$$.fragment,a),W(u.$$.fragment,a),c=!1},d(a){a&&T(e),a&&T(n),a&&T(l),se(s),se(o),se(u)}}}class Bd extends Ce{constructor(e){super(),Oe(this,e,null,kd,Be,{})}}function Cd(t){let e,n,l,s=gn(t[0])+"",i,o,r,u,c,a,d,m,v,g;return d=new Gn({props:{modifier:t[2]}}),{c(){e=_("div"),n=_("label"),l=_("h2"),i=G(s),o=y(),r=_("div"),u=_("input"),a=G(" / "),ne(d.$$.fragment),p(u,"id",c=`${t[0]}-input}`),p(u,"type","number"),p(u,"inputmode","numeric"),u.value=t[1],p(u,"min","1"),p(u,"max","20"),p(u,"class","w-1/2"),p(r,"class","sheet-stat flex gap-1"),p(e,"class","flex flex-col")},m(h,b){w(h,e,b),f(e,n),f(n,l),f(l,i),f(n,o),f(n,r),f(r,u),f(r,a),le(d,r,null),m=!0,v||(g=I(u,"input",t[4]),v=!0)},p(h,[b]){(!m||b&1)&&s!==(s=gn(h[0])+"")&&ee(i,s),(!m||b&1&&c!==(c=`${h[0]}-input}`))&&p(u,"id",c),(!m||b&2&&u.value!==h[1])&&(u.value=h[1]);const A={};b&4&&(A.modifier=h[2]),d.$set(A)},i(h){m||(P(d.$$.fragment,h),m=!0)},o(h){W(d.$$.fragment,h),m=!1},d(h){h&&T(e),se(d),v=!1,g()}}}function Od(t,e,n){let l,s,i,o,{forStat:r}=e;const u=ye;Re(t,u,a=>n(5,o=a));function c(a){const d=parseInt(a.target.value)||10;ze(u,o.stats[r]=d-i,o)}return t.$$set=a=>{"forStat"in a&&n(0,r=a.forStat)},t.$$.update=()=>{t.$$.dirty&33&&n(2,l=Ut(o,r)),t.$$.dirty&33&&n(1,s=Vl(o,r)),t.$$.dirty&33&&(i=Oa(o,r))},[r,s,l,u,c,o]}class pn extends Ce{constructor(e){super(),Oe(this,e,Od,Cd,Be,{forStat:0})}}function bo(t,e,n){const l=t.slice();l[7]=e[n];const s=l[0].includes(l[7]);return l[8]=s,l}function yo(t){let e,n,l=(t[3][t[7]]??t[7])+"",s,i,o,r,u;function c(){return t[6](t[7])}return{c(){e=_("button"),n=_("div"),s=G(l),o=y(),p(n,"class",i=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)},m(a,d){w(a,e,d),f(e,n),f(n,s),f(e,o),r||(u=I(e,"click",c),r=!0)},p(a,d){t=a,d&12&&l!==(l=(t[3][t[7]]??t[7])+"")&&ee(s,l),d&5&&i!==(i=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)&&p(n,"class",i)},d(a){a&&T(e),r=!1,u()}}}function Sd(t){let e,n=t[2],l=[];for(let s=0;s<n.length;s+=1)l[s]=yo(bo(t,n,s));return{c(){e=_("div");for(let s=0;s<l.length;s+=1)l[s].c();p(e,"id",t[1]),p(e,"class","w-full flex flex-wrap gap-1")},m(s,i){w(s,e,i);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null)},p(s,[i]){if(i&29){n=s[2];let o;for(o=0;o<n.length;o+=1){const r=bo(s,n,o);l[o]?l[o].p(r,i):(l[o]=yo(r),l[o].c(),l[o].m(e,null))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}i&2&&p(e,"id",s[1])},i:V,o:V,d(s){s&&T(e),ke(l,s)}}}function Md(t,e,n){let{id:l="multiSelect"}=e,{values:s=[]}=e,{minSelected:i=0}=e,{options:o=[]}=e,{labels:r={}}=e;function u(a){const d=s.findIndex(m=>m===a);d>=0?s.length>i&&s.splice(d,1):s.push(a),n(0,s)}const c=a=>u(a);return t.$$set=a=>{"id"in a&&n(1,l=a.id),"values"in a&&n(0,s=a.values),"minSelected"in a&&n(5,i=a.minSelected),"options"in a&&n(2,o=a.options),"labels"in a&&n(3,r=a.labels)},[s,l,o,r,u,i,c]}class er extends Ce{constructor(e){super(),Oe(this,e,Md,Sd,Be,{id:1,values:0,minSelected:5,options:2,labels:3})}}function wo(t,e,n){const l=t.slice();return l[44]=e[n],l}function To(t,e,n){const l=t.slice();return l[36]=e[n],l}function Eo(t,e,n){const l=t.slice();return l[36]=e[n],l}function Ao(t,e,n){const l=t.slice();return l[41]=e[n],l}function Rd(t,e,n){const l=t.slice();return l[47]=e[n],l}function $d(t){let e,n;return{c(){e=_("option"),n=G(t[47]),e.__value=t[47],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:V,d(l){l&&T(e)}}}function ko(t){let e,n,l,s,i,o,r,u,c,a,d,m,v;const g=[Id,Nd,Dd],h=[];function b(A,E){return A[1].gearType==="Basic"?0:A[1].gearType==="Weapon"?1:A[1].gearType==="Armor"?2:-1}return~(c=b(t))&&(a=h[c]=g[c](t)),{c(){e=_("div"),n=_("label"),n.textContent="裝備類型",l=y(),s=_("select"),i=_("option"),i.textContent="基礎",o=_("option"),o.textContent="武器",r=_("option"),r.textContent="防具",u=y(),a&&a.c(),p(n,"for","gearType"),p(n,"class","font-bold"),i.__value="Basic",i.value=i.__value,o.__value="Weapon",o.value=o.__value,r.__value="Armor",r.value=r.__value,p(s,"name","gearType"),p(s,"class","border p-1 rounded"),t[1].gearType===void 0&&Pe(()=>t[14].call(s)),p(e,"class","flex flex-col gap-2 bg-gray-50 p-2 rounded border")},m(A,E){w(A,e,E),f(e,n),f(e,l),f(e,s),f(s,i),f(s,o),f(s,r),me(s,t[1].gearType,!0),f(e,u),~c&&h[c].m(e,null),d=!0,m||(v=I(s,"change",t[14]),m=!0)},p(A,E){E[0]&2&&me(s,A[1].gearType);let k=c;c=b(A),c===k?~c&&h[c].p(A,E):(a&&(qe(),W(h[k],1,1,()=>{h[k]=null}),Ue()),~c?(a=h[c],a?a.p(A,E):(a=h[c]=g[c](A),a.c()),P(a,1),a.m(e,null)):a=null)},i(A){d||(P(a),d=!0)},o(A){W(a),d=!1},d(A){A&&T(e),~c&&h[c].d(),m=!1,v()}}}function Dd(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h,b,A,E,k,B,S,M,N,R,C,O,$,D,F,U,Z,ve;function re(q){t[27](q)}let de={id:"armorProperties",options:Br,labels:t[6]};t[1].armorProperties!==void 0&&(de.values=t[1].armorProperties),l=new er({props:de}),Ve.push(()=>Ye(l,"values",re));let ae=Wt,j=[];for(let q=0;q<ae.length;q+=1)j[q]=Bo(wo(t,ae,q));return{c(){e=_("label"),e.textContent="防具特性",n=y(),ne(l.$$.fragment),i=y(),o=_("div"),r=_("div"),u=_("label"),u.textContent="基礎 AC",c=y(),a=_("input"),d=y(),m=_("div"),v=_("label"),v.textContent="AC 修正 (+1等)",g=y(),h=_("input"),b=y(),A=_("label"),A.textContent="AC 屬性加成 (通常無或 Dex)",E=y(),k=_("select"),B=_("option"),S=G("無");for(let q=0;q<j.length;q+=1)j[q].c();M=y(),N=_("label"),N.textContent="最大敏捷加值 (Max Dex)",R=y(),C=_("select"),O=_("option"),$=G("無限制 (輕甲)"),D=_("option"),D.textContent="+2 (中甲)",F=_("option"),F.textContent="0 (重甲)",p(e,"for","armorProperties"),p(e,"class","font-bold"),p(u,"for","baseAC"),p(a,"id","baseAC"),p(a,"type","number"),p(a,"class","border p-1 rounded"),p(a,"inputmode","numeric"),p(r,"class","flex flex-col w-1/2"),p(v,"for","acModifier"),p(h,"id","acModifier"),p(h,"type","number"),p(h,"class","border p-1 rounded"),p(h,"inputmode","numeric"),p(m,"class","flex flex-col w-1/2"),p(o,"class","flex gap-2"),p(A,"for","armorStat"),B.__value=void 0,B.value=B.__value,p(k,"id","armorStat"),p(k,"class","border p-1 rounded"),t[1].armorStat===void 0&&Pe(()=>t[30].call(k)),p(N,"for","maxDex"),O.__value=void 0,O.value=O.__value,D.__value=2,D.value=D.__value,F.__value=0,F.value=F.__value,p(C,"id","maxDex"),p(C,"class","border p-1 rounded"),t[1].maxDex===void 0&&Pe(()=>t[31].call(C))},m(q,K){w(q,e,K),w(q,n,K),le(l,q,K),w(q,i,K),w(q,o,K),f(o,r),f(r,u),f(r,c),f(r,a),oe(a,t[1].baseAC),f(o,d),f(o,m),f(m,v),f(m,g),f(m,h),oe(h,t[1].acModifier),w(q,b,K),w(q,A,K),w(q,E,K),w(q,k,K),f(k,B),f(B,S);for(let we=0;we<j.length;we+=1)j[we]&&j[we].m(k,null);me(k,t[1].armorStat,!0),w(q,M,K),w(q,N,K),w(q,R,K),w(q,C,K),f(C,O),f(O,$),f(C,D),f(C,F),me(C,t[1].maxDex,!0),U=!0,Z||(ve=[I(a,"input",t[28]),I(h,"input",t[29]),I(k,"change",t[30]),I(C,"change",t[31])],Z=!0)},p(q,K){const we={};if(!s&&K[0]&2&&(s=!0,we.values=q[1].armorProperties,Ke(()=>s=!1)),l.$set(we),K[0]&2&&Me(a.value)!==q[1].baseAC&&oe(a,q[1].baseAC),K[0]&2&&Me(h.value)!==q[1].acModifier&&oe(h,q[1].acModifier),K&0){ae=Wt;let Y;for(Y=0;Y<ae.length;Y+=1){const pe=wo(q,ae,Y);j[Y]?j[Y].p(pe,K):(j[Y]=Bo(pe),j[Y].c(),j[Y].m(k,null))}for(;Y<j.length;Y+=1)j[Y].d(1);j.length=ae.length}K[0]&2&&me(k,q[1].armorStat),K[0]&2&&me(C,q[1].maxDex)},i(q){U||(P(l.$$.fragment,q),U=!0)},o(q){W(l.$$.fragment,q),U=!1},d(q){q&&T(e),q&&T(n),se(l,q),q&&T(i),q&&T(o),q&&T(b),q&&T(A),q&&T(E),q&&T(k),ke(j,q),q&&T(M),q&&T(N),q&&T(R),q&&T(C),Z=!1,Fe(ve)}}}function Nd(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g=t[1].weaponProperties.includes("Magical"),h,b,A,E,k,B,S,M,N,R,C,O,$,D,F,U,Z,ve,re,de,ae,j,q,K,we,Y,pe,be,X,H,J,he,_e;function ue(L){t[18](L)}let ce={id:"weaponProperties",options:Sr,labels:t[4]};t[1].weaponProperties!==void 0&&(ce.values=t[1].weaponProperties),d=new er({props:ce}),Ve.push(()=>Ye(d,"values",ue));let z=g&&Co(t),te=As,Ae=[];for(let L=0;L<te.length;L+=1)Ae[L]=Oo(Ao(t,te,L));let Ie=Pt,x=[];for(let L=0;L<Ie.length;L+=1)x[L]=So(Eo(t,Ie,L));let fe=Pt,Se=[];for(let L=0;L<fe.length;L+=1)Se[L]=Mo(To(t,fe,L));return{c(){e=_("label"),e.textContent="武器類型",n=y(),l=_("select"),s=_("option"),s.textContent="簡易近戰",i=_("option"),i.textContent="簡易遠程",o=_("option"),o.textContent="軍用近戰",r=_("option"),r.textContent="軍用遠程",u=y(),c=_("label"),c.textContent="武器特性",a=y(),ne(d.$$.fragment),v=y(),z&&z.c(),h=y(),b=_("label"),b.textContent="距離",A=y(),E=_("select");for(let L=0;L<Ae.length;L+=1)Ae[L].c();k=y(),B=_("label"),B.innerHTML='傷害<span class="text-red-700">*</span>',S=y(),M=_("div"),N=_("input"),R=y(),C=_("div"),O=_("div"),O.textContent="單手:",$=y(),D=_("input"),U=y(),Z=_("select");for(let L=0;L<x.length;L+=1)x[L].c();re=y(),de=_("div"),ae=_("input"),j=y(),q=_("div"),K=_("div"),K.textContent="雙手:",we=y(),Y=_("input"),be=y(),X=_("select");for(let L=0;L<Se.length;L+=1)Se[L].c();p(e,"for","weaponType"),p(e,"class","font-bold"),s.__value="Simple Melee",s.value=s.__value,i.__value="Simple Ranged",i.value=i.__value,o.__value="Martial Melee",o.value=o.__value,r.__value="Martial Ranged",r.value=r.__value,p(l,"name","weaponType"),p(l,"id","weaponType"),p(l,"class","border p-1 rounded"),t[1].weaponType===void 0&&Pe(()=>t[17].call(l)),p(c,"for","weaponProperties"),p(c,"class","font-bold"),p(b,"for","range"),p(b,"class","font-bold"),p(E,"id","range"),p(E,"class","border p-1 rounded"),t[1].weaponRange===void 0&&Pe(()=>t[20].call(E)),p(B,"for","damage"),p(B,"class","font-bold"),p(N,"type","checkbox"),p(N,"class","svelte-qhgyyp"),p(O,"class","whitespace-nowrap font-bold text-xs"),D.disabled=F=!t[1].hasOneHandedAttack,p(D,"type","number"),p(D,"inputmode","numeric"),p(D,"class","w-10 text-center border-b"),Z.disabled=ve=!t[1].hasOneHandedAttack,p(Z,"class","border-none bg-transparent"),t[1].oneHandedDiceType===void 0&&Pe(()=>t[23].call(Z)),p(C,"class","flex gap-1 items-center border p-1 rounded bg-white"),$e(C,"opacity-50",!t[1].hasOneHandedAttack),p(M,"class","flex gap-1 items-center"),p(ae,"type","checkbox"),p(ae,"class","svelte-qhgyyp"),p(K,"class","whitespace-nowrap font-bold text-xs"),Y.disabled=pe=!t[1].hasTwoHandedAttack,p(Y,"type","number"),p(Y,"inputmode","numeric"),p(Y,"class","w-10 text-center border-b"),X.disabled=H=!t[1].hasTwoHandedAttack,p(X,"class","border-none bg-transparent"),t[1].twoHandedDiceType===void 0&&Pe(()=>t[26].call(X)),p(q,"class","flex gap-1 items-center border p-1 rounded bg-white"),$e(q,"opacity-50",!t[1].hasTwoHandedAttack),p(de,"class","flex gap-1 items-center")},m(L,ge){w(L,e,ge),w(L,n,ge),w(L,l,ge),f(l,s),f(l,i),f(l,o),f(l,r),me(l,t[1].weaponType,!0),w(L,u,ge),w(L,c,ge),w(L,a,ge),le(d,L,ge),w(L,v,ge),z&&z.m(L,ge),w(L,h,ge),w(L,b,ge),w(L,A,ge),w(L,E,ge);for(let Le=0;Le<Ae.length;Le+=1)Ae[Le]&&Ae[Le].m(E,null);me(E,t[1].weaponRange,!0),w(L,k,ge),w(L,B,ge),w(L,S,ge),w(L,M,ge),f(M,N),N.checked=t[1].hasOneHandedAttack,f(M,R),f(M,C),f(C,O),f(C,$),f(C,D),oe(D,t[1].oneHandedNumDice),f(C,U),f(C,Z);for(let Le=0;Le<x.length;Le+=1)x[Le]&&x[Le].m(Z,null);me(Z,t[1].oneHandedDiceType,!0),w(L,re,ge),w(L,de,ge),f(de,ae),ae.checked=t[1].hasTwoHandedAttack,f(de,j),f(de,q),f(q,K),f(q,we),f(q,Y),oe(Y,t[1].twoHandedNumDice),f(q,be),f(q,X);for(let Le=0;Le<Se.length;Le+=1)Se[Le]&&Se[Le].m(X,null);me(X,t[1].twoHandedDiceType,!0),J=!0,he||(_e=[I(l,"change",t[17]),I(E,"change",t[20]),I(N,"change",t[21]),I(D,"input",t[22]),I(Z,"change",t[23]),I(ae,"change",t[24]),I(Y,"input",t[25]),I(X,"change",t[26])],he=!0)},p(L,ge){ge[0]&2&&me(l,L[1].weaponType);const Le={};if(!m&&ge[0]&2&&(m=!0,Le.values=L[1].weaponProperties,Ke(()=>m=!1)),d.$set(Le),ge[0]&2&&(g=L[1].weaponProperties.includes("Magical")),g?z?z.p(L,ge):(z=Co(L),z.c(),z.m(h.parentNode,h)):z&&(z.d(1),z=null),ge[0]&32){te=As;let Te;for(Te=0;Te<te.length;Te+=1){const nt=Ao(L,te,Te);Ae[Te]?Ae[Te].p(nt,ge):(Ae[Te]=Oo(nt),Ae[Te].c(),Ae[Te].m(E,null))}for(;Te<Ae.length;Te+=1)Ae[Te].d(1);Ae.length=te.length}if(ge[0]&2&&me(E,L[1].weaponRange),ge[0]&2&&(N.checked=L[1].hasOneHandedAttack),(!J||ge[0]&2&&F!==(F=!L[1].hasOneHandedAttack))&&(D.disabled=F),ge[0]&2&&Me(D.value)!==L[1].oneHandedNumDice&&oe(D,L[1].oneHandedNumDice),ge&0){Ie=Pt;let Te;for(Te=0;Te<Ie.length;Te+=1){const nt=Eo(L,Ie,Te);x[Te]?x[Te].p(nt,ge):(x[Te]=So(nt),x[Te].c(),x[Te].m(Z,null))}for(;Te<x.length;Te+=1)x[Te].d(1);x.length=Ie.length}if((!J||ge[0]&2&&ve!==(ve=!L[1].hasOneHandedAttack))&&(Z.disabled=ve),ge[0]&2&&me(Z,L[1].oneHandedDiceType),(!J||ge[0]&2)&&$e(C,"opacity-50",!L[1].hasOneHandedAttack),ge[0]&2&&(ae.checked=L[1].hasTwoHandedAttack),(!J||ge[0]&2&&pe!==(pe=!L[1].hasTwoHandedAttack))&&(Y.disabled=pe),ge[0]&2&&Me(Y.value)!==L[1].twoHandedNumDice&&oe(Y,L[1].twoHandedNumDice),ge&0){fe=Pt;let Te;for(Te=0;Te<fe.length;Te+=1){const nt=To(L,fe,Te);Se[Te]?Se[Te].p(nt,ge):(Se[Te]=Mo(nt),Se[Te].c(),Se[Te].m(X,null))}for(;Te<Se.length;Te+=1)Se[Te].d(1);Se.length=fe.length}(!J||ge[0]&2&&H!==(H=!L[1].hasTwoHandedAttack))&&(X.disabled=H),ge[0]&2&&me(X,L[1].twoHandedDiceType),(!J||ge[0]&2)&&$e(q,"opacity-50",!L[1].hasTwoHandedAttack)},i(L){J||(P(d.$$.fragment,L),J=!0)},o(L){W(d.$$.fragment,L),J=!1},d(L){L&&T(e),L&&T(n),L&&T(l),L&&T(u),L&&T(c),L&&T(a),se(d,L),L&&T(v),z&&z.d(L),L&&T(h),L&&T(b),L&&T(A),L&&T(E),ke(Ae,L),L&&T(k),L&&T(B),L&&T(S),L&&T(M),ke(x,L),L&&T(re),L&&T(de),ke(Se,L),he=!1,Fe(_e)}}}function Id(t){let e,n,l,s,i,o,r,u,c=t[1].canBeEquipped&&Ro(t);return{c(){e=_("div"),n=_("input"),l=y(),s=_("label"),s.textContent="可裝備？",i=y(),c&&c.c(),o=vt(),p(n,"id","canBeEquipped"),p(n,"type","checkbox"),p(n,"class","svelte-qhgyyp"),p(s,"for","canBeEquipped"),p(e,"class","flex gap-1")},m(a,d){w(a,e,d),f(e,n),n.checked=t[1].canBeEquipped,f(e,l),f(e,s),w(a,i,d),c&&c.m(a,d),w(a,o,d),r||(u=I(n,"change",t[15]),r=!0)},p(a,d){d[0]&2&&(n.checked=a[1].canBeEquipped),a[1].canBeEquipped?c?c.p(a,d):(c=Ro(a),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},i:V,o:V,d(a){a&&T(e),a&&T(i),c&&c.d(a),a&&T(o),r=!1,u()}}}function Bo(t){let e,n=gn(t[44])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[44],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function Co(t){let e,n,l,s,i,o;return{c(){e=_("div"),n=_("label"),n.textContent="魔法武器修正: +",l=y(),s=_("input"),p(n,"for","magicWeaponModifier"),p(s,"id","magicWeaponModifier"),p(s,"type","number"),p(s,"min","0"),p(s,"inputmode","numeric"),p(s,"class","w-10 text-center border p-1 rounded"),p(e,"class","flex flex-row gap-1 items-center")},m(r,u){w(r,e,u),f(e,n),f(e,l),f(e,s),oe(s,t[1].magicWeaponModifier),i||(o=I(s,"input",t[19]),i=!0)},p(r,u){u[0]&2&&Me(s.value)!==r[1].magicWeaponModifier&&oe(s,r[1].magicWeaponModifier)},d(r){r&&T(e),i=!1,o()}}}function Oo(t){let e,n=(t[5][t[41]]??t[41])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[41],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function So(t){let e,n=t[36]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[36],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function Mo(t){let e,n=t[36]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[36],e.value=e.__value},m(s,i){w(s,e,i),f(e,l)},p:V,d(s){s&&T(e)}}}function Ro(t){let e,n,l,s,i,o;return{c(){e=_("div"),n=_("input"),l=y(),s=_("label"),s.innerHTML='裝備時顯示於 <span class="pirata text-lg">攻擊</span> 列表？',p(n,"id","attackable"),p(n,"type","checkbox"),p(n,"class","svelte-qhgyyp"),p(s,"for","attackable"),p(e,"class","flex gap-1 items-center")},m(r,u){w(r,e,u),f(e,n),n.checked=t[1].attackable,f(e,l),f(e,s),i||(o=I(n,"change",t[16]),i=!0)},p(r,u){u[0]&2&&(n.checked=r[1].attackable)},d(r){r&&T(e),i=!1,o()}}}function Ld(t){let e;return{c(){e=G("新增")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Pd(t){let e;return{c(){e=G("更新")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Hd(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h,b,A,E,k,B,S,M,N,R,C,O,$,D,F,U,Z,ve,re,de,ae,j,q,K=["gp","sp","cp"],we=[];for(let H=0;H<3;H+=1)we[H]=$d(Rd(t,K,H));let Y=t[1].showAdvanced&&ko(t);function pe(H,J){return H[0]?Pd:Ld}let be=pe(t),X=be(t);return{c(){e=_("div"),n=_("div"),l=_("label"),l.innerHTML='名稱<span class="text-red-700">*</span>',s=y(),i=_("input"),o=y(),r=_("div"),u=_("div"),c=_("label"),c.textContent="重量 (lb)",a=y(),d=_("input"),m=y(),v=_("div"),g=_("label"),g.innerHTML='數量<span class="text-red-700">*</span>',h=y(),b=_("input"),A=y(),E=_("div"),k=_("div"),B=_("label"),B.textContent="價格",S=y(),M=_("input"),N=y(),R=_("div"),C=_("select");for(let H=0;H<3;H+=1)we[H].c();O=y(),$=_("div"),D=_("input"),F=y(),U=_("label"),U.textContent="進階選項",Z=y(),Y&&Y.c(),ve=y(),re=_("button"),X.c(),p(l,"for","name"),p(l,"class","font-bold"),p(i,"id","name"),p(i,"type","text"),p(i,"class","border p-1 rounded"),p(n,"class","flex flex-col gap-1"),p(c,"for","weight"),p(c,"class","font-bold"),p(d,"id","weight"),p(d,"type","number"),p(d,"class","border p-1 rounded"),p(d,"inputmode","numeric"),p(d,"min","0"),p(d,"step","0.1"),p(u,"class","flex flex-col gap-1 w-1/2"),p(g,"for","quantity"),p(g,"class","font-bold"),p(b,"id","quantity"),p(b,"type","number"),p(b,"class","border p-1 rounded"),p(b,"inputmode","numeric"),p(b,"min","1"),p(v,"class","flex flex-col gap-1 w-1/2"),p(r,"class","flex gap-2"),p(B,"for","cost"),p(B,"class","font-bold"),p(M,"id","cost"),p(M,"type","number"),p(M,"class","border p-1 rounded"),p(M,"inputmode","numeric"),p(M,"min","0"),p(k,"class","flex flex-col gap-1 flex-grow"),p(C,"id","currency"),p(C,"class","border p-1 rounded h-[34px]"),t[1].currency===void 0&&Pe(()=>t[12].call(C)),p(R,"class","flex flex-col gap-1 w-16"),p(E,"class","flex gap-2 items-end"),p(D,"id","showAdvanced"),p(D,"type","checkbox"),p(D,"class","svelte-qhgyyp"),p(U,"for","showAdvanced"),p(U,"class","font-bold cursor-pointer"),p($,"class","flex gap-2 items-center mt-2 border-t pt-2"),p(re,"class","mt-4 px-3 hover:bg-gray-700 bg-black text-white p-2 rounded shadow font-bold"),re.disabled=de=!t[2],$e(re,"opacity-50",!t[2]),p(e,"class","flex flex-col gap-2 p-2 max-h-[80vh] overflow-y-auto")},m(H,J){w(H,e,J),f(e,n),f(n,l),f(n,s),f(n,i),oe(i,t[1].name),f(e,o),f(e,r),f(r,u),f(u,c),f(u,a),f(u,d),oe(d,t[1].weight),f(r,m),f(r,v),f(v,g),f(v,h),f(v,b),oe(b,t[1].quantity),f(e,A),f(e,E),f(E,k),f(k,B),f(k,S),f(k,M),oe(M,t[1].cost),f(E,N),f(E,R),f(R,C);for(let he=0;he<3;he+=1)we[he]&&we[he].m(C,null);me(C,t[1].currency,!0),f(e,O),f(e,$),f($,D),D.checked=t[1].showAdvanced,f($,F),f($,U),f(e,Z),Y&&Y.m(e,null),f(e,ve),f(e,re),X.m(re,null),ae=!0,j||(q=[I(i,"input",t[8]),I(d,"input",t[9]),I(b,"input",t[10]),I(M,"input",t[11]),I(C,"change",t[12]),I(D,"change",t[13]),I(re,"click",t[3])],j=!0)},p(H,J){J[0]&2&&i.value!==H[1].name&&oe(i,H[1].name),J[0]&2&&Me(d.value)!==H[1].weight&&oe(d,H[1].weight),J[0]&2&&Me(b.value)!==H[1].quantity&&oe(b,H[1].quantity),J[0]&2&&Me(M.value)!==H[1].cost&&oe(M,H[1].cost),J[0]&2&&me(C,H[1].currency),J[0]&2&&(D.checked=H[1].showAdvanced),H[1].showAdvanced?Y?(Y.p(H,J),J[0]&2&&P(Y,1)):(Y=ko(H),Y.c(),P(Y,1),Y.m(e,ve)):Y&&(qe(),W(Y,1,1,()=>{Y=null}),Ue()),be!==(be=pe(H))&&(X.d(1),X=be(H),X&&(X.c(),X.m(re,null))),(!ae||J[0]&4&&de!==(de=!H[2]))&&(re.disabled=de),(!ae||J[0]&4)&&$e(re,"opacity-50",!H[2])},i(H){ae||(P(Y),ae=!0)},o(H){W(Y),ae=!1},d(H){H&&T(e),ke(we,H),Y&&Y.d(),X.d(),j=!1,Fe(q)}}}function Gd(t){var n;if(!t)return 0;let e=(n=t==null?void 0:t.playerBonuses)==null?void 0:n.find(l=>l.type==="modifyAmt"&&l.bonusTo==="attackRoll");return(e==null?void 0:e.bonusAmount)??0}function Wd(t){return t&&t.range||"5 ft"}function qd(t,e,n){var we,Y,pe,be,X,H,J,he,_e,ue,ce,z,te,Ae,Ie,x;let l,s,i;Re(t,De,fe=>n(33,i=fe));const o=yn();let{gear:r=void 0}=e;const u=i.gear.find(fe=>fe.name===(r==null?void 0:r.name)),c={name:(r==null?void 0:r.name)??void 0,weight:(r==null?void 0:r.weight)??0,cost:((we=r==null?void 0:r.cost)==null?void 0:we.gp)??0,currency:"gp",quantity:(u==null?void 0:u.quantity)??1,showAdvanced:(r==null?void 0:r.type)!==void 0&&(r==null?void 0:r.type)!=="Basic",gearType:(r==null?void 0:r.type)??"Basic",canBeEquipped:(r==null?void 0:r.canBeEquipped)??!1,attackable:((Y=r==null?void 0:r.properties)==null?void 0:Y.includes("Attackable"))??!1,weaponProperties:(r==null?void 0:r.properties)??[],magicWeaponModifier:Gd(r),weaponType:(r==null?void 0:r.weaponType)??"Simple Melee",weaponRange:Wd(r),hasOneHandedAttack:r?!!((pe=r==null?void 0:r.damage)!=null&&pe.oneHanded):!0,oneHandedNumDice:((X=(be=r==null?void 0:r.damage)==null?void 0:be.oneHanded)==null?void 0:X.numDice)??1,oneHandedDiceType:((J=(H=r==null?void 0:r.damage)==null?void 0:H.oneHanded)==null?void 0:J.diceType)??"d6",hasTwoHandedAttack:!!((he=r==null?void 0:r.damage)!=null&&he.twoHanded),twoHandedNumDice:((ue=(_e=r==null?void 0:r.damage)==null?void 0:_e.twoHanded)==null?void 0:ue.numDice)??1,twoHandedDiceType:((z=(ce=r==null?void 0:r.damage)==null?void 0:ce.twoHanded)==null?void 0:z.diceType)??"d8",baseAC:((te=r==null?void 0:r.ac)==null?void 0:te.base)??10,armorProperties:(r==null?void 0:r.properties)??[],acModifier:((Ae=r==null?void 0:r.ac)==null?void 0:Ae.modifier)??0,armorStat:(Ie=r==null?void 0:r.ac)==null?void 0:Ie.stat,maxDex:(x=r==null?void 0:r.ac)==null?void 0:x.maxDex};let a=JSON.parse(JSON.stringify(c));function d(){var Se;let fe={name:a.name,type:a.gearType,canBeEquipped:a.canBeEquipped,desc:a.name,weight:a.weight,editable:!0,playerBonuses:[],cost:{gp:0,sp:0,cp:0,ep:0,pp:0,[a.currency]:a.cost}};switch(a.gearType){case"Basic":{a.canBeEquipped&&a.attackable&&(fe.properties=["Attackable"]);break}case"Weapon":{let L=fe;L.properties=a.weaponProperties,L.weaponType=a.weaponType,L.range=a.weaponRange,L.canBeEquipped=!0,L.damage={},a.hasOneHandedAttack&&(L.damage.oneHanded={numDice:a.oneHandedNumDice,diceType:a.oneHandedDiceType}),a.hasTwoHandedAttack&&(L.damage.twoHanded={numDice:a.twoHandedNumDice,diceType:a.twoHandedDiceType}),a.weaponProperties.includes("Magical")&&a.magicWeaponModifier>0&&(L.playerBonuses.push({name:L.name+`: +${a.magicWeaponModifier} to atk`,desc:`+${a.magicWeaponModifier} to attack rolls when ${L.name} is equipped`,type:"modifyAmt",bonusAmount:a.magicWeaponModifier,bonusTo:"attackRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:L.name}}),L.playerBonuses.push({name:L.name+`: +${a.magicWeaponModifier} to dmg`,desc:`+${a.magicWeaponModifier} to damage rolls when ${L.name} is equipped`,type:"modifyAmt",bonusAmount:a.magicWeaponModifier,bonusTo:"damageRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:L.name}}));break}case"Armor":{let L=fe;L.properties=a.armorProperties,L.canBeEquipped=!0,L.ac={base:a.baseAC,modifier:a.acModifier,stat:a.armorStat,maxDex:a.maxDex};break}}if(r){for(let L in r)r.hasOwnProperty(L)&&delete r[L];fe.type!=="Basic"&&(fe.properties=(Se=fe.properties)==null?void 0:Se.filter(L=>L!=="Attackable")),Object.assign(r,fe),u&&(u.name=fe.name,u.quantity=a.quantity)}else i.customGear.push(fe),i.gear.push({name:fe.name,quantity:a.quantity});De.set(i),o("finish")}const m={Ammunition:"彈藥",Finesse:"靈巧",Heavy:"重型",Light:"輕型",Loading:"裝填",Range:"射程",Reach:"長觸",Special:"特殊",Thrown:"投擲","Two-Handed":"雙手",Versatile:"靈活",Silvered:"鍍銀",Magical:"魔法"},v={"5 ft":"5 尺","10 ft":"10 尺","30 ft":"30 尺","60 ft":"60 尺","120 ft":"120 尺",Touch:"觸碰",Sight:"視線",Self:"自身"},g={Shield:"盾牌","+1":"+1","+2":"+2","+3":"+3",Magic:"魔法"};function h(){a.name=this.value,n(1,a)}function b(){a.weight=Me(this.value),n(1,a)}function A(){a.quantity=Me(this.value),n(1,a)}function E(){a.cost=Me(this.value),n(1,a)}function k(){a.currency=Ge(this),n(1,a)}function B(){a.showAdvanced=this.checked,n(1,a)}function S(){a.gearType=Ge(this),n(1,a)}function M(){a.canBeEquipped=this.checked,n(1,a)}function N(){a.attackable=this.checked,n(1,a)}function R(){a.weaponType=Ge(this),n(1,a)}function C(fe){t.$$.not_equal(a.weaponProperties,fe)&&(a.weaponProperties=fe,n(1,a))}function O(){a.magicWeaponModifier=Me(this.value),n(1,a)}function $(){a.weaponRange=Ge(this),n(1,a)}function D(){a.hasOneHandedAttack=this.checked,n(1,a)}function F(){a.oneHandedNumDice=Me(this.value),n(1,a)}function U(){a.oneHandedDiceType=Ge(this),n(1,a)}function Z(){a.hasTwoHandedAttack=this.checked,n(1,a)}function ve(){a.twoHandedNumDice=Me(this.value),n(1,a)}function re(){a.twoHandedDiceType=Ge(this),n(1,a)}function de(fe){t.$$.not_equal(a.armorProperties,fe)&&(a.armorProperties=fe,n(1,a))}function ae(){a.baseAC=Me(this.value),n(1,a)}function j(){a.acModifier=Me(this.value),n(1,a)}function q(){a.armorStat=Ge(this),n(1,a)}function K(){a.maxDex=Ge(this),n(1,a)}return t.$$set=fe=>{"gear"in fe&&n(0,r=fe.gear)},t.$$.update=()=>{var fe;if(t.$$.dirty[0]&2&&(a.showAdvanced||(n(1,a.gearType="Basic",a),n(1,a.canBeEquipped=!1,a),n(1,a.attackable=!1,a))),t.$$.dirty[0]&2&&n(7,l=a.gearType!=="Weapon"||a.hasOneHandedAttack||a.hasTwoHandedAttack),t.$$.dirty[0]&130&&n(2,s=((fe=a.name)==null?void 0:fe.length)>0&&a.quantity>0&&l),t.$$.dirty[0]&2)if(a.hasOneHandedAttack&&a.hasTwoHandedAttack)a.weaponProperties.includes("Versatile")||a.weaponProperties.push("Versatile");else{const Se=a.weaponProperties.findIndex(L=>L==="Versatile");Se>=0&&a.weaponProperties.splice(Se,1)}},[r,a,s,d,m,v,g,l,h,b,A,E,k,B,S,M,N,R,C,O,$,D,F,U,Z,ve,re,de,ae,j,q,K]}class tr extends Ce{constructor(e){super(),Oe(this,e,qd,Hd,Be,{gear:0},null,[-1,-1])}}function $o(t){let e,n,l;function s(o){t[4](o)}let i={vw:50,$$slots:{header:[Fd],default:[Ud]},$$scope:{ctx:t}};return t[1]!==void 0&&(i.showModal=t[1]),e=new ft({props:i}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(o,r){le(e,o,r),l=!0},p(o,r){const u={};r&33&&(u.$$scope={dirty:r,ctx:o}),!n&&r&2&&(n=!0,u.showModal=o[1],Ke(()=>n=!1)),e.$set(u)},i(o){l||(P(e.$$.fragment,o),l=!0)},o(o){W(e.$$.fragment,o),l=!1},d(o){se(e,o)}}}function Ud(t){let e,n;return e=new tr({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:V,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Fd(t){let e;return{c(){e=_("h1"),e.textContent="Custom Gear",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Vd(t){let e,n,l,s,i,o,r=t[0]&&$o(t);return{c(){e=_("button"),e.textContent="Custom Gear",n=y(),r&&r.c(),l=vt(),p(e,"class","bg-black text-white px-2")},m(u,c){w(u,e,c),w(u,n,c),r&&r.m(u,c),w(u,l,c),s=!0,i||(o=I(e,"click",t[2]),i=!0)},p(u,[c]){u[0]?r?(r.p(u,c),c&1&&P(r,1)):(r=$o(u),r.c(),P(r,1),r.m(l.parentNode,l)):r&&(qe(),W(r,1,1,()=>{r=null}),Ue())},i(u){s||(P(r),s=!0)},o(u){W(r),s=!1},d(u){u&&T(e),u&&T(n),r&&r.d(u),u&&T(l),i=!1,o()}}}function jd(t,e,n){let l=!1,s=!1;const i=()=>{n(0,l=!0),n(1,s=!0)},o=()=>{n(0,l=!1)};function r(u){s=u,n(1,s)}return[l,s,i,o,r]}class zd extends Ce{constructor(e){super(),Oe(this,e,jd,Vd,Be,{})}}function Do(t,e,n){const l=t.slice();return l[23]=e[n],l[25]=n,l}function No(t){let e,n=t[23].desc+"",l;return{c(){e=_("div"),l=G(n),p(e,"class","text-gray-500 truncate max-w-[120px]")},m(s,i){w(s,e,i),f(e,l)},p(s,i){i&256&&n!==(n=s[23].desc+"")&&ee(l,n)},d(s){s&&T(e)}}}function Io(t){let e,n,l,s,i;function o(){return t[18](t[23])}function r(){return t[19](t[23])}return{c(){e=_("button"),e.innerHTML='<i class="material-icons text-sm">delete</i>',n=y(),l=_("button"),l.innerHTML='<i class="material-icons text-sm">edit</i>',p(e,"class","bg-gray-800 rounded text-white px-1 py-0.5"),p(e,"title","刪除"),p(l,"class","bg-gray-800 rounded text-white px-1 py-0.5"),p(l,"title","編輯")},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c),s||(i=[I(e,"click",o),I(l,"click",r)],s=!0)},p(u,c){t=u},d(u){u&&T(e),u&&T(n),u&&T(l),s=!1,Fe(i)}}}function Lo(t){var O;let e,n,l,s=(((O=t[23].l10n)==null?void 0:O.name)??t[23].name)+"",i,o,r,u,c=Ho(t[23])+"",a,d,m,v=(t[23].weight??0)+"",g,h,b,A,E,k,B,S,M,N=t[23].desc&&No(t),R=t[23].editable&&Io(t);function C(){return t[20](t[23])}return{c(){e=_("tr"),n=_("td"),l=_("div"),i=G(s),o=y(),N&&N.c(),r=y(),u=_("td"),a=G(c),d=y(),m=_("td"),g=G(v),h=G(" lb"),b=y(),A=_("td"),R&&R.c(),E=y(),k=_("button"),k.innerHTML='<i class="material-icons">add_circle</i>',B=y(),p(l,"class","font-bold"),p(n,"class","pl-2 py-2"),p(u,"class","whitespace-nowrap"),p(k,"class","text-green-700 hover:text-green-900"),p(k,"title","購買/加入"),p(A,"class","flex justify-end gap-1 pr-2 py-2 items-center"),p(e,"class","border-b hover:bg-gray-50 text-xs"),$e(e,"bg-gray-50",t[25]%2==0)},m($,D){w($,e,D),f(e,n),f(n,l),f(l,i),f(n,o),N&&N.m(n,null),f(e,r),f(e,u),f(u,a),f(e,d),f(e,m),f(m,g),f(m,h),f(e,b),f(e,A),R&&R.m(A,null),f(A,E),f(A,k),f(e,B),S||(M=I(k,"click",C),S=!0)},p($,D){var F;t=$,D&256&&s!==(s=(((F=t[23].l10n)==null?void 0:F.name)??t[23].name)+"")&&ee(i,s),t[23].desc?N?N.p(t,D):(N=No(t),N.c(),N.m(n,null)):N&&(N.d(1),N=null),D&256&&c!==(c=Ho(t[23])+"")&&ee(a,c),D&256&&v!==(v=(t[23].weight??0)+"")&&ee(g,v),t[23].editable?R?R.p(t,D):(R=Io(t),R.c(),R.m(A,E)):R&&(R.d(1),R=null)},d($){$&&T(e),N&&N.d(),R&&R.d(),S=!1,M()}}}function Po(t){let e,n,l;function s(o){t[22](o)}let i={$$slots:{header:[Kd],default:[Yd]},$$scope:{ctx:t}};return t[7]!==void 0&&(i.showModal=t[7]),e=new ft({props:i}),Ve.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(o,r){le(e,o,r),l=!0},p(o,r){const u={};r&67109056&&(u.$$scope={dirty:r,ctx:o}),!n&&r&128&&(n=!0,u.showModal=o[7],Ke(()=>n=!1)),e.$set(u)},i(o){l||(P(e.$$.fragment,o),l=!0)},o(o){W(e.$$.fragment,o),l=!1},d(o){se(e,o)}}}function Yd(t){let e,n;return e=new tr({props:{gear:t[6]}}),e.$on("finish",t[21]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const i={};s&64&&(i.gear=l[6]),e.$set(i)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Kd(t){let e;return{c(){e=_("h2"),e.textContent="自訂裝備",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Xd(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h,b,A,E,k,B,S,M,N,R,C,O,$,D,F,U,Z,ve,re,de,ae,j,q,K;function we(H){t[12](H)}let Y={placeholder:"搜尋 例如: 長劍",class:"w-full"};t[5]!==void 0&&(Y.value=t[5]),l=new Qa({props:Y}),Ve.push(()=>Ye(l,"value",we));let pe=t[8],be=[];for(let H=0;H<pe.length;H+=1)be[H]=Lo(Do(t,pe,H));let X=t[7]&&t[6]&&Po(t);return{c(){e=_("div"),n=_("div"),ne(l.$$.fragment),i=y(),o=_("div"),r=_("div"),r.textContent="過濾:",u=y(),c=_("label"),a=_("input"),d=G(" 武器"),m=y(),v=_("label"),g=_("input"),h=G(" 防具"),b=y(),A=_("label"),E=_("input"),k=G(" 基礎"),B=y(),S=_("label"),M=_("input"),N=G(" 自訂"),R=y(),C=_("label"),O=_("input"),$=G(" 買得起"),D=y(),F=_("div"),U=_("table"),Z=_("thead"),Z.innerHTML=`<tr><th class="pl-2 py-1">名稱</th> 
          <th class="py-1">價格</th> 
          <th class="py-1">重量</th> 
          <th class="pr-2 py-1"></th></tr>`,ve=y(),re=_("tbody");for(let H=0;H<be.length;H+=1)be[H].c();de=y(),X&&X.c(),ae=vt(),p(r,"class","font-bold"),p(a,"type","checkbox"),p(c,"class","flex gap-1 items-center"),p(g,"type","checkbox"),p(v,"class","flex gap-1 items-center"),p(E,"type","checkbox"),p(A,"class","flex gap-1 items-center"),p(M,"type","checkbox"),p(S,"class","flex gap-1 items-center"),p(O,"type","checkbox"),p(C,"class","flex gap-1 items-center border-l pl-1 ml-1 border-gray-400"),p(o,"class","flex gap-1 items-center flex-wrap text-sm mt-1"),p(n,"class","p-2 border-b"),p(Z,"class","text-left sticky top-0 bg-white shadow-sm z-10"),p(U,"class","w-full text-sm"),p(F,"class","overflow-auto flex-1"),p(e,"class","border-b flex flex-col gap-1 h-full overflow-hidden")},m(H,J){w(H,e,J),f(e,n),le(l,n,null),f(n,i),f(n,o),f(o,r),f(o,u),f(o,c),f(c,a),a.checked=t[1],f(c,d),f(o,m),f(o,v),f(v,g),g.checked=t[2],f(v,h),f(o,b),f(o,A),f(A,E),E.checked=t[3],f(A,k),f(o,B),f(o,S),f(S,M),M.checked=t[4],f(S,N),f(o,R),f(o,C),f(C,O),O.checked=t[0],f(C,$),f(e,D),f(e,F),f(F,U),f(U,Z),f(U,ve),f(U,re);for(let he=0;he<be.length;he+=1)be[he]&&be[he].m(re,null);w(H,de,J),X&&X.m(H,J),w(H,ae,J),j=!0,q||(K=[I(a,"change",t[13]),I(g,"change",t[14]),I(E,"change",t[15]),I(M,"change",t[16]),I(O,"change",t[17])],q=!0)},p(H,[J]){const he={};if(!s&&J&32&&(s=!0,he.value=H[5],Ke(()=>s=!1)),l.$set(he),J&2&&(a.checked=H[1]),J&4&&(g.checked=H[2]),J&8&&(E.checked=H[3]),J&16&&(M.checked=H[4]),J&1&&(O.checked=H[0]),J&1984){pe=H[8];let _e;for(_e=0;_e<pe.length;_e+=1){const ue=Do(H,pe,_e);be[_e]?be[_e].p(ue,J):(be[_e]=Lo(ue),be[_e].c(),be[_e].m(re,null))}for(;_e<be.length;_e+=1)be[_e].d(1);be.length=pe.length}H[7]&&H[6]?X?(X.p(H,J),J&192&&P(X,1)):(X=Po(H),X.c(),P(X,1),X.m(ae.parentNode,ae)):X&&(qe(),W(X,1,1,()=>{X=null}),Ue())},i(H){j||(P(l.$$.fragment,H),P(X),j=!0)},o(H){W(l.$$.fragment,H),W(X),j=!1},d(H){H&&T(e),se(l),ke(be,H),H&&T(de),X&&X.d(H),H&&T(ae),q=!1,Fe(K)}}}function Ho(t){const{gp:e,sp:n,cp:l}=t.cost;let s=[];return e&&s.push(`${e}gp`),n&&s.push(`${n}sp`),l&&s.push(`${l}cp`),s.length>0?s.join(" "):"0cp"}function Jd(t,e,n){let l,s;Re(t,De,O=>n(11,s=O));let i,o=!1,r=!1,u=!0,c=!0,a=!0,d=!1,m="";function v(O){const $=s.gear.find(D=>D.name===O.name);if($)$.quantity++;else{const D={name:O.name,quantity:1};s.gear.push(D)}De.set(s)}function g(O){ze(De,s.gear=s.gear.filter($=>$.name!==O.name),s),ze(De,s.bonuses=s.bonuses.filter($=>{var D,F;return!(((D=$.metadata)==null?void 0:D.type)==="weapon"&&$.metadata.weapon===O.name||((F=$.metadata)==null?void 0:F.type)==="armor"&&$.metadata.armor===O.name)}),s),ze(De,s.customGear=s.customGear.filter($=>$.name!==O.name),s)}function h(O){m=O,n(5,m)}function b(){u=this.checked,n(1,u)}function A(){c=this.checked,n(2,c)}function E(){a=this.checked,n(3,a)}function k(){d=this.checked,n(4,d)}function B(){r=this.checked,n(0,r)}const S=O=>g(O),M=O=>{n(6,i=O),n(7,o=!0)},N=O=>v(O),R=()=>{n(7,o=!1),n(6,i=void 0)};function C(O){o=O,n(7,o)}return t.$$.update=()=>{t.$$.dirty&2111&&n(8,l=Object.values(Gl).concat(Object.values(Hl)).concat(Object.values(ql)).concat(s.customGear??[]).filter(O=>d&&!s.customGear.find($=>$.name===O.name)||!u&&O.type==="Weapon"||!c&&O.type==="Armor"||!a&&O.type==="Basic"||r&&!Yr(s,O)?!1:O.name.toLowerCase().includes(m.toLowerCase())))},[r,u,c,a,d,m,i,o,l,v,g,s,h,b,A,E,k,B,S,M,N,R,C]}class Zd extends Ce{constructor(e){super(),Oe(this,e,Jd,Xd,Be,{})}}function Qd(t){let e,n;return e=new Zd({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function xd(t){let e;return{c(){e=_("h1"),e.textContent="裝備",p(e,"slot","header"),p(e,"class","min-w-[300px]")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function ep(t){let e,n,l,s,i,o,r;function u(a){t[2](a)}let c={vh:90,$$slots:{header:[xd],default:[Qd]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.textContent="裝備",n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white px-3 rounded-md")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),i=!0,o||(r=I(e,"click",t[1]),o=!0)},p(a,[d]){const m={};d&8&&(m.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,m.showModal=a[0],Ke(()=>s=!1)),l.$set(m)},i(a){i||(P(l.$$.fragment,a),i=!0)},o(a){W(l.$$.fragment,a),i=!1},d(a){a&&T(e),a&&T(n),se(l,a),o=!1,r()}}}function tp(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function i(o){l=o,n(0,l)}return[l,s,i]}class np extends Ce{constructor(e){super(),Oe(this,e,tp,ep,Be,{})}}function Go(t){const e=Qe(t.name);return e?(e.weight||0)*t.quantity:(console.log("Cannot find gear: "+t.name),0)}function Wo(t,e,n){const l=t.slice();return l[16]=e[n],l[18]=n,l}function qo(t){let e;return{c(){e=G("(超重)")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Uo(t){let e,n=t[16].quantity+"",l;return{c(){e=G("x "),l=G(n)},m(s,i){w(s,e,i),w(s,l,i)},p(s,i){i&16&&n!==(n=s[16].quantity+"")&&ee(l,n)},d(s){s&&T(e),s&&T(l)}}}function Fo(t){var s;let e,n=((s=Qe(t[16].name))==null?void 0:s.desc)+"",l;return{c(){e=_("div"),l=G(n),p(e,"class","text-xs text-gray-600 truncate max-w-[200px]")},m(i,o){w(i,e,o),f(e,l)},p(i,o){var r;o&16&&n!==(n=((r=Qe(i[16].name))==null?void 0:r.desc)+"")&&ee(l,n)},d(i){i&&T(e)}}}function Vo(t){let e,n,l,s,i,o,r;function u(){return t[13](t[16])}return{c(){e=_("label"),n=_("input"),s=y(),i=_("span"),i.textContent="裝備",p(n,"title","Equipped"),p(n,"type","checkbox"),p(n,"class","w-5 h-5"),n.checked=l=t[16].equipped,p(i,"class","text-[10px]"),p(e,"class","flex flex-col items-center")},m(c,a){w(c,e,a),f(e,n),f(e,s),f(e,i),o||(r=I(n,"click",u),o=!0)},p(c,a){t=c,a&16&&l!==(l=t[16].equipped)&&(n.checked=l)},d(c){c&&T(e),o=!1,r()}}}function jo(t){let e,n,l,s,i,o,r;function u(){return t[14](t[16])}return{c(){e=_("label"),n=_("input"),s=y(),i=_("span"),i.textContent="同調",p(n,"title","Attuned"),p(n,"type","checkbox"),p(n,"class","w-5 h-5 accent-purple-600"),n.checked=l=t[16].attuned,p(i,"class","text-[10px]"),p(e,"class","flex flex-col items-center text-purple-700")},m(c,a){w(c,e,a),f(e,n),f(e,s),f(e,i),o||(r=I(n,"click",u),o=!0)},p(c,a){t=c,a&16&&l!==(l=t[16].attuned)&&(n.checked=l)},d(c){c&&T(e),o=!1,r()}}}function zo(t){var Z,ve,re,de,ae,j;let e,n,l,s,i,o=(((ve=(Z=Qe(t[16].name))==null?void 0:Z.l10n)==null?void 0:ve.name)??t[16].name)+"",r,u,c,a,d=Go(t[16])+"",m,v,g,h=(re=Qe(t[16].name))==null?void 0:re.desc,b,A,E=(de=Qe(t[16].name))==null?void 0:de.canBeEquipped,k,B=(j=(ae=Qe(t[16].name))==null?void 0:ae.properties)==null?void 0:j.includes("Attunement"),S,M,N,R,C,O=t[16].quantity>1&&Uo(t),$=h&&Fo(t),D=E&&Vo(t),F=B&&jo(t);function U(){return t[15](t[16])}return{c(){e=_("li"),n=_("div"),l=_("div"),s=_("div"),i=_("span"),r=G(o),u=y(),O&&O.c(),c=y(),a=_("span"),m=G(d),v=G(" lb"),g=y(),$&&$.c(),b=y(),A=_("div"),D&&D.c(),k=y(),F&&F.c(),S=y(),M=_("button"),M.innerHTML='<i class="material-icons text-sm">delete</i>',N=y(),p(i,"class","font-bold"),p(a,"class","text-xs text-gray-500"),p(s,"class","flex justify-between items-center w-full"),p(l,"class","flex flex-col w-full"),p(M,"class","p-1 rounded bg-black text-white hover:bg-gray-700"),p(M,"title","Delete"),p(A,"class","flex gap-2 items-center flex-shrink-0"),p(n,"class","flex gap-1 items-center justify-between"),p(e,"class","border-b border-gray-300 pb-1")},m(q,K){w(q,e,K),f(e,n),f(n,l),f(l,s),f(s,i),f(i,r),f(i,u),O&&O.m(i,null),f(s,c),f(s,a),f(a,m),f(a,v),f(l,g),$&&$.m(l,null),f(n,b),f(n,A),D&&D.m(A,null),f(A,k),F&&F.m(A,null),f(A,S),f(A,M),f(e,N),R||(C=I(M,"click",U),R=!0)},p(q,K){var we,Y,pe,be,X,H;t=q,K&16&&o!==(o=(((Y=(we=Qe(t[16].name))==null?void 0:we.l10n)==null?void 0:Y.name)??t[16].name)+"")&&ee(r,o),t[16].quantity>1?O?O.p(t,K):(O=Uo(t),O.c(),O.m(i,null)):O&&(O.d(1),O=null),K&16&&d!==(d=Go(t[16])+"")&&ee(m,d),K&16&&(h=(pe=Qe(t[16].name))==null?void 0:pe.desc),h?$?$.p(t,K):($=Fo(t),$.c(),$.m(l,null)):$&&($.d(1),$=null),K&16&&(E=(be=Qe(t[16].name))==null?void 0:be.canBeEquipped),E?D?D.p(t,K):(D=Vo(t),D.c(),D.m(A,k)):D&&(D.d(1),D=null),K&16&&(B=(H=(X=Qe(t[16].name))==null?void 0:X.properties)==null?void 0:H.includes("Attunement")),B?F?F.p(t,K):(F=jo(t),F.c(),F.m(A,S)):F&&(F.d(1),F=null)},d(q){q&&T(e),O&&O.d(),$&&$.d(),D&&D.d(),F&&F.d(),R=!1,C()}}}function lp(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h,b,A,E,k,B,S,M,N,R,C,O,$,D,F,U,Z,ve,re,de,ae,j,q,K,we,Y,pe,be,X,H,J,he,_e=t[3]&&qo();m=new np({}),g=new zd({});let ue=t[4],ce=[];for(let z=0;z<ue.length;z+=1)ce[z]=zo(Wo(t,ue,z));return{c(){e=_("div"),n=_("div"),l=_("h2"),l.textContent="裝備",s=y(),i=_("span"),o=G(t[1]),r=G(" / "),u=G(t[0]),c=G(` lb
      `),_e&&_e.c(),a=y(),d=_("div"),ne(m.$$.fragment),v=y(),ne(g.$$.fragment),h=y(),b=_("div"),A=_("div"),E=_("label"),E.textContent="PP",k=y(),B=_("input"),S=y(),M=_("div"),N=_("label"),N.textContent="GP",R=y(),C=_("input"),O=y(),$=_("div"),D=_("label"),D.textContent="EP",F=y(),U=_("input"),Z=y(),ve=_("div"),re=_("label"),re.textContent="SP",de=y(),ae=_("input"),j=y(),q=_("div"),K=_("label"),K.textContent="CP",we=y(),Y=_("input"),pe=y(),be=_("div"),X=_("ul");for(let z=0;z<ce.length;z+=1)ce[z].c();$e(i,"text-red-600",t[3]),p(n,"class","flex gap-2 items-center"),p(d,"class","flex gap-1"),p(e,"class","flex gap-1 p-1 items-center justify-between"),p(E,"for","pp"),p(B,"type","number"),p(B,"id","pp"),p(B,"class","w-12 border rounded px-1"),p(A,"class","flex items-center gap-1"),p(N,"for","gp"),p(C,"type","number"),p(C,"id","gp"),p(C,"class","w-12 border rounded px-1"),p(M,"class","flex items-center gap-1"),p(D,"for","ep"),p(U,"type","number"),p(U,"id","ep"),p(U,"class","w-12 border rounded px-1"),p($,"class","flex items-center gap-1"),p(re,"for","sp"),p(ae,"type","number"),p(ae,"id","sp"),p(ae,"class","w-12 border rounded px-1"),p(ve,"class","flex items-center gap-1"),p(K,"for","cp"),p(Y,"type","number"),p(Y,"id","cp"),p(Y,"class","w-12 border rounded px-1"),p(q,"class","flex items-center gap-1"),p(b,"class","flex gap-2 p-1 border-b border-gray-300 pb-2 mb-2 flex-wrap text-sm"),p(X,"class","flex flex-col gap-1"),p(be,"class","overflow-scroll flex flex-col gap-1 p-2 h-full"),En(be,"box-shadow","inset 0 0 5px #000")},m(z,te){w(z,e,te),f(e,n),f(n,l),f(n,s),f(n,i),f(i,o),f(i,r),f(i,u),f(i,c),_e&&_e.m(i,null),f(e,a),f(e,d),le(m,d,null),f(d,v),le(g,d,null),w(z,h,te),w(z,b,te),f(b,A),f(A,E),f(A,k),f(A,B),oe(B,t[2].currency.pp),f(b,S),f(b,M),f(M,N),f(M,R),f(M,C),oe(C,t[2].currency.gp),f(b,O),f(b,$),f($,D),f($,F),f($,U),oe(U,t[2].currency.ep),f(b,Z),f(b,ve),f(ve,re),f(ve,de),f(ve,ae),oe(ae,t[2].currency.sp),f(b,j),f(b,q),f(q,K),f(q,we),f(q,Y),oe(Y,t[2].currency.cp),w(z,pe,te),w(z,be,te),f(be,X);for(let Ae=0;Ae<ce.length;Ae+=1)ce[Ae]&&ce[Ae].m(X,null);H=!0,J||(he=[I(B,"input",t[8]),I(C,"input",t[9]),I(U,"input",t[10]),I(ae,"input",t[11]),I(Y,"input",t[12])],J=!0)},p(z,[te]){if((!H||te&2)&&ee(o,z[1]),(!H||te&1)&&ee(u,z[0]),z[3]?_e||(_e=qo(),_e.c(),_e.m(i,null)):_e&&(_e.d(1),_e=null),(!H||te&8)&&$e(i,"text-red-600",z[3]),te&4&&Me(B.value)!==z[2].currency.pp&&oe(B,z[2].currency.pp),te&4&&Me(C.value)!==z[2].currency.gp&&oe(C,z[2].currency.gp),te&4&&Me(U.value)!==z[2].currency.ep&&oe(U,z[2].currency.ep),te&4&&Me(ae.value)!==z[2].currency.sp&&oe(ae,z[2].currency.sp),te&4&&Me(Y.value)!==z[2].currency.cp&&oe(Y,z[2].currency.cp),te&240){ue=z[4];let Ae;for(Ae=0;Ae<ue.length;Ae+=1){const Ie=Wo(z,ue,Ae);ce[Ae]?ce[Ae].p(Ie,te):(ce[Ae]=zo(Ie),ce[Ae].c(),ce[Ae].m(X,null))}for(;Ae<ce.length;Ae+=1)ce[Ae].d(1);ce.length=ue.length}},i(z){H||(P(m.$$.fragment,z),P(g.$$.fragment,z),H=!0)},o(z){W(m.$$.fragment,z),W(g.$$.fragment,z),H=!1},d(z){z&&T(e),_e&&_e.d(),se(m),se(g),z&&T(h),z&&T(b),z&&T(pe),z&&T(be),ke(ce,z),J=!1,Fe(he)}}}function sp(t,e,n){let l,s,i,o,r;Re(t,De,k=>n(2,r=k));function u(k){const B=r.gear.findIndex(M=>M.name===k),S=r.gear[B];S.quantity>1?S.quantity-=1:r.gear.splice(B,1),De.set(r)}function c(k){k.equipped=!k.equipped,De.set(r)}function a(k){k.attuned=!k.attuned,De.set(r)}function d(){r.currency.pp=Me(this.value),De.set(r)}function m(){r.currency.gp=Me(this.value),De.set(r)}function v(){r.currency.ep=Me(this.value),De.set(r)}function g(){r.currency.sp=Me(this.value),De.set(r)}function h(){r.currency.cp=Me(this.value),De.set(r)}const b=k=>c(k),A=k=>a(k),E=k=>u(k.name);return t.$$.update=()=>{t.$$.dirty&4&&n(4,l=r.gear.sort((k,B)=>Zn(k.name,B.name))),t.$$.dirty&4&&n(1,s=Gr(r)),t.$$.dirty&4&&n(0,i=Hr(r)),t.$$.dirty&3&&n(3,o=s>i)},[i,s,r,o,l,u,c,a,d,m,v,g,h,b,A,E]}class ip extends Ce{constructor(e){super(),Oe(this,e,sp,lp,Be,{})}}const{Boolean:op}=va;function Yo(t,e,n){const l=t.slice();return l[5]=e[n],l}function Ko(t,e,n){const l=t.slice();l[8]=e[n];const s=In(l[0],l[8]);l[9]=s;const i=l[9]!==0?Nn(l[9]):"";l[10]=i;const o={Close:"貼身",Near:"近距",Far:"遠距",Self:"自身"};return l[11]=o,l}function Al(t){const e=t.slice(),n=Ca(e[0],e[8],"twoHanded");return e[14]=n,e}function kl(t){const e=t.slice(),n=Ca(e[0],e[8],"oneHanded");return e[14]=n,e}function Xo(t){let e,n;return e=new Gn({props:{diceType:t[14],numDice:t[8].damage.oneHanded.numDice,modifier:In(t[0],t[8]),$$slots:{default:[ap]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const i={};s&5&&(i.diceType=l[14]),s&4&&(i.numDice=l[8].damage.oneHanded.numDice),s&5&&(i.modifier=In(l[0],l[8])),s&32773&&(i.$$scope={dirty:s,ctx:l}),e.$set(i)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function ap(t){let e,n,l=`${t[8].damage.oneHanded.numDice}${t[14]}${t[10]}`,s,i,o;return{c(){e=_("div"),n=_("span"),s=G(l),i=y(),o=_("i"),o.textContent="back_hand",p(o,"class","material-icons"),p(e,"class","bg-black text-white p-1 px-2 rounded-md flex flex-col items-center text-xs")},m(r,u){w(r,e,u),f(e,n),f(n,s),f(e,i),f(e,o)},p(r,u){u&5&&l!==(l=`${r[8].damage.oneHanded.numDice}${r[14]}${r[10]}`)&&ee(s,l)},d(r){r&&T(e)}}}function Jo(t){let e,n;return e=new Gn({props:{diceType:t[14],numDice:t[8].damage.twoHanded.numDice,modifier:In(t[0],t[8]),$$slots:{default:[rp]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const i={};s&5&&(i.diceType=l[14]),s&4&&(i.numDice=l[8].damage.twoHanded.numDice),s&5&&(i.modifier=In(l[0],l[8])),s&32773&&(i.$$scope={dirty:s,ctx:l}),e.$set(i)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function rp(t){let e,n,l=`${t[8].damage.twoHanded.numDice}${t[14]}${t[10]}`,s,i,o;return{c(){e=_("div"),n=_("span"),s=G(l),i=y(),o=_("i"),o.textContent="sign_language",p(o,"class","material-icons"),p(e,"class","bg-black text-white rounded-md p-1 px-2 flex flex-col items-center")},m(r,u){w(r,e,u),f(e,n),f(n,s),f(e,i),f(e,o)},p(r,u){u&5&&l!==(l=`${r[8].damage.twoHanded.numDice}${r[14]}${r[10]}`)&&ee(s,l)},d(r){r&&T(e)}}}function Zo(t){var k;let e,n,l=(((k=t[8].l10n)==null?void 0:k.name)??t[8].name)+"",s,i,o,r=(Array.isArray(t[8].range)?t[8].range.map(b).join("/"):t[11][t[8].range]??t[8].range)+"",u,c,a,d,m,v,g,h;function b(...B){return t[4](t[11],...B)}d=new Gn({props:{modifier:$s(t[0],t[8])}});let A=t[8].damage.oneHanded&&Xo(kl(t)),E=t[8].damage.twoHanded&&Jo(Al(t));return{c(){e=_("tr"),n=_("td"),s=G(l),i=y(),o=_("td"),u=G(r),c=y(),a=_("td"),ne(d.$$.fragment),m=y(),v=_("td"),A&&A.c(),g=y(),E&&E.c(),p(v,"class","flex gap-1"),p(e,"class","border-b")},m(B,S){w(B,e,S),f(e,n),f(n,s),f(e,i),f(e,o),f(o,u),f(e,c),f(e,a),le(d,a,null),f(e,m),f(e,v),A&&A.m(v,null),f(v,g),E&&E.m(v,null),h=!0},p(B,S){var N;t=B,(!h||S&4)&&l!==(l=(((N=t[8].l10n)==null?void 0:N.name)??t[8].name)+"")&&ee(s,l),(!h||S&4)&&r!==(r=(Array.isArray(t[8].range)?t[8].range.map(b).join("/"):t[11][t[8].range]??t[8].range)+"")&&ee(u,r);const M={};S&5&&(M.modifier=$s(t[0],t[8])),d.$set(M),t[8].damage.oneHanded?A?(A.p(kl(t),S),S&4&&P(A,1)):(A=Xo(kl(t)),A.c(),P(A,1),A.m(v,g)):A&&(qe(),W(A,1,1,()=>{A=null}),Ue()),t[8].damage.twoHanded?E?(E.p(Al(t),S),S&4&&P(E,1)):(E=Jo(Al(t)),E.c(),P(E,1),E.m(v,null)):E&&(qe(),W(E,1,1,()=>{E=null}),Ue())},i(B){h||(P(d.$$.fragment,B),P(A),P(E),h=!0)},o(B){W(d.$$.fragment,B),W(A),W(E),h=!1},d(B){B&&T(e),se(d),A&&A.d(),E&&E.d()}}}function Qo(t){var s;let e,n=(((s=t[5].l10n)==null?void 0:s.name)??t[5].name)+"",l;return{c(){e=_("div"),l=G(n),p(e,"class","py-1")},m(i,o){w(i,e,o),f(e,l)},p(i,o){var r;o&2&&n!==(n=(((r=i[5].l10n)==null?void 0:r.name)??i[5].name)+"")&&ee(l,n)},d(i){i&&T(e)}}}function up(t){let e,n,l,s,i,o,r,u,c=t[2],a=[];for(let g=0;g<c.length;g+=1)a[g]=Zo(Ko(t,c,g));const d=g=>W(a[g],1,1,()=>{a[g]=null});let m=t[1],v=[];for(let g=0;g<m.length;g+=1)v[g]=Qo(Yo(t,m,g));return{c(){e=_("h2"),e.textContent="攻擊",n=y(),l=_("div"),s=_("table"),i=_("tr"),i.innerHTML=`<th>攻擊</th> 
      <th>距離</th> 
      <th>命中/DC</th> 
      <th>傷害</th>`,o=y();for(let g=0;g<a.length;g+=1)a[g].c();r=y();for(let g=0;g<v.length;g+=1)v[g].c();p(i,"class","border-b"),p(s,"class","table-auto text-left text-sm w-full"),p(l,"class","overflow-y-auto")},m(g,h){w(g,e,h),w(g,n,h),w(g,l,h),f(l,s),f(s,i),f(s,o);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(s,null);f(s,r);for(let b=0;b<v.length;b+=1)v[b]&&v[b].m(s,null);u=!0},p(g,[h]){if(h&5){c=g[2];let b;for(b=0;b<c.length;b+=1){const A=Ko(g,c,b);a[b]?(a[b].p(A,h),P(a[b],1)):(a[b]=Zo(A),a[b].c(),P(a[b],1),a[b].m(s,r))}for(qe(),b=c.length;b<a.length;b+=1)d(b);Ue()}if(h&2){m=g[1];let b;for(b=0;b<m.length;b+=1){const A=Yo(g,m,b);v[b]?v[b].p(A,h):(v[b]=Qo(A),v[b].c(),v[b].m(s,null))}for(;b<v.length;b+=1)v[b].d(1);v.length=m.length}},i(g){if(!u){for(let h=0;h<c.length;h+=1)P(a[h]);u=!0}},o(g){a=a.filter(op);for(let h=0;h<a.length;h+=1)W(a[h]);u=!1},d(g){g&&T(e),g&&T(n),g&&T(l),ke(a,g),ke(v,g)}}}function cp(t,e,n){let l,s,i,o;Re(t,ye,u=>n(0,o=u));const r=(u,c)=>u[c]??c;return t.$$.update=()=>{t.$$.dirty&1&&n(3,l=o.gear.filter(u=>u.equipped)),t.$$.dirty&8&&n(2,s=l.map(u=>Ea(u.name)).filter(Boolean)),t.$$.dirty&8&&n(1,i=l.map(u=>ka(u.name)).filter(Boolean).filter(u=>{var c;return u.canBeEquipped&&((c=u.properties)==null?void 0:c.includes("Attackable"))}))},[o,i,s,l,r]}class fp extends Ce{constructor(e){super(),Oe(this,e,cp,up,Be,{})}}function dp(t){return JSON.parse(t)}function pp(t){let e,n,l,s,i,o,r,u,c,a=Ds(t[0])+"",d,m,v,g,h,b,A,E,k,B;return{c(){e=_("h2"),e.textContent="生命值",n=y(),l=_("label"),s=y(),i=_("input"),o=y(),r=_("div"),u=_("div"),c=G("最大值: "),d=G(a),m=y(),v=_("div"),g=_("button"),g.innerHTML='<i class="material-icons text-base align-middle">remove</i>',h=y(),b=_("button"),b.innerHTML='<i class="material-icons text-base align-middle">add</i>',A=y(),E=_("button"),E.textContent="長休",p(l,"for","hitpoints"),p(i,"id","hitpoints"),p(i,"type","number"),p(i,"inputmode","numeric"),p(i,"class","pirata text-5xl text-center"),p(i,"min","0"),p(u,"class","whitespace-nowrap"),p(g,"class","hover:bg-gray-700 rounded"),p(b,"class","hover:bg-gray-700 rounded"),p(v,"class","flex items-center"),p(r,"class","flex gap-1 justify-between items-center text-sm mt-1"),p(E,"class","bg-black text-white rounded-md text-sm self-center px-2")},m(S,M){w(S,e,M),w(S,n,M),w(S,l,M),w(S,s,M),w(S,i,M),oe(i,t[0].hitPoints),w(S,o,M),w(S,r,M),f(r,u),f(u,c),f(u,d),f(r,m),f(r,v),f(v,g),f(v,h),f(v,b),w(S,A,M),w(S,E,M),k||(B=[I(i,"input",t[4]),I(g,"click",t[2]),I(b,"click",t[1]),I(E,"click",t[3])],k=!0)},p(S,[M]){M&1&&Me(i.value)!==S[0].hitPoints&&oe(i,S[0].hitPoints),M&1&&a!==(a=Ds(S[0])+"")&&ee(d,a)},i:V,o:V,d(S){S&&T(e),S&&T(n),S&&T(l),S&&T(s),S&&T(i),S&&T(o),S&&T(r),S&&T(A),S&&T(E),k=!1,Fe(B)}}}function _p(t,e,n){let l;Re(t,ye,u=>n(0,l=u));function s(){ze(ye,l.maxHitPoints+=1,l),ye.set(l)}function i(){ze(ye,l.maxHitPoints=Math.max(1,l.maxHitPoints-1),l),l.hitPoints>l.maxHitPoints&&ze(ye,l.hitPoints=l.maxHitPoints,l),ye.set(l)}function o(){ze(ye,l.hitPoints=l.maxHitPoints,l),ze(ye,l.spells=l.spells.map(u=>({...u})),l),ye.set(l)}function r(){l.hitPoints=Me(this.value),ye.set(l)}return[l,s,i,o,r]}class mp extends Ce{constructor(e){super(),Oe(this,e,_p,pp,Be,{})}}function hp(t){let e;return{c(){e=_("div"),e.innerHTML=`<div>這是一個非官方的 Shadowdark 角色追蹤工具！
      <a target="_blank" href="https://www.thearcanelibrary.com/pages/shadowdark" class="svelte-1a204e">購買 Shadowdark</a></div> 

    <h2>匯入</h2> 
    <div>本工具可直接從 <a href="https://www.shadowdarklings.net" target="_blank" class="svelte-1a204e">Shadowdarkling Character Creator</a> 匯入您的角色。也能匯入先前匯出的 JSON 檔案。</div> 

    <h2>儲存</h2> 
    <div>本工具會自動將您的角色卡儲存於瀏覽器的 Local
      Storage。若您刪除本網站的儲存資料，請務必先匯出角色 JSON 檔。</div> 

    <h2>聯絡</h2> 
    <div>您可以透過 <a href="mailto:maxpaulus43@gmail.com" target="_blank" class="svelte-1a204e">maxpaulus43@gmail.com</a> 聯絡我（英文），我也會出沒在 Shadowdark 官方 Discord 頻道。</div> 

    <h2>問題回報</h2> 
    <div>本專案為免費且開源！歡迎提交 Pull Request 或
      <a href="https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet" target="_blank" class="svelte-1a204e">建立 Issue</a></div> 

    <h2>致謝</h2> 
    <div>看看其他很棒的 Shadowdark 工具！</div> 
    <div><a href="https://shadowdarklings.net" target="_blank" class="svelte-1a204e">https://shadowdarklings.net</a></div> 
    <div><a href="https://www.shadowdork.com" target="_blank" class="svelte-1a204e">https://www.shadowdork.com</a></div> 

    <h2>授權</h2> 
    <div>本工具為獨立產品，依據 Shadowdark RPG Third-Party License 發布，與 The
      Arcane Library, LLC 無關。 Shadowdark RPG © 2023 The Arcane Library, LLC.</div> 
    <hr/> 
    <div>免責聲明：我已獲得 The Arcane Library
      明確許可，可於本工具轉載角色創建資料（如天賦表）。</div> 

    <a href="https://www.buymeacoffee.com/tKsqTr4ABl" target="_blank" class="pirata text-xl rounded-md p-2 self-center svelte-1a204e">請我吃份口糧 🍖</a>`,p(e,"class","flex flex-col")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function gp(t){let e;return{c(){e=_("h1"),e.textContent="資訊",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function vp(t){let e,n,l,s,i,o,r;function u(a){t[2](a)}let c={$$slots:{header:[gp],default:[hp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons">help</i>',n=y(),ne(l.$$.fragment)},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),i=!0,o||(r=I(e,"click",t[1]),o=!0)},p(a,[d]){const m={};d&8&&(m.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,m.showModal=a[0],Ke(()=>s=!1)),l.$set(m)},i(a){i||(P(l.$$.fragment,a),i=!0)},o(a){W(l.$$.fragment,a),i=!1},d(a){a&&T(e),a&&T(n),se(l,a),o=!1,r()}}}function bp(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function i(o){l=o,n(0,l)}return[l,s,i]}class yp extends Ce{constructor(e){super(),Oe(this,e,bp,vp,Be,{})}}async function wp(t){const e=t.name;t=JSON.parse(JSON.stringify(t)),t.schemaVersion=Cr,t.schemaType=Or;const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});if("showSaveFilePicker"in window&&(()=>{try{return window.self===window.top}catch{return!1}})())try{const r=await(await window.showSaveFilePicker({suggestedName:e,types:[{description:"json files",accept:{"application/json":[".json"]}}]})).createWritable();await r.write(n),await r.close();return}catch(o){if(o.name!=="AbortError"){console.error(o.name,o.message);return}}const s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=e,i.style.display="none",document.body.append(i),i.click(),setTimeout(()=>{URL.revokeObjectURL(s),i.remove()},1e3)}function xo(t,e,n){const l=t.slice();return l[17]=e[n],l[19]=n,l}function ea(t){let e,n=t[19]+1+"",l,s,i;function o(){return t[9](t[19])}return{c(){e=_("button"),l=G(n),p(e,"class","svelte-1bwcddv"),$e(e,"green",t[3]===t[19]+1)},m(r,u){w(r,e,u),f(e,l),s||(i=I(e,"click",o),s=!0)},p(r,u){t=r,u&8&&$e(e,"green",t[3]===t[19]+1)},d(r){r&&T(e),s=!1,i()}}}function Tp(t){let e,n,l,s,i,o,r,u,c;return{c(){e=_("label"),n=_("div"),l=_("div"),l.textContent="通知持續時間:",s=y(),i=_("input"),o=y(),r=_("div"),r.textContent="秒",p(i,"class","w-16 text-right"),p(i,"id","notificationDuration"),p(i,"type","number"),p(i,"inputmode","numeric"),p(i,"min","0"),p(n,"class","flex flex-row gap-1 items-center"),p(e,"for","notificationDuration")},m(a,d){w(a,e,d),f(e,n),f(n,l),f(n,s),f(n,i),oe(i,t[4].popoverDuration),f(n,o),f(n,r),u||(c=I(i,"input",t[10]),u=!0)},p(a,d){d&16&&Me(i.value)!==a[4].popoverDuration&&oe(i,a[4].popoverDuration)},d(a){a&&T(e),u=!1,c()}}}function ta(t){let e,n,l,s,i,o,r;return{c(){e=_("div"),e.textContent="進階選項（請謹慎操作）",n=y(),l=_("button"),l.textContent="清除目前欄位資料",s=y(),i=_("button"),i.textContent="清除所有暫存資料（請謹慎操作）",p(l,"class","svelte-1bwcddv"),p(i,"class","svelte-1bwcddv")},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c),w(u,s,c),w(u,i,c),o||(r=[I(l,"click",t[14]),I(i,"click",t[15])],o=!0)},p:V,d(u){u&&T(e),u&&T(n),u&&T(l),u&&T(s),u&&T(i),o=!1,Fe(r)}}}function Ep(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h,b,A,E,k,B={length:ol},S=[];for(let R=0;R<B.length;R+=1)S[R]=ea(xo(t,B,R));let M=je.isAvailable&&Tp(t),N=!t[2]&&ta(t);return{c(){e=_("div"),n=_("div"),l=_("h2"),l.textContent="選擇存檔欄位",s=y(),i=_("div");for(let R=0;R<S.length;R+=1)S[R].c();o=y(),M&&M.c(),r=y(),u=_("label"),c=_("div"),c.textContent="匯入 JSON",a=y(),d=_("input"),v=y(),g=_("button"),g.textContent="匯出 JSON",h=y(),b=_("a"),b.textContent="回報問題",A=y(),N&&N.c(),p(i,"class","flex gap-1 w-full justify-stretch"),p(c,"class","text-center"),p(d,"id","jsonImport"),p(d,"type","file"),p(d,"class","hidden"),p(d,"accept","application/json"),d.disabled=t[2],p(u,"for","jsonImport"),p(u,"class",m=Es(t[2]?"btn-disabled":"btn")+" svelte-1bwcddv"),p(g,"class","svelte-1bwcddv"),p(b,"class","btn svelte-1bwcddv"),p(b,"href","https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet/issues/new"),p(b,"target","_blank"),p(e,"class","flex flex-col gap-1 min-w-[200px] svelte-1bwcddv"),p(e,"id","options")},m(R,C){w(R,e,C),f(e,n),f(n,l),f(n,s),f(n,i);for(let O=0;O<S.length;O+=1)S[O]&&S[O].m(i,null);f(e,o),M&&M.m(e,null),f(e,r),f(e,u),f(u,c),f(u,a),f(u,d),f(e,v),f(e,g),f(e,h),f(e,b),f(e,A),N&&N.m(e,null),E||(k=[I(d,"change",t[11]),I(d,"click",t[12]),I(g,"click",t[13])],E=!0)},p(R,C){if(C&8){B={length:ol};let O;for(O=0;O<B.length;O+=1){const $=xo(R,B,O);S[O]?S[O].p($,C):(S[O]=ea($),S[O].c(),S[O].m(i,null))}for(;O<S.length;O+=1)S[O].d(1);S.length=B.length}je.isAvailable&&M.p(R,C),C&4&&(d.disabled=R[2]),C&4&&m!==(m=Es(R[2]?"btn-disabled":"btn")+" svelte-1bwcddv")&&p(u,"class",m),R[2]?N&&(N.d(1),N=null):N?N.p(R,C):(N=ta(R),N.c(),N.m(e,null))},d(R){R&&T(e),ke(S,R),M&&M.d(),N&&N.d(),E=!1,Fe(k)}}}function Ap(t){let e;return{c(){e=_("h1"),e.textContent="選項",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function kp(t){let e,n,l,s,i,o,r;function u(a){t[16](a)}let c={$$slots:{header:[Ap],default:[Ep]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons translate-y-[1px]">settings</i>',n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white rounded-md px-1 text-xs svelte-1bwcddv")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),i=!0,o||(r=I(e,"click",t[8]),o=!0)},p(a,[d]){const m={};d&1048637&&(m.$$scope={dirty:d,ctx:a}),!s&&d&2&&(s=!0,m.showModal=a[1],Ke(()=>s=!1)),l.$set(m)},i(a){i||(P(l.$$.fragment,a),i=!0)},o(a){W(l.$$.fragment,a),i=!1},d(a){a&&T(e),a&&T(n),se(l,a),o=!1,r()}}}function Bp(t,e,n){let l,s,i,o,r,u;Re(t,mn,B=>n(6,s=B)),Re(t,Gt,B=>n(7,i=B)),Re(t,_t,B=>n(3,o=B)),Re(t,hn,B=>n(4,r=B)),Re(t,ye,B=>n(5,u=B));let{files:c}=e,a=!1;const d=()=>n(1,a=!0),m=B=>{ze(_t,o=B+1,o)};function v(){r.popoverDuration=Me(this.value),hn.set(r)}function g(){c=this.files,n(0,c)}const h=B=>{B.currentTarget.value="",n(0,c=void 0)},b=()=>{wp(u)},A=()=>{ze(ye,u=Ht(),u)},E=()=>{ze(ye,u=Ht(),u),Of()};function k(B){a=B,n(1,a)}return t.$$set=B=>{"files"in B&&n(0,c=B.files)},t.$$.update=()=>{t.$$.dirty&192&&n(2,l=i&&!s)},[c,a,l,o,r,u,s,i,d,m,v,g,h,b,A,E,k]}class Cp extends Ce{constructor(e){super(),Oe(this,e,Bp,kp,Be,{files:0})}}function na(t,e,n){const l=t.slice();return l[4]=e[n],l}function la(t){let e;return{c(){e=_("div"),e.textContent="(必須至少達到 1 等級)"},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Op(t){let e,n,l,s,i,o=qt,r=[];for(let u=0;u<o.length;u+=1)r[u]=sa(na(t,o,u));return{c(){e=_("select");for(let u=0;u<r.length;u+=1)r[u].c();e.disabled=l=!t[1]},m(u,c){w(u,e,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null);me(e,t[0].class),s||(i=I(e,"change",t[2]),s=!0)},p(u,c){if(c&0){o=qt;let a;for(a=0;a<o.length;a+=1){const d=na(u,o,a);r[a]?r[a].p(d,c):(r[a]=sa(d),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=o.length}c&1&&n!==(n=u[0].class)&&me(e,u[0].class),c&2&&l!==(l=!u[1])&&(e.disabled=l)},d(u){u&&T(e),ke(r,u),s=!1,i()}}}function Sp(t){let e,n,l,s,i;return{c(){e=_("input"),p(e,"type","text"),e.value=n=t[0].class,e.disabled=l=!t[1]},m(o,r){w(o,e,r),s||(i=I(e,"input",t[2]),s=!0)},p(o,r){r&1&&n!==(n=o[0].class)&&e.value!==n&&(e.value=n),r&2&&l!==(l=!o[1])&&(e.disabled=l)},d(o){o&&T(e),s=!1,i()}}}function sa(t){let e,n=Cl(t[4])+"",l,s;return{c(){e=_("option"),l=G(n),s=y(),e.__value=t[4],e.value=e.__value},m(i,o){w(i,e,o),f(e,l),f(e,s)},p:V,d(i){i&&T(e)}}}function Mp(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h=!t[1]&&la();function b(k,B){return k[0].hasCustomClass?Sp:Op}let A=b(t),E=A(t);return{c(){e=_("div"),n=_("h2"),n.textContent="職業",l=y(),h&&h.c(),s=y(),i=_("div"),o=_("input"),c=y(),a=_("label"),a.textContent="自訂",d=y(),E.c(),m=vt(),p(o,"id","customClass"),p(o,"type","checkbox"),o.disabled=r=!t[1],o.checked=u=t[0].hasCustomClass,p(a,"for","customClass"),p(i,"class","flex items-center gap-1"),p(e,"class","flex justify-between")},m(k,B){w(k,e,B),f(e,n),f(e,l),h&&h.m(e,null),f(e,s),f(e,i),f(i,o),f(i,c),f(i,a),w(k,d,B),E.m(k,B),w(k,m,B),v||(g=I(o,"input",t[3]),v=!0)},p(k,[B]){k[1]?h&&(h.d(1),h=null):h||(h=la(),h.c(),h.m(e,s)),B&2&&r!==(r=!k[1])&&(o.disabled=r),B&1&&u!==(u=k[0].hasCustomClass)&&(o.checked=u),A===(A=b(k))&&E?E.p(k,B):(E.d(1),E=A(k),E&&(E.c(),E.m(m.parentNode,m)))},i:V,o:V,d(k){k&&T(e),h&&h.d(),k&&T(d),E.d(k),k&&T(m),v=!1,g()}}}function Rp(t,e,n){let l,s;Re(t,ye,r=>n(0,s=r));function i(r){const u=r.target.value;Nr(s,u),ye.set(s)}function o(r){ze(ye,s.hasCustomClass=r.target.checked,s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=s.level>=1)},[s,l,i,o]}class $p extends Ce{constructor(e){super(),Oe(this,e,Rp,Mp,Be,{})}}function Dp(t){let e,n,l,s,i,o,r,u,c=t[0].armorClass+"",a,d,m,v,g,h,b;return{c(){e=_("h2"),e.textContent="防禦等級",n=y(),l=_("div"),s=G(t[1]),i=y(),o=_("div"),r=_("span"),u=G("基礎 AC: "),a=G(c),d=y(),m=_("button"),m.innerHTML='<i class="material-icons">remove</i>',v=y(),g=_("button"),g.innerHTML='<i class="material-icons">add</i>',p(l,"class","flex w-full h-full justify-center items-center text-7xl pirata text-center"),p(r,"class","text-sm"),p(o,"class","flex items-center")},m(A,E){w(A,e,E),w(A,n,E),w(A,l,E),f(l,s),w(A,i,E),w(A,o,E),f(o,r),f(r,u),f(r,a),f(o,d),f(o,m),f(o,v),f(o,g),h||(b=[I(m,"click",t[3]),I(g,"click",t[2])],h=!0)},p(A,[E]){E&2&&ee(s,A[1]),E&1&&c!==(c=A[0].armorClass+"")&&ee(a,c)},i:V,o:V,d(A){A&&T(e),A&&T(n),A&&T(l),A&&T(i),A&&T(o),h=!1,Fe(b)}}}function Np(t,e,n){let l,s;Re(t,ye,r=>n(0,s=r));function i(){ze(ye,s.armorClass+=1,s),ye.set(s)}function o(){ze(ye,s.armorClass-=1,s),ye.set(s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=Lr(s))},[s,l,i,o]}class Ip extends Ce{constructor(e){super(),Oe(this,e,Np,Dp,Be,{})}}function Lp(t){let e,n,l;return{c(){e=_("textarea"),p(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(s,i){w(s,e,i),oe(e,t[1].notes),n||(l=I(e,"input",t[3]),n=!0)},p(s,i){i&2&&oe(e,s[1].notes)},d(s){s&&T(e),n=!1,l()}}}function Pp(t){let e;return{c(){e=_("h1"),e.textContent="筆記",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Hp(t){let e,n,l,s,i,o,r;function u(a){t[4](a)}let c={$$slots:{header:[Pp],default:[Lp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons translate-y-1">notes</i>',n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white px-1")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),i=!0,o||(r=I(e,"click",t[2]),o=!0)},p(a,[d]){const m={};d&34&&(m.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,m.showModal=a[0],Ke(()=>s=!1)),l.$set(m)},i(a){i||(P(l.$$.fragment,a),i=!0)},o(a){W(l.$$.fragment,a),i=!1},d(a){a&&T(e),a&&T(n),se(l,a),o=!1,r()}}}function Gp(t,e,n){let l;Re(t,ye,u=>n(1,l=u));let s=!1;const i=()=>n(0,s=!0);function o(){l.notes=this.value,ye.set(l)}function r(u){s=u,n(0,s)}return[s,l,i,o,r]}class Wp extends Ce{constructor(e){super(),Oe(this,e,Gp,Hp,Be,{})}}function ia(t,e,n){const l=t.slice();return l[12]=e[n],l}function oa(t){let e,n,l,s,i;return{c(){e=_("button"),n=_("i"),n.textContent="group",p(n,"class","material-icons translate-y-1"),p(e,"class",l=(t[5]?"bg-black":"bg-green-600")+" text-white px-1")},m(o,r){w(o,e,r),f(e,n),s||(i=I(e,"click",t[9]),s=!0)},p(o,r){r&32&&l!==(l=(o[5]?"bg-black":"bg-green-600")+" text-white px-1")&&p(e,"class",l)},d(o){o&&T(e),s=!1,i()}}}function qp(t){let e;return{c(){e=_("div"),e.textContent="同步中"},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function Up(t){let e,n,l;function s(){return t[10](t[12])}return{c(){e=_("button"),e.textContent="載入",p(e,"class","bg-black text-white p-1 rounded-md px-1")},m(i,o){w(i,e,o),n||(l=I(e,"click",s),n=!0)},p(i,o){t=i},d(i){i&&T(e),n=!1,l()}}}function aa(t){let e,n,l=t[12].name+"",s,i=t[12].id==t[1]?"（你）":"",o,r,u;function c(m,v){if(m[3]!==m[12].id)return Up;if(!m[5])return qp}let a=c(t),d=a&&a(t);return{c(){e=_("div"),n=_("div"),s=G(l),o=G(i),r=y(),d&&d.c(),u=y(),p(e,"class","flex gap-1 justify-between items-center p-1 rounded-md w-full"),$e(e,"bg-yellow-300",t[3]===t[12].id)},m(m,v){w(m,e,v),f(e,n),f(n,s),f(n,o),f(e,r),d&&d.m(e,null),f(e,u)},p(m,v){v&1&&l!==(l=m[12].name+"")&&ee(s,l),v&3&&i!==(i=m[12].id==m[1]?"（你）":"")&&ee(o,i),a===(a=c(m))&&d?d.p(m,v):(d&&d.d(1),d=a&&a(m),d&&(d.c(),d.m(e,u))),v&9&&$e(e,"bg-yellow-300",m[3]===m[12].id)},d(m){m&&T(e),d&&d.d()}}}function Fp(t){let e,n,l,s=t[0],i=[];for(let o=0;o<s.length;o+=1)i[o]=aa(ia(t,s,o));return{c(){e=_("div"),e.textContent="注意：載入其他玩家僅載入其數據。這是玩家角色卡的唯讀預覽。",n=y(),l=_("div");for(let o=0;o<i.length;o+=1)i[o].c();p(e,"class","w-72 mt-4 mb-4"),p(l,"class","flex flex-col gap-1 w-full")},m(o,r){w(o,e,r),w(o,n,r),w(o,l,r);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(l,null)},p(o,r){if(r&107){s=o[0];let u;for(u=0;u<s.length;u+=1){const c=ia(o,s,u);i[u]?i[u].p(c,r):(i[u]=aa(c),i[u].c(),i[u].m(l,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=s.length}},d(o){o&&T(e),o&&T(n),o&&T(l),ke(i,o)}}}function Vp(t){let e;return{c(){e=_("h1"),e.textContent="玩家",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function jp(t){let e,n,l,s,i=t[4]&&oa(t);function o(u){t[11](u)}let r={$$slots:{header:[Vp],default:[Fp]},$$scope:{ctx:t}};return t[2]!==void 0&&(r.showModal=t[2]),n=new ft({props:r}),Ve.push(()=>Ye(n,"showModal",o)),{c(){i&&i.c(),e=y(),ne(n.$$.fragment)},m(u,c){i&&i.m(u,c),w(u,e,c),le(n,u,c),s=!0},p(u,[c]){u[4]?i?i.p(u,c):(i=oa(u),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null);const a={};c&32811&&(a.$$scope={dirty:c,ctx:u}),!l&&c&4&&(l=!0,a.showModal=u[2],Ke(()=>l=!1)),n.$set(a)},i(u){s||(P(n.$$.fragment,u),s=!0)},o(u){W(n.$$.fragment,u),s=!1},d(u){i&&i.d(u),u&&T(e),se(n,u)}}}function zp(t,e,n){let l,s,i,o,r,u;Re(t,kt,h=>n(3,l=h)),Re(t,ss,h=>n(7,s=h)),Re(t,Hn,h=>n(1,i=h)),Re(t,Sn,h=>n(8,o=h)),Re(t,Gt,h=>n(4,r=h)),Re(t,mn,h=>n(5,u=h));let c=!1,a;function d(h){ze(kt,l=h.id,l)}const m=()=>n(2,c=!0),v=h=>d(h);function g(h){c=h,n(2,c)}return t.$$.update=()=>{t.$$.dirty&387&&(n(0,a=o.map(h=>({id:h.id,name:h.name}))),a.unshift({id:i,name:(s==null?void 0:s.name)??"GM"}))},[a,i,c,l,r,u,d,s,o,m,v,g]}class Yp extends Ce{constructor(e){super(),Oe(this,e,zp,jp,Be,{})}}function ra(t,e,n){const l=t.slice();return l[3]=e[n],l}function Kp(t){let e,n,l,s,i=Os,o=[];for(let r=0;r<i.length;r+=1)o[r]=ua(ra(t,i,r));return{c(){e=_("select");for(let r=0;r<o.length;r+=1)o[r].c()},m(r,u){w(r,e,u);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);me(e,t[0].ancestry),l||(s=I(e,"change",t[2]),l=!0)},p(r,u){if(u&0){i=Os;let c;for(c=0;c<i.length;c+=1){const a=ra(r,i,c);o[c]?o[c].p(a,u):(o[c]=ua(a),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=i.length}u&1&&n!==(n=r[0].ancestry)&&me(e,r[0].ancestry)},d(r){r&&T(e),ke(o,r),l=!1,s()}}}function Xp(t){let e,n,l,s;return{c(){e=_("input"),p(e,"type","text"),e.value=n=t[0].ancestry},m(i,o){w(i,e,o),l||(s=I(e,"input",t[2]),l=!0)},p(i,o){o&1&&n!==(n=i[0].ancestry)&&e.value!==n&&(e.value=n)},d(i){i&&T(e),l=!1,s()}}}function ua(t){let e,n=xr(t[3])+"",l,s;return{c(){e=_("option"),l=G(n),s=y(),e.__value=t[3],e.value=e.__value},m(i,o){w(i,e,o),f(e,l),f(e,s)},p:V,d(i){i&&T(e)}}}function Jp(t){let e,n,l,s,i,o,r,u,c,a,d,m;function v(b,A){return b[0].hasCustomAncestry?Xp:Kp}let g=v(t),h=g(t);return{c(){e=_("div"),n=_("h2"),n.textContent="種族",l=y(),s=_("div"),i=_("input"),r=y(),u=_("label"),u.textContent="自訂",c=y(),h.c(),a=vt(),p(i,"id","customAncestry"),p(i,"type","checkbox"),i.checked=o=t[0].hasCustomAncestry,p(u,"for","customAncestry"),p(s,"class","flex items-center gap-1"),p(e,"class","flex justify-between")},m(b,A){w(b,e,A),f(e,n),f(e,l),f(e,s),f(s,i),f(s,r),f(s,u),w(b,c,A),h.m(b,A),w(b,a,A),d||(m=I(i,"input",t[1]),d=!0)},p(b,[A]){A&1&&o!==(o=b[0].hasCustomAncestry)&&(i.checked=o),g===(g=v(b))&&h?h.p(b,A):(h.d(1),h=g(b),h&&(h.c(),h.m(a.parentNode,a)))},i:V,o:V,d(b){b&&T(e),b&&T(c),h.d(b),b&&T(a),d=!1,m()}}}function Zp(t,e,n){let l;Re(t,ye,o=>n(0,l=o));function s(o){ze(ye,l.hasCustomAncestry=o.target.checked,l)}function i(o){const r=o.target.value;Ir(l,r),ye.set(l)}return[l,s,i]}class Qp extends Ce{constructor(e){super(),Oe(this,e,Zp,Jp,Be,{})}}function ca(t,e,n){const l=t.slice();return l[5]=e[n],l}function fa(t){let e,n,l=t[5].msg+"",s,i,o,r=t[2].format(t[5].timestamp)+"",u;return{c(){e=_("div"),n=_("span"),s=G(l),i=y(),o=_("span"),u=G(r),p(o,"class","text-gray-400"),p(e,"class","shadow-sm rounded-md border border-gray-200 p-2 flex flex-col md:flex-row justify-between")},m(c,a){w(c,e,a),f(e,n),f(n,s),f(e,i),f(e,o),f(o,u)},p(c,a){a&2&&l!==(l=c[5].msg+"")&&ee(s,l),a&2&&r!==(r=c[2].format(c[5].timestamp)+"")&&ee(u,r)},d(c){c&&T(e)}}}function da(t){let e,n,l;return{c(){e=_("button"),e.innerHTML=`<i class="material-icons translate-y-1">delete</i>
          清除通知`,p(e,"class","p-2 bg-white")},m(s,i){w(s,e,i),n||(l=I(e,"click",Cf),n=!0)},p:V,d(s){s&&T(e),n=!1,l()}}}function xp(t){let e,n,l,s=t[1],i=[];for(let r=0;r<s.length;r+=1)i[r]=fa(ca(t,s,r));let o=t[1].length&&da();return{c(){e=_("div"),n=_("div");for(let r=0;r<i.length;r+=1)i[r].c();l=y(),o&&o.c(),p(n,"class","flex flex-col gap-1"),p(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(r,u){w(r,e,u),f(e,n);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(n,null);f(n,l),o&&o.m(n,null)},p(r,u){if(u&6){s=r[1];let c;for(c=0;c<s.length;c+=1){const a=ca(r,s,c);i[c]?i[c].p(a,u):(i[c]=fa(a),i[c].c(),i[c].m(n,l))}for(;c<i.length;c+=1)i[c].d(1);i.length=s.length}r[1].length?o?o.p(r,u):(o=da(),o.c(),o.m(n,null)):o&&(o.d(1),o=null)},d(r){r&&T(e),ke(i,r),o&&o.d()}}}function e_(t){let e;return{c(){e=_("h1"),e.textContent="通知",p(e,"slot","header")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function t_(t){let e,n,l,s,i,o,r;function u(a){t[4](a)}let c={$$slots:{header:[e_],default:[xp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),Ve.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons translate-y-1">history</i>',n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white px-1")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),i=!0,o||(r=I(e,"click",t[3]),o=!0)},p(a,[d]){const m={};d&258&&(m.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,m.showModal=a[0],Ke(()=>s=!1)),l.$set(m)},i(a){i||(P(l.$$.fragment,a),i=!0)},o(a){W(l.$$.fragment,a),i=!1},d(a){a&&T(e),a&&T(n),se(l,a),o=!1,r()}}}function n_(t,e,n){let l;Re(t,ls,u=>n(1,l=u));let s=!1;const i=new Intl.DateTimeFormat("zh-TW",{timeStyle:"medium"}),o=()=>n(0,s=!0);function r(u){s=u,n(0,s)}return[s,l,i,o,r]}class l_ extends Ce{constructor(e){super(),Oe(this,e,n_,t_,Be,{})}}function pa(t,e,n){const l=t.slice();return l[23]=e[n],l}function _a(t){let e;return{c(){e=_("div"),e.innerHTML='<i class="material-icons">save</i>...',p(e,"title","save in progress..."),p(e,"class","absolute top-0 left-0 opacity-20 bg-black text-white p-1 rounded-md flex items-center")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function ma(t){let e,n,l,s,i,o,r,u,c;return{c(){e=_("button"),n=_("i"),n.textContent="undo",s=y(),i=_("button"),o=_("i"),o.textContent="redo",p(n,"class","material-icons translate-y-1 px-1"),e.disabled=l=!t[6],p(e,"class","bg-black text-white rounded-md"),$e(e,"opacity-50",!t[6]),p(o,"class","material-icons translate-y-1 px-1"),i.disabled=r=!t[7],p(i,"class","bg-black text-white rounded-md"),$e(i,"opacity-50",!t[7])},m(a,d){w(a,e,d),f(e,n),w(a,s,d),w(a,i,d),f(i,o),u||(c=[I(e,"click",t[11]),I(i,"click",t[12])],u=!0)},p(a,d){d&64&&l!==(l=!a[6])&&(e.disabled=l),d&64&&$e(e,"opacity-50",!a[6]),d&128&&r!==(r=!a[7])&&(i.disabled=r),d&128&&$e(i,"opacity-50",!a[7])},d(a){a&&T(e),a&&T(s),a&&T(i),u=!1,Fe(c)}}}function s_(t){let e,n;return e=new l_({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function i_(t){let e;return{c(){e=G("最高等級")},m(n,l){w(n,e,l)},p:V,d(n){n&&T(e)}}}function o_(t){let e,n,l,s,i,o;return{c(){e=_("input"),n=G(`
              /
              `),l=_("div"),s=G(t[1]),p(e,"id","xp"),p(e,"type","number"),p(e,"inputmode","numeric"),p(e,"min","0"),p(e,"class","svelte-z687v8")},m(r,u){w(r,e,u),oe(e,t[2].xp),w(r,n,u),w(r,l,u),f(l,s),i||(o=I(e,"input",t[16]),i=!0)},p(r,u){u&4&&Me(e.value)!==r[2].xp&&oe(e,r[2].xp),u&2&&ee(s,r[1])},d(r){r&&T(e),r&&T(n),r&&T(l),i=!1,o()}}}function ha(t){let e,n=eu(t[23])+"",l,s;return{c(){e=_("option"),l=G(n),s=y(),e.__value=t[23],e.value=e.__value},m(i,o){w(i,e,o),f(e,l),f(e,s)},p:V,d(i){i&&T(e)}}}function a_(t){let e,n,l,s,i,o,r,u,c,a,d,m,v,g,h,b,A,E,k,B,S,M,N,R,C,O,$,D,F,U,Z,ve,re,de,ae,j,q,K,we,Y,pe,be,X,H,J,he,_e,ue,ce,z,te,Ae,Ie,x,fe,Se,L,ge,Le,Te,nt,lt,jt,Mt,Tt,zt,wn,Je,Ze,bt,yt,Ot,Xe,et,ie,He,Ee,Rt,Wn,is,$t,dl,os,pl,as,Dt,rs,xt,_l,us,St,cs,en,ml,fs,Nt,ds,tn,hl,ps,Yt,_s,nn,qn,ln,ms,Un,sn,on,gl,hs;d=new yp({});let pt=t[4]&&_a(),dt=!t[5]&&ma(t);function nr(Q){t[13](Q)}let gs={};t[0]!==void 0&&(gs.files=t[0]),b=new Cp({props:gs}),Ve.push(()=>Ye(b,"files",nr)),k=new Wp({});let It=je.isAvailable&&s_();M=new Yp({}),C=new pn({props:{forStat:"STR"}}),D=new pn({props:{forStat:"INT"}}),Z=new pn({props:{forStat:"DEX"}}),de=new pn({props:{forStat:"WIS"}}),q=new pn({props:{forStat:"CON"}}),Y=new pn({props:{forStat:"CHA"}}),X=new mp({}),he=new Ip({}),ce=new fp({}),Le=new Qp({}),lt=new $p({});function vs(Q,st){return Q[2].level<10?o_:i_}let Fn=vs(t),Et=Fn(t),an=ks,ot=[];for(let Q=0;Q<an.length;Q+=1)ot[Q]=ha(pa(t,an,Q));return ln=new Bd({}),sn=new ip({}),{c(){e=_("div"),n=_("main"),l=_("div"),s=_("div"),i=_("div"),o=_("div"),r=_("div"),u=_("div"),c=_("h1"),c.textContent="Shadowdark",a=y(),ne(d.$$.fragment),m=y(),pt&&pt.c(),v=y(),g=_("div"),dt&&dt.c(),h=y(),ne(b.$$.fragment),E=y(),ne(k.$$.fragment),B=y(),It&&It.c(),S=y(),ne(M.$$.fragment),N=y(),R=_("div"),ne(C.$$.fragment),O=y(),$=_("div"),ne(D.$$.fragment),F=y(),U=_("div"),ne(Z.$$.fragment),ve=y(),re=_("div"),ne(de.$$.fragment),ae=y(),j=_("div"),ne(q.$$.fragment),K=y(),we=_("div"),ne(Y.$$.fragment),pe=y(),be=_("div"),ne(X.$$.fragment),H=y(),J=_("div"),ne(he.$$.fragment),_e=y(),ue=_("div"),ne(ce.$$.fragment),z=y(),te=_("div"),Ae=_("div"),Ie=_("label"),x=_("h2"),x.textContent="姓名",fe=y(),Se=_("input"),L=y(),ge=_("div"),ne(Le.$$.fragment),Te=y(),nt=_("div"),ne(lt.$$.fragment),jt=y(),Mt=_("div"),Tt=_("label"),zt=_("h2"),zt.textContent="等級",wn=y(),Je=_("input"),Ze=y(),bt=_("div"),yt=_("h2"),yt.textContent="經驗值",Ot=y(),Xe=_("label"),et=y(),ie=_("div"),Et.c(),He=y(),Ee=_("button"),Rt=G("🆙"),is=y(),$t=_("div"),dl=_("h2"),dl.textContent="稱號",os=y(),pl=_("h2"),pl.textContent="稱號",as=y(),Dt=_("input"),rs=y(),xt=_("div"),_l=_("h2"),_l.textContent="陣營",us=y(),St=_("select");for(let Q=0;Q<ot.length;Q+=1)ot[Q].c();cs=y(),en=_("div"),ml=_("h2"),ml.textContent="背景",fs=y(),Nt=_("input"),ds=y(),tn=_("div"),hl=_("h2"),hl.textContent="神祇",ps=y(),Yt=_("input"),_s=y(),nn=_("div"),qn=_("div"),ne(ln.$$.fragment),ms=y(),Un=_("div"),ne(sn.$$.fragment),p(c,"class",""),p(u,"class","flex items-center gap-1"),p(g,"class","-translate-y-2 flex gap-1"),p(r,"class","flex flex-col items-center"),p(o,"class","flex gap-1 justify-around"),p(i,"class","col-span-full cell svelte-z687v8"),p(R,"class","cell svelte-z687v8"),p($,"class","cell svelte-z687v8"),p(U,"class","cell svelte-z687v8"),p(re,"class","cell svelte-z687v8"),p(j,"class","cell svelte-z687v8"),p(we,"class","cell svelte-z687v8"),p(be,"class","row-span-2 cell svelte-z687v8"),p(J,"class","row-span-2 cell svelte-z687v8"),p(ue,"class","col-span-full row-span-2 cell svelte-z687v8"),p(s,"class","flex-[2] min-w-[257px] h-[700px] grid grid-rows-8 grid-cols-2 gap-2"),p(Se,"type","text"),p(Se,"class","svelte-z687v8"),p(Ae,"class","col-span-full cell svelte-z687v8"),p(ge,"class","col-span-full cell svelte-z687v8"),p(nt,"class","col-span-full cell svelte-z687v8"),p(Je,"type","number"),p(Je,"inputmode","numeric"),p(Je,"max","10"),p(Je,"min","1"),p(Je,"class","svelte-z687v8"),p(Mt,"class","cell svelte-z687v8"),p(Xe,"for","xp"),p(Ee,"class","text-2xl"),Ee.disabled=Wn=!t[3],$e(Ee,"opacity-20",!t[3]),p(ie,"class","sheet-stat flex gap-1"),p(bt,"class","cell svelte-z687v8"),p(Dt,"type","text"),p(Dt,"class","svelte-z687v8"),p($t,"class","col-span-full cell svelte-z687v8"),p(St,"class","svelte-z687v8"),t[2].alignment===void 0&&Pe(()=>t[19].call(St)),p(xt,"class","col-span-full cell svelte-z687v8"),p(Nt,"type","text"),p(Nt,"class","svelte-z687v8"),p(en,"class","col-span-full cell svelte-z687v8"),p(Yt,"class","svelte-z687v8"),p(tn,"class","col-span-full cell svelte-z687v8"),p(te,"class","flex-[2] min-w-[257px] h-[700px] grid grid-rows-8 grid-cols-2 gap-2"),p(qn,"class","cell svelte-z687v8"),p(Un,"class","cell svelte-z687v8"),p(nn,"class","flex-[3] min-w-[257px] min-[805px]:h-[700px] grid grid-rows-2 gap-2"),p(l,"id","sheet"),p(l,"class","bg-black min-w-[277px] max-w-[1000px] p-2 flex flex-wrap gap-2"),p(e,"class","flex items-center justify-center bg-black")},m(Q,st){w(Q,e,st),f(e,n),f(n,l),f(l,s),f(s,i),f(i,o),f(o,r),f(r,u),f(u,c),f(u,a),le(d,u,null),f(r,m),pt&&pt.m(r,null),f(r,v),f(r,g),dt&&dt.m(g,null),f(g,h),le(b,g,null),f(g,E),le(k,g,null),f(g,B),It&&It.m(g,null),f(g,S),le(M,g,null),f(s,N),f(s,R),le(C,R,null),f(s,O),f(s,$),le(D,$,null),f(s,F),f(s,U),le(Z,U,null),f(s,ve),f(s,re),le(de,re,null),f(s,ae),f(s,j),le(q,j,null),f(s,K),f(s,we),le(Y,we,null),f(s,pe),f(s,be),le(X,be,null),f(s,H),f(s,J),le(he,J,null),f(s,_e),f(s,ue),le(ce,ue,null),f(l,z),f(l,te),f(te,Ae),f(Ae,Ie),f(Ie,x),f(Ie,fe),f(Ie,Se),oe(Se,t[2].name),f(te,L),f(te,ge),le(Le,ge,null),f(te,Te),f(te,nt),le(lt,nt,null),f(te,jt),f(te,Mt),f(Mt,Tt),f(Tt,zt),f(Tt,wn),f(Tt,Je),oe(Je,t[2].level),f(te,Ze),f(te,bt),f(bt,yt),f(bt,Ot),f(bt,Xe),f(bt,et),f(bt,ie),Et.m(ie,null),f(ie,He),f(ie,Ee),f(Ee,Rt),f(te,is),f(te,$t),f($t,dl),f($t,os),f($t,pl),f($t,as),f($t,Dt),oe(Dt,t[2].title),f(te,rs),f(te,xt),f(xt,_l),f(xt,us),f(xt,St);for(let Kt=0;Kt<ot.length;Kt+=1)ot[Kt]&&ot[Kt].m(St,null);me(St,t[2].alignment,!0),f(te,cs),f(te,en),f(en,ml),f(en,fs),f(en,Nt),oe(Nt,t[2].background),f(te,ds),f(te,tn),f(tn,hl),f(tn,ps),f(tn,Yt),oe(Yt,t[2].deity),f(l,_s),f(l,nn),f(nn,qn),le(ln,qn,null),f(nn,ms),f(nn,Un),le(sn,Un,null),on=!0,gl||(hs=[I(Se,"input",t[14]),I(Je,"input",t[15]),I(Ee,"click",t[17]),I(Dt,"input",t[18]),I(St,"change",t[19]),I(Nt,"input",t[20]),I(Yt,"input",t[21])],gl=!0)},p(Q,[st]){Q[4]?pt||(pt=_a(),pt.c(),pt.m(r,v)):pt&&(pt.d(1),pt=null),Q[5]?dt&&(dt.d(1),dt=null):dt?dt.p(Q,st):(dt=ma(Q),dt.c(),dt.m(g,h));const Kt={};if(!A&&st&1&&(A=!0,Kt.files=Q[0],Ke(()=>A=!1)),b.$set(Kt),st&4&&Se.value!==Q[2].name&&oe(Se,Q[2].name),st&4&&Me(Je.value)!==Q[2].level&&oe(Je,Q[2].level),Fn===(Fn=vs(Q))&&Et?Et.p(Q,st):(Et.d(1),Et=Fn(Q),Et&&(Et.c(),Et.m(ie,He))),(!on||st&8&&Wn!==(Wn=!Q[3]))&&(Ee.disabled=Wn),(!on||st&8)&&$e(Ee,"opacity-20",!Q[3]),st&4&&Dt.value!==Q[2].title&&oe(Dt,Q[2].title),st&0){an=ks;let gt;for(gt=0;gt<an.length;gt+=1){const bs=pa(Q,an,gt);ot[gt]?ot[gt].p(bs,st):(ot[gt]=ha(bs),ot[gt].c(),ot[gt].m(St,null))}for(;gt<ot.length;gt+=1)ot[gt].d(1);ot.length=an.length}st&4&&me(St,Q[2].alignment),st&4&&Nt.value!==Q[2].background&&oe(Nt,Q[2].background),st&4&&Yt.value!==Q[2].deity&&oe(Yt,Q[2].deity)},i(Q){on||(P(d.$$.fragment,Q),P(b.$$.fragment,Q),P(k.$$.fragment,Q),P(It),P(M.$$.fragment,Q),P(C.$$.fragment,Q),P(D.$$.fragment,Q),P(Z.$$.fragment,Q),P(de.$$.fragment,Q),P(q.$$.fragment,Q),P(Y.$$.fragment,Q),P(X.$$.fragment,Q),P(he.$$.fragment,Q),P(ce.$$.fragment,Q),P(Le.$$.fragment,Q),P(lt.$$.fragment,Q),P(ln.$$.fragment,Q),P(sn.$$.fragment,Q),on=!0)},o(Q){W(d.$$.fragment,Q),W(b.$$.fragment,Q),W(k.$$.fragment,Q),W(It),W(M.$$.fragment,Q),W(C.$$.fragment,Q),W(D.$$.fragment,Q),W(Z.$$.fragment,Q),W(de.$$.fragment,Q),W(q.$$.fragment,Q),W(Y.$$.fragment,Q),W(X.$$.fragment,Q),W(he.$$.fragment,Q),W(ce.$$.fragment,Q),W(Le.$$.fragment,Q),W(lt.$$.fragment,Q),W(ln.$$.fragment,Q),W(sn.$$.fragment,Q),on=!1},d(Q){Q&&T(e),se(d),pt&&pt.d(),dt&&dt.d(),se(b),se(k),It&&It.d(),se(M),se(C),se(D),se(Z),se(de),se(q),se(Y),se(X),se(he),se(ce),se(Le),se(lt),Et.d(),ke(ot,Q),se(ln),se(sn),gl=!1,Fe(hs)}}}function r_(t,e,n){let l,s,i,o,r,u,c;Re(t,ye,C=>n(2,i=C)),Re(t,Il,C=>n(4,o=C));const{isGM:a}=Nf;Re(t,a,C=>n(5,r=C)),gr(()=>{If(),je.isAvailable?Xa():Sf()});const{canUndo:d,canRedo:m}=ye;Re(t,d,C=>n(6,u=C)),Re(t,m,C=>n(7,c=C));let v;const g=()=>ye.undo(),h=()=>ye.redo();function b(C){v=C,n(0,v)}function A(){i.name=this.value,ye.set(i)}function E(){i.level=Me(this.value),ye.set(i)}function k(){i.xp=Me(this.value),ye.set(i)}const B=()=>{qr(i),ye.set(i)};function S(){i.title=this.value,ye.set(i)}function M(){i.alignment=Ge(this),ye.set(i)}function N(){i.background=this.value,ye.set(i)}function R(){i.deity=this.value,ye.set(i)}return t.$$.update=()=>{if(t.$$.dirty&1&&v)for(const C of v){C.text().then(O=>{ze(ye,i=dp(O),i)}),n(0,v=void 0);break}t.$$.dirty&4&&wr(i),t.$$.dirty&4&&n(1,l=i.level===0?10:i.level*10),t.$$.dirty&6&&n(3,s=i.level<10&&i.xp>=l)},[v,l,i,s,o,r,u,c,a,d,m,g,h,b,A,E,k,B,S,M,N,R]}class u_ extends Ce{constructor(e){super(),Oe(this,e,r_,a_,Be,{})}}new u_({target:document.getElementById("app")});
