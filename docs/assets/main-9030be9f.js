import{n as j,s as Vr,r as Ve,a as Se,i as jr,g as Ue,S as Oe,b as Me,e as _,c as w,t as P,d,f as E,h as f,l as N,j as Z,k,m as Ee,o as Re,p as $e,q as In,u as zr,v as Yr,w as Nn,x as Ln,y as Pn,z as L,A as G,B as Kr,C as je,D as Ye,E as te,F as ne,G as Ke,H as le,I as Fe,J as V,K as Xr,L as ve,M as He,N as gt,O as Ge,P as We,Q as re,R as kn,T as Ie,U as Jr,V as Wt,W as Ss,X as Zr,Y as Qr,Z as xr,_ as sl,$ as nr,a0 as eu,a1 as Os,a2 as Ms,a3 as tu,a4 as nu,a5 as lu,a6 as lr,a7 as Rs,a8 as su}from"./index-f8344f8c.js";const pn=[];function iu(t,e){return{subscribe:ct(t,e).subscribe}}function ct(t,e=j){let n;const l=new Set;function s(a){if(Se(t,a)&&(t=a,n)){const u=!pn.length;for(const c of l)c[1](),pn.push(c,t);if(u){for(let c=0;c<pn.length;c+=2)pn[c][0](pn[c+1]);pn.length=0}}}function i(a){s(a(t))}function o(a,u=j){const c=[a,u];return l.add(c),l.size===1&&(n=e(s)||j),a(t),()=>{l.delete(c),l.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:o}}function ou(t,e,n){const l=!Array.isArray(t),s=l?[t]:t,i=e.length<2;return iu(n,o=>{let a=!1;const u=[];let c=0,r=j;const p=()=>{if(c)return;r();const b=e(l?u[0]:u,o);i?o(b):r=jr(b)?b:j},m=s.map((b,g)=>Vr(b,h=>{u[g]=h,c&=~(1<<g),a&&p()},()=>{c|=1<<g}));return a=!0,p(),function(){Ve(m),r(),a=!1}})}const sr=[{name:"Padded",type:"Armor",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:11,modifier:0,maxDex:void 0,stealthDisadvantage:!0},weight:8,l10n:{name:"甲冑"}},{name:"Leather Armor",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:11,modifier:0,maxDex:void 0},weight:10,l10n:{name:"皮甲"}},{name:"Studded Leather",type:"Armor",cost:{gp:45,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:12,modifier:0,maxDex:void 0},weight:13,l10n:{name:"鑲釘皮甲"}},{name:"Hide",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:12,modifier:0,maxDex:2},weight:12,l10n:{name:"獸皮甲"}},{name:"Chain Shirt",type:"Armor",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:13,modifier:0,maxDex:2},weight:20,l10n:{name:"鍊甲衫"}},{name:"Scale Mail",type:"Armor",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:14,modifier:0,maxDex:2,stealthDisadvantage:!0},weight:45,l10n:{name:"鱗甲"}},{name:"Breastplate",type:"Armor",cost:{gp:400,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:14,modifier:0,maxDex:2},weight:20,l10n:{name:"胸甲"}},{name:"Half Plate",type:"Armor",cost:{gp:750,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:15,modifier:0,maxDex:2,stealthDisadvantage:!0},weight:40,l10n:{name:"半身板甲"}},{name:"Ring Mail",type:"Armor",cost:{gp:30,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:14,modifier:0,maxDex:0,stealthDisadvantage:!0},weight:40,l10n:{name:"環甲"}},{name:"Chain Mail",type:"Armor",cost:{gp:75,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:16,modifier:0,maxDex:0,stealthDisadvantage:!0},minStr:13,weight:55,l10n:{name:"鎖子甲"}},{name:"Splint",type:"Armor",cost:{gp:200,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:17,modifier:0,maxDex:0,stealthDisadvantage:!0},minStr:15,weight:60,l10n:{name:"條板甲"}},{name:"Plate",type:"Armor",cost:{gp:1500,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:18,modifier:0,maxDex:0,stealthDisadvantage:!0},minStr:15,weight:65,l10n:{name:"全身板甲"}},{name:"Shield",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:2,modifier:0},properties:["Shield"],weight:6,l10n:{name:"盾牌"}}],Vl={};for(const t of sr)Vl[t.name.toLowerCase()]=t;const au=[{name:"Backpack",type:"Basic",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:5,l10n:{name:"背包"}},{name:"Bedroll",type:"Basic",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:7,l10n:{name:"睡袋"}},{name:"Crowbar",type:"Basic",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:5,l10n:{name:"撬棍"}},{name:"Hammer",type:"Basic",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:3,l10n:{name:"鐵鎚"}},{name:"Healer's Kit",type:"Basic",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:3,l10n:{name:"醫藥箱"}},{name:"Holy Water (flask)",type:"Basic",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"聖水 (瓶)"}},{name:"Lantern, bullseye",type:"Basic",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:2,l10n:{name:"靶心提燈"}},{name:"Lantern, hooded",type:"Basic",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:2,l10n:{name:"防風提燈"}},{name:"Lock",type:"Basic",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:1,l10n:{name:"鎖"}},{name:"Mess Kit",type:"Basic",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:1,l10n:{name:"餐具組"}},{name:"Oil (flask)",type:"Basic",cost:{gp:0,sp:1,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"油 (瓶)"}},{name:"Piton",type:"Basic",cost:{gp:0,sp:0,cp:5,ep:0,pp:0},canBeEquipped:!1,weight:.25,l10n:{name:"岩釘"}},{name:"Potion of Healing",type:"Basic",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:.5,l10n:{name:"治療藥水"}},{name:"Rations (1 day)",type:"Basic",cost:{gp:0,sp:5,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:2,l10n:{name:"口糧 (1天份)"}},{name:"Rope, hempen (50 feet)",type:"Basic",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:10,l10n:{name:"麻繩 (50呎)"}},{name:"Rope, silk (50 feet)",type:"Basic",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:5,l10n:{name:"絲繩 (50呎)"}},{name:"Tinderbox",type:"Basic",cost:{gp:0,sp:5,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:1,l10n:{name:"打火匣"}},{name:"Torch",type:"Basic",cost:{gp:0,sp:0,cp:1,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"火把"}},{name:"Waterskin",type:"Basic",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!0,weight:5,l10n:{name:"水袋"}}],jl={};for(const t of au)jl[t.name.toLowerCase()]=t;const ir=[{name:"Eldritch Blast",range:"120 feet",class:"Warlock",tier:0,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"A beam of crackling energy streaks toward a creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 force damage.",l10n:{name:"魔能爆",desc:"一道裂能量光束射向射程內的生物。對目標進行遠程法術攻擊。命中時造成 1d10 力場傷害。"}},{name:"Fire Bolt",range:"120 feet",class:"Wizard",tier:0,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"You hurl a mote of fire at a creature or object within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 fire damage.",l10n:{name:"火焰箭",desc:"你向射程內的生物或物體投擲一團火焰。對目標進行遠程法術攻擊。命中時造成 1d10 火焰傷害。"}},{name:"Light",range:"Touch",class:"Cleric",tier:0,duration:"1 hour",components:{verbal:!0,material:!0,materialDesc:"a firefly or phosphorescent moss"},desc:"You touch one object that is no larger than 10 feet in any dimension. Until the spell ends, the object sheds bright light in a 20-foot radius and dim light for an additional 20 feet.",l10n:{name:"光亮術",desc:"你觸碰一個長寬高不超過 10 呎的物體。在法術結束前，該物體發出半徑 20 呎的明亮光照，以及額外 20 呎的微光光照。"}},{name:"Mage Hand",range:"30 feet",class:"Wizard",tier:0,duration:"1 minute",components:{verbal:!0,somatic:!0},desc:"A spectral, floating hand appears at a point you choose within range. The hand lasts for the duration or until you dismiss it as an action. The hand vanishes if it is ever more than 30 feet away from you or if you cast this spell again.",l10n:{name:"法師之手",desc:"一隻幽靈般的漂浮手掌出現在射程內你選擇的點。手掌持續至持續時間結束，或直到你用一個動作解除它。若手掌距離你超過 30 呎或你再次施展此法術，它會消失。"}},{name:"Guidance",range:"Touch",class:"Cleric",tier:0,duration:"1 minute",components:{verbal:!0,somatic:!0},desc:"Concentration. You touch one willing creature. Once before the spell ends, the target can roll a d4 and add the number rolled to one ability check of its choice.",l10n:{name:"神導術",desc:"專注。你觸碰一名自願生物。在法術結束前，目標可以選擇在一次屬性檢定中擲一顆 d4 並將結果加到檢定值中。"}},{name:"Bless",range:"30 feet",class:"Cleric",tier:1,duration:"1 minute",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a sprinkling of holy water"},desc:"Concentration. You bless up to three creatures of your choice within range. Whenever a target makes an attack roll or a saving throw before the spell ends, the target can roll a d4 and add the number rolled to the attack roll or saving throw.",l10n:{name:"祝福術",desc:"專注。你祝福射程內最多三名生物。在法術結束前，每當目標進行攻擊檢定或豁免檢定時，可以擲一顆 d4 並將結果加到檢定值中。"}},{name:"Cure Wounds",range:"Touch",class:"Cleric",tier:1,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"A creature you touch regains a number of hit points equal to 1d8 + your spellcasting ability modifier.",l10n:{name:"治療傷口",desc:"你觸碰的生物回復 1d8 + 你施法屬性調整值的生命值。"}},{name:"Healing Word",range:"60 feet",class:"Cleric",tier:1,duration:"Instantaneous",components:{verbal:!0},desc:"A creature of your choice that you can see within range regains hit points equal to 1d4 + your spellcasting ability modifier.",l10n:{name:"治癒真言",desc:"射程內你可見的一名生物回復 1d4 + 你施法屬性調整值的生命值。"}},{name:"Magic Missile",range:"120 feet",class:"Wizard",tier:1,duration:"Instantaneous",components:{verbal:!0,somatic:!0},desc:"You create three glowing darts of magical force. Each dart hits a creature of your choice that you can see within range. A dart deals 1d4 + 1 force damage to its target. The darts all strike simultaneously, and you can direct them to hit one creature or several.",l10n:{name:"魔法飛彈",desc:"你創造三支發光的魔法力場飛鏢。每支飛鏢擊中射程內你可見的一個生物。每支飛鏢造成 1d4 + 1 力場傷害。飛鏢同時擊中，你可以指定它們攻擊同一生物或多個生物。"}},{name:"Shield",range:"Self",class:"Wizard",tier:1,duration:"1 round",components:{verbal:!0,somatic:!0},desc:"Reaction. An invisible barrier of magical force appears and protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from magic missile.",l10n:{name:"護盾術",desc:"反應。一道隱形魔法護盾出現保護你。直到你下回合開始，你的 AC 獲得 +5 加值（包含對觸發此反應的攻擊），且魔法飛彈無法對你造成傷害。"}},{name:"Invisibility",range:"Touch",class:"Wizard",tier:2,duration:"1 hour",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"an eyelash encased in gum arabic"},desc:"Concentration. A creature you touch becomes invisible until the spell ends. Anything the target is wearing or carrying is invisible as long as it is on the target's person. The spell ends for a target that attacks or casts a spell.",l10n:{name:"隱形術",desc:"專注。你觸碰的生物變為隱形，直到法術結束。目標穿戴或攜帶的物品也隨之隱形。若目標進行攻擊或施法，該目標的法術即解除。"}},{name:"Misty Step",range:"Self",class:"Wizard",tier:2,duration:"Instantaneous",components:{verbal:!0},desc:"Briefly surrounded by silvery mist, you teleport up to 30 feet to an unoccupied space that you can see.",l10n:{name:"迷蹤步",desc:"被銀色迷霧短暫環繞，你傳送最多 30 呎到你可見的未佔據空間。"}},{name:"Web",range:"60 feet",class:"Wizard",tier:2,duration:"1 hour",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a bit of spiderweb"},desc:"Concentration. You conjure a mass of thick, sticky webbing at a point of your choice within range. The webs fill a 20-foot cube and remain for the duration.",l10n:{name:"蛛網術",desc:"專注。你在射程內的一點召喚大量黏稠蛛網。蛛網填滿 20 呎立方區域，持續至法術結束。"}},{name:"Fireball",range:"150 feet",class:"Wizard",tier:3,duration:"Instantaneous",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a tiny ball of bat guano and sulfur"},desc:"A bright streak flashes from your pointing finger to a point you choose within range and then blossoms with a low roar into an explosion of flame. Each creature in a 20-foot-radius sphere centered on that point must make a Dexterity saving throw. A target takes 8d6 fire damage on a failed save, or half as much damage on a successful one.",l10n:{name:"火球術",desc:"一道亮光從你手指射出，擊中射程內你選擇的一點，隨即爆發出低沉轟鳴與烈焰。以該點為中心半徑 20 呎球形區域內的所有生物必須進行敏捷豁免。失敗者受到 8d6 火焰傷害，成功者傷害減半。"}},{name:"Fly",range:"Touch",class:"Wizard",tier:3,duration:"10 minutes",components:{verbal:!0,somatic:!0,material:!0,materialDesc:"a wing feather from any bird"},desc:"Concentration. You touch a willing creature. The target gains a flying speed of 60 feet for the duration. When the spell ends, the target falls if it is still aloft, unless it can stop the fall.",l10n:{name:"飛行術",desc:"專注。你觸碰一名自願生物。目標獲得 60 呎飛行速度，持續至法術結束。法術結束時，若目標仍在空中且無法阻止墜落，則跌落。"}},{name:"Counterspell",range:"60 feet",class:"Wizard",tier:3,duration:"Instantaneous",components:{somatic:!0},desc:"Reaction. You attempt to interrupt a creature in the process of casting a spell. If the creature is casting a spell of 3rd level or lower, its spell fails and has no effect.",l10n:{name:"法術反制",desc:"反應。你試圖打斷正在施法的生物。若該生物施展的是 3 環或更低階的法術，該法術失敗且無效。"}}],zl={};for(const t of ir)zl[t.name.toLowerCase()]=t;const or=[{name:"Club",type:"Weapon",cost:{gp:0,sp:1,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light"],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"棍棒"}},{name:"Dagger",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Piercing"},weight:1,l10n:{name:"匕首"}},{name:"Greatclub",type:"Weapon",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Two-Handed"],range:"5 ft",weaponType:"Simple Melee",damage:{twoHanded:{diceType:"d8",numDice:1},damageType:"Bludgeoning"},weight:10,l10n:{name:"巨棒"}},{name:"Handaxe",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Slashing"},weight:2,l10n:{name:"手斧"}},{name:"Javelin",type:"Weapon",cost:{gp:0,sp:5,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Thrown"],range:"30/120",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"標槍"}},{name:"Light Hammer",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"輕鎚"}},{name:"Mace",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Bludgeoning"},weight:4,l10n:{name:"釘頭錘"}},{name:"Quarterstaff",type:"Weapon",cost:{gp:0,sp:2,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},twoHanded:{diceType:"d8",numDice:1},damageType:"Bludgeoning"},weight:4,l10n:{name:"長棍"}},{name:"Sickle",type:"Weapon",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Light"],range:"5 ft",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Slashing"},weight:2,l10n:{name:"鐮刀"}},{name:"Spear",type:"Weapon",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Thrown","Versatile"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d6",numDice:1},twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:3,l10n:{name:"矛"}},{name:"Crossbow, light",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Loading","Two-Handed"],range:"80/320",weaponType:"Simple Ranged",damage:{twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:5,l10n:{name:"輕型十字弓"}},{name:"Dart",type:"Weapon",cost:{gp:0,sp:0,cp:5,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Thrown"],range:"20/60",weaponType:"Simple Ranged",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Piercing"},weight:.25,l10n:{name:"飛鏢"}},{name:"Shortbow",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Two-Handed"],range:"80/320",weaponType:"Simple Ranged",damage:{twoHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"短弓"}},{name:"Sling",type:"Weapon",cost:{gp:0,sp:1,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition"],range:"30/120",weaponType:"Simple Ranged",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Bludgeoning"},weight:0,l10n:{name:"投石索"}},{name:"Battleaxe",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:4,l10n:{name:"戰斧"}},{name:"Flail",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"連枷"}},{name:"Glaive",type:"Weapon",cost:{gp:20,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Reach","Two-Handed"],range:"10 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:6,l10n:{name:"關刀"}},{name:"Greataxe",type:"Weapon",cost:{gp:30,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Two-Handed"],range:"5 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d12",numDice:1},damageType:"Slashing"},weight:7,l10n:{name:"巨斧"}},{name:"Greatsword",type:"Weapon",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Two-Handed"],range:"5 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d6",numDice:2},damageType:"Slashing"},weight:6,l10n:{name:"巨劍"}},{name:"Halberd",type:"Weapon",cost:{gp:20,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Reach","Two-Handed"],range:"10 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:6,l10n:{name:"長戟"}},{name:"Lance",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Reach","Special"],range:"10 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d12",numDice:1},damageType:"Piercing"},weight:6,l10n:{name:"騎槍"}},{name:"Longsword",type:"Weapon",cost:{gp:15,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1},damageType:"Slashing"},weight:3,l10n:{name:"長劍"}},{name:"Maul",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Two-Handed"],range:"5 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d6",numDice:2},damageType:"Bludgeoning"},weight:10,l10n:{name:"巨鎚"}},{name:"Morningstar",type:"Weapon",cost:{gp:15,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:4,l10n:{name:"晨星鎚"}},{name:"Pike",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Heavy","Reach","Two-Handed"],range:"10 ft",weaponType:"Martial Melee",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Piercing"},weight:18,l10n:{name:"長矛"}},{name:"Rapier",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"刺劍"}},{name:"Scimitar",type:"Weapon",cost:{gp:25,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Slashing"},weight:3,l10n:{name:"彎刀"}},{name:"Shortsword",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"短劍"}},{name:"Trident",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Thrown","Versatile"],range:"20/60",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d6",numDice:1},twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:4,l10n:{name:"三叉戟"}},{name:"War Pick",type:"Weapon",cost:{gp:5,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:[],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"戰鎬"}},{name:"Warhammer",type:"Weapon",cost:{gp:15,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Versatile"],range:"5 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d8",numDice:1},twoHanded:{diceType:"d10",numDice:1},damageType:"Bludgeoning"},weight:2,l10n:{name:"戰鎚"}},{name:"Whip",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Reach"],range:"10 ft",weaponType:"Martial Melee",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Slashing"},weight:3,l10n:{name:"鞭子"}},{name:"Blowgun",type:"Weapon",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Loading"],range:"25/100",weaponType:"Martial Ranged",damage:{oneHanded:{diceType:"d4",numDice:1},damageType:"Piercing"},weight:1,l10n:{name:"吹箭筒"}},{name:"Crossbow, hand",type:"Weapon",cost:{gp:75,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Light","Loading"],range:"30/120",weaponType:"Martial Ranged",damage:{oneHanded:{diceType:"d6",numDice:1},damageType:"Piercing"},weight:3,l10n:{name:"手弩"}},{name:"Crossbow, heavy",type:"Weapon",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Heavy","Loading","Two-Handed"],range:"100/400",weaponType:"Martial Ranged",damage:{twoHanded:{diceType:"d10",numDice:1},damageType:"Piercing"},weight:18,l10n:{name:"重型十字弓"}},{name:"Longbow",type:"Weapon",cost:{gp:50,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Ammunition","Heavy","Two-Handed"],range:"150/600",weaponType:"Martial Ranged",damage:{twoHanded:{diceType:"d8",numDice:1},damageType:"Piercing"},weight:2,l10n:{name:"長弓"}},{name:"Net",type:"Weapon",cost:{gp:1,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Special","Thrown"],range:"5/15",weaponType:"Martial Ranged",damage:{oneHanded:{diceType:"d4",numDice:0}},weight:3,l10n:{name:"網"}}],Yl={};for(const t of or)Yl[t.name.toLowerCase()]=t;let Kl=[],ar=[];function ru(t){Kl=t.customGear??[],ar=t.customSpells??[]}function rr(t){return Yl[t.toLowerCase()]??du(t)}function uu(t){return Vl[t.toLowerCase()]}function cu(t){return jl[t.toLowerCase()]}function fu(t){return ar.find(e=>e.name.toLowerCase()===t.toLowerCase())}function ur(t){return zl[t.toLowerCase()]||fu(t)}function cr(t){return Kl.find(e=>e.name.toLowerCase()===t.toLowerCase())}function du(t){return Kl.filter(e=>e.type==="Weapon").map(e=>e).find(e=>e.name.toLowerCase()===t.toLowerCase())}function Qe(t){return rr(t)||uu(t)||cu(t)||cr(t)}const pu=["Shield","+1","+2","+3","Magic"],$s=["Self","Touch","5 ft","10 ft","30 ft","60 ft","120 ft","Sight"],Ft=["d4","d6","d8","d10","d12","d20","d100"],_u="1.0.0",mu="dnd5e-char-sheet",Mt=["STR","DEX","CON","INT","WIS","CHA"],Ds=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],Is=["Simple Melee","Simple Ranged","Martial Melee","Martial Ranged"],hu=["Ammunition","Finesse","Heavy","Light","Loading","Range","Reach","Special","Thrown","Two-Handed","Versatile","Silvered","Magical"],gu=["armorClass","hp","proficiencyBonus","speed","initiative","passivePerception","stat","skill"],Rl=["attackRoll","damageRoll","savingThrow","skillCheck","abilityCheck","initiativeRoll"],Ns=[...gu,...Rl],Ut=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard","Artificer"],Ls=["Dragonborn","Dwarf","Elf","Gnome","Half-Elf","Half-Orc","Halfling","Human","Tiefling"],Ps=["Common","Dwarvish","Elvish","Giant","Gnomish","Goblin","Halfling","Orc","Abyssal","Celestial","Draconic","Deep Speech","Infernal","Primordial","Sylvan","Undercommon"],Hs=["Acrobatics","Animal Handling","Arcana","Athletics","Deception","History","Insight","Intimidation","Investigation","Medicine","Nature","Perception","Performance","Persuasion","Religion","Sleight of Hand","Stealth","Survival"],Gs=["Blinded","Charmed","Deafened","Frightened","Grappled","Incapacitated","Invisible","Paralyzed","Petrified","Poisoned","Prone","Restrained","Stunned","Unconscious","Exhaustion"],bu={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100};function Gt(t,e=1){let n=0;for(let l=0;l<e;l++)n+=Math.floor(Math.random()*bu[t])+1;return n}function Hn(t){return`${t>=0?"+":""}${t}`}function tl(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),t<e?-1:t>e?1:0}function Ws(t){return Qe(t.name)}function Xl(t,e=500,n,l){let s;return(...i)=>(n==null||n(),new Promise(o=>{s&&clearTimeout(s),s=setTimeout(()=>{o(t(...i)),l==null||l()},e)}))}function Fs(t,e){return Ft.findIndex(n=>n===t)-Ft.findIndex(n=>n===e)}const vu=100;function yu(t){const e=[Ue(t)];let n=0;const l=ct(!1),s=ct(!1),i=Xl(o=>{if(o){for(n++,e[n]=JSON.parse(JSON.stringify(o));n<e.length-1;)e.pop();e.length>vu&&(e.splice(0,1),n=Math.max(0,n-1)),l.set(!0),s.set(!1)}},1e3);return{subscribe:t.subscribe,canUndo:l,canRedo:s,set:o=>{i(o),t.set(o)},undo:()=>{n!==0&&(n--,n===0&&l.set(!1),s.set(!0),t.set(e[n]))},redo:()=>{n>=e.length-1||(n++,n>=e.length-1&&s.set(!1),l.set(!0),t.set(e[n]))}}}const wu={Barbarian:"野蠻人",Bard:"吟遊詩人",Cleric:"牧師",Druid:"德魯伊",Fighter:"戰士",Monk:"武僧",Paladin:"聖騎士",Ranger:"巡林客",Rogue:"盜賊",Sorcerer:"術士",Warlock:"邪術師",Wizard:"法師",Artificer:"奇械師"},Tu={Dragonborn:"龍裔",Dwarf:"矮人",Elf:"精靈",Gnome:"地侏","Half-Elf":"半精靈","Half-Orc":"半獸人",Halfling:"哈比人",Human:"人類",Tiefling:"堤夫林"},Eu={"Lawful Good":"守序善良","Neutral Good":"中立善良","Chaotic Good":"混沌善良","Lawful Neutral":"守序中立","True Neutral":"絕對中立","Chaotic Neutral":"混沌中立","Lawful Evil":"守序邪惡","Neutral Evil":"中立邪惡","Chaotic Evil":"混沌邪惡"},ku={STR:"力量",DEX:"敏捷",CON:"體質",INT:"智力",WIS:"感知",CHA:"魅力"},Au={Common:"通用語",Dwarvish:"矮人語",Elvish:"精靈語",Giant:"巨人語",Gnomish:"地侏語",Goblin:"哥布林語",Halfling:"哈比人語",Orc:"獸人語",Abyssal:"深淵語",Celestial:"天界語",Draconic:"龍語","Deep Speech":"地底語",Infernal:"煉獄語",Primordial:"原初語",Sylvan:"森林語",Undercommon:"地底通用語"};function $l(t){return t?wu[t]??t:""}function Bu(t){return t?Tu[t]??t:""}function fr(t){return t?Eu[t]??t:""}function Vt(t){return t?ku[t]??t:""}function Dl(t){return t?Au[t]??t:""}const he=yu(ct(Ct())),ae=he;function Ct(){return{name:"",ancestry:"Human",class:"",level:1,title:"",alignment:"True Neutral",background:"Noble",deity:"",notes:"",gear:[],customGear:[],stats:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10},skills:{Acrobatics:0,"Animal Handling":0,Arcana:0,Athletics:0,Deception:0,History:0,Insight:0,Intimidation:0,Investigation:0,Medicine:0,Nature:0,Perception:0,Performance:0,Persuasion:0,Religion:0,"Sleight of Hand":0,Stealth:0,Survival:0},savingThrows:{STR:!1,DEX:!1,CON:!1,INT:!1,WIS:!1,CHA:!1},proficiencyBonus:2,passivePerception:10,speed:30,bonuses:[],customBonuses:[],customTalents:[],maxHitPoints:10,hitPoints:10,tempHitPoints:0,hitDice:{},deathSaves:{successes:0,failures:0},conditions:[],exhaustion:0,armorClass:0,carryingCapacity:150,currency:{cp:0,sp:0,ep:0,gp:0,pp:0},languages:["Common"],customLanguages:[],xp:0,spells:[],customSpells:[],spellSlots:{}}}function Il(t){const e=Ct();return t?{...e,...t,stats:{...e.stats,...t.stats||{}},skills:{...e.skills,...t.skills||{}},savingThrows:{...e.savingThrows,...t.savingThrows||{}},currency:{...e.currency,...t.currency||{}},hitDice:{...e.hitDice,...t.hitDice||{}},deathSaves:{...e.deathSaves,...t.deathSaves||{}},gear:Array.isArray(t.gear)?t.gear:[],customGear:Array.isArray(t.customGear)?t.customGear:[],spells:Array.isArray(t.spells)?t.spells:[],customSpells:Array.isArray(t.customSpells)?t.customSpells:[],bonuses:Array.isArray(t.bonuses)?t.bonuses:[],customBonuses:Array.isArray(t.customBonuses)?t.customBonuses:[],customTalents:Array.isArray(t.customTalents)?t.customTalents:[],conditions:Array.isArray(t.conditions)?t.conditions:[],languages:Array.isArray(t.languages)?t.languages:[],customLanguages:Array.isArray(t.customLanguages)?t.customLanguages:[],proficiencyBonus:t.proficiencyBonus??e.proficiencyBonus,armorClass:t.armorClass===10?0:t.armorClass??e.armorClass,maxHitPoints:t.maxHitPoints??e.maxHitPoints,hitPoints:t.hitPoints??e.hitPoints}:e}function fl(t){return t<=0?2:Math.ceil(t/4)+1}function Rt(t,e){const n=Jl(t,e);return Math.floor((n-10)/2)}function Cu(t,e){t.class=e}function Su(t,e){t.ancestry=e}function dl(t){const e=(t.gear||[]).filter(i=>i.equipped).flatMap(i=>{const o=Qe(i.name);return(o==null?void 0:o.playerBonuses)||[]}),n=(t.customGear||[]).filter(i=>i.equipped).flatMap(i=>i.playerBonuses||[]),l=t.bonuses||[],s=t.customBonuses||[];return[...l,...s,...e,...n]}function Jl(t,e){return t.stats[e]+pr(t,e)}function Zl(t,e){var i,o;const n=!t.metadata,l=((i=t.metadata)==null?void 0:i.type)==="weaponType"&&e.weaponType.includes(t.metadata.weaponType),s=((o=t.metadata)==null?void 0:o.type)==="weapon"&&t.metadata.weapon===e.name;return n||l||s}function dr(t,e,n){var o;let l=((o=e.damage[n])==null?void 0:o.diceType)??"d4";const i=dl(t).filter(a=>a.type==="diceType"&&a.bonusTo==="damageRoll"&&Zl(a,e)).map(a=>a.diceType).sort(Fs).reverse();return i[0]&&Fs(i[0],l)>0&&(l=i[0]),l}function pr(t,e){return dl(t).filter(l=>{var s;return l.type==="modifyAmt"&&l.bonusTo==="stat"&&((s=l.metadata)==null?void 0:s.type)==="stat"&&l.metadata.stat===e}).reduce((l,s)=>l+en(t,s),0)}function Ou(t){let e=0;const n=t.gear.filter(a=>a.equipped).map(Ws).filter(a=>{var u;return a.type==="Armor"&&!((u=a.properties)!=null&&u.includes("Shield"))}),l=Rt(t,"DEX");if(n.length>0){const a=n[0],u=a.ac.base;let c=l;a.ac.maxDex!==void 0&&(a.ac.maxDex===0?c=0:c=Math.min(l,a.ac.maxDex)),e=u+c,e+=a.ac.modifier}else e=10+l;const s=t.gear.filter(a=>a.equipped).map(Ws).filter(a=>{var u;return a.type==="Armor"&&((u=a.properties)==null?void 0:u.includes("Shield"))});for(const a of s)e+=a.ac.base>0?a.ac.base:2,e+=a.ac.modifier;const o=dl(t).reduce((a,u)=>u.type==="modifyAmt"&&u.bonusTo==="armorClass"?a+en(t,u):a,0);return e+=o,e+=t.armorClass,e}function Mu(t){if(t.title)return t.title;const e=fr(t.alignment),n=t.background||"",l=t.class||"",s=t.level;return`${[e,n,l].filter(o=>o).join(" ")} (Lv. ${s})`}function _r(t,e="Wizard"){const n=fl(t.level);let l="INT";["Cleric","Druid","Ranger"].includes(t.class||"")&&(l="WIS"),["Bard","Paladin","Sorcerer","Warlock"].includes(t.class||"")&&(l="CHA");const s=Rt(t,l);return n+s}function Ru(t){return 8+_r(t)}function Gn(t,e){var o,a,u;let n=0;const l=Rt(t,"STR"),s=Rt(t,"DEX");(o=e.properties)!=null&&o.includes("Finesse")||e.weaponType&&e.weaponType.includes("Ranged")?e.weaponType.includes("Ranged")&&!((a=e.properties)!=null&&a.includes("Thrown"))?n+=s:(u=e.properties)!=null&&u.includes("Finesse")?n+=Math.max(l,s):n+=l:n+=l;const i=t.bonuses.filter(c=>c.type==="modifyAmt"&&c.bonusTo==="damageRoll").reduce((c,r)=>(Zl(r,e)&&(c+=en(t,r)),c),0);return n+=i,n}function qs(t,e){var a,u;let n=0;const l=Rt(t,"STR"),s=Rt(t,"DEX");(a=e.properties)!=null&&a.includes("Finesse")?n+=Math.max(l,s):e.weaponType.includes("Ranged")&&!((u=e.properties)!=null&&u.includes("Thrown"))?n+=s:n+=l;const i=fl(t.level);n+=i;const o=t.bonuses.filter(c=>c.type==="modifyAmt"&&c.bonusTo==="attackRoll").reduce((c,r)=>(Zl(r,e)&&(c+=en(t,r)),c),0);return n+=o,n}function $u(t){return Jl(t,"STR")*15}function Du(t){return t.gear.reduce((e,n)=>{const l=Qe(n.name);return e+((l==null?void 0:l.weight)||0)*n.quantity},0)}const Iu=[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3,1e5,12e4,14e4,165e3,195e3,225e3,265e3,305e3,355e3],pl=20;function mr(t){return t>=pl||t<1?0:Iu[t]}function hr(t){return t.level>=pl?!1:t.xp>=mr(t.level)}function Nu(t){hr(t)&&(t.level+=1)}function gr(t,e){return t.spells.findIndex(n=>n.name===e.name)>-1}function Lu(t,e){return!0}function Pu(t,e){gr(t,e)||t.spells.push({name:e.name})}function Hu(t,e){t.spells=t.spells.filter(n=>n.name!==e.name)}function Sn(t,e){t.bonuses.push(e)}function Gu(t,e){t.bonuses=t.bonuses.filter(n=>n.name!==e.name)}function Us(t){const e=t.maxHitPoints,l=dl(t).filter(s=>s.type==="modifyAmt"&&s.bonusTo==="hp").reduce((s,i)=>s+en(t,i),0);return e+l}function en(t,e){var s;let n=e.bonusAmount;e.bonusTo!=="stat"&&((s=e.metadata)==null?void 0:s.type)==="stat"&&(n=Math.max(n,Rt(t,e.metadata.stat)));const l=Math.floor(t.level*(e.bonusIncreaseRatePerLevel??0));return n+l}function Wu(t,e){t.spells=t.spells.filter(n=>n.name!==e.name),t.bonuses=t.bonuses.filter(n=>{var l;return!(((l=n.metadata)==null?void 0:l.type)==="spell"&&n.metadata.spell===e.name)}),t.customSpells=t.customSpells.filter(n=>n.name!==e.name)}function Fu(t,e){var s,i,o;const n=e.cost.gp*100+e.cost.sp*10+e.cost.cp;return(((s=t.currency)==null?void 0:s.gp)||0)*100+(((i=t.currency)==null?void 0:i.sp)||0)*10+(((o=t.currency)==null?void 0:o.cp)||0)>=n}function qu(t,e){let n="WIS";switch(e){case"Athletics":n="STR";break;case"Acrobatics":case"Sleight of Hand":case"Stealth":n="DEX";break;case"Arcana":case"History":case"Investigation":case"Nature":case"Religion":n="INT";break;case"Animal Handling":case"Insight":case"Medicine":case"Perception":case"Survival":n="WIS";break;case"Deception":case"Intimidation":case"Performance":case"Persuasion":n="CHA";break}const l=Rt(t,n),s=t.skills[e]||0,i=Math.floor(fl(t.level)*s);return l+i}function Vs(t,e,n){const l=t.slice();return l[8]=e[n],l}function js(t,e,n){const l=t.slice();return l[8]=e[n],l}function zs(t){let e,n,l,s,i=Ps.filter(t[2]),o=[];for(let a=0;a<i.length;a+=1)o[a]=Ys(js(t,i,a));return{c(){e=_("select"),n=_("option");for(let a=0;a<o.length;a+=1)o[a].c();n.__value="",n.value=n.__value,d(e,"class","flex-grow")},m(a,u){E(a,e,u),f(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);l||(s=N(e,"change",t[3]),l=!0)},p(a,u){if(u&4){i=Ps.filter(a[2]);let c;for(c=0;c<i.length;c+=1){const r=js(a,i,c);o[c]?o[c].p(r,u):(o[c]=Ys(r),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=i.length}},d(a){a&&k(e),Ee(o,a),l=!1,s()}}}function Ys(t){let e,n=Dl(t[8])+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[8],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function Ks(t){let e,n,l=Dl(t[8])+"",s,i,o,a,u,c;function r(){return t[6](t[8])}return{c(){e=_("li"),n=_("div"),s=P(l),i=w(),o=_("button"),o.innerHTML='<i class="material-icons translate-y-1">delete</i>',a=w(),d(o,"class","text-white bg-black p-1 text-xs"),d(e,"class","border-b flex justify-between gap-4")},m(p,m){E(p,e,m),f(e,n),f(n,s),f(e,i),f(e,o),f(e,a),u||(c=N(o,"click",r),u=!0)},p(p,m){t=p,m&2&&l!==(l=Dl(t[8])+"")&&Z(s,l)},d(p){p&&k(e),u=!1,c()}}}function Uu(t){let e,n,l,s,i,o=t[0]?"do_not_disturb_on":"add_circle",a,u,c,r,p,m,b=t[0]&&zs(t),g=t[1].languages,h=[];for(let y=0;y<g.length;y+=1)h[y]=Ks(Vs(t,g,y));return{c(){e=_("div"),n=_("h2"),n.textContent="語言",l=w(),s=_("button"),i=_("i"),a=P(o),u=w(),b&&b.c(),c=w(),r=_("ul");for(let y=0;y<h.length;y+=1)h[y].c();d(i,"class","material-icons translate-y-1"),d(s,"class","px-3 hover:bg-gray-400"),d(e,"class","flex justify-start")},m(y,v){E(y,e,v),f(e,n),f(e,l),f(e,s),f(s,i),f(i,a),f(e,u),b&&b.m(e,null),E(y,c,v),E(y,r,v);for(let T=0;T<h.length;T+=1)h[T]&&h[T].m(r,null);p||(m=N(s,"click",t[5]),p=!0)},p(y,[v]){if(v&1&&o!==(o=y[0]?"do_not_disturb_on":"add_circle")&&Z(a,o),y[0]?b?b.p(y,v):(b=zs(y),b.c(),b.m(e,null)):b&&(b.d(1),b=null),v&18){g=y[1].languages;let T;for(T=0;T<g.length;T+=1){const A=Vs(y,g,T);h[T]?h[T].p(A,v):(h[T]=Ks(A),h[T].c(),h[T].m(r,null))}for(;T<h.length;T+=1)h[T].d(1);h.length=g.length}},i:j,o:j,d(y){y&&k(e),b&&b.d(),y&&k(c),y&&k(r),Ee(h,y),p=!1,m()}}}function Vu(t,e,n){let l;Re(t,he,p=>n(1,l=p));let s=!1;function i(p){return!l.languages.includes(p)}function o(p){l.languages.push(p),n(0,s=!1),he.set(l)}function a(p){o(p.target.value)}function u(p){$e(he,l.languages=l.languages.filter(m=>m!==p),l)}return[s,l,i,a,u,()=>{n(0,s=!s)},p=>{u(p)}]}class ju extends Oe{constructor(e){super(),Me(this,e,Vu,Uu,Se,{})}}const zu=t=>({}),Xs=t=>({});function Yu(t){let e,n,l,s,i,o,a,u,c,r,p,m,b;const g=t[5].header,h=In(g,t,t[4],Xs),y=t[5].default,v=In(y,t,t[4],null);return{c(){e=_("dialog"),n=_("div"),l=_("button"),l.innerHTML='<i class="material-icons">close</i>',s=w(),h&&h.c(),i=w(),o=_("hr"),a=w(),v&&v.c(),u=w(),c=_("hr"),d(l,"class","absolute top-0 right-0 p-4 hover:bg-gray-200 rounded-md"),d(n,"class","svelte-eyp6eo"),d(e,"class","max-w-3xl svelte-eyp6eo"),d(e,"style",r=`min-width: 20rem; width: ${t[1]}vw;`+t[2]?`height: ${t[2]}vh`:"")},m(T,A){E(T,e,A),f(e,n),f(n,l),f(n,s),h&&h.m(n,null),f(n,i),f(n,o),f(n,a),v&&v.m(n,null),f(n,u),f(n,c),t[8](e),p=!0,m||(b=[N(l,"click",t[7]),N(n,"click",zr(t[6])),N(e,"close",t[9]),N(e,"click",Yr(t[10]))],m=!0)},p(T,[A]){h&&h.p&&(!p||A&16)&&Nn(h,g,T,T[4],p?Pn(g,T[4],A,zu):Ln(T[4]),Xs),v&&v.p&&(!p||A&16)&&Nn(v,y,T,T[4],p?Pn(y,T[4],A,null):Ln(T[4]),null),(!p||A&6&&r!==(r=`min-width: 20rem; width: ${T[1]}vw;`+T[2]?`height: ${T[2]}vh`:""))&&d(e,"style",r)},i(T){p||(L(h,T),L(v,T),p=!0)},o(T){G(h,T),G(v,T),p=!1},d(T){T&&k(e),h&&h.d(T),v&&v.d(T),t[8](null),m=!1,Ve(b)}}}function Ku(t,e,n){let{$$slots:l={},$$scope:s}=e,{showModal:i=!0}=e,{vw:o=85}=e,{vh:a=void 0}=e,u;function c(g){Kr.call(this,t,g)}const r=()=>{n(0,i=!1)};function p(g){je[g?"unshift":"push"](()=>{u=g,n(3,u)})}const m=()=>n(0,i=!1),b=()=>u.close();return t.$$set=g=>{"showModal"in g&&n(0,i=g.showModal),"vw"in g&&n(1,o=g.vw),"vh"in g&&n(2,a=g.vh),"$$scope"in g&&n(4,s=g.$$scope)},t.$$.update=()=>{t.$$.dirty&9&&u&&(i?u.showModal():u.close())},[i,o,a,u,s,l,c,r,p,m,b]}class ft extends Oe{constructor(e){super(),Me(this,e,Ku,Yu,Se,{showModal:0,vw:1,vh:2})}}const il={};function Js(t,e,n){const l=t.slice();return l[27]=e[n],l}function Zs(t,e,n){const l=t.slice();return l[30]=e[n],l}function Qs(t,e,n){const l=t.slice();return l[33]=e[n],l[35]=n,l}function xs(t,e,n){const l=t.slice();l[36]=e[n],l[35]=n;const s=il[l[2].class][l[35]];return l[37]=s,l}function ei(t){var c,r,p;let e,n,l=(t[36].min===t[36].max?t[36].min:`${t[36].min}-${t[36].max}`)+"",s,i,o,a=(((r=(c=t[37])==null?void 0:c.l10n)==null?void 0:r.name)??((p=t[37])==null?void 0:p.name))+"",u;return{c(){e=_("tr"),n=_("td"),s=P(l),i=w(),o=_("td"),u=P(a),d(e,"class","border-b border-black"),V(e,"bg-yellow-300",t[1]===t[35])},m(m,b){E(m,e,b),f(e,n),f(n,s),f(e,i),f(e,o),f(o,u)},p(m,b){var g,h,y;b[0]&4&&a!==(a=(((h=(g=m[37])==null?void 0:g.l10n)==null?void 0:h.name)??((y=m[37])==null?void 0:y.name))+"")&&Z(u,a),b[0]&2&&V(e,"bg-yellow-300",m[1]===m[35])},d(m){m&&k(e)}}}function ti(t){let e,n,l;return{c(){e=_("button"),e.textContent="擲骰",d(e,"class","w-full bg-black text-white p-1")},m(s,i){E(s,e,i),n||(l=N(e,"click",t[11]),n=!0)},p:j,d(s){s&&k(e),n=!1,l()}}}function ni(t){let e,n,l,s,i,o,a,u,c,r,p;return c=Xr(t[18][0]),{c(){e=_("div"),n=_("label"),n.textContent="選擇天賦",l=w(),s=_("input"),i=w(),o=_("label"),o.textContent="分配屬性",a=w(),u=_("input"),d(n,"for","chooseTalentCheckBox"),d(s,"id","chooseTalentCheckBox"),d(s,"type","radio"),d(s,"name","pick"),s.__value="talent",s.value=s.__value,d(o,"for","distributeStatsCheckBox"),d(u,"id","distributeStatsCheckBox"),d(u,"type","radio"),d(u,"name","pick"),u.__value="stats",u.value=u.__value,d(e,"class","flex gap-5 items-center justify-center p-2"),c.p(s,u)},m(m,b){E(m,e,b),f(e,n),f(e,l),f(e,s),s.checked=s.__value===t[7],f(e,i),f(e,o),f(e,a),f(e,u),u.checked=u.__value===t[7],r||(p=[N(s,"change",t[17]),N(u,"change",t[19])],r=!0)},p(m,b){b[0]&128&&(s.checked=s.__value===m[7]),b[0]&128&&(u.checked=u.__value===m[7])},d(m){m&&k(e),c.r(),r=!1,Ve(p)}}}function li(t){let e,n,l,s=il[t[2].class],i=[];for(let o=0;o<s.length;o+=1)i[o]=si(Qs(t,s,o));return{c(){e=_("select");for(let o=0;o<i.length;o+=1)i[o].c();d(e,"class","w-full svelte-ox30w2")},m(o,a){E(o,e,a);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);ve(e,t[1]),n||(l=N(e,"change",t[13]),n=!0)},p(o,a){if(a[0]&4){s=il[o[2].class];let u;for(u=0;u<s.length;u+=1){const c=Qs(o,s,u);i[u]?i[u].p(c,a):(i[u]=si(c),i[u].c(),i[u].m(e,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=s.length}a[0]&2&&ve(e,o[1])},d(o){o&&k(e),Ee(i,o),n=!1,l()}}}function si(t){var s;let e,n=(((s=t[33].l10n)==null?void 0:s.name)??t[33].name)+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[35],e.value=e.__value},m(i,o){E(i,e,o),f(e,l)},p(i,o){var a;o[0]&4&&n!==(n=(((a=i[33].l10n)==null?void 0:a.name)??i[33].name)+"")&&Z(l,n)},d(i){i&&k(e)}}}function ii(t){let e,n,l,s,i,o=Mt,a=[];for(let u=0;u<o.length;u+=1)a[u]=oi(Zs(t,o,u));return{c(){e=_("div"),n=P("剩餘屬性點數: "),l=P(t[8]),s=w(),i=_("div");for(let u=0;u<a.length;u+=1)a[u].c();d(e,"class","self-center"),d(i,"class","flex flex-col gap-1 items-center")},m(u,c){E(u,e,c),f(e,n),f(e,l),E(u,s,c),E(u,i,c);for(let r=0;r<a.length;r+=1)a[r]&&a[r].m(i,null)},p(u,c){if(c[0]&256&&Z(l,u[8]),c[0]&49668){o=Mt;let r;for(r=0;r<o.length;r+=1){const p=Zs(u,o,r);a[r]?a[r].p(p,c):(a[r]=oi(p),a[r].c(),a[r].m(i,null))}for(;r<a.length;r+=1)a[r].d(1);a.length=o.length}},d(u){u&&k(e),u&&k(s),u&&k(i),Ee(a,u)}}}function oi(t){let e,n,l=t[30]+"",s,i,o,a=t[9][t[30]]+"",u,c,r,p,m,b,g,h;function y(){return t[20](t[30])}function v(){return t[21](t[30])}return{c(){e=_("div"),n=_("div"),s=P(l),i=w(),o=_("div"),u=P(a),c=w(),r=_("button"),r.innerHTML='<i class="material-icons">remove</i>',p=w(),m=_("button"),m.innerHTML='<i class="material-icons">add</i>',b=w(),d(n,"class","w-12"),d(o,"class","p-1 bg-gray-200 rounded-md"),V(o,"text-green-600",t[9][t[30]]>t[2].stats[t[30]]),d(e,"class","flex items-center")},m(T,A){E(T,e,A),f(e,n),f(n,s),f(e,i),f(e,o),f(o,u),f(e,c),f(e,r),f(e,p),f(e,m),f(e,b),g||(h=[N(r,"click",y),N(m,"click",v)],g=!0)},p(T,A){t=T,A[0]&512&&a!==(a=t[9][t[30]]+"")&&Z(u,a),A[0]&516&&V(o,"text-green-600",t[9][t[30]]>t[2].stats[t[30]])},d(T){T&&k(e),g=!1,Ve(h)}}}function ai(t){let e,n,l,s=t[5],i=[];for(let o=0;o<s.length;o+=1)i[o]=ri(Js(t,s,o));return{c(){e=_("select");for(let o=0;o<i.length;o+=1)i[o].c();d(e,"class","svelte-ox30w2"),t[6]===void 0&&He(()=>t[22].call(e))},m(o,a){E(o,e,a);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);ve(e,t[6],!0),n||(l=N(e,"change",t[22]),n=!0)},p(o,a){if(a[0]&32){s=o[5];let u;for(u=0;u<s.length;u+=1){const c=Js(o,s,u);i[u]?i[u].p(c,a):(i[u]=ri(c),i[u].c(),i[u].m(e,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=s.length}a[0]&96&&ve(e,o[6])},d(o){o&&k(e),Ee(i,o),n=!1,l()}}}function ri(t){let e,n=ci(t[27])+"",l,s;return{c(){e=_("option"),l=P(n),e.__value=s=t[27],e.value=e.__value},m(i,o){E(i,e,o),f(e,l)},p(i,o){o[0]&32&&n!==(n=ci(i[27])+"")&&Z(l,n),o[0]&32&&s!==(s=i[27])&&(e.__value=s,e.value=e.__value)},d(i){i&&k(e)}}}function ui(t){let e,n,l;return{c(){e=_("button"),e.textContent="更新角色卡",d(e,"class","w-full bg-black text-white p-1")},m(s,i){E(s,e,i),n||(l=N(e,"click",t[12]),n=!0)},p:j,d(s){s&&k(e),n=!1,l()}}}function Xu(t){let e,n,l,s,i,o,a,u,c,r,p,m,b=t[10],g=[];for(let O=0;O<b.length;O+=1)g[O]=ei(xs(t,b,O));let h=t[3]&&ti(t),y=t[1]===4&&ni(t),v=t[7]==="talent"&&li(t),T=t[7]==="stats"&&ii(t),A=t[5].length&&ai(t),B=t[4]&&ui(t);return{c(){e=_("table"),n=_("tr"),n.innerHTML=`<th class="w-20">2d6</th> 
      <th>效果</th>`,l=w();for(let O=0;O<g.length;O+=1)g[O].c();s=w(),i=_("tr"),i.innerHTML=`<td>12</td> 
      <td>選擇一項天賦或 +2 點數分配至屬性</td>`,o=w(),h&&h.c(),a=w(),u=_("div"),y&&y.c(),c=w(),v&&v.c(),r=w(),T&&T.c(),p=w(),A&&A.c(),m=w(),B&&B.c(),d(n,"class","text-left border-b border-black"),d(i,"class","border-b border-black"),V(i,"bg-yellow-300",t[1]===4),d(u,"class","flex flex-col gap-1")},m(O,R){E(O,e,R),f(e,n),f(e,l);for(let D=0;D<g.length;D+=1)g[D]&&g[D].m(e,null);f(e,s),f(e,i),E(O,o,R),h&&h.m(O,R),E(O,a,R),E(O,u,R),y&&y.m(u,null),f(u,c),v&&v.m(u,null),f(u,r),T&&T.m(u,null),f(u,p),A&&A.m(u,null),f(u,m),B&&B.m(u,null)},p(O,R){if(R[0]&1030){b=O[10];let D;for(D=0;D<b.length;D+=1){const M=xs(O,b,D);g[D]?g[D].p(M,R):(g[D]=ei(M),g[D].c(),g[D].m(e,s))}for(;D<g.length;D+=1)g[D].d(1);g.length=b.length}R[0]&2&&V(i,"bg-yellow-300",O[1]===4),O[3]?h?h.p(O,R):(h=ti(O),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null),O[1]===4?y?y.p(O,R):(y=ni(O),y.c(),y.m(u,c)):y&&(y.d(1),y=null),O[7]==="talent"?v?v.p(O,R):(v=li(O),v.c(),v.m(u,r)):v&&(v.d(1),v=null),O[7]==="stats"?T?T.p(O,R):(T=ii(O),T.c(),T.m(u,p)):T&&(T.d(1),T=null),O[5].length?A?A.p(O,R):(A=ai(O),A.c(),A.m(u,m)):A&&(A.d(1),A=null),O[4]?B?B.p(O,R):(B=ui(O),B.c(),B.m(u,null)):B&&(B.d(1),B=null)},d(O){O&&k(e),Ee(g,O),O&&k(o),h&&h.d(O),O&&k(a),O&&k(u),y&&y.d(),v&&v.d(),T&&T.d(),A&&A.d(),B&&B.d()}}}function Ju(t){let e;return{c(){e=_("h2"),e.textContent="擲新天賦",d(e,"slot","header"),d(e,"class","text-lg")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Zu(t){let e,n,l,s,i,o,a;function u(r){t[23](r)}let c={$$slots:{header:[Ju],default:[Xu]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),je.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.textContent="擲新天賦",n=w(),te(l.$$.fragment),d(e,"class","bg-black text-white w-full p-2")},m(r,p){E(r,e,p),E(r,n,p),ne(l,r,p),i=!0,o||(a=N(e,"click",t[16]),o=!0)},p(r,p){const m={};p[0]&1022|p[1]&256&&(m.$$scope={dirty:p,ctx:r}),!s&&p[0]&1&&(s=!0,m.showModal=r[0],Ke(()=>s=!1)),l.$set(m)},i(r){i||(L(l.$$.fragment,r),i=!0)},o(r){G(l.$$.fragment,r),i=!1},d(r){r&&k(e),r&&k(n),le(l,r),o=!1,a()}}}function ci(t){var e;return Array.isArray(t)?t.map(n=>{var l;return((l=n.l10n)==null?void 0:l.name)??n.name}).join(" & "):((e=t.l10n)==null?void 0:e.name)??t.name}function Qu(t,e,n){let l,s;Re(t,ae,q=>n(2,s=q));let i=!1;const o=[{min:2,max:2},{min:3,max:7},{min:8,max:9},{min:10,max:11}];let a=!0,u=!1,c=-1;function r(){const q=Gt("d6")+Gt("d6");if(n(3,a=!1),q===12){n(1,c=4),n(4,u=!0);return}for(let F=0;F<o.length;F++){const ie=o[F];if(q>=ie.min&&q<=ie.max){n(1,c=F),n(4,u=!0);break}}}let p=[],m,b=()=>{};function g(q){const F=il[s.class][q];switch(F==null?void 0:F.type){case"generic":b=()=>{Sn(s,{name:F.name,desc:F.name,type:"generic",editable:!0})};break;case"bonus":b=()=>{for(const fe of F.bonuses)Sn(s,fe)};break;case"chooseBonus":const ie=F.choices[0];!Array.isArray(ie)&&ie.metadata&&ie.metadata.type==="spell"?n(5,p=F.choices.filter(fe=>s.spells.find(me=>{var ue;return me.name===((ue=fe.metadata)==null?void 0:ue.spell)}))):n(5,p=F.choices);break}}function h(){n(3,a=!0),n(1,c=-1),n(4,u=!1),n(5,p=[]),n(6,m=void 0),n(7,v=void 0),n(8,T=2),n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})}function y(){if(v==="stats")$e(ae,s.stats=l,s);else if(m)if(Array.isArray(m))for(const q of m)Sn(s,q);else Sn(s,m);else b();ae.set(s),n(0,i=!1)}let v,T=2;function A(q){n(5,p=[]),g(parseInt(q.target.value))}function B(q){T<1||(n(9,l[q]+=1,l),n(8,T-=1))}function O(q){T===2||l[q]-1<s.stats[q]||(n(9,l[q]=Math.max(s.stats[q],l[q]-1),l),n(8,T+=1))}const R=[[]],D=()=>n(0,i=!0);function M(){v=this.__value,n(7,v)}function S(){v=this.__value,n(7,v)}const C=q=>O(q),$=q=>B(q);function I(){m=Fe(this),n(6,m),n(5,p)}function z(q){i=q,n(0,i)}return t.$$.update=()=>{t.$$.dirty[0]&1&&(i||h()),t.$$.dirty[0]&2&&c>-1&&g(c),t.$$.dirty[0]&4&&n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})},[i,c,s,a,u,p,m,v,T,l,o,r,y,A,B,O,D,M,R,S,C,$,I,z]}class xu extends Oe{constructor(e){super(),Me(this,e,Qu,Zu,Se,{},null,[-1,-1])}}function ec(t){let e,n,l,s,i=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",o,a,u=t[1].diceType+"",c;return{c(){e=_("div"),n=P(t[3]),l=w(),s=_("div"),o=P(i),a=w(),c=P(u),d(e,"class","font-bold")},m(r,p){E(r,e,p),f(e,n),E(r,l,p),E(r,s,p),f(s,o),f(s,a),f(s,c)},p(r,p){p&8&&Z(n,r[3]),p&2&&i!==(i=(r[5][r[1].bonusTo]??r[1].bonusTo)+"")&&Z(o,i),p&2&&u!==(u=r[1].diceType+"")&&Z(c,u)},d(r){r&&k(e),r&&k(l),r&&k(s)}}}function tc(t){let e,n,l,s,i=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",o,a,u=t[1].type==="advantage"?"優勢":"劣勢",c;return{c(){e=_("div"),n=P(t[3]),l=w(),s=_("div"),o=P(i),a=w(),c=P(u),d(e,"class","font-bold")},m(r,p){E(r,e,p),f(e,n),E(r,l,p),E(r,s,p),f(s,o),f(s,a),f(s,c)},p(r,p){p&8&&Z(n,r[3]),p&2&&i!==(i=(r[5][r[1].bonusTo]??r[1].bonusTo)+"")&&Z(o,i),p&2&&u!==(u=r[1].type==="advantage"?"優勢":"劣勢")&&Z(c,u)},d(r){r&&k(e),r&&k(l),r&&k(s)}}}function nc(t){let e,n,l,s,i=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",o,a,u=Hn(en(t[4],t[1]))+"",c;return{c(){e=_("div"),n=P(t[3]),l=w(),s=_("div"),o=P(i),a=w(),c=P(u),d(e,"class","font-bold")},m(r,p){E(r,e,p),f(e,n),E(r,l,p),E(r,s,p),f(s,o),f(s,a),f(s,c)},p(r,p){p&8&&Z(n,r[3]),p&2&&i!==(i=(r[5][r[1].bonusTo]??r[1].bonusTo)+"")&&Z(o,i),p&18&&u!==(u=Hn(en(r[4],r[1]))+"")&&Z(c,u)},d(r){r&&k(e),r&&k(l),r&&k(s)}}}function lc(t){var s;let e,n=(((s=t[1].l10n)==null?void 0:s.desc)??t[1].desc)+"",l;return{c(){e=_("div"),l=P(n)},m(i,o){E(i,e,o),f(e,l)},p(i,o){var a;o&2&&n!==(n=(((a=i[1].l10n)==null?void 0:a.desc)??i[1].desc)+"")&&Z(l,n)},d(i){i&&k(e)}}}function fi(t){let e,n,l;return{c(){e=_("button"),e.innerHTML='<i class="material-icons">info</i>'},m(s,i){E(s,e,i),n||(l=N(e,"click",t[8]),n=!0)},p:j,d(s){s&&k(e),n=!1,l()}}}function di(t){let e,n,l,s;return{c(){e=_("div"),n=_("button"),n.innerHTML='<i class="material-icons">delete</i>',d(n,"class","pt-1 px-1 rounded-md bg-black text-white"),d(e,"class","flex gap-1")},m(i,o){E(i,e,o),f(e,n),l||(s=N(n,"click",t[9]),l=!0)},p:j,d(i){i&&k(e),l=!1,s()}}}function pi(t){let e,n,l;function s(o){t[10](o)}let i={$$slots:{header:[ic],default:[sc]},$$scope:{ctx:t}};return t[2]!==void 0&&(i.showModal=t[2]),e=new ft({props:i}),je.push(()=>Ye(e,"showModal",s)),{c(){te(e.$$.fragment)},m(o,a){ne(e,o,a),l=!0},p(o,a){const u={};a&2050&&(u.$$scope={dirty:a,ctx:o}),!n&&a&4&&(n=!0,u.showModal=o[2],Ke(()=>n=!1)),e.$set(u)},i(o){l||(L(e.$$.fragment,o),l=!0)},o(o){G(e.$$.fragment,o),l=!1},d(o){le(e,o)}}}function sc(t){let e,n,l=t[1].desc+"",s,i,o,a,u=(t[1].bonusSource??"none")+"",c,r,p,m,b=(t[1].editable??"no")+"",g;return{c(){e=_("div"),n=P("Description: "),s=P(l),i=w(),o=_("div"),a=P("Source: "),c=P(u),r=w(),p=_("div"),m=P("Editable: "),g=P(b)},m(h,y){E(h,e,y),f(e,n),f(e,s),E(h,i,y),E(h,o,y),f(o,a),f(o,c),E(h,r,y),E(h,p,y),f(p,m),f(p,g)},p(h,y){y&2&&l!==(l=h[1].desc+"")&&Z(s,l),y&2&&u!==(u=(h[1].bonusSource??"none")+"")&&Z(c,u),y&2&&b!==(b=(h[1].editable??"no")+"")&&Z(g,b)},d(h){h&&k(e),h&&k(i),h&&k(o),h&&k(r),h&&k(p)}}}function ic(t){let e,n=t[1].name+"",l;return{c(){e=_("h2"),l=P(n),d(e,"slot","header")},m(s,i){E(s,e,i),f(e,l)},p(s,i){i&2&&n!==(n=s[1].name+"")&&Z(l,n)},d(s){s&&k(e)}}}function oc(t){let e,n,l,s,i,o,a;function u(g,h){if(g[1].type==="generic")return lc;if(g[1].type==="modifyAmt")return nc;if(g[1].type==="disadvantage"||g[1].type==="advantage")return tc;if(g[1].type==="diceType")return ec}let c=u(t),r=c&&c(t),p=t[0]&&fi(t),m=t[1].editable&&di(t),b=t[2]&&pi(t);return{c(){e=_("div"),n=_("div"),r&&r.c(),l=w(),p&&p.c(),s=w(),m&&m.c(),i=w(),b&&b.c(),o=gt(),d(n,"class","flex gap-1"),d(e,"class","flex justify-between gap-3 items-center")},m(g,h){E(g,e,h),f(e,n),r&&r.m(n,null),f(n,l),p&&p.m(n,null),f(e,s),m&&m.m(e,null),E(g,i,h),b&&b.m(g,h),E(g,o,h),a=!0},p(g,[h]){c===(c=u(g))&&r?r.p(g,h):(r&&r.d(1),r=c&&c(g),r&&(r.c(),r.m(n,l))),g[0]?p?p.p(g,h):(p=fi(g),p.c(),p.m(n,null)):p&&(p.d(1),p=null),g[1].editable?m?m.p(g,h):(m=di(g),m.c(),m.m(e,null)):m&&(m.d(1),m=null),g[2]?b?(b.p(g,h),h&4&&L(b,1)):(b=pi(g),b.c(),L(b,1),b.m(o.parentNode,o)):b&&(Ge(),G(b,1,1,()=>{b=null}),We())},i(g){a||(L(b),a=!0)},o(g){G(b),a=!1},d(g){g&&k(e),r&&r.d(),p&&p.d(),m&&m.d(),g&&k(i),b&&b.d(g),g&&k(o)}}}function ac(t,e,n){let l,s;Re(t,ae,g=>n(4,s=g));let{bonus:i}=e,{showInfo:o=!0}=e,a=!1;const u={attackRoll:"攻擊檢定",damageRoll:"傷害",armorClass:"AC",hp:"生命值",gearSlots:"裝備格",spellcastRoll:"施法檢定",backstabDice:"背刺骰",initiativeRoll:"先攻",hpRoll:"生命值擲骰",stat:"屬性",statRoll:"屬性檢定"};let c="";function r(g){Gu(s,g),ae.set(s)}const p=()=>{n(2,a=!0)},m=()=>r(l);function b(g){a=g,n(2,a)}return t.$$set=g=>{"bonus"in g&&n(7,i=g.bonus),"showInfo"in g&&n(0,o=g.showInfo)},t.$$.update=()=>{var g,h,y,v;if(t.$$.dirty&128&&n(1,l=i),t.$$.dirty&2)switch((g=l.metadata)==null?void 0:g.type){case"weapon":{const T=Qe(l.metadata.weapon);n(3,c=(((h=T==null?void 0:T.l10n)==null?void 0:h.name)??l.metadata.weapon)+":");break}case"weaponType":{n(3,c=({Melee:"近戰",Ranged:"遠程",MeleeRanged:"近戰/遠程"}[l.metadata.weaponType]??l.metadata.weaponType)+":");break}case"armor":{const T=Qe(l.metadata.armor);n(3,c=(((y=T==null?void 0:T.l10n)==null?void 0:y.name)??l.metadata.armor)+":");break}case"stat":{n(3,c=Vt(l.metadata.stat)+":");break}case"spell":{const T=ur(l.metadata.spell);n(3,c=(((v=T==null?void 0:T.l10n)==null?void 0:v.name)??l.metadata.spell)+":");break}default:n(3,c="")}},[o,l,a,c,s,u,r,i,p,m,b]}class Ql extends Oe{constructor(e){super(),Me(this,e,ac,oc,Se,{bonus:7,showInfo:0})}}function _i(t,e,n){const l=t.slice();return l[44]=e[n],l}function mi(t,e,n){const l=t.slice();return l[39]=e[n],l}function hi(t,e,n){const l=t.slice();return l[39]=e[n],l}function gi(t,e,n){const l=t.slice();return l[36]=e[n],l}function bi(t,e,n){const l=t.slice();return l[33]=e[n],l}function vi(t,e,n){const l=t.slice();return l[47]=e[n],l}function yi(t,e,n){const l=t.slice();return l[50]=e[n],l}function wi(t,e,n){const l=t.slice();return l[50]=e[n],l}function Ti(t){let e,n,l,s,i,o;function a(r,p){return r[10]==="diceType"||r[10]==="advantage"||r[10]==="disadvantage"?uc:rc}let u=a(t),c=u(t);return{c(){e=_("div"),n=_("label"),n.textContent="加值對象:",l=w(),s=_("select"),c.c(),d(n,"for","bto"),d(n,"class","font-bold"),d(s,"id","bto"),d(s,"class","border p-1 rounded"),t[2]===void 0&&He(()=>t[23].call(s)),d(e,"class","flex flex-col")},m(r,p){E(r,e,p),f(e,n),f(e,l),f(e,s),c.m(s,null),ve(s,t[2],!0),i||(o=N(s,"change",t[23]),i=!0)},p(r,p){u===(u=a(r))&&c?c.p(r,p):(c.d(1),c=u(r),c&&(c.c(),c.m(s,null))),p[0]&4&&ve(s,r[2])},d(r){r&&k(e),c.d(),i=!1,o()}}}function rc(t){let e,n=Ns,l=[];for(let s=0;s<n.length;s+=1)l[s]=Ei(yi(t,n,s));return{c(){for(let s=0;s<l.length;s+=1)l[s].c();e=gt()},m(s,i){for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(s,i);E(s,e,i)},p(s,i){if(i[0]&262144){n=Ns;let o;for(o=0;o<n.length;o+=1){const a=yi(s,n,o);l[o]?l[o].p(a,i):(l[o]=Ei(a),l[o].c(),l[o].m(e.parentNode,e))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}},d(s){Ee(l,s),s&&k(e)}}}function uc(t){let e,n=Rl,l=[];for(let s=0;s<n.length;s+=1)l[s]=ki(wi(t,n,s));return{c(){for(let s=0;s<l.length;s+=1)l[s].c();e=gt()},m(s,i){for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(s,i);E(s,e,i)},p(s,i){if(i[0]&262144){n=Rl;let o;for(o=0;o<n.length;o+=1){const a=wi(s,n,o);l[o]?l[o].p(a,i):(l[o]=ki(a),l[o].c(),l[o].m(e.parentNode,e))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}},d(s){Ee(l,s),s&&k(e)}}}function Ei(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[50],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function ki(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[50],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function cc(t){let e,n,l,s,i,o,a=Ft,u=[];for(let c=0;c<a.length;c+=1)u[c]=Ai(vi(t,a,c));return{c(){e=_("div"),n=_("label"),n.textContent="骰子類型",l=w(),s=_("select");for(let c=0;c<u.length;c+=1)u[c].c();d(n,"for","diceType"),d(n,"class","font-bold"),d(s,"id","diceType"),d(s,"class","border p-1 rounded"),t[12]===void 0&&He(()=>t[25].call(s)),d(e,"class","flex flex-col")},m(c,r){E(c,e,r),f(e,n),f(e,l),f(e,s);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(s,null);ve(s,t[12],!0),i||(o=N(s,"change",t[25]),i=!0)},p(c,r){if(r&0){a=Ft;let p;for(p=0;p<a.length;p+=1){const m=vi(c,a,p);u[p]?u[p].p(m,r):(u[p]=Ai(m),u[p].c(),u[p].m(s,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=a.length}r[0]&4096&&ve(s,c[12])},d(c){c&&k(e),Ee(u,c),i=!1,o()}}}function fc(t){let e,n,l,s,i,o;return{c(){e=_("div"),n=_("label"),n.textContent="數值多少?",l=w(),s=_("input"),d(n,"for","modifyAmt"),d(n,"class","font-bold"),d(s,"id","modifyAmt"),d(s,"type","number"),d(s,"inputmode","numeric"),d(s,"class","border p-1 rounded"),d(e,"class","flex flex-col")},m(a,u){E(a,e,u),f(e,n),f(e,l),f(e,s),re(s,t[11]),i||(o=N(s,"input",t[24]),i=!0)},p(a,u){u[0]&2048&&Ie(s.value)!==a[11]&&re(s,a[11])},d(a){a&&k(e),i=!1,o()}}}function Ai(t){let e,n=t[47]+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[47],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function dc(t){let e,n,l,s,i,o=Is,a=[];for(let u=0;u<o.length;u+=1)a[u]=Bi(_i(t,o,u));return{c(){e=_("label"),e.textContent="選擇武器類型",n=w(),l=_("select");for(let u=0;u<a.length;u+=1)a[u].c();d(e,"for","weaponType"),d(l,"id","weaponType"),d(l,"class","border p-1 rounded w-full"),t[8]===void 0&&He(()=>t[31].call(l))},m(u,c){E(u,e,c),E(u,n,c),E(u,l,c);for(let r=0;r<a.length;r+=1)a[r]&&a[r].m(l,null);ve(l,t[8],!0),s||(i=N(l,"change",t[31]),s=!0)},p(u,c){if(c&0){o=Is;let r;for(r=0;r<o.length;r+=1){const p=_i(u,o,r);a[r]?a[r].p(p,c):(a[r]=Bi(p),a[r].c(),a[r].m(l,null))}for(;r<a.length;r+=1)a[r].d(1);a.length=o.length}c[0]&256&&ve(l,u[8])},d(u){u&&k(e),u&&k(n),u&&k(l),Ee(a,u),s=!1,i()}}}function pc(t){let e,n,l,s,i,o=Mt,a=[];for(let u=0;u<o.length;u+=1)a[u]=Ci(mi(t,o,u));return{c(){e=_("label"),e.textContent="選擇屬性",n=w(),l=_("select");for(let u=0;u<a.length;u+=1)a[u].c();d(e,"for","stat"),d(l,"id","stat"),d(l,"class","border p-1 rounded w-full"),t[7]===void 0&&He(()=>t[30].call(l))},m(u,c){E(u,e,c),E(u,n,c),E(u,l,c);for(let r=0;r<a.length;r+=1)a[r]&&a[r].m(l,null);ve(l,t[7],!0),s||(i=N(l,"change",t[30]),s=!0)},p(u,c){if(c&0){o=Mt;let r;for(r=0;r<o.length;r+=1){const p=mi(u,o,r);a[r]?a[r].p(p,c):(a[r]=Ci(p),a[r].c(),a[r].m(l,null))}for(;r<a.length;r+=1)a[r].d(1);a.length=o.length}c[0]&128&&ve(l,u[7])},d(u){u&&k(e),u&&k(n),u&&k(l),Ee(a,u),s=!1,i()}}}function _c(t){let e,n,l,s,i,o=t[14],a=[];for(let u=0;u<o.length;u+=1)a[u]=Si(hi(t,o,u));return{c(){e=_("label"),e.textContent="選擇法術",n=w(),l=_("select");for(let u=0;u<a.length;u+=1)a[u].c();d(e,"for","spell"),d(l,"id","spell"),d(l,"class","border p-1 rounded w-full"),t[6]===void 0&&He(()=>t[29].call(l))},m(u,c){E(u,e,c),E(u,n,c),E(u,l,c);for(let r=0;r<a.length;r+=1)a[r]&&a[r].m(l,null);ve(l,t[6],!0),s||(i=N(l,"change",t[29]),s=!0)},p(u,c){if(c[0]&16384){o=u[14];let r;for(r=0;r<o.length;r+=1){const p=hi(u,o,r);a[r]?a[r].p(p,c):(a[r]=Si(p),a[r].c(),a[r].m(l,null))}for(;r<a.length;r+=1)a[r].d(1);a.length=o.length}c[0]&16448&&ve(l,u[6])},d(u){u&&k(e),u&&k(n),u&&k(l),Ee(a,u),s=!1,i()}}}function mc(t){let e,n,l,s,i,o=t[15],a=[];for(let u=0;u<o.length;u+=1)a[u]=Oi(gi(t,o,u));return{c(){e=_("label"),e.textContent="選擇防具",n=w(),l=_("select");for(let u=0;u<a.length;u+=1)a[u].c();d(e,"for","armor"),d(l,"id","armor"),d(l,"class","border p-1 rounded w-full"),t[5]===void 0&&He(()=>t[28].call(l))},m(u,c){E(u,e,c),E(u,n,c),E(u,l,c);for(let r=0;r<a.length;r+=1)a[r]&&a[r].m(l,null);ve(l,t[5],!0),s||(i=N(l,"change",t[28]),s=!0)},p(u,c){if(c[0]&32768){o=u[15];let r;for(r=0;r<o.length;r+=1){const p=gi(u,o,r);a[r]?a[r].p(p,c):(a[r]=Oi(p),a[r].c(),a[r].m(l,null))}for(;r<a.length;r+=1)a[r].d(1);a.length=o.length}c[0]&32800&&ve(l,u[5])},d(u){u&&k(e),u&&k(n),u&&k(l),Ee(a,u),s=!1,i()}}}function hc(t){let e,n,l,s,i,o=t[16],a=[];for(let u=0;u<o.length;u+=1)a[u]=Mi(bi(t,o,u));return{c(){e=_("label"),e.textContent="選擇武器",n=w(),l=_("select");for(let u=0;u<a.length;u+=1)a[u].c();d(e,"for","weapon"),d(l,"id","weapon"),d(l,"class","border p-1 rounded w-full"),t[4]===void 0&&He(()=>t[27].call(l))},m(u,c){E(u,e,c),E(u,n,c),E(u,l,c);for(let r=0;r<a.length;r+=1)a[r]&&a[r].m(l,null);ve(l,t[4],!0),s||(i=N(l,"change",t[27]),s=!0)},p(u,c){if(c[0]&65536){o=u[16];let r;for(r=0;r<o.length;r+=1){const p=bi(u,o,r);a[r]?a[r].p(p,c):(a[r]=Mi(p),a[r].c(),a[r].m(l,null))}for(;r<a.length;r+=1)a[r].d(1);a.length=o.length}c[0]&65552&&ve(l,u[4])},d(u){u&&k(e),u&&k(n),u&&k(l),Ee(a,u),s=!1,i()}}}function Bi(t){let e,n=t[44]+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[44],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function Ci(t){let e,n=Vt(t[39])+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[39],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function Si(t){var i;let e,n=(((i=t[39].l10n)==null?void 0:i.name)??t[39].name)+"",l,s;return{c(){e=_("option"),l=P(n),e.__value=s=t[39].name,e.value=e.__value},m(o,a){E(o,e,a),f(e,l)},p(o,a){var u;a[0]&16384&&n!==(n=(((u=o[39].l10n)==null?void 0:u.name)??o[39].name)+"")&&Z(l,n),a[0]&16384&&s!==(s=o[39].name)&&(e.__value=s,e.value=e.__value)},d(o){o&&k(e)}}}function Oi(t){var i;let e,n=(((i=t[36].l10n)==null?void 0:i.name)??t[36].name)+"",l,s;return{c(){e=_("option"),l=P(n),e.__value=s=t[36].name,e.value=e.__value},m(o,a){E(o,e,a),f(e,l)},p(o,a){var u;a[0]&32768&&n!==(n=(((u=o[36].l10n)==null?void 0:u.name)??o[36].name)+"")&&Z(l,n),a[0]&32768&&s!==(s=o[36].name)&&(e.__value=s,e.value=e.__value)},d(o){o&&k(e)}}}function Mi(t){var i;let e,n=(((i=t[33].l10n)==null?void 0:i.name)??t[33].name)+"",l,s;return{c(){e=_("option"),l=P(n),e.__value=s=t[33].name,e.value=e.__value},m(o,a){E(o,e,a),f(e,l)},p(o,a){var u;a[0]&65536&&n!==(n=(((u=o[33].l10n)==null?void 0:u.name)??o[33].name)+"")&&Z(l,n),a[0]&65536&&s!==(s=o[33].name)&&(e.__value=s,e.value=e.__value)},d(o){o&&k(e)}}}function gc(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T,A,B,O,R,D,M,S,C,$,I,z,q,F,ie,fe,me,ue,Y,U,Q,ke,X,ge=t[10]!=="generic"&&Ti(t);function Te(de,pe){if(de[10]==="modifyAmt")return fc;if(de[10]==="diceType")return cc}let x=Te(t),W=x&&x(t);function ee(de,pe){if(de[3]==="weapon")return hc;if(de[3]==="armor")return mc;if(de[3]==="spell")return _c;if(de[3]==="stat")return pc;if(de[3]==="weaponType")return dc}let ye=ee(t),be=ye&&ye(t);return{c(){e=_("div"),n=_("div"),l=_("label"),l.textContent="名稱",s=w(),i=_("input"),o=w(),a=_("div"),u=_("label"),u.textContent="描述",c=w(),r=_("input"),p=w(),m=_("div"),b=_("label"),b.textContent="加值類型",g=w(),h=_("select"),y=_("option"),y.textContent="一般 (純文字描述)",v=_("option"),v.textContent="數值修正 (例如 +1) ",T=_("option"),T.textContent="優勢 ",A=_("option"),A.textContent="劣勢 ",B=_("option"),B.textContent="更改骰子類型",O=w(),ge&&ge.c(),R=w(),W&&W.c(),D=w(),M=_("div"),S=_("label"),S.textContent="進階條件 (選填)",C=w(),$=_("select"),I=_("option"),I.textContent="無",z=_("option"),z.textContent="特定武器",q=_("option"),q.textContent="特定防具",F=_("option"),F.textContent="特定法術",ie=_("option"),ie.textContent="特定屬性",fe=_("option"),fe.textContent="特定武器類型",me=w(),be&&be.c(),ue=w(),Y=_("button"),U=P(t[13]),d(l,"for","name"),d(l,"class","font-bold"),d(i,"id","name"),d(i,"type","text"),d(i,"placeholder","例如：力量藥水"),d(i,"class","border p-1 rounded"),d(n,"class","flex flex-col"),d(u,"for","desc"),d(u,"class","font-bold"),d(r,"id","desc"),d(r,"placeholder","例如：力量 +2"),d(r,"class","border p-1 rounded"),d(a,"class","flex flex-col"),d(b,"for","type"),d(b,"class","font-bold"),y.__value="generic",y.value=y.__value,v.__value="modifyAmt",v.value=v.__value,T.__value="advantage",T.value=T.__value,A.__value="disadvantage",A.value=A.__value,B.__value="diceType",B.value=B.__value,d(h,"id","type"),d(h,"class","border p-1 rounded"),t[10]===void 0&&He(()=>t[22].call(h)),d(m,"class","flex flex-col"),d(S,"for","metaDataType"),d(S,"class","font-bold text-sm block mb-1"),I.__value="",I.value=I.__value,z.__value="weapon",z.value=z.__value,q.__value="armor",q.value=q.__value,F.__value="spell",F.value=F.__value,ie.__value="stat",ie.value=ie.__value,fe.__value="weaponType",fe.value=fe.__value,d($,"id","metaDataType"),d($,"class","border p-1 rounded w-full mb-2"),t[3]===void 0&&He(()=>t[26].call($)),d(M,"class","border-t pt-2 mt-2"),d(Y,"class","w-full p-2 bg-black text-white mt-4 rounded shadow font-bold disabled:opacity-50 disabled:cursor-not-allowed"),Y.disabled=Q=!t[9],d(e,"class","flex flex-col gap-2 w-full max-h-[80vh] overflow-y-auto p-1")},m(de,pe){E(de,e,pe),f(e,n),f(n,l),f(n,s),f(n,i),re(i,t[0]),f(e,o),f(e,a),f(a,u),f(a,c),f(a,r),re(r,t[1]),f(e,p),f(e,m),f(m,b),f(m,g),f(m,h),f(h,y),f(h,v),f(h,T),f(h,A),f(h,B),ve(h,t[10],!0),f(e,O),ge&&ge.m(e,null),f(e,R),W&&W.m(e,null),f(e,D),f(e,M),f(M,S),f(M,C),f(M,$),f($,I),f($,z),f($,q),f($,F),f($,ie),f($,fe),ve($,t[3],!0),f(M,me),be&&be.m(M,null),f(e,ue),f(e,Y),f(Y,U),ke||(X=[N(i,"input",t[20]),N(r,"input",t[21]),N(h,"change",t[22]),N($,"change",t[26]),N(Y,"click",t[17])],ke=!0)},p(de,pe){pe[0]&1&&i.value!==de[0]&&re(i,de[0]),pe[0]&2&&r.value!==de[1]&&re(r,de[1]),pe[0]&1024&&ve(h,de[10]),de[10]!=="generic"?ge?ge.p(de,pe):(ge=Ti(de),ge.c(),ge.m(e,R)):ge&&(ge.d(1),ge=null),x===(x=Te(de))&&W?W.p(de,pe):(W&&W.d(1),W=x&&x(de),W&&(W.c(),W.m(e,D))),pe[0]&8&&ve($,de[3]),ye===(ye=ee(de))&&be?be.p(de,pe):(be&&be.d(1),be=ye&&ye(de),be&&(be.c(),be.m(M,null))),pe[0]&8192&&Z(U,de[13]),pe[0]&512&&Q!==(Q=!de[9])&&(Y.disabled=Q)},i:j,o:j,d(de){de&&k(e),ge&&ge.d(),W&&W.d(),be&&be.d(),ke=!1,Ve(X)}}}function bc(t,e,n){let l,s,i,o;Re(t,ae,Y=>n(19,o=Y));const a=kn();let u="",c="",r="generic",p="attackRoll",m=1,b="",g="d8",h="",y="",v="",T="",A="",B=!!u&&!!c,O="新增";function R(){let Y;switch(r){case"generic":Y={name:u,desc:c,type:r};break;case"modifyAmt":Y={name:u,desc:c,type:r,bonusTo:p,bonusAmount:m};break;case"advantage":case"disadvantage":{Y={name:u,desc:c,type:r,bonusTo:p};break}case"diceType":Y={name:u,desc:c,type:r,bonusTo:p,diceType:g};break;default:return}b&&(b==="weapon"&&h?Y.metadata={type:"weapon",weapon:h}:b==="weaponType"&&A?Y.metadata={type:"weaponType",weaponType:A}:b==="armor"&&y?Y.metadata={type:"armor",armor:y}:b==="stat"&&T?Y.metadata={type:"stat",stat:T}:b==="spell"&&v&&(Y.metadata={type:"spell",spell:v})),Y.editable=!0,Sn(o,Y),ae.set(o),a("finish")}const D={attackRoll:"攻擊檢定 (Attack)",damageRoll:"傷害檢定 (Damage)",armorClass:"AC (防禦)",hp:"HP (生命)",proficiencyBonus:"熟練加值",speed:"速度",initiative:"先攻 (數值)",initiativeRoll:"先攻檢定 (Roll)",passivePerception:"被動感知",stat:"屬性值 (Score)",savingThrow:"豁免檢定",skillCheck:"技能檢定",abilityCheck:"屬性檢定 (Check)"};function M(){u=this.value,n(0,u)}function S(){c=this.value,n(1,c)}function C(){r=Fe(this),n(10,r)}function $(){p=Fe(this),n(2,p)}function I(){m=Ie(this.value),n(11,m)}function z(){g=Fe(this),n(12,g)}function q(){b=Fe(this),n(3,b),n(2,p),n(0,u),n(1,c),n(7,T),n(4,h),n(5,y),n(6,v),n(8,A),n(9,B)}function F(){h=Fe(this),n(4,h),n(2,p),n(16,l),n(19,o)}function ie(){y=Fe(this),n(5,y),n(2,p),n(15,s),n(19,o)}function fe(){v=Fe(this),n(6,v),n(2,p),n(14,i),n(19,o)}function me(){T=Fe(this),n(7,T),n(2,p)}function ue(){A=Fe(this),n(8,A),n(2,p)}return t.$$.update=()=>{t.$$.dirty[0]&524288&&n(16,l=or.concat(o.customGear.filter(Y=>Y.type==="Weapon").map(Y=>Y)??[])),t.$$.dirty[0]&524288&&n(15,s=sr.concat(o.customGear.filter(Y=>Y.type==="Armor").map(Y=>Y)??[])),t.$$.dirty[0]&524288&&n(14,i=ir.concat(o.customSpells??[])),t.$$.dirty[0]&4&&p&&(n(4,h=""),n(5,y=""),n(6,v=""),n(7,T=""),n(8,A="")),t.$$.dirty[0]&1023&&(p==="stat"?(n(3,b="stat"),n(9,B=!!u&&!!c&&!!T)):n(9,B=!!u&&!!c),b==="stat"&&!T&&n(9,B=!1),b==="weapon"&&!h&&n(9,B=!1),b==="armor"&&!y&&n(9,B=!1),b==="spell"&&!v&&n(9,B=!1),b==="weaponType"&&!A&&n(9,B=!1),n(13,O=B?"新增":"請填寫必要欄位"))},[u,c,p,b,h,y,v,T,A,B,r,m,g,O,i,s,l,R,D,o,M,S,C,$,I,z,q,F,ie,fe,me,ue]}class vc extends Oe{constructor(e){super(),Me(this,e,bc,gc,Se,{},null,[-1,-1])}}function Ri(t){let e,n,l;function s(o){t[4](o)}let i={$$slots:{header:[wc],default:[yc]},$$scope:{ctx:t}};return t[1]!==void 0&&(i.showModal=t[1]),e=new ft({props:i}),je.push(()=>Ye(e,"showModal",s)),{c(){te(e.$$.fragment)},m(o,a){ne(e,o,a),l=!0},p(o,a){const u={};a&33&&(u.$$scope={dirty:a,ctx:o}),!n&&a&2&&(n=!0,u.showModal=o[1],Ke(()=>n=!1)),e.$set(u)},i(o){l||(L(e.$$.fragment,o),l=!0)},o(o){G(e.$$.fragment,o),l=!1},d(o){le(e,o)}}}function yc(t){let e,n;return e=new vc({}),e.$on("finish",t[3]),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},p:j,i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function wc(t){let e;return{c(){e=_("h1"),e.textContent="自訂加值",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Tc(t){let e,n,l,s,i,o,a=t[0]&&Ri(t);return{c(){e=_("button"),e.textContent="自訂加值",n=w(),a&&a.c(),l=gt(),d(e,"class","w-full bg-black text-white p-2")},m(u,c){E(u,e,c),E(u,n,c),a&&a.m(u,c),E(u,l,c),s=!0,i||(o=N(e,"click",t[2]),i=!0)},p(u,[c]){u[0]?a?(a.p(u,c),c&1&&L(a,1)):(a=Ri(u),a.c(),L(a,1),a.m(l.parentNode,l)):a&&(Ge(),G(a,1,1,()=>{a=null}),We())},i(u){s||(L(a),s=!0)},o(u){G(a),s=!1},d(u){u&&k(e),u&&k(n),a&&a.d(u),u&&k(l),i=!1,o()}}}function Ec(t,e,n){let l=!1,s=!1;const i=()=>{n(0,l=!0),n(1,s=!0)},o=()=>{n(0,l=!1)};function a(u){s=u,n(1,s)}return[l,s,i,o,a]}class kc extends Oe{constructor(e){super(),Me(this,e,Ec,Tc,Se,{})}}function $i(t,e,n){const l=t.slice();return l[6]=e[n],l}function Di(t,e,n){const l=t.slice();return l[9]=e[n],l}function Ii(t,e,n){const l=t.slice();return l[6]=e[n],l}function Ni(t,e,n){const l=t.slice();return l[9]=e[n],l}function Li(t,e,n){const l=t.slice();return l[9]=e[n],l}function Pi(t){let e,n,l,s;return n=new Ql({props:{bonus:t[9]}}),{c(){e=_("li"),te(n.$$.fragment),l=w(),d(e,"class","border-b")},m(i,o){E(i,e,o),ne(n,e,null),f(e,l),s=!0},p(i,o){const a={};o&1&&(a.bonus=i[9]),n.$set(a)},i(i){s||(L(n.$$.fragment,i),s=!0)},o(i){G(n.$$.fragment,i),s=!1},d(i){i&&k(e),le(n)}}}function Hi(t){let e,n,l,s;return l=new Ql({props:{bonus:t[9]}}),{c(){e=_("li"),n=P("* "),te(l.$$.fragment),d(e,"class","border-b ps-8 flex gap-1")},m(i,o){E(i,e,o),f(e,n),ne(l,e,null),s=!0},p(i,o){const a={};o&2&&(a.bonus=i[9]),l.$set(a)},i(i){s||(L(l.$$.fragment,i),s=!0)},o(i){G(l.$$.fragment,i),s=!1},d(i){i&&k(e),le(l)}}}function Gi(t){var p;let e,n,l=(((p=t[6].l10n)==null?void 0:p.name)??t[6].name)+"",s,i,o,a,u=t[6].playerBonuses,c=[];for(let m=0;m<u.length;m+=1)c[m]=Hi(Ni(t,u,m));const r=m=>G(c[m],1,1,()=>{c[m]=null});return{c(){e=_("li"),n=_("div"),s=P(l),i=w(),o=_("ul");for(let m=0;m<c.length;m+=1)c[m].c();d(n,"class","font-bold bg-gray-300"),d(e,"class","border-b")},m(m,b){E(m,e,b),f(e,n),f(n,s),f(e,i),f(e,o);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(o,null);a=!0},p(m,b){var g;if((!a||b&2)&&l!==(l=(((g=m[6].l10n)==null?void 0:g.name)??m[6].name)+"")&&Z(s,l),b&2){u=m[6].playerBonuses;let h;for(h=0;h<u.length;h+=1){const y=Ni(m,u,h);c[h]?(c[h].p(y,b),L(c[h],1)):(c[h]=Hi(y),c[h].c(),L(c[h],1),c[h].m(o,null))}for(Ge(),h=u.length;h<c.length;h+=1)r(h);We()}},i(m){if(!a){for(let b=0;b<u.length;b+=1)L(c[b]);a=!0}},o(m){c=c.filter(Boolean);for(let b=0;b<c.length;b+=1)G(c[b]);a=!1},d(m){m&&k(e),Ee(c,m)}}}function Wi(t){let e,n,l,s,i;return l=new Ql({props:{bonus:t[9],showInfo:!1}}),{c(){e=_("li"),n=P("* "),te(l.$$.fragment),s=w(),d(e,"class","border-b ps-8 flex gap-1")},m(o,a){E(o,e,a),f(e,n),ne(l,e,null),f(e,s),i=!0},p(o,a){const u={};a&4&&(u.bonus=o[9]),l.$set(u)},i(o){i||(L(l.$$.fragment,o),i=!0)},o(o){G(l.$$.fragment,o),i=!1},d(o){o&&k(e),le(l)}}}function Fi(t){var m;let e,n,l=(((m=t[6].l10n)==null?void 0:m.name)??t[6].name)+"",s,i,o,a,u,c=t[6].playerBonuses,r=[];for(let b=0;b<c.length;b+=1)r[b]=Wi(Di(t,c,b));const p=b=>G(r[b],1,1,()=>{r[b]=null});return{c(){e=_("li"),n=_("div"),s=P(l),i=w(),o=_("ul");for(let b=0;b<r.length;b+=1)r[b].c();a=w(),d(n,"class","font-bold bg-gray-300"),d(e,"class","border-b")},m(b,g){E(b,e,g),f(e,n),f(n,s),f(e,i),f(e,o);for(let h=0;h<r.length;h+=1)r[h]&&r[h].m(o,null);f(e,a),u=!0},p(b,g){var h;if((!u||g&4)&&l!==(l=(((h=b[6].l10n)==null?void 0:h.name)??b[6].name)+"")&&Z(s,l),g&4){c=b[6].playerBonuses;let y;for(y=0;y<c.length;y+=1){const v=Di(b,c,y);r[y]?(r[y].p(v,g),L(r[y],1)):(r[y]=Wi(v),r[y].c(),L(r[y],1),r[y].m(o,null))}for(Ge(),y=c.length;y<r.length;y+=1)p(y);We()}},i(b){if(!u){for(let g=0;g<c.length;g+=1)L(r[g]);u=!0}},o(b){r=r.filter(Boolean);for(let g=0;g<r.length;g+=1)G(r[g]);u=!1},d(b){b&&k(e),Ee(r,b)}}}function qi(t){let e,n;return e=new xu({}),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function Ac(t){let e,n,l,s,i,o,a,u,c,r,p=t[0].level>0&&t[0].class&&!t[0].hasCustomClass&&Ut.includes(t[0].class),m,b,g,h=t[0].bonuses.sort(t[3]),y=[];for(let S=0;S<h.length;S+=1)y[S]=Pi(Li(t,h,S));const v=S=>G(y[S],1,1,()=>{y[S]=null});let T=t[1].sort(t[4]),A=[];for(let S=0;S<T.length;S+=1)A[S]=Gi(Ii(t,T,S));const B=S=>G(A[S],1,1,()=>{A[S]=null});let O=t[2].sort(t[5]),R=[];for(let S=0;S<O.length;S+=1)R[S]=Fi($i(t,O,S));const D=S=>G(R[S],1,1,()=>{R[S]=null});let M=p&&qi();return b=new kc({}),{c(){e=_("h2"),e.textContent="加值",n=w(),l=_("ul");for(let S=0;S<y.length;S+=1)y[S].c();s=w(),i=_("h2"),i.textContent="裝備加值",o=w(),a=_("ul");for(let S=0;S<A.length;S+=1)A[S].c();u=w();for(let S=0;S<R.length;S+=1)R[S].c();c=w(),r=_("div"),M&&M.c(),m=w(),te(b.$$.fragment),d(l,"class","px-1"),d(r,"class","flex gap-1")},m(S,C){E(S,e,C),E(S,n,C),E(S,l,C);for(let $=0;$<y.length;$+=1)y[$]&&y[$].m(l,null);E(S,s,C),E(S,i,C),E(S,o,C),E(S,a,C);for(let $=0;$<A.length;$+=1)A[$]&&A[$].m(a,null);f(a,u);for(let $=0;$<R.length;$+=1)R[$]&&R[$].m(a,null);E(S,c,C),E(S,r,C),M&&M.m(r,null),f(r,m),ne(b,r,null),g=!0},p(S,[C]){if(C&1){h=S[0].bonuses.sort(S[3]);let $;for($=0;$<h.length;$+=1){const I=Li(S,h,$);y[$]?(y[$].p(I,C),L(y[$],1)):(y[$]=Pi(I),y[$].c(),L(y[$],1),y[$].m(l,null))}for(Ge(),$=h.length;$<y.length;$+=1)v($);We()}if(C&2){T=S[1].sort(S[4]);let $;for($=0;$<T.length;$+=1){const I=Ii(S,T,$);A[$]?(A[$].p(I,C),L(A[$],1)):(A[$]=Gi(I),A[$].c(),L(A[$],1),A[$].m(a,u))}for(Ge(),$=T.length;$<A.length;$+=1)B($);We()}if(C&4){O=S[2].sort(S[5]);let $;for($=0;$<O.length;$+=1){const I=$i(S,O,$);R[$]?(R[$].p(I,C),L(R[$],1)):(R[$]=Fi(I),R[$].c(),L(R[$],1),R[$].m(a,null))}for(Ge(),$=O.length;$<R.length;$+=1)D($);We()}C&1&&(p=S[0].level>0&&S[0].class&&!S[0].hasCustomClass&&Ut.includes(S[0].class)),p?M?C&1&&L(M,1):(M=qi(),M.c(),L(M,1),M.m(r,m)):M&&(Ge(),G(M,1,1,()=>{M=null}),We())},i(S){if(!g){for(let C=0;C<h.length;C+=1)L(y[C]);for(let C=0;C<T.length;C+=1)L(A[C]);for(let C=0;C<O.length;C+=1)L(R[C]);L(M),L(b.$$.fragment,S),g=!0}},o(S){y=y.filter(Boolean);for(let C=0;C<y.length;C+=1)G(y[C]);A=A.filter(Boolean);for(let C=0;C<A.length;C+=1)G(A[C]);R=R.filter(Boolean);for(let C=0;C<R.length;C+=1)G(R[C]);G(M),G(b.$$.fragment,S),g=!1},d(S){S&&k(e),S&&k(n),S&&k(l),Ee(y,S),S&&k(s),S&&k(i),S&&k(o),S&&k(a),Ee(A,S),Ee(R,S),S&&k(c),S&&k(r),M&&M.d(),le(b)}}}function Bc(t,e,n){let l,s,i;Re(t,ae,c=>n(0,i=c));const o=(c,r)=>tl(c.desc,r.desc),a=(c,r)=>tl(c.name,r.name),u=(c,r)=>tl(c.name,r.name);return t.$$.update=()=>{t.$$.dirty&1&&n(2,l=i.gear.filter(c=>c.equipped).map(c=>Qe(c.name)).filter(c=>{var r;return c&&c.canBeEquipped&&((r=c.playerBonuses)==null?void 0:r.length)>0})),t.$$.dirty&1&&n(1,s=i.gear.filter(c=>!c.equipped).map(c=>Qe(c.name)).filter(c=>{var r;return c&&((r=c.playerBonuses)==null?void 0:r.length)>0&&!c.canBeEquipped}))},[i,s,l,o,a,u]}class Cc extends Oe{constructor(e){super(),Me(this,e,Bc,Ac,Se,{})}}function Ui(t,e,n){const l=t.slice();return l[31]=e[n],l}function Sc(t,e,n){const l=t.slice();return l[34]=e[n],l[36]=n,l}function Vi(t,e,n){const l=t.slice();return l[37]=e[n],l}function ji(t){let e,n=t[37]+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[37],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function Oc(t){let e,n;return{c(){e=_("option"),n=P(t[36]),e.__value=t[36],e.value=e.__value},m(l,s){E(l,e,s),f(e,n)},p:j,d(l){l&&k(e)}}}function zi(t){let e,n=Vt(t[31])+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[31],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function Yi(t){let e,n,l;return{c(){e=_("input"),d(e,"type","text"),d(e,"placeholder","材料描述 (例如: 一根樹枝)"),d(e,"class","border p-1 rounded text-sm w-full mt-1")},m(s,i){E(s,e,i),re(e,t[11]),n||(l=N(e,"input",t[24]),n=!0)},p(s,i){i[0]&2048&&e.value!==s[11]&&re(e,s[11])},d(s){s&&k(e),n=!1,l()}}}function Mc(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T,A,B,O,R,D,M,S,C,$,I,z,q,F,ie,fe,me,ue,Y,U,Q,ke,X,ge,Te,x,W,ee,ye,be,de,pe,K,oe,Ce,Le,se,_e,De,H,we,Pe,Ae,nt,lt,Kt=t[0]?"更新法術":"建立法術",Lt,Tt,Xt,An,Je=Ut,Ze=[];for(let ce=0;ce<Je.length;ce+=1)Ze[ce]=ji(Vi(t,Je,ce));let vt=Array(10),yt=[];for(let ce=0;ce<vt.length;ce+=1)yt[ce]=Oc(Sc(t,vt,ce));let $t=Mt,Xe=[];for(let ce=0;ce<$t.length;ce+=1)Xe[ce]=zi(Ui(t,$t,ce));let et=t[10]&&Yi(t);return{c(){e=_("div"),n=_("div"),l=_("label"),l.innerHTML='法術名稱<span class="text-red-700">*</span>',s=w(),i=_("input"),o=w(),a=_("div"),u=_("div"),c=_("label"),c.textContent="職業列表",r=w(),p=_("select");for(let ce=0;ce<Ze.length;ce+=1)Ze[ce].c();m=_("option"),m.textContent="其他",b=w(),g=_("div"),h=_("label"),h.textContent="環階 (0=戲法)",y=w(),v=_("select");for(let ce=0;ce<yt.length;ce+=1)yt[ce].c();T=w(),A=_("div"),B=_("div"),O=_("label"),O.textContent="施法關鍵屬性",R=w(),D=_("select");for(let ce=0;ce<Xe.length;ce+=1)Xe[ce].c();M=w(),S=_("div"),C=_("label"),C.textContent="距離 (例如: 60 ft)",$=w(),I=_("input"),z=w(),q=_("div"),F=_("label"),F.textContent="持續時間 (例如: 1 Minute)",ie=w(),fe=_("div"),me=_("input"),ue=w(),Y=_("div"),U=_("span"),U.textContent="構材 (Components)",Q=w(),ke=_("div"),X=_("label"),ge=_("input"),Te=P(" Verbal (V)"),x=w(),W=_("label"),ee=_("input"),ye=P(" Somatic (S)"),be=w(),de=_("label"),pe=_("input"),K=P(" Material (M)"),oe=w(),et&&et.c(),Ce=w(),Le=_("label"),se=_("input"),_e=P(" 儀式法術 (Ritual)"),De=w(),H=_("div"),we=_("label"),we.innerHTML='描述<span class="text-red-700">*</span>',Pe=w(),Ae=_("textarea"),nt=w(),lt=_("button"),Lt=P(Kt),d(l,"for","spellName"),d(l,"class","font-bold"),d(i,"type","text"),d(i,"id","spellName"),d(i,"class","border p-1 rounded"),d(n,"class","flex flex-col gap-1"),d(c,"for","spellClass"),d(c,"class","font-bold"),m.__value="Other",m.value=m.__value,d(p,"id","spellClass"),d(p,"class","border p-1 rounded"),t[4]===void 0&&He(()=>t[16].call(p)),d(u,"class","flex flex-col w-1/2"),d(h,"for","spellTier"),d(h,"class","font-bold"),d(v,"id","spellTier"),d(v,"class","border p-1 rounded"),t[3]===void 0&&He(()=>t[17].call(v)),d(g,"class","flex flex-col w-1/2"),d(a,"class","flex gap-2"),d(O,"for","spellStat"),d(O,"class","font-bold"),d(D,"id","spellStat"),d(D,"class","border p-1 rounded"),t[5]===void 0&&He(()=>t[18].call(D)),d(B,"class","flex flex-col w-1/2"),d(C,"for","spellRange"),d(C,"class","font-bold"),d(I,"type","text"),d(I,"id","spellRange"),d(I,"class","border p-1 rounded"),d(S,"class","flex flex-col w-1/2"),d(A,"class","flex gap-2"),d(F,"for","spellDuration"),d(F,"class","font-bold"),d(me,"type","text"),d(me,"id","spellDuration"),d(me,"class","border p-1 rounded w-full"),d(fe,"class","flex gap-2"),d(q,"class","flex flex-col gap-1"),d(U,"class","font-bold text-sm"),d(ge,"type","checkbox"),d(ge,"class","svelte-1ep1fgl"),d(X,"class","flex items-center gap-1"),d(ee,"type","checkbox"),d(ee,"class","svelte-1ep1fgl"),d(W,"class","flex items-center gap-1"),d(pe,"type","checkbox"),d(pe,"class","svelte-1ep1fgl"),d(de,"class","flex items-center gap-1"),d(ke,"class","flex gap-4"),d(Y,"class","flex flex-col gap-1 border p-2 rounded bg-gray-50"),d(se,"type","checkbox"),d(se,"class","svelte-1ep1fgl"),d(Le,"class","flex items-center gap-1 font-bold"),d(we,"for","spellDesc"),d(we,"class","font-bold"),d(Ae,"id","spellDesc"),d(Ae,"rows","5"),d(Ae,"class","border p-1 rounded"),d(H,"class","flex flex-col gap-1"),d(lt,"class","bg-black text-white p-2 rounded font-bold shadow hover:bg-gray-800 transition-colors mt-2"),lt.disabled=Tt=!t[13],V(lt,"opacity-50",!t[13]),d(e,"class","flex flex-col gap-2 max-h-[80vh] overflow-y-auto p-2")},m(ce,qe){E(ce,e,qe),f(e,n),f(n,l),f(n,s),f(n,i),re(i,t[1]),f(e,o),f(e,a),f(a,u),f(u,c),f(u,r),f(u,p);for(let Be=0;Be<Ze.length;Be+=1)Ze[Be]&&Ze[Be].m(p,null);f(p,m),ve(p,t[4],!0),f(a,b),f(a,g),f(g,h),f(g,y),f(g,v);for(let Be=0;Be<yt.length;Be+=1)yt[Be]&&yt[Be].m(v,null);ve(v,t[3],!0),f(e,T),f(e,A),f(A,B),f(B,O),f(B,R),f(B,D);for(let Be=0;Be<Xe.length;Be+=1)Xe[Be]&&Xe[Be].m(D,null);ve(D,t[5],!0),f(A,M),f(A,S),f(S,C),f(S,$),f(S,I),re(I,t[6]),f(e,z),f(e,q),f(q,F),f(q,ie),f(q,fe),f(fe,me),re(me,t[7]),f(e,ue),f(e,Y),f(Y,U),f(Y,Q),f(Y,ke),f(ke,X),f(X,ge),ge.checked=t[8],f(X,Te),f(ke,x),f(ke,W),f(W,ee),ee.checked=t[9],f(W,ye),f(ke,be),f(ke,de),f(de,pe),pe.checked=t[10],f(de,K),f(Y,oe),et&&et.m(Y,null),f(e,Ce),f(e,Le),f(Le,se),se.checked=t[12],f(Le,_e),f(e,De),f(e,H),f(H,we),f(H,Pe),f(H,Ae),re(Ae,t[2]),f(e,nt),f(e,lt),f(lt,Lt),Xt||(An=[N(i,"input",t[15]),N(p,"change",t[16]),N(v,"change",t[17]),N(D,"change",t[18]),N(I,"input",t[19]),N(me,"input",t[20]),N(ge,"change",t[21]),N(ee,"change",t[22]),N(pe,"change",t[23]),N(se,"change",t[25]),N(Ae,"input",t[26]),N(lt,"click",t[27])],Xt=!0)},p(ce,qe){if(qe[0]&2&&i.value!==ce[1]&&re(i,ce[1]),qe&0){Je=Ut;let Be;for(Be=0;Be<Je.length;Be+=1){const Dt=Vi(ce,Je,Be);Ze[Be]?Ze[Be].p(Dt,qe):(Ze[Be]=ji(Dt),Ze[Be].c(),Ze[Be].m(p,m))}for(;Be<Ze.length;Be+=1)Ze[Be].d(1);Ze.length=Je.length}if(qe[0]&16&&ve(p,ce[4]),qe[0]&8&&ve(v,ce[3]),qe&0){$t=Mt;let Be;for(Be=0;Be<$t.length;Be+=1){const Dt=Ui(ce,$t,Be);Xe[Be]?Xe[Be].p(Dt,qe):(Xe[Be]=zi(Dt),Xe[Be].c(),Xe[Be].m(D,null))}for(;Be<Xe.length;Be+=1)Xe[Be].d(1);Xe.length=$t.length}qe[0]&32&&ve(D,ce[5]),qe[0]&64&&I.value!==ce[6]&&re(I,ce[6]),qe[0]&128&&me.value!==ce[7]&&re(me,ce[7]),qe[0]&256&&(ge.checked=ce[8]),qe[0]&512&&(ee.checked=ce[9]),qe[0]&1024&&(pe.checked=ce[10]),ce[10]?et?et.p(ce,qe):(et=Yi(ce),et.c(),et.m(Y,null)):et&&(et.d(1),et=null),qe[0]&4096&&(se.checked=ce[12]),qe[0]&4&&re(Ae,ce[2]),qe[0]&1&&Kt!==(Kt=ce[0]?"更新法術":"建立法術")&&Z(Lt,Kt),qe[0]&8192&&Tt!==(Tt=!ce[13])&&(lt.disabled=Tt),qe[0]&8192&&V(lt,"opacity-50",!ce[13])},i:j,o:j,d(ce){ce&&k(e),Ee(Ze,ce),Ee(yt,ce),Ee(Xe,ce),et&&et.d(),Xt=!1,Ve(An)}}}function Rc(t,e,n){var me,ue,Y,U;let l,s;Re(t,ae,Q=>n(29,s=Q));const i=kn();let{spellToEdit:o=void 0}=e,a=s.spells.find(Q=>Q.name===(o==null?void 0:o.name)),u=(o==null?void 0:o.name)??"",c=(o==null?void 0:o.desc)??"",r=(o==null?void 0:o.tier)??0,p=(o==null?void 0:o.class)??"Wizard",m=(o==null?void 0:o.stat)??"INT",b=(o==null?void 0:o.range)??"60 feet",g=(o==null?void 0:o.duration)??"Instantaneous",h=((me=o==null?void 0:o.components)==null?void 0:me.verbal)??!1,y=((ue=o==null?void 0:o.components)==null?void 0:ue.somatic)??!1,v=((Y=o==null?void 0:o.components)==null?void 0:Y.material)??!1,T=((U=o==null?void 0:o.components)==null?void 0:U.materialDesc)??"",A=(o==null?void 0:o.ritual)??!1;function B(){const Q={editable:!0,name:u,class:p,stat:m,tier:r,range:b,duration:g,components:{verbal:h,somatic:y,material:v,materialDesc:T},ritual:A,desc:c};o?(Object.assign(o,Q),a&&(a.name=Q.name)):(s.spells.push({name:Q.name}),s.customSpells.push(Q)),ae.set(s),i("finish")}function O(){u=this.value,n(1,u)}function R(){p=Fe(this),n(4,p)}function D(){r=Fe(this),n(3,r)}function M(){m=Fe(this),n(5,m)}function S(){b=this.value,n(6,b)}function C(){g=this.value,n(7,g)}function $(){h=this.checked,n(8,h)}function I(){y=this.checked,n(9,y)}function z(){v=this.checked,n(10,v)}function q(){T=this.value,n(11,T)}function F(){A=this.checked,n(12,A)}function ie(){c=this.value,n(2,c)}const fe=()=>B();return t.$$set=Q=>{"spellToEdit"in Q&&n(0,o=Q.spellToEdit)},t.$$.update=()=>{t.$$.dirty[0]&6&&n(13,l=u.length>0&&c.length>0)},[o,u,c,r,p,m,b,g,h,y,v,T,A,l,B,O,R,D,M,S,C,$,I,z,q,F,ie,fe]}class br extends Oe{constructor(e){super(),Me(this,e,Rc,Mc,Se,{spellToEdit:0},null,[-1,-1])}}function Ki(t){let e,n,l;function s(o){t[4](o)}let i={vw:50,$$slots:{header:[Dc],default:[$c]},$$scope:{ctx:t}};return t[1]!==void 0&&(i.showModal=t[1]),e=new ft({props:i}),je.push(()=>Ye(e,"showModal",s)),{c(){te(e.$$.fragment)},m(o,a){ne(e,o,a),l=!0},p(o,a){const u={};a&33&&(u.$$scope={dirty:a,ctx:o}),!n&&a&2&&(n=!0,u.showModal=o[1],Ke(()=>n=!1)),e.$set(u)},i(o){l||(L(e.$$.fragment,o),l=!0)},o(o){G(e.$$.fragment,o),l=!1},d(o){le(e,o)}}}function $c(t){let e,n;return e=new br({}),e.$on("finish",t[3]),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},p:j,i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function Dc(t){let e;return{c(){e=_("h1"),e.textContent="Custom Spell",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Ic(t){let e,n,l,s,i,o,a=t[0]&&Ki(t);return{c(){e=_("button"),e.textContent="Custom Spell",n=w(),a&&a.c(),l=gt(),d(e,"class","bg-black text-white w-full")},m(u,c){E(u,e,c),E(u,n,c),a&&a.m(u,c),E(u,l,c),s=!0,i||(o=N(e,"click",t[2]),i=!0)},p(u,[c]){u[0]?a?(a.p(u,c),c&1&&L(a,1)):(a=Ki(u),a.c(),L(a,1),a.m(l.parentNode,l)):a&&(Ge(),G(a,1,1,()=>{a=null}),We())},i(u){s||(L(a),s=!0)},o(u){G(a),s=!1},d(u){u&&k(e),u&&k(n),a&&a.d(u),u&&k(l),i=!1,o()}}}function Nc(t,e,n){let l=!1,s=!1;const i=()=>{n(0,l=!0),n(1,s=!0)},o=()=>n(0,l=!1);function a(u){s=u,n(1,s)}return[l,s,i,o,a]}class Lc extends Oe{constructor(e){super(),Me(this,e,Nc,Ic,Se,{})}}function Xi(t,{delay:e=0,duration:n=400,easing:l=Jr}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:l,css:i=>`opacity: ${i*s}`}}const vr={};function Pc(t){let e,n,l,s,i,o;const a=t[5].default,u=In(a,t,t[4],null);return{c(){e=w(),n=_("div"),u&&u.c(),Wt(n,"top",t[1]+"px"),Wt(n,"left",t[0]+"px"),d(n,"class","svelte-zimeji")},m(c,r){E(c,e,r),E(c,n,r),u&&u.m(n,null),t[6](n),s=!0,i||(o=N(document.body,"click",t[3]),i=!0)},p(c,[r]){u&&u.p&&(!s||r&16)&&Nn(u,a,c,c[4],s?Pn(a,c[4],r,null):Ln(c[4]),null),(!s||r&2)&&Wt(n,"top",c[1]+"px"),(!s||r&1)&&Wt(n,"left",c[0]+"px")},i(c){s||(L(u,c),He(()=>{s&&(l||(l=Ss(n,Xi,{duration:100},!0)),l.run(1))}),s=!0)},o(c){G(u,c),l||(l=Ss(n,Xi,{duration:100},!1)),l.run(0),s=!1},d(c){c&&k(e),c&&k(n),u&&u.d(c),t[6](null),c&&l&&l.end(),i=!1,o()}}}function Hc(t,e,n){let{$$slots:l={},$$scope:s}=e,{x:i}=e,{y:o}=e,a;const u=kn();Zr(vr,{dispatchClick:()=>u("click")});function c(p){p.target===a||a.contains(p.target)||u("clickoutside")}function r(p){je[p?"unshift":"push"](()=>{a=p,n(2,a)})}return t.$$set=p=>{"x"in p&&n(0,i=p.x),"y"in p&&n(1,o=p.y),"$$scope"in p&&n(4,s=p.$$scope)},t.$$.update=()=>{if(t.$$.dirty&7&&a){const p=a.getBoundingClientRect();n(0,i=Math.min(window.innerWidth-p.width,i)),n(1,o=Math.min(window.innerHeight-p.height,o))}},[i,o,a,c,s,l,r]}class Gc extends Oe{constructor(e){super(),Me(this,e,Hc,Pc,Se,{x:0,y:1})}}function Wc(t){let e;const n=t[4].default,l=In(n,t,t[3],null);return{c(){l&&l.c()},m(s,i){l&&l.m(s,i),e=!0},p(s,i){l&&l.p&&(!e||i&8)&&Nn(l,n,s,s[3],e?Pn(n,s[3],i,null):Ln(s[3]),null)},i(s){e||(L(l,s),e=!0)},o(s){G(l,s),e=!1},d(s){l&&l.d(s)}}}function Fc(t){let e;return{c(){e=P(t[1])},m(n,l){E(n,e,l)},p(n,l){l&2&&Z(e,n[1])},i:j,o:j,d(n){n&&k(e)}}}function qc(t){let e,n,l,s,i,o;const a=[Fc,Wc],u=[];function c(r,p){return r[1]?0:1}return n=c(t),l=u[n]=a[n](t),{c(){e=_("div"),l.c(),d(e,"class","active:bg-gray-100 svelte-12ogry0"),V(e,"disabled",t[0])},m(r,p){E(r,e,p),u[n].m(e,null),s=!0,i||(o=N(e,"click",t[2]),i=!0)},p(r,[p]){let m=n;n=c(r),n===m?u[n].p(r,p):(Ge(),G(u[m],1,1,()=>{u[m]=null}),We(),l=u[n],l?l.p(r,p):(l=u[n]=a[n](r),l.c()),L(l,1),l.m(e,null)),(!s||p&1)&&V(e,"disabled",r[0])},i(r){s||(L(l),s=!0)},o(r){G(l),s=!1},d(r){r&&k(e),u[n].d(),i=!1,o()}}}function Uc(t,e,n){let{$$slots:l={},$$scope:s}=e,{isDisabled:i=!1}=e,{text:o=""}=e;const a=kn(),{dispatchClick:u}=Qr(vr),c=()=>{i||(a("click"),u())};return t.$$set=r=>{"isDisabled"in r&&n(0,i=r.isDisabled),"text"in r&&n(1,o=r.text),"$$scope"in r&&n(3,s=r.$$scope)},[i,o,c,s,l]}class Kn extends Oe{constructor(e){super(),Me(this,e,Uc,qc,Se,{isDisabled:0,text:1})}}var at=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Vc{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return at(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,n){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:n})})}deselect(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return at(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return at(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return at(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return at(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return at(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return at(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return at(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:l}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return l.indexOf(e)>-1})}getConnectionId(){return at(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const n=l=>{e(l.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",n)}}}var wt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class jc{constructor(e){this.messageBus=e}reset(){return wt(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return wt(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return wt(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return wt(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return wt(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return wt(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return n})}inverseTransformPoint(e){return wt(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return n})}}function zc(t){return typeof t.id=="string"}var ol={},Yc={get exports(){return ol},set exports(t){ol=t}},vn=typeof Reflect=="object"?Reflect:null,Ji=vn&&typeof vn.apply=="function"?vn.apply:function(e,n,l){return Function.prototype.apply.call(e,n,l)},nl;vn&&typeof vn.ownKeys=="function"?nl=vn.ownKeys:Object.getOwnPropertySymbols?nl=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:nl=function(e){return Object.getOwnPropertyNames(e)};function Kc(t){console&&console.warn&&console.warn(t)}var yr=Number.isNaN||function(e){return e!==e};function Ne(){Ne.init.call(this)}Yc.exports=Ne;ol.once=Qc;Ne.EventEmitter=Ne;Ne.prototype._events=void 0;Ne.prototype._eventsCount=0;Ne.prototype._maxListeners=void 0;var Zi=10;function _l(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Ne,"defaultMaxListeners",{enumerable:!0,get:function(){return Zi},set:function(t){if(typeof t!="number"||t<0||yr(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Zi=t}});Ne.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ne.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||yr(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function wr(t){return t._maxListeners===void 0?Ne.defaultMaxListeners:t._maxListeners}Ne.prototype.getMaxListeners=function(){return wr(this)};Ne.prototype.emit=function(e){for(var n=[],l=1;l<arguments.length;l++)n.push(arguments[l]);var s=e==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=i[e];if(u===void 0)return!1;if(typeof u=="function")Ji(u,this,n);else for(var c=u.length,r=Br(u,c),l=0;l<c;++l)Ji(r[l],this,n);return!0};function Tr(t,e,n,l){var s,i,o;if(_l(n),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),o=i[e]),o===void 0)o=i[e]=n,++t._eventsCount;else if(typeof o=="function"?o=i[e]=l?[n,o]:[o,n]:l?o.unshift(n):o.push(n),s=wr(t),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Kc(a)}return t}Ne.prototype.addListener=function(e,n){return Tr(this,e,n,!1)};Ne.prototype.on=Ne.prototype.addListener;Ne.prototype.prependListener=function(e,n){return Tr(this,e,n,!0)};function Xc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Er(t,e,n){var l={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=Xc.bind(l);return s.listener=n,l.wrapFn=s,s}Ne.prototype.once=function(e,n){return _l(n),this.on(e,Er(this,e,n)),this};Ne.prototype.prependOnceListener=function(e,n){return _l(n),this.prependListener(e,Er(this,e,n)),this};Ne.prototype.removeListener=function(e,n){var l,s,i,o,a;if(_l(n),s=this._events,s===void 0)return this;if(l=s[e],l===void 0)return this;if(l===n||l.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,l.listener||n));else if(typeof l!="function"){for(i=-1,o=l.length-1;o>=0;o--)if(l[o]===n||l[o].listener===n){a=l[o].listener,i=o;break}if(i<0)return this;i===0?l.shift():Jc(l,i),l.length===1&&(s[e]=l[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};Ne.prototype.off=Ne.prototype.removeListener;Ne.prototype.removeAllListeners=function(e){var n,l,s;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[e]),this;if(arguments.length===0){var i=Object.keys(l),o;for(s=0;s<i.length;++s)o=i[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=l[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(e,n[s]);return this};function kr(t,e,n){var l=t._events;if(l===void 0)return[];var s=l[e];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?Zc(s):Br(s,s.length)}Ne.prototype.listeners=function(e){return kr(this,e,!0)};Ne.prototype.rawListeners=function(e){return kr(this,e,!1)};Ne.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ar.call(t,e)};Ne.prototype.listenerCount=Ar;function Ar(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Ne.prototype.eventNames=function(){return this._eventsCount>0?nl(this._events):[]};function Br(t,e){for(var n=new Array(e),l=0;l<e;++l)n[l]=t[l];return n}function Jc(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Zc(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Qc(t,e){return new Promise(function(n,l){function s(o){t.removeListener(e,i),l(o)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",s),n([].slice.call(arguments))}Cr(t,e,i,{once:!0}),e!=="error"&&xc(t,s,{once:!0})})}function xc(t,e,n){typeof t.on=="function"&&Cr(t,"error",e,n)}function Cr(t,e,n,l){if(typeof t.on=="function")l.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(i){l.once&&t.removeEventListener(e,s),n(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}let Xn;const ef=new Uint8Array(16);function tf(){if(!Xn&&(Xn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Xn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xn(ef)}const tt=[];for(let t=0;t<256;++t)tt.push((t+256).toString(16).slice(1));function nf(t,e=0){return(tt[t[e+0]]+tt[t[e+1]]+tt[t[e+2]]+tt[t[e+3]]+"-"+tt[t[e+4]]+tt[t[e+5]]+"-"+tt[t[e+6]]+tt[t[e+7]]+"-"+tt[t[e+8]]+tt[t[e+9]]+"-"+tt[t[e+10]]+tt[t[e+11]]+tt[t[e+12]]+tt[t[e+13]]+tt[t[e+14]]+tt[t[e+15]]).toLowerCase()}const lf=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Qi={randomUUID:lf};function sf(t,e,n){if(Qi.randomUUID&&!e&&!t)return Qi.randomUUID();t=t||{};const l=t.random||(t.rng||tf)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,e){n=n||0;for(let s=0;s<16;++s)e[n+s]=l[s];return e}return nf(l)}class of extends ol.EventEmitter{constructor(e,n){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=l=>{const s=l.data;if(l.origin===this.targetOrigin&&zc(s)){if(s.id==="OBR_READY"){this.ready=!0;const i=s.data;this.ref=i.ref,this.userId=i.userId}this.emit(s.id,s.data)}},this.send=(l,s,i)=>{var o;if(!this.ref)throw Error("Unable to send message: not ready");(o=window.parent)===null||o===void 0||o.postMessage({id:l,data:s,ref:this.ref,nonce:i},this.targetOrigin)},this.sendAsync=(l,s,i=5e3)=>{const o=`_${sf()}`;return this.send(l,s,o),Promise.race([new Promise((a,u)=>{const c=this;function r(m){c.off(`${l}_RESPONSE${o}`,r),c.off(`${l}_ERROR${o}`,p),a(m)}function p(m){c.off(`${l}_RESPONSE${o}`,r),c.off(`${l}_ERROR${o}`,p),u(m)}this.on(`${l}_RESPONSE${o}`,r),this.on(`${l}_ERROR${o}`,p)}),...i>0?[new Promise((a,u)=>window.setTimeout(()=>u(new Error(`Message ${l} took longer than ${i}ms to get a result`)),i))]:[]])},this.roomId=n,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var xi=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class af{constructor(e){this.messageBus=e}show(e,n){return xi(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:n});return l})}close(e){return xi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var _n=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class rf{constructor(e){this.messageBus=e}getColor(){return _n(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return _n(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return _n(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return _n(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return _n(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return _n(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const n=l=>{e(l.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",n)}}}var rt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class uf{constructor(e){this.messageBus=e}getDpi(){return rt(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return rt(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return rt(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return rt(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return rt(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return rt(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return rt(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,n,l,s){return rt(this,void 0,void 0,function*(){const{position:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:n,useCorners:l,useCenter:s});return i})}getDistance(e,n){return rt(this,void 0,void 0,function*(){const{distance:l}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:n});return l})}onChange(e){const n=l=>{e(l.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",n)}}}var Jn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class cf{constructor(e){this.messageBus=e}undo(){return Jn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Jn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Jn(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Jn(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function it(t){for(var e=arguments.length,n=Array(e>1?e-1:0),l=1;l<e;l++)n[l-1]=arguments[l];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(s){return"'"+s+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function tn(t){return!!t&&!!t[mt]}function jt(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var l=Object.getPrototypeOf(n);if(l===null)return!0;var s=Object.hasOwnProperty.call(l,"constructor")&&l.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===bf}(t)||Array.isArray(t)||!!t[Rn]||!!(!((e=t.constructor)===null||e===void 0)&&e[Rn])||ml(t)||hl(t))}function Tn(t,e,n){n===void 0&&(n=!1),zt(t)===0?(n?Object.keys:is)(t).forEach(function(l){n&&typeof l=="symbol"||e(l,t[l],t)}):t.forEach(function(l,s){return e(s,l,t)})}function zt(t){var e=t[mt];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:ml(t)?2:hl(t)?3:0}function Wn(t,e){return zt(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function ll(t,e){return zt(t)===2?t.get(e):t[e]}function Sr(t,e,n){var l=zt(t);l===2?t.set(e,n):l===3?t.add(n):t[e]=n}function ff(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function ml(t){return hf&&t instanceof Map}function hl(t){return gf&&t instanceof Set}function Qt(t){return t.o||t.t}function xl(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=vf(t);delete e[mt];for(var n=is(e),l=0;l<n.length;l++){var s=n[l],i=e[s];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(e[s]={configurable:!0,writable:!0,enumerable:i.enumerable,value:t[s]})}return Object.create(Object.getPrototypeOf(t),e)}function es(t,e){return e===void 0&&(e=!1),ts(t)||tn(t)||!jt(t)||(zt(t)>1&&(t.set=t.add=t.clear=t.delete=df),Object.freeze(t),e&&Tn(t,function(n,l){return es(l,!0)},!0)),t}function df(){it(2)}function ts(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function St(t){var e=Hl[t];return e||it(18,t),e}function pf(t,e){Hl[t]||(Hl[t]=e)}function eo(){return Fn}function El(t,e){e&&(St("Patches"),t.u=[],t.s=[],t.v=e)}function al(t){Nl(t),t.p.forEach(_f),t.p=null}function Nl(t){t===Fn&&(Fn=t.l)}function to(t){return Fn={p:[],l:Fn,h:t,m:!0,_:0}}function _f(t){var e=t[mt];e.i===0||e.i===1?e.j():e.g=!0}function kl(t,e){e._=e.p.length;var n=e.p[0],l=t!==void 0&&t!==n;return e.h.O||St("ES5").S(e,t,l),l?(n[mt].P&&(al(e),it(4)),jt(t)&&(t=rl(e,t),e.l||ul(e,t)),e.u&&St("Patches").M(n[mt].t,t,e.u,e.s)):t=rl(e,n,[]),al(e),e.u&&e.v(e.u,e.s),t!==ss?t:void 0}function rl(t,e,n){if(ts(e))return e;var l=e[mt];if(!l)return Tn(e,function(a,u){return no(t,l,e,a,u,n)},!0),e;if(l.A!==t)return e;if(!l.P)return ul(t,l.t,!0),l.t;if(!l.I){l.I=!0,l.A._--;var s=l.i===4||l.i===5?l.o=xl(l.k):l.o,i=s,o=!1;l.i===3&&(i=new Set(s),s.clear(),o=!0),Tn(i,function(a,u){return no(t,l,s,a,u,n,o)}),ul(t,s,!1),n&&t.u&&St("Patches").N(l,n,t.u,t.s)}return l.o}function no(t,e,n,l,s,i,o){if(tn(s)){var a=rl(t,s,i&&e&&e.i!==3&&!Wn(e.R,l)?i.concat(l):void 0);if(Sr(n,l,a),!tn(a))return;t.m=!1}else o&&n.add(s);if(jt(s)&&!ts(s)){if(!t.h.D&&t._<1)return;rl(t,s),e&&e.A.l||ul(t,s)}}function ul(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&es(e,n)}function Al(t,e){var n=t[mt];return(n?Qt(n):t)[e]}function lo(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var l=Object.getOwnPropertyDescriptor(n,e);if(l)return l;n=Object.getPrototypeOf(n)}}function Ll(t){t.P||(t.P=!0,t.l&&Ll(t.l))}function Bl(t){t.o||(t.o=xl(t.t))}function Pl(t,e,n){var l=ml(e)?St("MapSet").F(e,n):hl(e)?St("MapSet").T(e,n):t.O?function(s,i){var o=Array.isArray(s),a={i:o?1:0,A:i?i.A:eo(),P:!1,I:!1,R:{},l:i,t:s,k:null,o:null,j:null,C:!1},u=a,c=Gl;o&&(u=[a],c=On);var r=Proxy.revocable(u,c),p=r.revoke,m=r.proxy;return a.k=m,a.j=p,m}(e,n):St("ES5").J(e,n);return(n?n.A:eo()).p.push(l),l}function mf(t){return tn(t)||it(22,t),function e(n){if(!jt(n))return n;var l,s=n[mt],i=zt(n);if(s){if(!s.P&&(s.i<4||!St("ES5").K(s)))return s.t;s.I=!0,l=so(n,i),s.I=!1}else l=so(n,i);return Tn(l,function(o,a){s&&ll(s.t,o)===a||Sr(l,o,e(a))}),i===3?new Set(l):l}(t)}function so(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return xl(t)}function ns(){function t(l){if(!jt(l))return l;if(Array.isArray(l))return l.map(t);if(ml(l))return new Map(Array.from(l.entries()).map(function(o){return[o[0],t(o[1])]}));if(hl(l))return new Set(Array.from(l).map(t));var s=Object.create(Object.getPrototypeOf(l));for(var i in l)s[i]=t(l[i]);return Wn(l,Rn)&&(s[Rn]=l[Rn]),s}function e(l){return tn(l)?t(l):l}var n="add";pf("Patches",{$:function(l,s){return s.forEach(function(i){for(var o=i.path,a=i.op,u=l,c=0;c<o.length-1;c++){var r=zt(u),p=o[c];typeof p!="string"&&typeof p!="number"&&(p=""+p),r!==0&&r!==1||p!=="__proto__"&&p!=="constructor"||it(24),typeof u=="function"&&p==="prototype"&&it(24),typeof(u=ll(u,p))!="object"&&it(15,o.join("/"))}var m=zt(u),b=t(i.value),g=o[o.length-1];switch(a){case"replace":switch(m){case 2:return u.set(g,b);case 3:it(16);default:return u[g]=b}case n:switch(m){case 1:return g==="-"?u.push(b):u.splice(g,0,b);case 2:return u.set(g,b);case 3:return u.add(b);default:return u[g]=b}case"remove":switch(m){case 1:return u.splice(g,1);case 2:return u.delete(g);case 3:return u.delete(i.value);default:return delete u[g]}default:it(17,a)}}),l},N:function(l,s,i,o){switch(l.i){case 0:case 4:case 2:return function(a,u,c,r){var p=a.t,m=a.o;Tn(a.R,function(b,g){var h=ll(p,b),y=ll(m,b),v=g?Wn(p,b)?"replace":n:"remove";if(h!==y||v!=="replace"){var T=u.concat(b);c.push(v==="remove"?{op:v,path:T}:{op:v,path:T,value:y}),r.push(v===n?{op:"remove",path:T}:v==="remove"?{op:n,path:T,value:e(h)}:{op:"replace",path:T,value:e(h)})}})}(l,s,i,o);case 5:case 1:return function(a,u,c,r){var p=a.t,m=a.R,b=a.o;if(b.length<p.length){var g=[b,p];p=g[0],b=g[1];var h=[r,c];c=h[0],r=h[1]}for(var y=0;y<p.length;y++)if(m[y]&&b[y]!==p[y]){var v=u.concat([y]);c.push({op:"replace",path:v,value:e(b[y])}),r.push({op:"replace",path:v,value:e(p[y])})}for(var T=p.length;T<b.length;T++){var A=u.concat([T]);c.push({op:n,path:A,value:e(b[T])})}p.length<b.length&&r.push({op:"replace",path:u.concat(["length"]),value:p.length})}(l,s,i,o);case 3:return function(a,u,c,r){var p=a.t,m=a.o,b=0;p.forEach(function(g){if(!m.has(g)){var h=u.concat([b]);c.push({op:"remove",path:h,value:g}),r.unshift({op:n,path:h,value:g})}b++}),b=0,m.forEach(function(g){if(!p.has(g)){var h=u.concat([b]);c.push({op:n,path:h,value:g}),r.unshift({op:"remove",path:h,value:g})}b++})}(l,s,i,o)}},M:function(l,s,i,o){i.push({op:"replace",path:[],value:s===ss?void 0:s}),o.push({op:"replace",path:[],value:l})}})}var io,Fn,ls=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",hf=typeof Map<"u",gf=typeof Set<"u",oo=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",ss=ls?Symbol.for("immer-nothing"):((io={})["immer-nothing"]=!0,io),Rn=ls?Symbol.for("immer-draftable"):"__$immer_draftable",mt=ls?Symbol.for("immer-state"):"__$immer_state",bf=""+Object.prototype.constructor,is=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,vf=Object.getOwnPropertyDescriptors||function(t){var e={};return is(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},Hl={},Gl={get:function(t,e){if(e===mt)return t;var n=Qt(t);if(!Wn(n,e))return function(s,i,o){var a,u=lo(i,o);return u?"value"in u?u.value:(a=u.get)===null||a===void 0?void 0:a.call(s.k):void 0}(t,n,e);var l=n[e];return t.I||!jt(l)?l:l===Al(t.t,e)?(Bl(t),t.o[e]=Pl(t.A.h,l,t)):l},has:function(t,e){return e in Qt(t)},ownKeys:function(t){return Reflect.ownKeys(Qt(t))},set:function(t,e,n){var l=lo(Qt(t),e);if(l!=null&&l.set)return l.set.call(t.k,n),!0;if(!t.P){var s=Al(Qt(t),e),i=s==null?void 0:s[mt];if(i&&i.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(ff(n,s)&&(n!==void 0||Wn(t.t,e)))return!0;Bl(t),Ll(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return Al(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,Bl(t),Ll(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=Qt(t),l=Reflect.getOwnPropertyDescriptor(n,e);return l&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:l.enumerable,value:n[e]}},defineProperty:function(){it(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){it(12)}},On={};Tn(Gl,function(t,e){On[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),On.deleteProperty=function(t,e){return On.set.call(this,t,e,void 0)},On.set=function(t,e,n){return Gl.set.call(this,t[0],e,n,t[0])};var yf=function(){function t(n){var l=this;this.O=oo,this.D=!0,this.produce=function(s,i,o){if(typeof s=="function"&&typeof i!="function"){var a=i;i=s;var u=l;return function(h){var y=this;h===void 0&&(h=a);for(var v=arguments.length,T=Array(v>1?v-1:0),A=1;A<v;A++)T[A-1]=arguments[A];return u.produce(h,function(B){var O;return(O=i).call.apply(O,[y,B].concat(T))})}}var c;if(typeof i!="function"&&it(6),o!==void 0&&typeof o!="function"&&it(7),jt(s)){var r=to(l),p=Pl(l,s,void 0),m=!0;try{c=i(p),m=!1}finally{m?al(r):Nl(r)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(h){return El(r,o),kl(h,r)},function(h){throw al(r),h}):(El(r,o),kl(c,r))}if(!s||typeof s!="object"){if((c=i(s))===void 0&&(c=s),c===ss&&(c=void 0),l.D&&es(c,!0),o){var b=[],g=[];St("Patches").M(s,c,b,g),o(b,g)}return c}it(21,s)},this.produceWithPatches=function(s,i){if(typeof s=="function")return function(c){for(var r=arguments.length,p=Array(r>1?r-1:0),m=1;m<r;m++)p[m-1]=arguments[m];return l.produceWithPatches(c,function(b){return s.apply(void 0,[b].concat(p))})};var o,a,u=l.produce(s,i,function(c,r){o=c,a=r});return typeof Promise<"u"&&u instanceof Promise?u.then(function(c){return[c,o,a]}):[u,o,a]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){jt(n)||it(8),tn(n)&&(n=mf(n));var l=to(this),s=Pl(this,n,void 0);return s[mt].C=!0,Nl(l),s},e.finishDraft=function(n,l){var s=n&&n[mt],i=s.A;return El(i,l),kl(void 0,i)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!oo&&it(20),this.O=n},e.applyPatches=function(n,l){var s;for(s=l.length-1;s>=0;s--){var i=l[s];if(i.path.length===0&&i.op==="replace"){n=i.value;break}}s>-1&&(l=l.slice(s+1));var o=St("Patches").$;return tn(n)?o(n,l):this.produce(n,function(a){return o(a,l)})},t}(),ht=new yf;ht.produce;var os=ht.produceWithPatches.bind(ht);ht.setAutoFreeze.bind(ht);ht.setUseProxies.bind(ht);ht.applyPatches.bind(ht);ht.createDraft.bind(ht);ht.finishDraft.bind(ht);var mn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};ns();class wf{constructor(e){this.messageBus=e}getItems(e){return mn(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n}})}isItemArray(e){return Array.isArray(e)&&e.every(n=>typeof n!="string")}updateItems(e,n,l=!0){return mn(this,void 0,void 0,function*(){let s;this.isItemArray(e)?s=e:s=yield this.getItems(e);const[i,o]=os(s,n),a=i.map(c=>({id:c.id,type:c.type}));for(const c of o){const[r,p]=c.path;typeof r=="number"&&typeof p=="string"&&(a[r][p]=i[r][p])}const u=a.filter(c=>Object.keys(c).length>2);u.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:u,updateAttachments:l}))})}addItems(e){return mn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return mn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return mn(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return mn(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",n)}}}var hn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};ns();class Tf{constructor(e){this.messageBus=e}getItems(e){return hn(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n}})}updateItems(e,n,l,s=!0){return hn(this,void 0,void 0,function*(){const i=yield this.getItems(e),[o,a]=os(i,n),u=o.map(r=>({id:r.id,type:r.type}));for(const r of a){const[p,m]=r.path;typeof p=="number"&&typeof m=="string"&&(u[p][m]=o[p][m])}const c=u.filter(r=>Object.keys(r).length>2);c.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:c,fastUpdate:l,updateAttachments:s}))})}addItems(e){return hn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return hn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return hn(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return hn(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",n)}}}var Cl=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Ef{constructor(e){this.messageBus=e,this.grid=new uf(e),this.fog=new rf(e),this.history=new cf(e),this.items=new wf(e),this.local=new Tf(e)}isReady(){return Cl(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const n=l=>{e(l.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",n)}}getMetadata(){return Cl(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return Cl(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",n)}}}function Or(t){return t.startsWith("http")?t:`${window.location.origin}${t}`}function $n(t){return t.map(e=>Object.assign(Object.assign({},e),{icon:Or(e.icon)}))}function as(t){return Object.assign(Object.assign({},t),{url:Or(t.url)})}var ao=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class kf{constructor(e){this.contextMenus={},this.handleClick=n=>{var l;const s=this.contextMenus[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return ao(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:$n(e.icons),embed:e.embed&&as(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return ao(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var At=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Af{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=n=>{const l=this.tools[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(i=>{i&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})},this.handleToolActionClick=n=>{var l;const s=this.toolActions[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.handleToolModeClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(i=>{i&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})},this.handleToolModeToolClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolClick){const s=l.onToolClick(n.context,n.event);Promise.resolve(s).then(i=>{i&&n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDoubleClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolDoubleClick){const s=l.onToolDoubleClick(n.context,n.event);Promise.resolve(s).then(i=>{i&&n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragStart=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragStart)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragEnd=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragEnd)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragCancel=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragCancel)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeActivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onActivate)===null||l===void 0||l.call(s,n.context))},this.handleToolModeDeactivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onDeactivate)===null||l===void 0||l.call(s,n.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:$n(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return At(this,void 0,void 0,function*(){const{metadata:n}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return n})}setMetadata(e,n){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:n})})}createAction(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:$n(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:$n(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,n){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:n})})}}var gn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Bf{constructor(e){this.messageBus=e}open(e){return gn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},as(e)))})}close(e){return gn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return gn(this,void 0,void 0,function*(){const{width:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return n})}setWidth(e,n){return gn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:n})})}getHeight(e){return gn(this,void 0,void 0,function*(){const{height:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return n})}setHeight(e,n){return gn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:n})})}}var ro=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Cf{constructor(e){this.messageBus=e}open(e){return ro(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},as(e)))})}close(e){return ro(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var ut=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Sf{constructor(e){this.messageBus=e}getWidth(){return ut(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return ut(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return ut(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return ut(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return ut(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return ut(this,void 0,void 0,function*(){const n=$n([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:n[0].icon})})}getTitle(){return ut(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return ut(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const n=l=>{e(l.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n)}}}var Of=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};ns();class Mf{constructor(e){this.messageBus=e}startItemInteraction(e,n=!0){return Of(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:n});let s=e;return[a=>{const[u,c]=os(s,a);return s=u,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:l,patches:c}),u},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:l})}]})}}var Rf=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class $f{constructor(e){this.messageBus=e}getPlayers(){return Rf(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const n=l=>{e(l.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",n)}}}var Sl=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Df{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return Sl(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return Sl(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return Sl(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",n)}}onPermissionsChange(e){const n=l=>{e(l.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n)}}}var If=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Nf{constructor(e){this.messageBus=e}getTheme(){return If(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const n=l=>{e(l.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",n)}}}var Zn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Lf{constructor(e){this.messageBus=e}uploadImages(e,n){return Zn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e,typeHint:n})})}uploadScenes(e,n){return Zn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e,disableShowScenes:n})})}downloadImages(e,n,l){return Zn(this,void 0,void 0,function*(){const{images:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:e,defaultSearch:n,typeHint:l},-1);return s})}downloadScenes(e,n){return Zn(this,void 0,void 0,function*(){const{scenes:l}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:e,defaultSearch:n},-1);return l})}}var Pf=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(r){try{c(l.next(r))}catch(p){o(p)}}function u(r){try{c(l.throw(r))}catch(p){o(p)}}function c(r){r.done?i(r.value):s(r.value).then(a,u)}c((l=l.apply(t,e||[])).next())})};class Hf{constructor(e){this.messageBus=e}sendMessage(e,n){return Pf(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:e,data:n})})}onMessage(e,n){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:e}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${e}`,n),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:e}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${e}`,n)}}}const Gf=typeof atob=="function",rs=typeof Buffer=="function",uo=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Wf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ff=Array.prototype.slice.call(Wf),Qn=(t=>{let e={};return t.forEach((n,l)=>e[n]=l),e})(Ff),qf=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,xt=String.fromCharCode.bind(String),co=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Mr=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),Uf=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Vf=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return xt((n>>>10)+55296)+xt((n&1023)+56320);case 3:return xt((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return xt((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},jf=t=>t.replace(Uf,Vf),zf=t=>{if(t=t.replace(/\s+/g,""),!qf.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",l,s;for(let i=0;i<t.length;)e=Qn[t.charAt(i++)]<<18|Qn[t.charAt(i++)]<<12|(l=Qn[t.charAt(i++)])<<6|(s=Qn[t.charAt(i++)]),n+=l===64?xt(e>>16&255):s===64?xt(e>>16&255,e>>8&255):xt(e>>16&255,e>>8&255,e&255);return n},Rr=Gf?t=>atob(Mr(t)):rs?t=>Buffer.from(t,"base64").toString("binary"):zf,Yf=rs?t=>co(Buffer.from(t,"base64")):t=>co(Rr(t).split("").map(e=>e.charCodeAt(0))),Kf=rs?t=>Buffer.from(t,"base64").toString("utf8"):uo?t=>uo.decode(Yf(t)):t=>jf(Rr(t)),Xf=t=>Mr(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),Jf=t=>Kf(Xf(t));function Zf(){const e=new URLSearchParams(window.location.search).get("obrref");let n="",l="";if(e){const i=Jf(e).split(" ");i.length===2&&(n=i[0],l=i[1])}return{origin:n,roomId:l}}var fo;(function(t){t[t.MOVE=0]="MOVE",t[t.LINE=1]="LINE",t[t.QUAD=2]="QUAD",t[t.CONIC=3]="CONIC",t[t.CUBIC=4]="CUBIC",t[t.CLOSE=5]="CLOSE"})(fo||(fo={}));const Wl=Zf(),xe=new of(Wl.origin,Wl.roomId),Qf=new jc(xe),xf=new Vc(xe),ed=new $f(xe),td=new af(xe),nd=new Ef(xe),ld=new kf(xe),sd=new Af(xe),id=new Bf(xe),od=new Cf(xe),ad=new Sf(xe),rd=new Mf(xe),ud=new Df(xe),cd=new Nf(xe),fd=new Lf(xe),dd=new Hf(xe),ze={onReady:t=>{xe.ready?t():xe.once("OBR_READY",()=>t())},get isReady(){return xe.ready},viewport:Qf,player:xf,party:ed,notification:td,scene:nd,contextMenu:ld,tool:sd,popover:id,modal:od,action:ad,interaction:rd,room:ud,theme:cd,assets:fd,broadcast:dd,isAvailable:!!Wl.origin},pd=50,us=ct([]);function _d(t){us.update(e=>(e.push({msg:t,timestamp:new Date}),e.length>pd&&e.shift(),e))}function md(){us.set([])}const cl=8,_t=ct(1),Fl=ct(!1),po=Xl($r,2e3,()=>Fl.set(!0),()=>Fl.set(!1));async function hd(){for(let t=0;t<cl;t++)await Ot.removeItem(gl(t+1))}async function gd(){_t.subscribe(t=>po(Ue(he),t)),he.subscribe(t=>po(t,Ue(_t))),_t.subscribe(async t=>{he.set(await Nr(t))}),_t.set(await Dr()),_t.subscribe(Ir)}async function $r(t,e){Ot.setItem(gl(e),JSON.stringify(t))}function gl(t){return`sd-character-sheet-slot-${t}`}async function Dr(){return parseInt(await Ot.getItem("sd-character-sheet-chosen-slot")??"1")}async function Ir(t){Ot.setItem("sd-character-sheet-chosen-slot",`${t}`)}async function Nr(t){await bd(t);const e=await Ot.getItem(gl(t));if(!e)return Ct();try{const n=JSON.parse(e);return Il(n)}catch(n){return console.warn("Failed to parse save, resetting slot",n),Ct()}}async function bd(t){const e="sd-character-sheet",n=await Ot.getItem(e);n&&(await Ot.setItem(gl(t),n),await Ot.removeItem(e))}const Ot={setItem:async function(t,e){return Promise.resolve().then(function(){window.localStorage.setItem(t,e)})},getItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.getItem(t)})},removeItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.removeItem(t)})}},vd="com.maxpaulus.sd-character-sheet",Mn=ct({}),Cn=ct({});function En(t){return`${vd}/${t}`}const qt=ct(!1),Dn=ct([]),Bt=ct(),qn=ct(),cs=ct(),yn=ou(Bt,t=>t==Ue(qn));async function Lr(){ze.onReady(async()=>{qt.set(await ze.player.getRole()==="GM"),yd(),Ue(qt)&&wd(),_o()})}function yd(){ze.broadcast.onMessage(Hr,({data:t})=>{typeof t=="string"&&Ul(t)})}async function wd(){qn.set(ze.player.id),Bt.set(ze.player.id),ze.player.onChange(t=>{cs.set(t)}),ze.party.onChange(t=>{Dn.set(t)}),Dn.subscribe(async t=>{const e={};e[ze.player.id]=(await ze.player.getMetadata())[En("sheetData")];for(const l of t)e[l.id]=l.metadata[En("sheetData")];Mn.set(e);const n=Ue(Bt);t.find(l=>l.id===n)||Bt.set(ze.player.id)}),Mn.subscribe(t=>{var l;const e=Ue(_t),n=Ue(Bt);he.set(((l=t[n])==null?void 0:l[`slot-${e}`])??Ct())}),_t.subscribe(t=>{var l;const e=Ue(Mn),n=Ue(Bt);he.set(((l=e[n])==null?void 0:l[`slot-${t}`])??Ct())}),Bt.subscribe(t=>{var l;const e=Ue(Mn),n=Ue(_t);he.set(((l=e[t])==null?void 0:l[`slot-${n}`])??Ct())}),Dn.set(await ze.party.getPlayers())}async function _o(){_t.set(await Dr());const t={};for(let e=1;e<=cl;e++)t[`slot-${e}`]=await Nr(e)??Ct();Cn.set(t),he.subscribe(Xl(e=>{if(Ue(qt)&&!Ue(yn))return;const n=Ue(Cn),l=Ue(_t);$r(e,l),n[`slot-${l}`]=e,Cn.set(n)},1e3)),_t.subscribe(e=>{if(Ue(qt)&&!Ue(yn))return;Ir(e);const n=Ue(Cn);he.set(n[`slot-${e}`])}),Cn.subscribe(e=>{if(Ue(qt)){if(!Ue(yn))return;const n=Ue(Mn),l=Ue(qn);n[l]=e}ze.player.setMetadata({[En("sheetData")]:e})})}const Td=Object.freeze(Object.defineProperty({__proto__:null,GmId:qn,GmPlayer:cs,PartyStore:Dn,TrackedPlayer:Bt,init:Lr,isGM:qt,isTrackedPlayerGM:yn,pluginId:En},Symbol.toStringTag,{value:"Module"})),Pr="sd-character-sheet-local-settings";function ql(){return{popoverDuration:5}}const wn=ct(ql());async function Ed(){wn.set(await kd()),wn.subscribe(t=>{if(t.popoverDuration<0){wn.set({...t,popoverDuration:0});return}Ot.setItem(Pr,JSON.stringify(t))})}async function kd(){try{const t=await Ot.getItem(Pr);return JSON.parse(t)??ql()}catch{return console.error("couldn't load settings from local storage"),ql()}}const Hr=En("notification");async function xn(t,e={}){if(!ze.isAvailable){alert(t);return}const l=`${await ze.player.getName()}: ${t}`;e.secret?Ul(`Secret: ${l}`):(ze.broadcast.sendMessage(Hr,l),Ul(l))}let el;async function Ul(t){_d(t);const e=En("popover");el&&(clearTimeout(el),el=null);try{await ze.popover.open({id:e,url:`/popover.html?msg=${encodeURIComponent(t)}`,height:100,width:400}),el=setTimeout(()=>{ze.popover.close(e)},(Ue(wn).popoverDuration??5)*1e3)}catch{alert(t)}}function Ad(t){let e,n=Hn(t[0])+"",l;return{c(){e=_("div"),l=P(n),d(e,"class","rounded-md bg-black text-white p-1")},m(s,i){E(s,e,i),f(e,l)},p(s,i){i&1&&n!==(n=Hn(s[0])+"")&&Z(l,n)},d(s){s&&k(e)}}}function mo(t){let e,n;const l=[t[3]];let s={$$slots:{default:[Od]},$$scope:{ctx:t}};for(let i=0;i<l.length;i+=1)s=sl(s,l[i]);return e=new Gc({props:s}),e.$on("click",t[11]),e.$on("clickoutside",t[11]),{c(){te(e.$$.fragment)},m(i,o){ne(e,i,o),n=!0},p(i,o){const a=o&8?nr(l,[eu(i[3])]):{};o&32768&&(a.$$scope={dirty:o,ctx:i}),e.$set(a)},i(i){n||(L(e.$$.fragment,i),n=!0)},o(i){G(e.$$.fragment,i),n=!1},d(i){le(e,i)}}}function Bd(t){let e;return{c(){e=_("div"),e.textContent="秘密擲骰",d(e,"class","text-black")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Cd(t){let e;return{c(){e=_("div"),e.textContent="優勢擲骰",d(e,"class","text-green-700")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Sd(t){let e;return{c(){e=_("div"),e.textContent="劣勢擲骰",d(e,"class","text-red-700")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Od(t){let e,n,l,s,i,o,a,u;return e=new Kn({props:{text:"擲骰"}}),e.$on("click",t[6]),l=new Kn({props:{$$slots:{default:[Bd]},$$scope:{ctx:t}}}),l.$on("click",t[9]),i=new Kn({props:{$$slots:{default:[Cd]},$$scope:{ctx:t}}}),i.$on("click",t[7]),a=new Kn({props:{$$slots:{default:[Sd]},$$scope:{ctx:t}}}),a.$on("click",t[8]),{c(){te(e.$$.fragment),n=w(),te(l.$$.fragment),s=w(),te(i.$$.fragment),o=w(),te(a.$$.fragment)},m(c,r){ne(e,c,r),E(c,n,r),ne(l,c,r),E(c,s,r),ne(i,c,r),E(c,o,r),ne(a,c,r),u=!0},p(c,r){const p={};r&32768&&(p.$$scope={dirty:r,ctx:c}),l.$set(p);const m={};r&32768&&(m.$$scope={dirty:r,ctx:c}),i.$set(m);const b={};r&32768&&(b.$$scope={dirty:r,ctx:c}),a.$set(b)},i(c){u||(L(e.$$.fragment,c),L(l.$$.fragment,c),L(i.$$.fragment,c),L(a.$$.fragment,c),u=!0)},o(c){G(e.$$.fragment,c),G(l.$$.fragment,c),G(i.$$.fragment,c),G(a.$$.fragment,c),u=!1},d(c){le(e,c),c&&k(n),le(l,c),c&&k(s),le(i,c),c&&k(o),le(a,c)}}}function Md(t){let e,n,l,s,i,o;const a=t[14].default,u=In(a,t,t[15],null),c=u||Ad(t);let r=t[2]&&mo(t);return{c(){e=_("div"),n=_("button"),c&&c.c(),l=w(),r&&r.c(),n.disabled=t[1],d(n,"class","bg-black text-white pt-1 px-1 rounded-md"),V(n,"opacity-50",t[1]),V(n,"cursor-not-allowed",t[1])},m(p,m){E(p,e,m),f(e,n),c&&c.m(n,null),f(e,l),r&&r.m(e,null),s=!0,i||(o=[N(n,"click",t[6]),N(n,"contextmenu",xr(t[10])),N(n,"touchstart",t[4]),N(n,"touchend",t[5],{passive:!0})],i=!0)},p(p,[m]){u?u.p&&(!s||m&32768)&&Nn(u,a,p,p[15],s?Pn(a,p[15],m,null):Ln(p[15]),null):c&&c.p&&(!s||m&1)&&c.p(p,s?m:-1),(!s||m&2)&&(n.disabled=p[1]),(!s||m&2)&&V(n,"opacity-50",p[1]),(!s||m&2)&&V(n,"cursor-not-allowed",p[1]),p[2]?r?(r.p(p,m),m&4&&L(r,1)):(r=mo(p),r.c(),L(r,1),r.m(e,null)):r&&(Ge(),G(r,1,1,()=>{r=null}),We())},i(p){s||(L(c,p),L(r),s=!0)},o(p){G(c,p),G(r),s=!1},d(p){p&&k(e),c&&c.d(p),r&&r.d(),i=!1,Ve(o)}}}function Rd(t,e,n){let{$$slots:l={},$$scope:s}=e,{modifier:i=0}=e,{numDice:o=1}=e,{diceType:a="d20"}=e,{disabled:u=!1}=e,c=!1,r={x:0,y:0},p;function m(B){p=setTimeout(()=>{T(B),p=null},500)}function b(){p&&(clearTimeout(p),p=null)}function g(){const B=Gt(a,o),R=`擲出 ${o}${a}: ${B} + ${i} = ${B+i}`;xn(R)}function h(){const B=Gt(a,o),O=Gt(a,o),R=Math.max(B,O),M=`擲出 ${o}${a}: ${B} 與 ${O};
 ${R} + ${i} = ${R+i}`;xn(M)}function y(){const B=Gt(a,o),O=Gt(a,o),R=Math.min(B,O),M=`擲出 ${o}${a}: ${B} 與 ${O};
 ${R} + ${i} = ${R+i}`;xn(M)}function v(){const B=Gt(a,o),R=`擲出 ${o}${a}: ${B} + ${i} = ${B+i}`;xn(R,{secret:!0})}async function T(B){u||(c&&(n(2,c=!1),await new Promise(O=>setTimeout(O,100))),n(3,r={x:B.clientX,y:B.clientY}),n(2,c=!0))}function A(){n(2,c=!1)}return t.$$set=B=>{"modifier"in B&&n(0,i=B.modifier),"numDice"in B&&n(12,o=B.numDice),"diceType"in B&&n(13,a=B.diceType),"disabled"in B&&n(1,u=B.disabled),"$$scope"in B&&n(15,s=B.$$scope)},[i,u,c,r,m,b,g,h,y,v,T,A,o,a,l,s]}class Yt extends Oe{constructor(e){super(),Me(this,e,Rd,Md,Se,{modifier:0,numDice:12,diceType:13,disabled:1})}}function ho(t){let e,n,l;return{c(){e=_("button"),e.innerHTML='<i class="material-icons bg-gray-500 text-white rounded-full text-md p-1 scale-[60%]">close</i>',d(e,"class","absolute right-0")},m(s,i){E(s,e,i),n||(l=N(e,"click",t[3]),n=!0)},p:j,d(s){s&&k(e),n=!1,l()}}}function $d(t){let e,n,l,s,i,o=[{type:"text"},t[1]],a={};for(let c=0;c<o.length;c+=1)a=sl(a,o[c]);let u=t[0]&&ho(t);return{c(){e=_("div"),n=_("input"),l=w(),u&&u.c(),Os(n,a),V(n,"svelte-hnbmdk",!0),d(e,"class","relative")},m(c,r){E(c,e,r),f(e,n),n.autofocus&&n.focus(),re(n,t[0]),f(e,l),u&&u.m(e,null),s||(i=N(n,"input",t[2]),s=!0)},p(c,[r]){Os(n,a=nr(o,[{type:"text"},r&2&&c[1]])),r&1&&n.value!==c[0]&&re(n,c[0]),V(n,"svelte-hnbmdk",!0),c[0]?u?u.p(c,r):(u=ho(c),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i:j,o:j,d(c){c&&k(e),u&&u.d(),s=!1,i()}}}function Dd(t,e,n){const l=["value"];let s=Ms(e,l),{value:i}=e;function o(){i=this.value,n(0,i)}const a=()=>{n(0,i="")};return t.$$set=u=>{e=sl(sl({},e),tu(u)),n(1,s=Ms(e,l)),"value"in u&&n(0,i=u.value)},[i,s,o,a]}class Gr extends Oe{constructor(e){super(),Me(this,e,Dd,$d,Se,{value:0})}}function go(t){let e;return{c(){e=P("(儀式)")},m(n,l){E(n,e,l)},d(n){n&&k(e)}}}function bo(t){let e,n=t[0].stat+"",l;return{c(){e=P("/ "),l=P(n)},m(s,i){E(s,e,i),E(s,l,i)},p(s,i){i&1&&n!==(n=s[0].stat+"")&&Z(l,n)},d(s){s&&k(e),s&&k(l)}}}function vo(t){let e,n,l,s,i=[t[0].components.verbal?"V":null,t[0].components.somatic?"S":null,t[0].components.material?`M (${t[0].components.materialDesc??""})`:null].filter(Boolean).join(", ")+"",o;return{c(){e=_("div"),n=_("span"),n.textContent="構材 (Components)",l=w(),s=_("span"),o=P(i),d(n,"class","font-bold block text-xs text-gray-500"),d(e,"class","col-span-2")},m(a,u){E(a,e,u),f(e,n),f(e,l),f(e,s),f(s,o)},p(a,u){u&1&&i!==(i=[a[0].components.verbal?"V":null,a[0].components.somatic?"S":null,a[0].components.material?`M (${a[0].components.materialDesc??""})`:null].filter(Boolean).join(", ")+"")&&Z(o,i)},d(a){a&&k(e)}}}function Id(t){let e;return{c(){e=_("button"),e.textContent="無法學習",d(e,"class","bg-gray-400 text-white w-full p-2 rounded cursor-not-allowed"),e.disabled=!0},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Nd(t){let e,n,l;return{c(){e=_("button"),e.textContent="學習",d(e,"class","bg-blue-800 text-white w-full p-2 rounded shadow hover:bg-blue-900 transition-colors font-bold")},m(s,i){E(s,e,i),n||(l=N(e,"click",t[9]),n=!0)},p:j,d(s){s&&k(e),n=!1,l()}}}function Ld(t){let e,n,l;return{c(){e=_("button"),e.textContent="遺忘",d(e,"class","bg-red-800 text-white w-full p-2 rounded shadow hover:bg-red-900 transition-colors font-bold")},m(s,i){E(s,e,i),n||(l=N(e,"click",t[8]),n=!0)},p:j,d(s){s&&k(e),n=!1,l()}}}function yo(t){let e,n,l,s,i;return{c(){e=_("button"),e.innerHTML='<i class="material-icons text-sm">delete</i>',n=w(),l=_("button"),l.innerHTML='<i class="material-icons text-sm">edit</i>',d(e,"class","bg-gray-800 text-white p-2 rounded hover:bg-black"),d(l,"class","bg-gray-800 text-white p-2 rounded hover:bg-black")},m(o,a){E(o,e,a),E(o,n,a),E(o,l,a),s||(i=[N(e,"click",t[10]),N(l,"click",t[11])],s=!0)},p:j,d(o){o&&k(e),o&&k(n),o&&k(l),s=!1,Ve(i)}}}function wo(t){let e,n,l;function s(o){t[13](o)}let i={$$slots:{header:[Hd],default:[Pd]},$$scope:{ctx:t}};return t[1]!==void 0&&(i.showModal=t[1]),e=new ft({props:i}),je.push(()=>Ye(e,"showModal",s)),{c(){te(e.$$.fragment)},m(o,a){ne(e,o,a),l=!0},p(o,a){const u={};a&65539&&(u.$$scope={dirty:a,ctx:o}),!n&&a&2&&(n=!0,u.showModal=o[1],Ke(()=>n=!1)),e.$set(u)},i(o){l||(L(e.$$.fragment,o),l=!0)},o(o){G(e.$$.fragment,o),l=!1},d(o){le(e,o)}}}function Pd(t){let e,n;return e=new br({props:{spellToEdit:t[0]}}),e.$on("finish",t[12]),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},p(l,s){const i={};s&1&&(i.spellToEdit=l[0]),e.$set(i)},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function Hd(t){var i;let e,n,l=(((i=t[0].l10n)==null?void 0:i.name)??t[0].name)+"",s;return{c(){e=_("h2"),n=P("編輯法術: "),s=P(l),d(e,"slot","header")},m(o,a){E(o,e,a),f(e,n),f(e,s)},p(o,a){var u;a&1&&l!==(l=(((u=o[0].l10n)==null?void 0:u.name)??o[0].name)+"")&&Z(s,l)},d(o){o&&k(e)}}}function Gd(t){var Ce,Le;let e,n,l,s,i=(((Ce=t[0].l10n)==null?void 0:Ce.name)??t[0].name)+"",o,a,u,c=t[0].tier===0?"戲法":`${t[0].tier} 環`,r,p,m,b,g=($l(t[0].class)??t[0].class)+"",h,y,v,T,A,B,O,R,D,M,S,C,$,I,z=t[7](t[0].range)+"",q,F,ie,fe,me=(((Le=t[0].l10n)==null?void 0:Le.desc)??t[0].desc)+"",ue,Y,U,Q,ke,X,ge,Te,x,W=t[0].ritual&&go(),ee=t[0].stat&&bo(t),ye=t[0].components&&vo(t);function be(se,_e){return _e&9&&(Q=null),_e&9&&(ke=null),Q==null&&(Q=!!gr(se[3],se[0])),Q?Ld:(ke==null&&(ke=!!Lu(se[3],se[0])),ke?Nd:Id)}let de=be(t,-1),pe=de(t),K=t[0].editable&&yo(t),oe=t[1]&&wo(t);return{c(){e=_("div"),n=_("div"),l=_("div"),s=_("span"),o=P(i),a=w(),u=_("span"),r=P(c),p=w(),W&&W.c(),m=w(),b=_("div"),h=P(g),y=w(),ee&&ee.c(),v=w(),T=_("div"),A=_("div"),B=_("span"),B.textContent="持續時間",O=w(),R=_("span"),D=P(t[2]),M=w(),S=_("div"),C=_("span"),C.textContent="施法距離",$=w(),I=_("span"),q=P(z),F=w(),ye&&ye.c(),ie=w(),fe=_("div"),ue=P(me),Y=w(),U=_("div"),pe.c(),X=w(),K&&K.c(),ge=w(),oe&&oe.c(),Te=gt(),d(s,"class","font-bold text-lg text-purple-900"),d(u,"class","text-sm font-bold text-gray-600"),d(l,"class","flex justify-between items-baseline"),d(b,"class","text-xs text-gray-500 italic"),d(n,"class","flex flex-col border-b pb-2 mb-2"),d(B,"class","font-bold block text-xs text-gray-500"),d(C,"class","font-bold block text-xs text-gray-500"),d(T,"class","grid grid-cols-2 gap-2 text-sm mb-3"),d(fe,"class","text-sm leading-relaxed text-gray-800 border-t pt-2 mb-3"),d(U,"class","flex gap-2"),d(e,"class","shadow-md border border-gray-200 mb-3 p-3 rounded-md bg-white")},m(se,_e){E(se,e,_e),f(e,n),f(n,l),f(l,s),f(s,o),f(l,a),f(l,u),f(u,r),f(u,p),W&&W.m(u,null),f(n,m),f(n,b),f(b,h),f(b,y),ee&&ee.m(b,null),f(e,v),f(e,T),f(T,A),f(A,B),f(A,O),f(A,R),f(R,D),f(T,M),f(T,S),f(S,C),f(S,$),f(S,I),f(I,q),f(T,F),ye&&ye.m(T,null),f(e,ie),f(e,fe),f(fe,ue),f(e,Y),f(e,U),pe.m(U,null),f(U,X),K&&K.m(U,null),E(se,ge,_e),oe&&oe.m(se,_e),E(se,Te,_e),x=!0},p(se,[_e]){var De,H;(!x||_e&1)&&i!==(i=(((De=se[0].l10n)==null?void 0:De.name)??se[0].name)+"")&&Z(o,i),(!x||_e&1)&&c!==(c=se[0].tier===0?"戲法":`${se[0].tier} 環`)&&Z(r,c),se[0].ritual?W||(W=go(),W.c(),W.m(u,null)):W&&(W.d(1),W=null),(!x||_e&1)&&g!==(g=($l(se[0].class)??se[0].class)+"")&&Z(h,g),se[0].stat?ee?ee.p(se,_e):(ee=bo(se),ee.c(),ee.m(b,null)):ee&&(ee.d(1),ee=null),(!x||_e&4)&&Z(D,se[2]),(!x||_e&1)&&z!==(z=se[7](se[0].range)+"")&&Z(q,z),se[0].components?ye?ye.p(se,_e):(ye=vo(se),ye.c(),ye.m(T,null)):ye&&(ye.d(1),ye=null),(!x||_e&1)&&me!==(me=(((H=se[0].l10n)==null?void 0:H.desc)??se[0].desc)+"")&&Z(ue,me),de===(de=be(se,_e))&&pe?pe.p(se,_e):(pe.d(1),pe=de(se),pe&&(pe.c(),pe.m(U,X))),se[0].editable?K?K.p(se,_e):(K=yo(se),K.c(),K.m(U,null)):K&&(K.d(1),K=null),se[1]?oe?(oe.p(se,_e),_e&2&&L(oe,1)):(oe=wo(se),oe.c(),L(oe,1),oe.m(Te.parentNode,Te)):oe&&(Ge(),G(oe,1,1,()=>{oe=null}),We())},i(se){x||(L(oe),x=!0)},o(se){G(oe),x=!1},d(se){se&&k(e),W&&W.d(),ee&&ee.d(),ye&&ye.d(),pe.d(),K&&K.d(),se&&k(ge),oe&&oe.d(se),se&&k(Te)}}}function Wd(t,e,n){let l,s;Re(t,ae,A=>n(3,s=A));let{s:i}=e,o=kn(),a=!1;const u={Self:"自身",Touch:"觸碰",Sight:"視線"};function c(A){Pu(s,A),ae.set(s)}function r(A){Hu(s,A),ae.set(s),o("close")}function p(A){Wu(s,A),ae.set(s),o("close")}function m(A){return u[A]??A}const b=()=>r(i),g=()=>c(i),h=()=>p(i),y=()=>{n(1,a=!0)},v=()=>{n(1,a=!1),n(0,i)};function T(A){a=A,n(1,a)}return t.$$set=A=>{"s"in A&&n(0,i=A.s)},t.$$.update=()=>{t.$$.dirty&1&&n(2,l=i.duration)},[i,a,l,s,c,r,p,m,b,g,h,y,v,T]}class Wr extends Oe{constructor(e){super(),Me(this,e,Wd,Gd,Se,{s:0})}}function To(t,e,n){const l=t.slice();return l[14]=e[n],l}function Eo(t,e,n){const l=t.slice();return l[17]=e[n],l}function Fd(t,e,n){const l=t.slice();return l[20]=e[n],l[22]=n,l}function qd(t,e,n){const l=t.slice();return l[20]=e[n],l[22]=n,l}function ko(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T=Array(10),A=[];for(let M=0;M<T.length;M+=1)A[M]=Ud(qd(t,T,M));let B=Array(10),O=[];for(let M=0;M<B.length;M+=1)O[M]=Vd(Fd(t,B,M));let R=Ut,D=[];for(let M=0;M<R.length;M+=1)D[M]=Ao(Eo(t,R,M));return{c(){e=_("div"),n=_("div"),l=_("label"),l.textContent="環階:",s=w(),i=_("select");for(let M=0;M<A.length;M+=1)A[M].c();o=w(),a=_("span"),a.textContent="-",u=w(),c=_("select");for(let M=0;M<O.length;M+=1)O[M].c();r=w(),p=_("div"),m=_("label"),m.textContent="職業:",b=w(),g=_("select"),h=_("option"),h.textContent="全部";for(let M=0;M<D.length;M+=1)D[M].c();d(l,"for","minTier"),d(l,"class","font-bold"),d(i,"id","minTier"),d(i,"class","border rounded"),t[1]===void 0&&He(()=>t[11].call(i)),d(c,"id","maxTier"),d(c,"class","border rounded"),t[2]===void 0&&He(()=>t[12].call(c)),d(n,"class","flex gap-2 items-center"),d(m,"for","classFilter"),d(m,"class","font-bold"),h.__value="All",h.value=h.__value,d(g,"id","classFilter"),d(g,"class","border rounded max-w-[200px]"),t[3]===void 0&&He(()=>t[13].call(g)),d(p,"class","flex gap-2 items-center"),d(e,"class","flex flex-col gap-2 bg-gray-50 p-2 rounded text-sm")},m(M,S){E(M,e,S),f(e,n),f(n,l),f(n,s),f(n,i);for(let C=0;C<A.length;C+=1)A[C]&&A[C].m(i,null);ve(i,t[1],!0),f(n,o),f(n,a),f(n,u),f(n,c);for(let C=0;C<O.length;C+=1)O[C]&&O[C].m(c,null);ve(c,t[2],!0),f(e,r),f(e,p),f(p,m),f(p,b),f(p,g),f(g,h);for(let C=0;C<D.length;C+=1)D[C]&&D[C].m(g,null);ve(g,t[3],!0),y||(v=[N(i,"change",t[11]),N(c,"change",t[12]),N(g,"change",t[13])],y=!0)},p(M,S){if(S&2&&ve(i,M[1]),S&4&&ve(c,M[2]),S&0){R=Ut;let C;for(C=0;C<R.length;C+=1){const $=Eo(M,R,C);D[C]?D[C].p($,S):(D[C]=Ao($),D[C].c(),D[C].m(g,null))}for(;C<D.length;C+=1)D[C].d(1);D.length=R.length}S&8&&ve(g,M[3])},d(M){M&&k(e),Ee(A,M),Ee(O,M),Ee(D,M),y=!1,Ve(v)}}}function Ud(t){let e,n;return{c(){e=_("option"),n=P(t[22]),e.__value=t[22],e.value=e.__value},m(l,s){E(l,e,s),f(e,n)},p:j,d(l){l&&k(e)}}}function Vd(t){let e,n;return{c(){e=_("option"),n=P(t[22]),e.__value=t[22],e.value=e.__value},m(l,s){E(l,e,s),f(e,n)},p:j,d(l){l&&k(e)}}}function Ao(t){let e,n=t[17]+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[17],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function jd(t){let e=[],n=new Map,l,s,i=t[6];const o=a=>a[14].name;for(let a=0;a<i.length;a+=1){let u=To(t,i,a),c=o(u);n.set(c,e[a]=Bo(c,u))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();l=gt()},m(a,u){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(a,u);E(a,l,u),s=!0},p(a,u){u&64&&(i=a[6],Ge(),e=nu(e,u,o,1,a,i,n,l.parentNode,lu,Bo,l,To),We())},i(a){if(!s){for(let u=0;u<i.length;u+=1)L(e[u]);s=!0}},o(a){for(let u=0;u<e.length;u+=1)G(e[u]);s=!1},d(a){for(let u=0;u<e.length;u+=1)e[u].d(a);a&&k(l)}}}function zd(t){let e;return{c(){e=_("div"),e.textContent="沒有符合的法術",d(e,"class","text-center text-gray-500 mt-10")},m(n,l){E(n,e,l)},p:j,i:j,o:j,d(n){n&&k(e)}}}function Bo(t,e){let n,l,s,i;return l=new Wr({props:{s:e[14]}}),{key:t,first:null,c(){n=_("div"),te(l.$$.fragment),s=w(),d(n,"class","mb-4 break-inside-avoid"),this.first=n},m(o,a){E(o,n,a),ne(l,n,null),f(n,s),i=!0},p(o,a){e=o;const u={};a&64&&(u.s=e[14]),l.$set(u)},i(o){i||(L(l.$$.fragment,o),i=!0)},o(o){G(l.$$.fragment,o),i=!1},d(o){o&&k(n),le(l)}}}function Yd(t){let e,n,l,s,i,o,a,u=t[5]?"隱藏過濾":"顯示過濾",c,r,p,m,b,g,h,y,v,T,A,B,O;function R(I){t[8](I)}let D={placeholder:"搜尋法術...",class:"w-full mb-2"};t[0]!==void 0&&(D.value=t[0]),l=new Gr({props:D}),je.push(()=>Ye(l,"value",R));let M=t[5]&&ko(t);const S=[zd,jd],C=[];function $(I,z){return I[6].length===0?0:1}return v=$(t),T=C[v]=S[v](t),{c(){e=_("div"),n=_("div"),te(l.$$.fragment),i=w(),o=_("div"),a=_("button"),c=P(u),r=w(),p=_("label"),m=_("input"),b=P(" 只顯示自訂"),g=w(),M&&M.c(),h=w(),y=_("div"),T.c(),d(a,"class","text-blue-700 underline text-xs"),d(m,"type","checkbox"),d(m,"class","svelte-1ep1fgl"),d(p,"class","flex gap-1 items-center ml-auto"),d(o,"class","flex gap-2 items-center text-sm mb-2 flex-wrap"),d(n,"class","sticky top-0 bg-white p-2 border-b z-10"),d(y,"class","overflow-y-auto p-2 flex-1"),d(e,"class","flex flex-col gap-1 h-full overflow-hidden")},m(I,z){E(I,e,z),f(e,n),ne(l,n,null),f(n,i),f(n,o),f(o,a),f(a,c),f(o,r),f(o,p),f(p,m),m.checked=t[4],f(p,b),f(n,g),M&&M.m(n,null),f(e,h),f(e,y),C[v].m(y,null),A=!0,B||(O=[N(a,"click",t[9]),N(m,"change",t[10])],B=!0)},p(I,[z]){const q={};!s&&z&1&&(s=!0,q.value=I[0],Ke(()=>s=!1)),l.$set(q),(!A||z&32)&&u!==(u=I[5]?"隱藏過濾":"顯示過濾")&&Z(c,u),z&16&&(m.checked=I[4]),I[5]?M?M.p(I,z):(M=ko(I),M.c(),M.m(n,null)):M&&(M.d(1),M=null);let F=v;v=$(I),v===F?C[v].p(I,z):(Ge(),G(C[F],1,1,()=>{C[F]=null}),We(),T=C[v],T?T.p(I,z):(T=C[v]=S[v](I),T.c()),L(T,1),T.m(y,null))},i(I){A||(L(l.$$.fragment,I),L(T),A=!0)},o(I){G(l.$$.fragment,I),G(T),A=!1},d(I){I&&k(e),le(l),M&&M.d(),C[v].d(),B=!1,Ve(O)}}}function Kd(t,e,n){let l,s;Re(t,ae,v=>n(7,s=v));let i="",o=!0,a=0,u=9,c="All",r=!1;function p(v){i=v,n(0,i)}const m=()=>n(5,o=!o);function b(){r=this.checked,n(4,r)}function g(){a=Fe(this),n(1,a)}function h(){u=Fe(this),n(2,u)}function y(){c=Fe(this),n(3,c)}return t.$$.update=()=>{t.$$.dirty&159&&n(6,l=Object.values(zl).concat(s.customSpells??[]).filter(v=>{var A,B;if(v.tier<a||v.tier>u||c!=="All"&&v.class!==c||r&&!s.customSpells.find(O=>O.name===v.name))return!1;const T=i.toLowerCase();return T?v.name.toLowerCase().includes(T)||v.desc.toLowerCase().includes(T)||(((B=(A=v.l10n)==null?void 0:A.name)==null?void 0:B.toLowerCase().includes(T))??!1):!0}).sort((v,T)=>v.tier!==T.tier?v.tier-T.tier:v.name.localeCompare(T.name)))},[i,a,u,c,r,o,l,s,p,m,b,g,h,y]}class Xd extends Oe{constructor(e){super(),Me(this,e,Kd,Yd,Se,{})}}function Jd(t){let e,n;return e=new Xd({}),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function Zd(t){let e;return{c(){e=_("h1"),e.textContent="法術",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Qd(t){let e,n,l,s,i,o,a;function u(r){t[2](r)}let c={vh:90,$$slots:{header:[Zd],default:[Jd]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),je.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.textContent="法術",n=w(),te(l.$$.fragment),d(e,"class","bg-black text-white p-2 w-full")},m(r,p){E(r,e,p),E(r,n,p),ne(l,r,p),i=!0,o||(a=N(e,"click",t[1]),o=!0)},p(r,[p]){const m={};p&8&&(m.$$scope={dirty:p,ctx:r}),!s&&p&1&&(s=!0,m.showModal=r[0],Ke(()=>s=!1)),l.$set(m)},i(r){i||(L(l.$$.fragment,r),i=!0)},o(r){G(l.$$.fragment,r),i=!1},d(r){r&&k(e),r&&k(n),le(l,r),o=!1,a()}}}function xd(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function i(o){l=o,n(0,l)}return[l,s,i]}class ep extends Oe{constructor(e){super(),Me(this,e,xd,Qd,Se,{})}}function tp(t){let e,n;return e=new Wr({props:{s:t[0]}}),e.$on("close",t[3]),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},p(l,s){const i={};s&1&&(i.s=l[0]),e.$set(i)},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function np(t){let e,n=t[0].name+"",l;return{c(){e=_("h2"),l=P(n),d(e,"slot","header")},m(s,i){E(s,e,i),f(e,l)},p(s,i){i&1&&n!==(n=s[0].name+"")&&Z(l,n)},d(s){s&&k(e)}}}function lp(t){let e,n,l,s,i,o,a;function u(r){t[4](r)}let c={$$slots:{header:[np],default:[tp]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ft({props:c}),je.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons">info</i>',n=w(),te(l.$$.fragment)},m(r,p){E(r,e,p),E(r,n,p),ne(l,r,p),i=!0,o||(a=N(e,"click",t[2]),o=!0)},p(r,[p]){const m={};p&35&&(m.$$scope={dirty:p,ctx:r}),!s&&p&2&&(s=!0,m.showModal=r[1],Ke(()=>s=!1)),l.$set(m)},i(r){i||(L(l.$$.fragment,r),i=!0)},o(r){G(l.$$.fragment,r),i=!1},d(r){r&&k(e),r&&k(n),le(l,r),o=!1,a()}}}function sp(t,e,n){let{spell:l}=e,s=!1;const i=()=>{n(1,s=!0)},o=()=>{n(1,s=!1)};function a(u){s=u,n(1,s)}return t.$$set=u=>{"spell"in u&&n(0,l=u.spell)},[l,s,i,o,a]}class ip extends Oe{constructor(e){super(),Me(this,e,sp,lp,Se,{spell:0})}}function Co(t,e,n){const l=t.slice();l[11]=e[n];const s=l[0].spellSlots[l[11]];return l[14]=s,l}function So(t,e,n){const l=t.slice();return l[17]=e[n],l[19]=n,l}function Oo(t,e,n){const l=t.slice();return l[11]=e[n],l}function op(t){let e;return{c(){e=_("div"),e.textContent="尚未設定法術位，點擊「設定」來配置",d(e,"class","text-xs text-gray-500 text-center py-2")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function ap(t){let e,n=t[3],l=[];for(let s=0;s<n.length;s+=1)l[s]=$o(Co(t,n,s));return{c(){e=_("div");for(let s=0;s<l.length;s+=1)l[s].c();d(e,"class","flex flex-wrap gap-2")},m(s,i){E(s,e,i);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null)},p(s,i){if(i&57){n=s[3];let o;for(o=0;o<n.length;o+=1){const a=Co(s,n,o);l[o]?l[o].p(a,i):(l[o]=$o(a),l[o].c(),l[o].m(e,null))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}},d(s){s&&k(e),Ee(l,s)}}}function rp(t){let e,n=t[3],l=[];for(let s=0;s<n.length;s+=1)l[s]=Do(Oo(t,n,s));return{c(){e=_("div");for(let s=0;s<l.length;s+=1)l[s].c();d(e,"class","grid grid-cols-3 gap-1 text-xs")},m(s,i){E(s,e,i);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null)},p(s,i){if(i&73){n=s[3];let o;for(o=0;o<n.length;o+=1){const a=Oo(s,n,o);l[o]?l[o].p(a,i):(l[o]=Do(a),l[o].c(),l[o].m(e,null))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}},d(s){s&&k(e),Ee(l,s)}}}function Mo(t){let e,n,l=t[11]+"",s,i,o,a,u,c,r=t[14].max-t[14].used+"",p,m,b=t[14].max+"",g,h,y=Array(t[14].max),v=[];for(let T=0;T<y.length;T+=1)v[T]=Ro(So(t,y,T));return{c(){e=_("div"),n=_("span"),s=P(l),i=P("環"),o=w(),a=_("div");for(let T=0;T<v.length;T+=1)v[T].c();u=w(),c=_("span"),p=P(r),m=P("/"),g=P(b),h=w(),d(n,"class","text-xs font-medium text-gray-600"),d(a,"class","flex gap-0.5 my-1"),d(c,"class","text-[10px] text-gray-500"),d(e,"class","flex flex-col items-center p-1 border rounded bg-white min-w-[50px]")},m(T,A){E(T,e,A),f(e,n),f(n,s),f(n,i),f(e,o),f(e,a);for(let B=0;B<v.length;B+=1)v[B]&&v[B].m(a,null);f(e,u),f(e,c),f(c,p),f(c,m),f(c,g),f(e,h)},p(T,A){if(A&57){y=Array(T[14].max);let B;for(B=0;B<y.length;B+=1){const O=So(T,y,B);v[B]?v[B].p(O,A):(v[B]=Ro(O),v[B].c(),v[B].m(a,null))}for(;B<v.length;B+=1)v[B].d(1);v.length=y.length}A&1&&r!==(r=T[14].max-T[14].used+"")&&Z(p,r),A&1&&b!==(b=T[14].max+"")&&Z(g,b)},d(T){T&&k(e),Ee(v,T)}}}function Ro(t){let e,n,l,s;function i(){return t[10](t[19],t[14],t[11])}return{c(){e=_("button"),d(e,"class","w-4 h-4 rounded-full border-2 transition-colors"),d(e,"title",n=t[19]>=t[14].max-t[14].used?"點擊恢復":"點擊使用"),V(e,"bg-purple-600",t[19]>=t[14].max-t[14].used),V(e,"border-purple-600",t[19]>=t[14].max-t[14].used),V(e,"border-gray-300",t[19]<t[14].max-t[14].used)},m(o,a){E(o,e,a),l||(s=N(e,"click",i),l=!0)},p(o,a){t=o,a&1&&n!==(n=t[19]>=t[14].max-t[14].used?"點擊恢復":"點擊使用")&&d(e,"title",n),a&9&&V(e,"bg-purple-600",t[19]>=t[14].max-t[14].used),a&9&&V(e,"border-purple-600",t[19]>=t[14].max-t[14].used),a&9&&V(e,"border-gray-300",t[19]<t[14].max-t[14].used)},d(o){o&&k(e),l=!1,s()}}}function $o(t){let e,n=t[14]&&t[14].max>0&&Mo(t);return{c(){n&&n.c(),e=gt()},m(l,s){n&&n.m(l,s),E(l,e,s)},p(l,s){l[14]&&l[14].max>0?n?n.p(l,s):(n=Mo(l),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(l){n&&n.d(l),l&&k(e)}}}function Do(t){let e,n,l=t[11]+"",s,i,o,a,u,c,r,p;function m(...b){return t[9](t[11],...b)}return{c(){var b;e=_("div"),n=_("span"),s=P(l),i=P("環"),o=w(),a=_("input"),c=w(),d(n,"class","font-medium w-6"),d(a,"type","number"),d(a,"min","0"),d(a,"max","9"),d(a,"class","w-10 border rounded px-1 text-center"),a.value=u=((b=t[0].spellSlots[t[11]])==null?void 0:b.max)??0,d(e,"class","flex items-center gap-1 p-1 border rounded bg-white")},m(b,g){E(b,e,g),f(e,n),f(n,s),f(n,i),f(e,o),f(e,a),f(e,c),r||(p=N(a,"input",m),r=!0)},p(b,g){var h;t=b,g&1&&u!==(u=((h=t[0].spellSlots[t[11]])==null?void 0:h.max)??0)&&a.value!==u&&(a.value=u)},d(b){b&&k(e),r=!1,p()}}}function up(t){let e,n,l,s,i,o,a,u,c=t[1]?"完成":"設定",r,p,m,b;function g(v,T){return v[1]?rp:v[2]?ap:op}let h=g(t),y=h(t);return{c(){e=_("div"),n=_("div"),l=_("h3"),l.textContent="法術位",s=w(),i=_("div"),o=_("button"),o.textContent="恢復全部",a=w(),u=_("button"),r=P(c),p=w(),y.c(),d(l,"class","font-bold text-sm"),d(o,"class","text-xs px-2 py-0.5 bg-blue-600 text-white rounded hover:bg-blue-700"),d(o,"title","長休恢復所有法術位"),d(u,"class","text-xs px-2 py-0.5 bg-gray-300 rounded hover:bg-gray-400"),d(u,"title","設定法術位上限"),d(i,"class","flex gap-1"),d(n,"class","flex justify-between items-center mb-2"),d(e,"class","border rounded p-2 bg-gray-50")},m(v,T){E(v,e,T),f(e,n),f(n,l),f(n,s),f(n,i),f(i,o),f(i,a),f(i,u),f(u,r),f(e,p),y.m(e,null),m||(b=[N(o,"click",t[7]),N(u,"click",t[8])],m=!0)},p(v,[T]){T&2&&c!==(c=v[1]?"完成":"設定")&&Z(r,c),h===(h=g(v))&&y?y.p(v,T):(y.d(1),y=h(v),y&&(y.c(),y.m(e,null)))},i:j,o:j,d(v){v&&k(e),y.d(),m=!1,Ve(b)}}}function cp(t,e,n){let l,s;Re(t,ae,g=>n(0,s=g));const i=[1,2,3,4,5,6,7,8,9];function o(g){s.spellSlots[g]||$e(ae,s.spellSlots[g]={max:0,used:0},s);const h=s.spellSlots[g];h.used<h.max&&(h.used+=1,ae.set(s))}function a(g){if(!s.spellSlots[g])return;const h=s.spellSlots[g];h.used>0&&(h.used-=1,ae.set(s))}function u(g,h){s.spellSlots[g]||$e(ae,s.spellSlots[g]={max:0,used:0},s),$e(ae,s.spellSlots[g].max=Math.max(0,h),s),s.spellSlots[g].used>s.spellSlots[g].max&&$e(ae,s.spellSlots[g].used=s.spellSlots[g].max,s),ae.set(s)}function c(){for(const g of i)s.spellSlots[g]&&$e(ae,s.spellSlots[g].used=0,s);ae.set(s)}let r=!1;const p=()=>n(1,r=!r),m=(g,h)=>u(g,parseInt(h.currentTarget.value)||0),b=(g,h,y)=>{g>=h.max-h.used?a(y):o(y)};return t.$$.update=()=>{t.$$.dirty&1&&n(2,l=i.some(g=>s.spellSlots[g]&&s.spellSlots[g].max>0))},[s,r,l,i,o,a,u,c,p,m,b]}class fp extends Oe{constructor(e){super(),Me(this,e,cp,up,Se,{})}}const{Boolean:dp}=lr;function Io(t,e,n){const l=t.slice();return l[5]=e[n],l}function pp(t){let e;return{c(){e=_("div"),e.textContent="尚未學習法術",d(e,"class","text-gray-500 text-center py-4")},m(n,l){E(n,e,l)},p:j,i:j,o:j,d(n){n&&k(e)}}}function _p(t){let e,n,l=t[0],s=[];for(let o=0;o<l.length;o+=1)s[o]=No(Io(t,l,o));const i=o=>G(s[o],1,1,()=>{s[o]=null});return{c(){e=_("ul");for(let o=0;o<s.length;o+=1)s[o].c();d(e,"class","flex flex-col gap-1")},m(o,a){E(o,e,a);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);n=!0},p(o,a){if(a&5){l=o[0];let u;for(u=0;u<l.length;u+=1){const c=Io(o,l,u);s[u]?(s[u].p(c,a),L(s[u],1)):(s[u]=No(c),s[u].c(),L(s[u],1),s[u].m(e,null))}for(Ge(),u=l.length;u<s.length;u+=1)i(u);We()}},i(o){if(!n){for(let a=0;a<l.length;a+=1)L(s[a]);n=!0}},o(o){s=s.filter(dp);for(let a=0;a<s.length;a+=1)G(s[a]);n=!1},d(o){o&&k(e),Ee(s,o)}}}function mp(t){let e;return{c(){e=_("span"),e.textContent="攻擊",d(e,"class","font-bold px-1")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function No(t){var O;let e,n,l,s,i,o,a,u=(((O=t[5].l10n)==null?void 0:O.name)??t[5].name)+"",c,r,p,m=t[5].tier===0?"戲法":`${t[5].tier} 環`,b,g,h,y,v,T,A,B;return s=new ip({props:{spell:t[5]}}),v=new Yt({props:{modifier:t[2],$$slots:{default:[mp]},$$scope:{ctx:t}}}),{c(){e=_("li"),n=_("div"),l=_("div"),te(s.$$.fragment),i=w(),o=_("div"),a=_("span"),c=P(u),r=w(),p=_("span"),b=P(m),g=w(),h=_("div"),y=_("div"),te(v.$$.fragment),A=w(),d(a,"class","font-bold"),d(p,"class","text-[10px] text-gray-500"),d(o,"class","flex flex-col"),d(l,"class","flex gap-2 items-center"),d(y,"title",T=`法術攻擊 (${t[2]>=0?"+":""}${t[2]})`),d(h,"class","flex items-center gap-2"),d(n,"class","flex justify-between border-b border-gray-300 items-center py-1")},m(R,D){E(R,e,D),f(e,n),f(n,l),ne(s,l,null),f(l,i),f(l,o),f(o,a),f(a,c),f(o,r),f(o,p),f(p,b),f(n,g),f(n,h),f(h,y),ne(v,y,null),f(e,A),B=!0},p(R,D){var C;const M={};D&1&&(M.spell=R[5]),s.$set(M),(!B||D&1)&&u!==(u=(((C=R[5].l10n)==null?void 0:C.name)??R[5].name)+"")&&Z(c,u),(!B||D&1)&&m!==(m=R[5].tier===0?"戲法":`${R[5].tier} 環`)&&Z(b,m);const S={};D&4&&(S.modifier=R[2]),D&256&&(S.$$scope={dirty:D,ctx:R}),v.$set(S),(!B||D&4&&T!==(T=`法術攻擊 (${R[2]>=0?"+":""}${R[2]})`))&&d(y,"title",T)},i(R){B||(L(s.$$.fragment,R),L(v.$$.fragment,R),B=!0)},o(R){G(s.$$.fragment,R),G(v.$$.fragment,R),B=!1},d(R){R&&k(e),le(s),le(v)}}}function hp(t){let e,n,l,s,i,o,a=t[2]>=0?"+":"",u,c,r,p,m,b,g,h,y,v,T,A,B,O,R,D,M,S,C;v=new fp({});const $=[_p,pp],I=[];function z(q,F){return q[3]?0:1}return A=z(t),B=I[A]=$[A](t),D=new ep({}),S=new Lc({}),{c(){e=_("div"),n=_("div"),l=_("div"),s=_("span"),s.textContent="法術攻擊",i=w(),o=_("span"),u=P(a),c=P(t[2]),r=w(),p=_("div"),m=_("span"),m.textContent="法術 DC",b=w(),g=_("span"),h=P(t[1]),y=w(),te(v.$$.fragment),T=w(),B.c(),O=w(),R=_("div"),te(D.$$.fragment),M=w(),te(S.$$.fragment),d(s,"class","text-xs font-bold text-gray-500"),d(o,"class","text-xl font-bold"),d(l,"class","flex flex-col items-center"),d(m,"class","text-xs font-bold text-gray-500"),d(g,"class","text-xl font-bold"),d(p,"class","flex flex-col items-center"),d(n,"class","flex justify-between items-center bg-gray-100 p-2 rounded"),d(R,"class","flex gap-2 mt-2"),d(e,"class","flex flex-col gap-2")},m(q,F){E(q,e,F),f(e,n),f(n,l),f(l,s),f(l,i),f(l,o),f(o,u),f(o,c),f(n,r),f(n,p),f(p,m),f(p,b),f(p,g),f(g,h),f(e,y),ne(v,e,null),f(e,T),I[A].m(e,null),f(e,O),f(e,R),ne(D,R,null),f(R,M),ne(S,R,null),C=!0},p(q,[F]){(!C||F&4)&&a!==(a=q[2]>=0?"+":"")&&Z(u,a),(!C||F&4)&&Z(c,q[2]),(!C||F&2)&&Z(h,q[1]);let ie=A;A=z(q),A===ie?I[A].p(q,F):(Ge(),G(I[ie],1,1,()=>{I[ie]=null}),We(),B=I[A],B?B.p(q,F):(B=I[A]=$[A](q),B.c()),L(B,1),B.m(e,O))},i(q){C||(L(v.$$.fragment,q),L(B),L(D.$$.fragment,q),L(S.$$.fragment,q),C=!0)},o(q){G(v.$$.fragment,q),G(B),G(D.$$.fragment,q),G(S.$$.fragment,q),C=!1},d(q){q&&k(e),le(v),I[A].d(),le(D),le(S)}}}function gp(t,e,n){let l,s,i,o,a;return Re(t,ae,u=>n(4,a=u)),t.$$.update=()=>{t.$$.dirty&16&&n(0,l=a.spells.map(u=>ur(u.name)).filter(Boolean)),t.$$.dirty&1&&n(3,s=(l==null?void 0:l.length)>0),t.$$.dirty&16&&n(2,i=_r(a)),t.$$.dirty&16&&n(1,o=Ru(a))},[l,o,i,s,a]}class bp extends Oe{constructor(e){super(),Me(this,e,gp,hp,Se,{})}}function Lo(t,e,n){const l=t.slice();l[5]=e[n];const s=l[0].skills[l[5]]||0;l[6]=s;const i=l[1][l[5]];l[7]=i;const o=qu(l[0],l[5]);l[8]=o;const a=l[6]>0;return l[9]=a,l}function Po(t){let e,n,l,s=Ho(t[6])+"",i,o,a,u,c,r=t[2][t[5]]+"",p,m,b,g=Vt(t[7])+"",h,y,v,T,A,B,O;function R(){return t[4](t[5])}return v=new Yt({props:{modifier:t[8]}}),{c(){e=_("div"),n=_("div"),l=_("button"),i=P(s),a=w(),u=_("div"),c=_("span"),p=P(r),m=w(),b=_("span"),h=P(g),y=w(),te(v.$$.fragment),T=w(),d(l,"class","w-5 h-5 rounded border flex items-center justify-center text-xs font-bold"),d(l,"title",o=Go(t[6])),V(l,"bg-green-600",t[6]===1),V(l,"bg-yellow-500",t[6]===2),V(l,"text-white",t[9]),V(l,"border-green-600",t[6]===1),V(l,"border-yellow-500",t[6]===2),V(l,"border-gray-300",!t[9]),d(c,"class","font-medium"),d(b,"class","text-[10px] text-gray-400"),d(u,"class","flex flex-col leading-tight"),d(n,"class","flex items-center gap-2"),d(e,"class","flex items-center justify-between border-b border-gray-100 py-1 px-2"),V(e,"bg-green-50",t[6]===1),V(e,"bg-yellow-50",t[6]===2)},m(D,M){E(D,e,M),f(e,n),f(n,l),f(l,i),f(n,a),f(n,u),f(u,c),f(c,p),f(u,m),f(u,b),f(b,h),f(e,y),ne(v,e,null),f(e,T),A=!0,B||(O=N(l,"click",R),B=!0)},p(D,M){t=D,(!A||M&1)&&s!==(s=Ho(t[6])+"")&&Z(i,s),(!A||M&1&&o!==(o=Go(t[6])))&&d(l,"title",o),(!A||M&1)&&V(l,"bg-green-600",t[6]===1),(!A||M&1)&&V(l,"bg-yellow-500",t[6]===2),(!A||M&1)&&V(l,"text-white",t[9]),(!A||M&1)&&V(l,"border-green-600",t[6]===1),(!A||M&1)&&V(l,"border-yellow-500",t[6]===2),(!A||M&1)&&V(l,"border-gray-300",!t[9]);const S={};M&1&&(S.modifier=t[8]),v.$set(S),(!A||M&1)&&V(e,"bg-green-50",t[6]===1),(!A||M&1)&&V(e,"bg-yellow-50",t[6]===2)},i(D){A||(L(v.$$.fragment,D),A=!0)},o(D){G(v.$$.fragment,D),A=!1},d(D){D&&k(e),le(v),B=!1,O()}}}function vp(t){let e,n,l,s,i,o,a,u,c=Hs,r=[];for(let m=0;m<c.length;m+=1)r[m]=Po(Lo(t,c,m));const p=m=>G(r[m],1,1,()=>{r[m]=null});return{c(){e=_("div"),n=_("h2"),n.textContent="技能",l=w(),s=_("div"),s.textContent="點擊切換: 無 → ● 熟練 → ◆ 專精",i=w(),o=_("div"),a=_("div");for(let m=0;m<r.length;m+=1)r[m].c();d(s,"class","text-xs text-gray-500 mb-1"),d(a,"class","flex flex-col text-sm"),d(o,"class","overflow-y-auto max-h-[280px]"),Wt(o,"box-shadow","inset 0 0 3px #0002"),d(e,"class","flex flex-col gap-1")},m(m,b){E(m,e,b),f(e,n),f(e,l),f(e,s),f(e,i),f(e,o),f(o,a);for(let g=0;g<r.length;g+=1)r[g]&&r[g].m(a,null);u=!0},p(m,[b]){if(b&15){c=Hs;let g;for(g=0;g<c.length;g+=1){const h=Lo(m,c,g);r[g]?(r[g].p(h,b),L(r[g],1)):(r[g]=Po(h),r[g].c(),L(r[g],1),r[g].m(a,null))}for(Ge(),g=c.length;g<r.length;g+=1)p(g);We()}},i(m){if(!u){for(let b=0;b<c.length;b+=1)L(r[b]);u=!0}},o(m){r=r.filter(Boolean);for(let b=0;b<r.length;b+=1)G(r[b]);u=!1},d(m){m&&k(e),Ee(r,m)}}}function Ho(t){switch(t){case 0:return"";case .5:return"½";case 1:return"●";case 2:return"◆";default:return""}}function Go(t){switch(t){case 0:return"無熟練";case .5:return"半熟練 (Jack of All Trades)";case 1:return"熟練";case 2:return"專精 (Expertise)";default:return""}}function yp(t,e,n){let l;Re(t,ae,u=>n(0,l=u));const s={Athletics:"STR",Acrobatics:"DEX","Sleight of Hand":"DEX",Stealth:"DEX",Arcana:"INT",History:"INT",Investigation:"INT",Nature:"INT",Religion:"INT","Animal Handling":"WIS",Insight:"WIS",Medicine:"WIS",Perception:"WIS",Survival:"WIS",Deception:"CHA",Intimidation:"CHA",Performance:"CHA",Persuasion:"CHA"},i={Acrobatics:"特技","Animal Handling":"馴獸",Arcana:"奧祕",Athletics:"運動",Deception:"欺瞞",History:"歷史",Insight:"洞察",Intimidation:"威嚇",Investigation:"調查",Medicine:"醫藥",Nature:"自然",Perception:"察覺",Performance:"表演",Persuasion:"說服",Religion:"宗教","Sleight of Hand":"巧手",Stealth:"隱匿",Survival:"求生"};function o(u){const c=l.skills[u]||0,r=c===0?1:c===1?2:0;$e(ae,l.skills[u]=r,l),ae.set(l)}return[l,s,i,o,u=>o(u)]}class wp extends Oe{constructor(e){super(),Me(this,e,yp,vp,Se,{})}}function Wo(t,e,n){const l=t.slice();l[4]=e[n];const s=l[2](l[4]);l[5]=s;const i=l[0].savingThrows[l[4]];return l[6]=i,l}function Fo(t){let e;return{c(){e=P("✓")},m(n,l){E(n,e,l)},d(n){n&&k(e)}}}function qo(t){let e,n,l,s,i,o,a=Vt(t[4])+"",u,c,r,p,m,b,g,h=t[6]&&Fo();function y(){return t[3](t[4])}return r=new Yt({props:{modifier:t[5]}}),{c(){e=_("div"),n=_("div"),l=_("button"),h&&h.c(),i=w(),o=_("span"),u=P(a),c=w(),te(r.$$.fragment),p=w(),d(l,"class","w-4 h-4 rounded border flex items-center justify-center text-xs"),d(l,"title",s=t[6]?"移除熟練":"添加熟練"),V(l,"bg-green-600",t[6]),V(l,"text-white",t[6]),V(l,"border-green-600",t[6]),V(l,"border-gray-400",!t[6]),d(o,"class","font-medium"),d(n,"class","flex items-center gap-1"),d(e,"class","flex items-center justify-between border-b border-gray-200 py-1 px-1 rounded"),V(e,"bg-green-50",t[6])},m(v,T){E(v,e,T),f(e,n),f(n,l),h&&h.m(l,null),f(n,i),f(n,o),f(o,u),f(e,c),ne(r,e,null),f(e,p),m=!0,b||(g=N(l,"click",y),b=!0)},p(v,T){t=v,t[6]?h||(h=Fo(),h.c(),h.m(l,null)):h&&(h.d(1),h=null),(!m||T&1&&s!==(s=t[6]?"移除熟練":"添加熟練"))&&d(l,"title",s),(!m||T&1)&&V(l,"bg-green-600",t[6]),(!m||T&1)&&V(l,"text-white",t[6]),(!m||T&1)&&V(l,"border-green-600",t[6]),(!m||T&1)&&V(l,"border-gray-400",!t[6]),(!m||T&1)&&V(e,"bg-green-50",t[6])},i(v){m||(L(r.$$.fragment,v),m=!0)},o(v){G(r.$$.fragment,v),m=!1},d(v){v&&k(e),h&&h.d(),le(r),b=!1,g()}}}function Tp(t){let e,n,l,s,i,o=Mt,a=[];for(let c=0;c<o.length;c+=1)a[c]=qo(Wo(t,o,c));const u=c=>G(a[c],1,1,()=>{a[c]=null});return{c(){e=_("div"),n=_("h2"),n.textContent="豁免檢定",l=w(),s=_("div");for(let c=0;c<a.length;c+=1)a[c].c();d(s,"class","grid grid-cols-2 gap-1 text-sm"),d(e,"class","flex flex-col gap-1")},m(c,r){E(c,e,r),f(e,n),f(e,l),f(e,s);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(s,null);i=!0},p(c,[r]){if(r&7){o=Mt;let p;for(p=0;p<o.length;p+=1){const m=Wo(c,o,p);a[p]?(a[p].p(m,r),L(a[p],1)):(a[p]=qo(m),a[p].c(),L(a[p],1),a[p].m(s,null))}for(Ge(),p=o.length;p<a.length;p+=1)u(p);We()}},i(c){if(!i){for(let r=0;r<o.length;r+=1)L(a[r]);i=!0}},o(c){a=a.filter(Boolean);for(let r=0;r<a.length;r+=1)G(a[r]);i=!1},d(c){c&&k(e),Ee(a,c)}}}function Ep(t,e,n){let l;Re(t,ae,a=>n(0,l=a));function s(a){$e(ae,l.savingThrows[a]=!l.savingThrows[a],l),ae.set(l)}function i(a){const u=Rt(l,a),c=l.savingThrows[a]?fl(l.level):0;return u+c}return[l,s,i,a=>s(a)]}class kp extends Oe{constructor(e){super(),Me(this,e,Ep,Tp,Se,{})}}function Uo(t,e,n){const l=t.slice();return l[3]=e[n],l}function Vo(t){let e,n=t[3].label+"",l,s,i,o;function a(){return t[2](t[3])}return{c(){e=_("button"),l=P(n),s=w(),d(e,"class","px-3 py-1 text-sm font-medium border-b-2 transition-colors"),V(e,"border-blue-600",t[0]===t[3].id),V(e,"text-blue-600",t[0]===t[3].id),V(e,"border-transparent",t[0]!==t[3].id),V(e,"text-gray-500",t[0]!==t[3].id),V(e,"hover:text-gray-700",t[0]!==t[3].id)},m(u,c){E(u,e,c),f(e,l),f(e,s),i||(o=N(e,"click",a),i=!0)},p(u,c){t=u,c&3&&V(e,"border-blue-600",t[0]===t[3].id),c&3&&V(e,"text-blue-600",t[0]===t[3].id),c&3&&V(e,"border-transparent",t[0]!==t[3].id),c&3&&V(e,"text-gray-500",t[0]!==t[3].id),c&3&&V(e,"hover:text-gray-700",t[0]!==t[3].id)},d(u){u&&k(e),i=!1,o()}}}function Ap(t){let e,n,l,s,i;return e=new Cc({}),s=new ju({}),{c(){te(e.$$.fragment),n=w(),l=_("div"),te(s.$$.fragment),d(l,"class","mt-3")},m(o,a){ne(e,o,a),E(o,n,a),E(o,l,a),ne(s,l,null),i=!0},i(o){i||(L(e.$$.fragment,o),L(s.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(s.$$.fragment,o),i=!1},d(o){le(e,o),o&&k(n),o&&k(l),le(s)}}}function Bp(t){let e,n;return e=new bp({}),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function Cp(t){let e,n,l,s,i;return e=new kp({}),s=new wp({}),{c(){te(e.$$.fragment),n=w(),l=_("div"),te(s.$$.fragment),d(l,"class","mt-3")},m(o,a){ne(e,o,a),E(o,n,a),E(o,l,a),ne(s,l,null),i=!0},i(o){i||(L(e.$$.fragment,o),L(s.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(s.$$.fragment,o),i=!1},d(o){le(e,o),o&&k(n),o&&k(l),le(s)}}}function Sp(t){let e,n,l,s,i,o,a=t[1],u=[];for(let m=0;m<a.length;m+=1)u[m]=Vo(Uo(t,a,m));const c=[Cp,Bp,Ap],r=[];function p(m,b){return m[0]==="skills"?0:m[0]==="spells"?1:m[0]==="bonuses"?2:-1}return~(s=p(t))&&(i=r[s]=c[s](t)),{c(){e=_("div");for(let m=0;m<u.length;m+=1)u[m].c();n=w(),l=_("div"),i&&i.c(),d(e,"class","flex border-b border-gray-300 mb-2"),d(l,"class","overflow-y-auto flex-1")},m(m,b){E(m,e,b);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(e,null);E(m,n,b),E(m,l,b),~s&&r[s].m(l,null),o=!0},p(m,[b]){if(b&3){a=m[1];let h;for(h=0;h<a.length;h+=1){const y=Uo(m,a,h);u[h]?u[h].p(y,b):(u[h]=Vo(y),u[h].c(),u[h].m(e,null))}for(;h<u.length;h+=1)u[h].d(1);u.length=a.length}let g=s;s=p(m),s!==g&&(i&&(Ge(),G(r[g],1,1,()=>{r[g]=null}),We()),~s?(i=r[s],i||(i=r[s]=c[s](m),i.c()),L(i,1),i.m(l,null)):i=null)},i(m){o||(L(i),o=!0)},o(m){G(i),o=!1},d(m){m&&k(e),Ee(u,m),m&&k(n),m&&k(l),~s&&r[s].d()}}}function Op(t,e,n){let l="skills";return[l,[{id:"skills",label:"技能"},{id:"spells",label:"法術"},{id:"bonuses",label:"加值"}],o=>n(0,l=o.id)]}class Mp extends Oe{constructor(e){super(),Me(this,e,Op,Sp,Se,{})}}function Rp(t){let e,n,l,s=Vt(t[0])+"",i,o,a,u,c,r,p,m,b,g;return p=new Yt({props:{modifier:t[2]}}),{c(){e=_("div"),n=_("label"),l=_("h2"),i=P(s),o=w(),a=_("div"),u=_("input"),r=P(" / "),te(p.$$.fragment),d(u,"id",c=`${t[0]}-input}`),d(u,"type","number"),d(u,"inputmode","numeric"),u.value=t[1],d(u,"min","1"),d(u,"max","20"),d(u,"class","w-1/2"),d(a,"class","sheet-stat flex gap-1"),d(e,"class","flex flex-col")},m(h,y){E(h,e,y),f(e,n),f(n,l),f(l,i),f(n,o),f(n,a),f(a,u),f(a,r),ne(p,a,null),m=!0,b||(g=N(u,"input",t[4]),b=!0)},p(h,[y]){(!m||y&1)&&s!==(s=Vt(h[0])+"")&&Z(i,s),(!m||y&1&&c!==(c=`${h[0]}-input}`))&&d(u,"id",c),(!m||y&2&&u.value!==h[1])&&(u.value=h[1]);const v={};y&4&&(v.modifier=h[2]),p.$set(v)},i(h){m||(L(p.$$.fragment,h),m=!0)},o(h){G(p.$$.fragment,h),m=!1},d(h){h&&k(e),le(p),b=!1,g()}}}function $p(t,e,n){let l,s,i,o,{forStat:a}=e;const u=he;Re(t,u,r=>n(5,o=r));function c(r){const p=parseInt(r.target.value)||10;$e(u,o.stats[a]=p-i,o)}return t.$$set=r=>{"forStat"in r&&n(0,a=r.forStat)},t.$$.update=()=>{t.$$.dirty&33&&n(2,l=Rt(o,a)),t.$$.dirty&33&&n(1,s=Jl(o,a)),t.$$.dirty&33&&(i=pr(o,a))},[a,s,l,u,c,o]}class bn extends Oe{constructor(e){super(),Me(this,e,$p,Rp,Se,{forStat:0})}}function jo(t,e,n){const l=t.slice();l[7]=e[n];const s=l[0].includes(l[7]);return l[8]=s,l}function zo(t){let e,n,l=(t[3][t[7]]??t[7])+"",s,i,o,a,u;function c(){return t[6](t[7])}return{c(){e=_("button"),n=_("div"),s=P(l),o=w(),d(n,"class",i=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)},m(r,p){E(r,e,p),f(e,n),f(n,s),f(e,o),a||(u=N(e,"click",c),a=!0)},p(r,p){t=r,p&12&&l!==(l=(t[3][t[7]]??t[7])+"")&&Z(s,l),p&5&&i!==(i=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)&&d(n,"class",i)},d(r){r&&k(e),a=!1,u()}}}function Dp(t){let e,n=t[2],l=[];for(let s=0;s<n.length;s+=1)l[s]=zo(jo(t,n,s));return{c(){e=_("div");for(let s=0;s<l.length;s+=1)l[s].c();d(e,"id",t[1]),d(e,"class","w-full flex flex-wrap gap-1")},m(s,i){E(s,e,i);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null)},p(s,[i]){if(i&29){n=s[2];let o;for(o=0;o<n.length;o+=1){const a=jo(s,n,o);l[o]?l[o].p(a,i):(l[o]=zo(a),l[o].c(),l[o].m(e,null))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}i&2&&d(e,"id",s[1])},i:j,o:j,d(s){s&&k(e),Ee(l,s)}}}function Ip(t,e,n){let{id:l="multiSelect"}=e,{values:s=[]}=e,{minSelected:i=0}=e,{options:o=[]}=e,{labels:a={}}=e;function u(r){const p=s.findIndex(m=>m===r);p>=0?s.length>i&&s.splice(p,1):s.push(r),n(0,s)}const c=r=>u(r);return t.$$set=r=>{"id"in r&&n(1,l=r.id),"values"in r&&n(0,s=r.values),"minSelected"in r&&n(5,i=r.minSelected),"options"in r&&n(2,o=r.options),"labels"in r&&n(3,a=r.labels)},[s,l,o,a,u,i,c]}class Fr extends Oe{constructor(e){super(),Me(this,e,Ip,Dp,Se,{id:1,values:0,minSelected:5,options:2,labels:3})}}function Yo(t,e,n){const l=t.slice();return l[44]=e[n],l}function Ko(t,e,n){const l=t.slice();return l[36]=e[n],l}function Xo(t,e,n){const l=t.slice();return l[36]=e[n],l}function Jo(t,e,n){const l=t.slice();return l[41]=e[n],l}function Np(t,e,n){const l=t.slice();return l[47]=e[n],l}function Lp(t){let e,n;return{c(){e=_("option"),n=P(t[47]),e.__value=t[47],e.value=e.__value},m(l,s){E(l,e,s),f(e,n)},p:j,d(l){l&&k(e)}}}function Zo(t){let e,n,l,s,i,o,a,u,c,r,p,m,b;const g=[Gp,Hp,Pp],h=[];function y(v,T){return v[1].gearType==="Basic"?0:v[1].gearType==="Weapon"?1:v[1].gearType==="Armor"?2:-1}return~(c=y(t))&&(r=h[c]=g[c](t)),{c(){e=_("div"),n=_("label"),n.textContent="裝備類型",l=w(),s=_("select"),i=_("option"),i.textContent="基礎",o=_("option"),o.textContent="武器",a=_("option"),a.textContent="防具",u=w(),r&&r.c(),d(n,"for","gearType"),d(n,"class","font-bold"),i.__value="Basic",i.value=i.__value,o.__value="Weapon",o.value=o.__value,a.__value="Armor",a.value=a.__value,d(s,"name","gearType"),d(s,"class","border p-1 rounded"),t[1].gearType===void 0&&He(()=>t[14].call(s)),d(e,"class","flex flex-col gap-2 bg-gray-50 p-2 rounded border")},m(v,T){E(v,e,T),f(e,n),f(e,l),f(e,s),f(s,i),f(s,o),f(s,a),ve(s,t[1].gearType,!0),f(e,u),~c&&h[c].m(e,null),p=!0,m||(b=N(s,"change",t[14]),m=!0)},p(v,T){T[0]&2&&ve(s,v[1].gearType);let A=c;c=y(v),c===A?~c&&h[c].p(v,T):(r&&(Ge(),G(h[A],1,1,()=>{h[A]=null}),We()),~c?(r=h[c],r?r.p(v,T):(r=h[c]=g[c](v),r.c()),L(r,1),r.m(e,null)):r=null)},i(v){p||(L(r),p=!0)},o(v){G(r),p=!1},d(v){v&&k(e),~c&&h[c].d(),m=!1,b()}}}function Pp(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T,A,B,O,R,D,M,S,C,$,I,z,q,F,ie;function fe(U){t[27](U)}let me={id:"armorProperties",options:pu,labels:t[6]};t[1].armorProperties!==void 0&&(me.values=t[1].armorProperties),l=new Fr({props:me}),je.push(()=>Ye(l,"values",fe));let ue=Mt,Y=[];for(let U=0;U<ue.length;U+=1)Y[U]=Qo(Yo(t,ue,U));return{c(){e=_("label"),e.textContent="防具特性",n=w(),te(l.$$.fragment),i=w(),o=_("div"),a=_("div"),u=_("label"),u.textContent="基礎 AC",c=w(),r=_("input"),p=w(),m=_("div"),b=_("label"),b.textContent="AC 修正 (+1等)",g=w(),h=_("input"),y=w(),v=_("label"),v.textContent="AC 屬性加成 (通常無或 Dex)",T=w(),A=_("select"),B=_("option"),O=P("無");for(let U=0;U<Y.length;U+=1)Y[U].c();R=w(),D=_("label"),D.textContent="最大敏捷加值 (Max Dex)",M=w(),S=_("select"),C=_("option"),$=P("無限制 (輕甲)"),I=_("option"),I.textContent="+2 (中甲)",z=_("option"),z.textContent="0 (重甲)",d(e,"for","armorProperties"),d(e,"class","font-bold"),d(u,"for","baseAC"),d(r,"id","baseAC"),d(r,"type","number"),d(r,"class","border p-1 rounded"),d(r,"inputmode","numeric"),d(a,"class","flex flex-col w-1/2"),d(b,"for","acModifier"),d(h,"id","acModifier"),d(h,"type","number"),d(h,"class","border p-1 rounded"),d(h,"inputmode","numeric"),d(m,"class","flex flex-col w-1/2"),d(o,"class","flex gap-2"),d(v,"for","armorStat"),B.__value=void 0,B.value=B.__value,d(A,"id","armorStat"),d(A,"class","border p-1 rounded"),t[1].armorStat===void 0&&He(()=>t[30].call(A)),d(D,"for","maxDex"),C.__value=void 0,C.value=C.__value,I.__value=2,I.value=I.__value,z.__value=0,z.value=z.__value,d(S,"id","maxDex"),d(S,"class","border p-1 rounded"),t[1].maxDex===void 0&&He(()=>t[31].call(S))},m(U,Q){E(U,e,Q),E(U,n,Q),ne(l,U,Q),E(U,i,Q),E(U,o,Q),f(o,a),f(a,u),f(a,c),f(a,r),re(r,t[1].baseAC),f(o,p),f(o,m),f(m,b),f(m,g),f(m,h),re(h,t[1].acModifier),E(U,y,Q),E(U,v,Q),E(U,T,Q),E(U,A,Q),f(A,B),f(B,O);for(let ke=0;ke<Y.length;ke+=1)Y[ke]&&Y[ke].m(A,null);ve(A,t[1].armorStat,!0),E(U,R,Q),E(U,D,Q),E(U,M,Q),E(U,S,Q),f(S,C),f(C,$),f(S,I),f(S,z),ve(S,t[1].maxDex,!0),q=!0,F||(ie=[N(r,"input",t[28]),N(h,"input",t[29]),N(A,"change",t[30]),N(S,"change",t[31])],F=!0)},p(U,Q){const ke={};if(!s&&Q[0]&2&&(s=!0,ke.values=U[1].armorProperties,Ke(()=>s=!1)),l.$set(ke),Q[0]&2&&Ie(r.value)!==U[1].baseAC&&re(r,U[1].baseAC),Q[0]&2&&Ie(h.value)!==U[1].acModifier&&re(h,U[1].acModifier),Q&0){ue=Mt;let X;for(X=0;X<ue.length;X+=1){const ge=Yo(U,ue,X);Y[X]?Y[X].p(ge,Q):(Y[X]=Qo(ge),Y[X].c(),Y[X].m(A,null))}for(;X<Y.length;X+=1)Y[X].d(1);Y.length=ue.length}Q[0]&2&&ve(A,U[1].armorStat),Q[0]&2&&ve(S,U[1].maxDex)},i(U){q||(L(l.$$.fragment,U),q=!0)},o(U){G(l.$$.fragment,U),q=!1},d(U){U&&k(e),U&&k(n),le(l,U),U&&k(i),U&&k(o),U&&k(y),U&&k(v),U&&k(T),U&&k(A),Ee(Y,U),U&&k(R),U&&k(D),U&&k(M),U&&k(S),F=!1,Ve(ie)}}}function Hp(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g=t[1].weaponProperties.includes("Magical"),h,y,v,T,A,B,O,R,D,M,S,C,$,I,z,q,F,ie,fe,me,ue,Y,U,Q,ke,X,ge,Te,x,W,ee,ye,be;function de(H){t[18](H)}let pe={id:"weaponProperties",options:hu,labels:t[4]};t[1].weaponProperties!==void 0&&(pe.values=t[1].weaponProperties),p=new Fr({props:pe}),je.push(()=>Ye(p,"values",de));let K=g&&xo(t),oe=$s,Ce=[];for(let H=0;H<oe.length;H+=1)Ce[H]=ea(Jo(t,oe,H));let Le=Ft,se=[];for(let H=0;H<Le.length;H+=1)se[H]=ta(Xo(t,Le,H));let _e=Ft,De=[];for(let H=0;H<_e.length;H+=1)De[H]=na(Ko(t,_e,H));return{c(){e=_("label"),e.textContent="武器類型",n=w(),l=_("select"),s=_("option"),s.textContent="簡易近戰",i=_("option"),i.textContent="簡易遠程",o=_("option"),o.textContent="軍用近戰",a=_("option"),a.textContent="軍用遠程",u=w(),c=_("label"),c.textContent="武器特性",r=w(),te(p.$$.fragment),b=w(),K&&K.c(),h=w(),y=_("label"),y.textContent="距離",v=w(),T=_("select");for(let H=0;H<Ce.length;H+=1)Ce[H].c();A=w(),B=_("label"),B.innerHTML='傷害<span class="text-red-700">*</span>',O=w(),R=_("div"),D=_("input"),M=w(),S=_("div"),C=_("div"),C.textContent="單手:",$=w(),I=_("input"),q=w(),F=_("select");for(let H=0;H<se.length;H+=1)se[H].c();fe=w(),me=_("div"),ue=_("input"),Y=w(),U=_("div"),Q=_("div"),Q.textContent="雙手:",ke=w(),X=_("input"),Te=w(),x=_("select");for(let H=0;H<De.length;H+=1)De[H].c();d(e,"for","weaponType"),d(e,"class","font-bold"),s.__value="Simple Melee",s.value=s.__value,i.__value="Simple Ranged",i.value=i.__value,o.__value="Martial Melee",o.value=o.__value,a.__value="Martial Ranged",a.value=a.__value,d(l,"name","weaponType"),d(l,"id","weaponType"),d(l,"class","border p-1 rounded"),t[1].weaponType===void 0&&He(()=>t[17].call(l)),d(c,"for","weaponProperties"),d(c,"class","font-bold"),d(y,"for","range"),d(y,"class","font-bold"),d(T,"id","range"),d(T,"class","border p-1 rounded"),t[1].weaponRange===void 0&&He(()=>t[20].call(T)),d(B,"for","damage"),d(B,"class","font-bold"),d(D,"type","checkbox"),d(D,"class","svelte-qhgyyp"),d(C,"class","whitespace-nowrap font-bold text-xs"),I.disabled=z=!t[1].hasOneHandedAttack,d(I,"type","number"),d(I,"inputmode","numeric"),d(I,"class","w-10 text-center border-b"),F.disabled=ie=!t[1].hasOneHandedAttack,d(F,"class","border-none bg-transparent"),t[1].oneHandedDiceType===void 0&&He(()=>t[23].call(F)),d(S,"class","flex gap-1 items-center border p-1 rounded bg-white"),V(S,"opacity-50",!t[1].hasOneHandedAttack),d(R,"class","flex gap-1 items-center"),d(ue,"type","checkbox"),d(ue,"class","svelte-qhgyyp"),d(Q,"class","whitespace-nowrap font-bold text-xs"),X.disabled=ge=!t[1].hasTwoHandedAttack,d(X,"type","number"),d(X,"inputmode","numeric"),d(X,"class","w-10 text-center border-b"),x.disabled=W=!t[1].hasTwoHandedAttack,d(x,"class","border-none bg-transparent"),t[1].twoHandedDiceType===void 0&&He(()=>t[26].call(x)),d(U,"class","flex gap-1 items-center border p-1 rounded bg-white"),V(U,"opacity-50",!t[1].hasTwoHandedAttack),d(me,"class","flex gap-1 items-center")},m(H,we){E(H,e,we),E(H,n,we),E(H,l,we),f(l,s),f(l,i),f(l,o),f(l,a),ve(l,t[1].weaponType,!0),E(H,u,we),E(H,c,we),E(H,r,we),ne(p,H,we),E(H,b,we),K&&K.m(H,we),E(H,h,we),E(H,y,we),E(H,v,we),E(H,T,we);for(let Pe=0;Pe<Ce.length;Pe+=1)Ce[Pe]&&Ce[Pe].m(T,null);ve(T,t[1].weaponRange,!0),E(H,A,we),E(H,B,we),E(H,O,we),E(H,R,we),f(R,D),D.checked=t[1].hasOneHandedAttack,f(R,M),f(R,S),f(S,C),f(S,$),f(S,I),re(I,t[1].oneHandedNumDice),f(S,q),f(S,F);for(let Pe=0;Pe<se.length;Pe+=1)se[Pe]&&se[Pe].m(F,null);ve(F,t[1].oneHandedDiceType,!0),E(H,fe,we),E(H,me,we),f(me,ue),ue.checked=t[1].hasTwoHandedAttack,f(me,Y),f(me,U),f(U,Q),f(U,ke),f(U,X),re(X,t[1].twoHandedNumDice),f(U,Te),f(U,x);for(let Pe=0;Pe<De.length;Pe+=1)De[Pe]&&De[Pe].m(x,null);ve(x,t[1].twoHandedDiceType,!0),ee=!0,ye||(be=[N(l,"change",t[17]),N(T,"change",t[20]),N(D,"change",t[21]),N(I,"input",t[22]),N(F,"change",t[23]),N(ue,"change",t[24]),N(X,"input",t[25]),N(x,"change",t[26])],ye=!0)},p(H,we){we[0]&2&&ve(l,H[1].weaponType);const Pe={};if(!m&&we[0]&2&&(m=!0,Pe.values=H[1].weaponProperties,Ke(()=>m=!1)),p.$set(Pe),we[0]&2&&(g=H[1].weaponProperties.includes("Magical")),g?K?K.p(H,we):(K=xo(H),K.c(),K.m(h.parentNode,h)):K&&(K.d(1),K=null),we[0]&32){oe=$s;let Ae;for(Ae=0;Ae<oe.length;Ae+=1){const nt=Jo(H,oe,Ae);Ce[Ae]?Ce[Ae].p(nt,we):(Ce[Ae]=ea(nt),Ce[Ae].c(),Ce[Ae].m(T,null))}for(;Ae<Ce.length;Ae+=1)Ce[Ae].d(1);Ce.length=oe.length}if(we[0]&2&&ve(T,H[1].weaponRange),we[0]&2&&(D.checked=H[1].hasOneHandedAttack),(!ee||we[0]&2&&z!==(z=!H[1].hasOneHandedAttack))&&(I.disabled=z),we[0]&2&&Ie(I.value)!==H[1].oneHandedNumDice&&re(I,H[1].oneHandedNumDice),we&0){Le=Ft;let Ae;for(Ae=0;Ae<Le.length;Ae+=1){const nt=Xo(H,Le,Ae);se[Ae]?se[Ae].p(nt,we):(se[Ae]=ta(nt),se[Ae].c(),se[Ae].m(F,null))}for(;Ae<se.length;Ae+=1)se[Ae].d(1);se.length=Le.length}if((!ee||we[0]&2&&ie!==(ie=!H[1].hasOneHandedAttack))&&(F.disabled=ie),we[0]&2&&ve(F,H[1].oneHandedDiceType),(!ee||we[0]&2)&&V(S,"opacity-50",!H[1].hasOneHandedAttack),we[0]&2&&(ue.checked=H[1].hasTwoHandedAttack),(!ee||we[0]&2&&ge!==(ge=!H[1].hasTwoHandedAttack))&&(X.disabled=ge),we[0]&2&&Ie(X.value)!==H[1].twoHandedNumDice&&re(X,H[1].twoHandedNumDice),we&0){_e=Ft;let Ae;for(Ae=0;Ae<_e.length;Ae+=1){const nt=Ko(H,_e,Ae);De[Ae]?De[Ae].p(nt,we):(De[Ae]=na(nt),De[Ae].c(),De[Ae].m(x,null))}for(;Ae<De.length;Ae+=1)De[Ae].d(1);De.length=_e.length}(!ee||we[0]&2&&W!==(W=!H[1].hasTwoHandedAttack))&&(x.disabled=W),we[0]&2&&ve(x,H[1].twoHandedDiceType),(!ee||we[0]&2)&&V(U,"opacity-50",!H[1].hasTwoHandedAttack)},i(H){ee||(L(p.$$.fragment,H),ee=!0)},o(H){G(p.$$.fragment,H),ee=!1},d(H){H&&k(e),H&&k(n),H&&k(l),H&&k(u),H&&k(c),H&&k(r),le(p,H),H&&k(b),K&&K.d(H),H&&k(h),H&&k(y),H&&k(v),H&&k(T),Ee(Ce,H),H&&k(A),H&&k(B),H&&k(O),H&&k(R),Ee(se,H),H&&k(fe),H&&k(me),Ee(De,H),ye=!1,Ve(be)}}}function Gp(t){let e,n,l,s,i,o,a,u,c=t[1].canBeEquipped&&la(t);return{c(){e=_("div"),n=_("input"),l=w(),s=_("label"),s.textContent="可裝備？",i=w(),c&&c.c(),o=gt(),d(n,"id","canBeEquipped"),d(n,"type","checkbox"),d(n,"class","svelte-qhgyyp"),d(s,"for","canBeEquipped"),d(e,"class","flex gap-1")},m(r,p){E(r,e,p),f(e,n),n.checked=t[1].canBeEquipped,f(e,l),f(e,s),E(r,i,p),c&&c.m(r,p),E(r,o,p),a||(u=N(n,"change",t[15]),a=!0)},p(r,p){p[0]&2&&(n.checked=r[1].canBeEquipped),r[1].canBeEquipped?c?c.p(r,p):(c=la(r),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},i:j,o:j,d(r){r&&k(e),r&&k(i),c&&c.d(r),r&&k(o),a=!1,u()}}}function Qo(t){let e,n=Vt(t[44])+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[44],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function xo(t){let e,n,l,s,i,o;return{c(){e=_("div"),n=_("label"),n.textContent="魔法武器修正: +",l=w(),s=_("input"),d(n,"for","magicWeaponModifier"),d(s,"id","magicWeaponModifier"),d(s,"type","number"),d(s,"min","0"),d(s,"inputmode","numeric"),d(s,"class","w-10 text-center border p-1 rounded"),d(e,"class","flex flex-row gap-1 items-center")},m(a,u){E(a,e,u),f(e,n),f(e,l),f(e,s),re(s,t[1].magicWeaponModifier),i||(o=N(s,"input",t[19]),i=!0)},p(a,u){u[0]&2&&Ie(s.value)!==a[1].magicWeaponModifier&&re(s,a[1].magicWeaponModifier)},d(a){a&&k(e),i=!1,o()}}}function ea(t){let e,n=(t[5][t[41]]??t[41])+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[41],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function ta(t){let e,n=t[36]+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[36],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function na(t){let e,n=t[36]+"",l;return{c(){e=_("option"),l=P(n),e.__value=t[36],e.value=e.__value},m(s,i){E(s,e,i),f(e,l)},p:j,d(s){s&&k(e)}}}function la(t){let e,n,l,s,i,o;return{c(){e=_("div"),n=_("input"),l=w(),s=_("label"),s.innerHTML='裝備時顯示於 <span class="pirata text-lg">攻擊</span> 列表？',d(n,"id","attackable"),d(n,"type","checkbox"),d(n,"class","svelte-qhgyyp"),d(s,"for","attackable"),d(e,"class","flex gap-1 items-center")},m(a,u){E(a,e,u),f(e,n),n.checked=t[1].attackable,f(e,l),f(e,s),i||(o=N(n,"change",t[16]),i=!0)},p(a,u){u[0]&2&&(n.checked=a[1].attackable)},d(a){a&&k(e),i=!1,o()}}}function Wp(t){let e;return{c(){e=P("新增")},m(n,l){E(n,e,l)},d(n){n&&k(e)}}}function Fp(t){let e;return{c(){e=P("更新")},m(n,l){E(n,e,l)},d(n){n&&k(e)}}}function qp(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T,A,B,O,R,D,M,S,C,$,I,z,q,F,ie,fe,me,ue,Y,U,Q=["gp","sp","cp"],ke=[];for(let W=0;W<3;W+=1)ke[W]=Lp(Np(t,Q,W));let X=t[1].showAdvanced&&Zo(t);function ge(W,ee){return W[0]?Fp:Wp}let Te=ge(t),x=Te(t);return{c(){e=_("div"),n=_("div"),l=_("label"),l.innerHTML='名稱<span class="text-red-700">*</span>',s=w(),i=_("input"),o=w(),a=_("div"),u=_("div"),c=_("label"),c.textContent="重量 (lb)",r=w(),p=_("input"),m=w(),b=_("div"),g=_("label"),g.innerHTML='數量<span class="text-red-700">*</span>',h=w(),y=_("input"),v=w(),T=_("div"),A=_("div"),B=_("label"),B.textContent="價格",O=w(),R=_("input"),D=w(),M=_("div"),S=_("select");for(let W=0;W<3;W+=1)ke[W].c();C=w(),$=_("div"),I=_("input"),z=w(),q=_("label"),q.textContent="進階選項",F=w(),X&&X.c(),ie=w(),fe=_("button"),x.c(),d(l,"for","name"),d(l,"class","font-bold"),d(i,"id","name"),d(i,"type","text"),d(i,"class","border p-1 rounded"),d(n,"class","flex flex-col gap-1"),d(c,"for","weight"),d(c,"class","font-bold"),d(p,"id","weight"),d(p,"type","number"),d(p,"class","border p-1 rounded"),d(p,"inputmode","numeric"),d(p,"min","0"),d(p,"step","0.1"),d(u,"class","flex flex-col gap-1 w-1/2"),d(g,"for","quantity"),d(g,"class","font-bold"),d(y,"id","quantity"),d(y,"type","number"),d(y,"class","border p-1 rounded"),d(y,"inputmode","numeric"),d(y,"min","1"),d(b,"class","flex flex-col gap-1 w-1/2"),d(a,"class","flex gap-2"),d(B,"for","cost"),d(B,"class","font-bold"),d(R,"id","cost"),d(R,"type","number"),d(R,"class","border p-1 rounded"),d(R,"inputmode","numeric"),d(R,"min","0"),d(A,"class","flex flex-col gap-1 flex-grow"),d(S,"id","currency"),d(S,"class","border p-1 rounded h-[34px]"),t[1].currency===void 0&&He(()=>t[12].call(S)),d(M,"class","flex flex-col gap-1 w-16"),d(T,"class","flex gap-2 items-end"),d(I,"id","showAdvanced"),d(I,"type","checkbox"),d(I,"class","svelte-qhgyyp"),d(q,"for","showAdvanced"),d(q,"class","font-bold cursor-pointer"),d($,"class","flex gap-2 items-center mt-2 border-t pt-2"),d(fe,"class","mt-4 px-3 hover:bg-gray-700 bg-black text-white p-2 rounded shadow font-bold"),fe.disabled=me=!t[2],V(fe,"opacity-50",!t[2]),d(e,"class","flex flex-col gap-2 p-2 max-h-[80vh] overflow-y-auto")},m(W,ee){E(W,e,ee),f(e,n),f(n,l),f(n,s),f(n,i),re(i,t[1].name),f(e,o),f(e,a),f(a,u),f(u,c),f(u,r),f(u,p),re(p,t[1].weight),f(a,m),f(a,b),f(b,g),f(b,h),f(b,y),re(y,t[1].quantity),f(e,v),f(e,T),f(T,A),f(A,B),f(A,O),f(A,R),re(R,t[1].cost),f(T,D),f(T,M),f(M,S);for(let ye=0;ye<3;ye+=1)ke[ye]&&ke[ye].m(S,null);ve(S,t[1].currency,!0),f(e,C),f(e,$),f($,I),I.checked=t[1].showAdvanced,f($,z),f($,q),f(e,F),X&&X.m(e,null),f(e,ie),f(e,fe),x.m(fe,null),ue=!0,Y||(U=[N(i,"input",t[8]),N(p,"input",t[9]),N(y,"input",t[10]),N(R,"input",t[11]),N(S,"change",t[12]),N(I,"change",t[13]),N(fe,"click",t[3])],Y=!0)},p(W,ee){ee[0]&2&&i.value!==W[1].name&&re(i,W[1].name),ee[0]&2&&Ie(p.value)!==W[1].weight&&re(p,W[1].weight),ee[0]&2&&Ie(y.value)!==W[1].quantity&&re(y,W[1].quantity),ee[0]&2&&Ie(R.value)!==W[1].cost&&re(R,W[1].cost),ee[0]&2&&ve(S,W[1].currency),ee[0]&2&&(I.checked=W[1].showAdvanced),W[1].showAdvanced?X?(X.p(W,ee),ee[0]&2&&L(X,1)):(X=Zo(W),X.c(),L(X,1),X.m(e,ie)):X&&(Ge(),G(X,1,1,()=>{X=null}),We()),Te!==(Te=ge(W))&&(x.d(1),x=Te(W),x&&(x.c(),x.m(fe,null))),(!ue||ee[0]&4&&me!==(me=!W[2]))&&(fe.disabled=me),(!ue||ee[0]&4)&&V(fe,"opacity-50",!W[2])},i(W){ue||(L(X),ue=!0)},o(W){G(X),ue=!1},d(W){W&&k(e),Ee(ke,W),X&&X.d(),x.d(),Y=!1,Ve(U)}}}function Up(t){var n;if(!t)return 0;let e=(n=t==null?void 0:t.playerBonuses)==null?void 0:n.find(l=>l.type==="modifyAmt"&&l.bonusTo==="attackRoll");return(e==null?void 0:e.bonusAmount)??0}function Vp(t){return t&&t.range||"5 ft"}function jp(t,e,n){var ke,X,ge,Te,x,W,ee,ye,be,de,pe,K,oe,Ce,Le,se;let l,s,i;Re(t,ae,_e=>n(33,i=_e));const o=kn();let{gear:a=void 0}=e;const u=i.gear.find(_e=>_e.name===(a==null?void 0:a.name)),c={name:(a==null?void 0:a.name)??void 0,weight:(a==null?void 0:a.weight)??0,cost:((ke=a==null?void 0:a.cost)==null?void 0:ke.gp)??0,currency:"gp",quantity:(u==null?void 0:u.quantity)??1,showAdvanced:(a==null?void 0:a.type)!==void 0&&(a==null?void 0:a.type)!=="Basic",gearType:(a==null?void 0:a.type)??"Basic",canBeEquipped:(a==null?void 0:a.canBeEquipped)??!1,attackable:((X=a==null?void 0:a.properties)==null?void 0:X.includes("Attackable"))??!1,weaponProperties:(a==null?void 0:a.properties)??[],magicWeaponModifier:Up(a),weaponType:(a==null?void 0:a.weaponType)??"Simple Melee",weaponRange:Vp(a),hasOneHandedAttack:a?!!((ge=a==null?void 0:a.damage)!=null&&ge.oneHanded):!0,oneHandedNumDice:((x=(Te=a==null?void 0:a.damage)==null?void 0:Te.oneHanded)==null?void 0:x.numDice)??1,oneHandedDiceType:((ee=(W=a==null?void 0:a.damage)==null?void 0:W.oneHanded)==null?void 0:ee.diceType)??"d6",hasTwoHandedAttack:!!((ye=a==null?void 0:a.damage)!=null&&ye.twoHanded),twoHandedNumDice:((de=(be=a==null?void 0:a.damage)==null?void 0:be.twoHanded)==null?void 0:de.numDice)??1,twoHandedDiceType:((K=(pe=a==null?void 0:a.damage)==null?void 0:pe.twoHanded)==null?void 0:K.diceType)??"d8",baseAC:((oe=a==null?void 0:a.ac)==null?void 0:oe.base)??10,armorProperties:(a==null?void 0:a.properties)??[],acModifier:((Ce=a==null?void 0:a.ac)==null?void 0:Ce.modifier)??0,armorStat:(Le=a==null?void 0:a.ac)==null?void 0:Le.stat,maxDex:(se=a==null?void 0:a.ac)==null?void 0:se.maxDex};let r=JSON.parse(JSON.stringify(c));function p(){var De;let _e={name:r.name,type:r.gearType,canBeEquipped:r.canBeEquipped,desc:r.name,weight:r.weight,editable:!0,playerBonuses:[],cost:{gp:0,sp:0,cp:0,ep:0,pp:0,[r.currency]:r.cost}};switch(r.gearType){case"Basic":{r.canBeEquipped&&r.attackable&&(_e.properties=["Attackable"]);break}case"Weapon":{let H=_e;H.properties=r.weaponProperties,H.weaponType=r.weaponType,H.range=r.weaponRange,H.canBeEquipped=!0,H.damage={},r.hasOneHandedAttack&&(H.damage.oneHanded={numDice:r.oneHandedNumDice,diceType:r.oneHandedDiceType}),r.hasTwoHandedAttack&&(H.damage.twoHanded={numDice:r.twoHandedNumDice,diceType:r.twoHandedDiceType}),r.weaponProperties.includes("Magical")&&r.magicWeaponModifier>0&&(H.playerBonuses.push({name:H.name+`: +${r.magicWeaponModifier} to atk`,desc:`+${r.magicWeaponModifier} to attack rolls when ${H.name} is equipped`,type:"modifyAmt",bonusAmount:r.magicWeaponModifier,bonusTo:"attackRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:H.name}}),H.playerBonuses.push({name:H.name+`: +${r.magicWeaponModifier} to dmg`,desc:`+${r.magicWeaponModifier} to damage rolls when ${H.name} is equipped`,type:"modifyAmt",bonusAmount:r.magicWeaponModifier,bonusTo:"damageRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:H.name}}));break}case"Armor":{let H=_e;H.properties=r.armorProperties,H.canBeEquipped=!0,H.ac={base:r.baseAC,modifier:r.acModifier,stat:r.armorStat,maxDex:r.maxDex};break}}if(a){for(let H in a)a.hasOwnProperty(H)&&delete a[H];_e.type!=="Basic"&&(_e.properties=(De=_e.properties)==null?void 0:De.filter(H=>H!=="Attackable")),Object.assign(a,_e),u&&(u.name=_e.name,u.quantity=r.quantity)}else i.customGear.push(_e),i.gear.push({name:_e.name,quantity:r.quantity});ae.set(i),o("finish")}const m={Ammunition:"彈藥",Finesse:"靈巧",Heavy:"重型",Light:"輕型",Loading:"裝填",Range:"射程",Reach:"長觸",Special:"特殊",Thrown:"投擲","Two-Handed":"雙手",Versatile:"靈活",Silvered:"鍍銀",Magical:"魔法"},b={"5 ft":"5 尺","10 ft":"10 尺","30 ft":"30 尺","60 ft":"60 尺","120 ft":"120 尺",Touch:"觸碰",Sight:"視線",Self:"自身"},g={Shield:"盾牌","+1":"+1","+2":"+2","+3":"+3",Magic:"魔法"};function h(){r.name=this.value,n(1,r)}function y(){r.weight=Ie(this.value),n(1,r)}function v(){r.quantity=Ie(this.value),n(1,r)}function T(){r.cost=Ie(this.value),n(1,r)}function A(){r.currency=Fe(this),n(1,r)}function B(){r.showAdvanced=this.checked,n(1,r)}function O(){r.gearType=Fe(this),n(1,r)}function R(){r.canBeEquipped=this.checked,n(1,r)}function D(){r.attackable=this.checked,n(1,r)}function M(){r.weaponType=Fe(this),n(1,r)}function S(_e){t.$$.not_equal(r.weaponProperties,_e)&&(r.weaponProperties=_e,n(1,r))}function C(){r.magicWeaponModifier=Ie(this.value),n(1,r)}function $(){r.weaponRange=Fe(this),n(1,r)}function I(){r.hasOneHandedAttack=this.checked,n(1,r)}function z(){r.oneHandedNumDice=Ie(this.value),n(1,r)}function q(){r.oneHandedDiceType=Fe(this),n(1,r)}function F(){r.hasTwoHandedAttack=this.checked,n(1,r)}function ie(){r.twoHandedNumDice=Ie(this.value),n(1,r)}function fe(){r.twoHandedDiceType=Fe(this),n(1,r)}function me(_e){t.$$.not_equal(r.armorProperties,_e)&&(r.armorProperties=_e,n(1,r))}function ue(){r.baseAC=Ie(this.value),n(1,r)}function Y(){r.acModifier=Ie(this.value),n(1,r)}function U(){r.armorStat=Fe(this),n(1,r)}function Q(){r.maxDex=Fe(this),n(1,r)}return t.$$set=_e=>{"gear"in _e&&n(0,a=_e.gear)},t.$$.update=()=>{var _e;if(t.$$.dirty[0]&2&&(r.showAdvanced||(n(1,r.gearType="Basic",r),n(1,r.canBeEquipped=!1,r),n(1,r.attackable=!1,r))),t.$$.dirty[0]&2&&n(7,l=r.gearType!=="Weapon"||r.hasOneHandedAttack||r.hasTwoHandedAttack),t.$$.dirty[0]&130&&n(2,s=((_e=r.name)==null?void 0:_e.length)>0&&r.quantity>0&&l),t.$$.dirty[0]&2)if(r.hasOneHandedAttack&&r.hasTwoHandedAttack)r.weaponProperties.includes("Versatile")||r.weaponProperties.push("Versatile");else{const De=r.weaponProperties.findIndex(H=>H==="Versatile");De>=0&&r.weaponProperties.splice(De,1)}},[a,r,s,p,m,b,g,l,h,y,v,T,A,B,O,R,D,M,S,C,$,I,z,q,F,ie,fe,me,ue,Y,U,Q]}class qr extends Oe{constructor(e){super(),Me(this,e,jp,qp,Se,{gear:0},null,[-1,-1])}}function sa(t){let e,n,l;function s(o){t[4](o)}let i={vw:50,$$slots:{header:[Yp],default:[zp]},$$scope:{ctx:t}};return t[1]!==void 0&&(i.showModal=t[1]),e=new ft({props:i}),je.push(()=>Ye(e,"showModal",s)),{c(){te(e.$$.fragment)},m(o,a){ne(e,o,a),l=!0},p(o,a){const u={};a&33&&(u.$$scope={dirty:a,ctx:o}),!n&&a&2&&(n=!0,u.showModal=o[1],Ke(()=>n=!1)),e.$set(u)},i(o){l||(L(e.$$.fragment,o),l=!0)},o(o){G(e.$$.fragment,o),l=!1},d(o){le(e,o)}}}function zp(t){let e,n;return e=new qr({}),e.$on("finish",t[3]),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},p:j,i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function Yp(t){let e;return{c(){e=_("h1"),e.textContent="Custom Gear",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Kp(t){let e,n,l,s,i,o,a=t[0]&&sa(t);return{c(){e=_("button"),e.textContent="Custom Gear",n=w(),a&&a.c(),l=gt(),d(e,"class","bg-black text-white px-2")},m(u,c){E(u,e,c),E(u,n,c),a&&a.m(u,c),E(u,l,c),s=!0,i||(o=N(e,"click",t[2]),i=!0)},p(u,[c]){u[0]?a?(a.p(u,c),c&1&&L(a,1)):(a=sa(u),a.c(),L(a,1),a.m(l.parentNode,l)):a&&(Ge(),G(a,1,1,()=>{a=null}),We())},i(u){s||(L(a),s=!0)},o(u){G(a),s=!1},d(u){u&&k(e),u&&k(n),a&&a.d(u),u&&k(l),i=!1,o()}}}function Xp(t,e,n){let l=!1,s=!1;const i=()=>{n(0,l=!0),n(1,s=!0)},o=()=>{n(0,l=!1)};function a(u){s=u,n(1,s)}return[l,s,i,o,a]}class Jp extends Oe{constructor(e){super(),Me(this,e,Xp,Kp,Se,{})}}function ia(t,e,n){const l=t.slice();return l[23]=e[n],l[25]=n,l}function oa(t){let e,n=t[23].desc+"",l;return{c(){e=_("div"),l=P(n),d(e,"class","text-gray-500 truncate max-w-[120px]")},m(s,i){E(s,e,i),f(e,l)},p(s,i){i&256&&n!==(n=s[23].desc+"")&&Z(l,n)},d(s){s&&k(e)}}}function aa(t){let e,n,l,s,i;function o(){return t[18](t[23])}function a(){return t[19](t[23])}return{c(){e=_("button"),e.innerHTML='<i class="material-icons text-sm">delete</i>',n=w(),l=_("button"),l.innerHTML='<i class="material-icons text-sm">edit</i>',d(e,"class","bg-gray-800 rounded text-white px-1 py-0.5"),d(e,"title","刪除"),d(l,"class","bg-gray-800 rounded text-white px-1 py-0.5"),d(l,"title","編輯")},m(u,c){E(u,e,c),E(u,n,c),E(u,l,c),s||(i=[N(e,"click",o),N(l,"click",a)],s=!0)},p(u,c){t=u},d(u){u&&k(e),u&&k(n),u&&k(l),s=!1,Ve(i)}}}function ra(t){var C;let e,n,l,s=(((C=t[23].l10n)==null?void 0:C.name)??t[23].name)+"",i,o,a,u,c=ca(t[23])+"",r,p,m,b=(t[23].weight??0)+"",g,h,y,v,T,A,B,O,R,D=t[23].desc&&oa(t),M=t[23].editable&&aa(t);function S(){return t[20](t[23])}return{c(){e=_("tr"),n=_("td"),l=_("div"),i=P(s),o=w(),D&&D.c(),a=w(),u=_("td"),r=P(c),p=w(),m=_("td"),g=P(b),h=P(" lb"),y=w(),v=_("td"),M&&M.c(),T=w(),A=_("button"),A.innerHTML='<i class="material-icons">add_circle</i>',B=w(),d(l,"class","font-bold"),d(n,"class","pl-2 py-2"),d(u,"class","whitespace-nowrap"),d(A,"class","text-green-700 hover:text-green-900"),d(A,"title","購買/加入"),d(v,"class","flex justify-end gap-1 pr-2 py-2 items-center"),d(e,"class","border-b hover:bg-gray-50 text-xs"),V(e,"bg-gray-50",t[25]%2==0)},m($,I){E($,e,I),f(e,n),f(n,l),f(l,i),f(n,o),D&&D.m(n,null),f(e,a),f(e,u),f(u,r),f(e,p),f(e,m),f(m,g),f(m,h),f(e,y),f(e,v),M&&M.m(v,null),f(v,T),f(v,A),f(e,B),O||(R=N(A,"click",S),O=!0)},p($,I){var z;t=$,I&256&&s!==(s=(((z=t[23].l10n)==null?void 0:z.name)??t[23].name)+"")&&Z(i,s),t[23].desc?D?D.p(t,I):(D=oa(t),D.c(),D.m(n,null)):D&&(D.d(1),D=null),I&256&&c!==(c=ca(t[23])+"")&&Z(r,c),I&256&&b!==(b=(t[23].weight??0)+"")&&Z(g,b),t[23].editable?M?M.p(t,I):(M=aa(t),M.c(),M.m(v,T)):M&&(M.d(1),M=null)},d($){$&&k(e),D&&D.d(),M&&M.d(),O=!1,R()}}}function ua(t){let e,n,l;function s(o){t[22](o)}let i={$$slots:{header:[Qp],default:[Zp]},$$scope:{ctx:t}};return t[7]!==void 0&&(i.showModal=t[7]),e=new ft({props:i}),je.push(()=>Ye(e,"showModal",s)),{c(){te(e.$$.fragment)},m(o,a){ne(e,o,a),l=!0},p(o,a){const u={};a&67109056&&(u.$$scope={dirty:a,ctx:o}),!n&&a&128&&(n=!0,u.showModal=o[7],Ke(()=>n=!1)),e.$set(u)},i(o){l||(L(e.$$.fragment,o),l=!0)},o(o){G(e.$$.fragment,o),l=!1},d(o){le(e,o)}}}function Zp(t){let e,n;return e=new qr({props:{gear:t[6]}}),e.$on("finish",t[21]),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},p(l,s){const i={};s&64&&(i.gear=l[6]),e.$set(i)},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function Qp(t){let e;return{c(){e=_("h2"),e.textContent="自訂裝備",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function xp(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T,A,B,O,R,D,M,S,C,$,I,z,q,F,ie,fe,me,ue,Y,U,Q;function ke(W){t[12](W)}let X={placeholder:"搜尋 例如: 長劍",class:"w-full"};t[5]!==void 0&&(X.value=t[5]),l=new Gr({props:X}),je.push(()=>Ye(l,"value",ke));let ge=t[8],Te=[];for(let W=0;W<ge.length;W+=1)Te[W]=ra(ia(t,ge,W));let x=t[7]&&t[6]&&ua(t);return{c(){e=_("div"),n=_("div"),te(l.$$.fragment),i=w(),o=_("div"),a=_("div"),a.textContent="過濾:",u=w(),c=_("label"),r=_("input"),p=P(" 武器"),m=w(),b=_("label"),g=_("input"),h=P(" 防具"),y=w(),v=_("label"),T=_("input"),A=P(" 基礎"),B=w(),O=_("label"),R=_("input"),D=P(" 自訂"),M=w(),S=_("label"),C=_("input"),$=P(" 買得起"),I=w(),z=_("div"),q=_("table"),F=_("thead"),F.innerHTML=`<tr><th class="pl-2 py-1">名稱</th> 
          <th class="py-1">價格</th> 
          <th class="py-1">重量</th> 
          <th class="pr-2 py-1"></th></tr>`,ie=w(),fe=_("tbody");for(let W=0;W<Te.length;W+=1)Te[W].c();me=w(),x&&x.c(),ue=gt(),d(a,"class","font-bold"),d(r,"type","checkbox"),d(c,"class","flex gap-1 items-center"),d(g,"type","checkbox"),d(b,"class","flex gap-1 items-center"),d(T,"type","checkbox"),d(v,"class","flex gap-1 items-center"),d(R,"type","checkbox"),d(O,"class","flex gap-1 items-center"),d(C,"type","checkbox"),d(S,"class","flex gap-1 items-center border-l pl-1 ml-1 border-gray-400"),d(o,"class","flex gap-1 items-center flex-wrap text-sm mt-1"),d(n,"class","p-2 border-b"),d(F,"class","text-left sticky top-0 bg-white shadow-sm z-10"),d(q,"class","w-full text-sm"),d(z,"class","overflow-auto flex-1"),d(e,"class","border-b flex flex-col gap-1 h-full overflow-hidden")},m(W,ee){E(W,e,ee),f(e,n),ne(l,n,null),f(n,i),f(n,o),f(o,a),f(o,u),f(o,c),f(c,r),r.checked=t[1],f(c,p),f(o,m),f(o,b),f(b,g),g.checked=t[2],f(b,h),f(o,y),f(o,v),f(v,T),T.checked=t[3],f(v,A),f(o,B),f(o,O),f(O,R),R.checked=t[4],f(O,D),f(o,M),f(o,S),f(S,C),C.checked=t[0],f(S,$),f(e,I),f(e,z),f(z,q),f(q,F),f(q,ie),f(q,fe);for(let ye=0;ye<Te.length;ye+=1)Te[ye]&&Te[ye].m(fe,null);E(W,me,ee),x&&x.m(W,ee),E(W,ue,ee),Y=!0,U||(Q=[N(r,"change",t[13]),N(g,"change",t[14]),N(T,"change",t[15]),N(R,"change",t[16]),N(C,"change",t[17])],U=!0)},p(W,[ee]){const ye={};if(!s&&ee&32&&(s=!0,ye.value=W[5],Ke(()=>s=!1)),l.$set(ye),ee&2&&(r.checked=W[1]),ee&4&&(g.checked=W[2]),ee&8&&(T.checked=W[3]),ee&16&&(R.checked=W[4]),ee&1&&(C.checked=W[0]),ee&1984){ge=W[8];let be;for(be=0;be<ge.length;be+=1){const de=ia(W,ge,be);Te[be]?Te[be].p(de,ee):(Te[be]=ra(de),Te[be].c(),Te[be].m(fe,null))}for(;be<Te.length;be+=1)Te[be].d(1);Te.length=ge.length}W[7]&&W[6]?x?(x.p(W,ee),ee&192&&L(x,1)):(x=ua(W),x.c(),L(x,1),x.m(ue.parentNode,ue)):x&&(Ge(),G(x,1,1,()=>{x=null}),We())},i(W){Y||(L(l.$$.fragment,W),L(x),Y=!0)},o(W){G(l.$$.fragment,W),G(x),Y=!1},d(W){W&&k(e),le(l),Ee(Te,W),W&&k(me),x&&x.d(W),W&&k(ue),U=!1,Ve(Q)}}}function ca(t){const{gp:e,sp:n,cp:l}=t.cost;let s=[];return e&&s.push(`${e}gp`),n&&s.push(`${n}sp`),l&&s.push(`${l}cp`),s.length>0?s.join(" "):"0cp"}function e_(t,e,n){let l,s;Re(t,ae,C=>n(11,s=C));let i,o=!1,a=!1,u=!0,c=!0,r=!0,p=!1,m="";function b(C){const $=s.gear.find(I=>I.name===C.name);if($)$.quantity++;else{const I={name:C.name,quantity:1};s.gear.push(I)}ae.set(s)}function g(C){$e(ae,s.gear=s.gear.filter($=>$.name!==C.name),s),$e(ae,s.bonuses=s.bonuses.filter($=>{var I,z;return!(((I=$.metadata)==null?void 0:I.type)==="weapon"&&$.metadata.weapon===C.name||((z=$.metadata)==null?void 0:z.type)==="armor"&&$.metadata.armor===C.name)}),s),$e(ae,s.customGear=s.customGear.filter($=>$.name!==C.name),s)}function h(C){m=C,n(5,m)}function y(){u=this.checked,n(1,u)}function v(){c=this.checked,n(2,c)}function T(){r=this.checked,n(3,r)}function A(){p=this.checked,n(4,p)}function B(){a=this.checked,n(0,a)}const O=C=>g(C),R=C=>{n(6,i=C),n(7,o=!0)},D=C=>b(C),M=()=>{n(7,o=!1),n(6,i=void 0)};function S(C){o=C,n(7,o)}return t.$$.update=()=>{t.$$.dirty&2111&&n(8,l=Object.values(jl).concat(Object.values(Vl)).concat(Object.values(Yl)).concat(s.customGear??[]).filter(C=>p&&!s.customGear.find($=>$.name===C.name)||!u&&C.type==="Weapon"||!c&&C.type==="Armor"||!r&&C.type==="Basic"||a&&!Fu(s,C)?!1:C.name.toLowerCase().includes(m.toLowerCase())))},[a,u,c,r,p,m,i,o,l,b,g,s,h,y,v,T,A,B,O,R,D,M,S]}class t_ extends Oe{constructor(e){super(),Me(this,e,e_,xp,Se,{})}}function n_(t){let e,n;return e=new t_({}),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function l_(t){let e;return{c(){e=_("h1"),e.textContent="裝備",d(e,"slot","header"),d(e,"class","min-w-[300px]")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function s_(t){let e,n,l,s,i,o,a;function u(r){t[2](r)}let c={vh:90,$$slots:{header:[l_],default:[n_]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),je.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.textContent="裝備",n=w(),te(l.$$.fragment),d(e,"class","bg-black text-white px-3 rounded-md")},m(r,p){E(r,e,p),E(r,n,p),ne(l,r,p),i=!0,o||(a=N(e,"click",t[1]),o=!0)},p(r,[p]){const m={};p&8&&(m.$$scope={dirty:p,ctx:r}),!s&&p&1&&(s=!0,m.showModal=r[0],Ke(()=>s=!1)),l.$set(m)},i(r){i||(L(l.$$.fragment,r),i=!0)},o(r){G(l.$$.fragment,r),i=!1},d(r){r&&k(e),r&&k(n),le(l,r),o=!1,a()}}}function i_(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function i(o){l=o,n(0,l)}return[l,s,i]}class o_ extends Oe{constructor(e){super(),Me(this,e,i_,s_,Se,{})}}function fa(t){const e=Qe(t.name);return e?(e.weight||0)*t.quantity:(console.log("Cannot find gear: "+t.name),0)}function da(t,e,n){const l=t.slice();return l[16]=e[n],l[18]=n,l}function pa(t){let e;return{c(){e=P("(超重)")},m(n,l){E(n,e,l)},d(n){n&&k(e)}}}function _a(t){let e,n=t[16].quantity+"",l;return{c(){e=P("x "),l=P(n)},m(s,i){E(s,e,i),E(s,l,i)},p(s,i){i&16&&n!==(n=s[16].quantity+"")&&Z(l,n)},d(s){s&&k(e),s&&k(l)}}}function ma(t){var s;let e,n=((s=Qe(t[16].name))==null?void 0:s.desc)+"",l;return{c(){e=_("div"),l=P(n),d(e,"class","text-xs text-gray-600 truncate max-w-[200px]")},m(i,o){E(i,e,o),f(e,l)},p(i,o){var a;o&16&&n!==(n=((a=Qe(i[16].name))==null?void 0:a.desc)+"")&&Z(l,n)},d(i){i&&k(e)}}}function ha(t){let e,n,l,s,i,o,a;function u(){return t[13](t[16])}return{c(){e=_("label"),n=_("input"),s=w(),i=_("span"),i.textContent="裝備",d(n,"title","Equipped"),d(n,"type","checkbox"),d(n,"class","w-5 h-5"),n.checked=l=t[16].equipped,d(i,"class","text-[10px]"),d(e,"class","flex flex-col items-center")},m(c,r){E(c,e,r),f(e,n),f(e,s),f(e,i),o||(a=N(n,"click",u),o=!0)},p(c,r){t=c,r&16&&l!==(l=t[16].equipped)&&(n.checked=l)},d(c){c&&k(e),o=!1,a()}}}function ga(t){let e,n,l,s,i,o,a;function u(){return t[14](t[16])}return{c(){e=_("label"),n=_("input"),s=w(),i=_("span"),i.textContent="同調",d(n,"title","Attuned"),d(n,"type","checkbox"),d(n,"class","w-5 h-5 accent-purple-600"),n.checked=l=t[16].attuned,d(i,"class","text-[10px]"),d(e,"class","flex flex-col items-center text-purple-700")},m(c,r){E(c,e,r),f(e,n),f(e,s),f(e,i),o||(a=N(n,"click",u),o=!0)},p(c,r){t=c,r&16&&l!==(l=t[16].attuned)&&(n.checked=l)},d(c){c&&k(e),o=!1,a()}}}function ba(t){var F,ie,fe,me,ue,Y;let e,n,l,s,i,o=(((ie=(F=Qe(t[16].name))==null?void 0:F.l10n)==null?void 0:ie.name)??t[16].name)+"",a,u,c,r,p=fa(t[16])+"",m,b,g,h=(fe=Qe(t[16].name))==null?void 0:fe.desc,y,v,T=(me=Qe(t[16].name))==null?void 0:me.canBeEquipped,A,B=(Y=(ue=Qe(t[16].name))==null?void 0:ue.properties)==null?void 0:Y.includes("Attunement"),O,R,D,M,S,C=t[16].quantity>1&&_a(t),$=h&&ma(t),I=T&&ha(t),z=B&&ga(t);function q(){return t[15](t[16])}return{c(){e=_("li"),n=_("div"),l=_("div"),s=_("div"),i=_("span"),a=P(o),u=w(),C&&C.c(),c=w(),r=_("span"),m=P(p),b=P(" lb"),g=w(),$&&$.c(),y=w(),v=_("div"),I&&I.c(),A=w(),z&&z.c(),O=w(),R=_("button"),R.innerHTML='<i class="material-icons text-sm">delete</i>',D=w(),d(i,"class","font-bold"),d(r,"class","text-xs text-gray-500"),d(s,"class","flex justify-between items-center w-full"),d(l,"class","flex flex-col w-full"),d(R,"class","p-1 rounded bg-black text-white hover:bg-gray-700"),d(R,"title","Delete"),d(v,"class","flex gap-2 items-center flex-shrink-0"),d(n,"class","flex gap-1 items-center justify-between"),d(e,"class","border-b border-gray-300 pb-1")},m(U,Q){E(U,e,Q),f(e,n),f(n,l),f(l,s),f(s,i),f(i,a),f(i,u),C&&C.m(i,null),f(s,c),f(s,r),f(r,m),f(r,b),f(l,g),$&&$.m(l,null),f(n,y),f(n,v),I&&I.m(v,null),f(v,A),z&&z.m(v,null),f(v,O),f(v,R),f(e,D),M||(S=N(R,"click",q),M=!0)},p(U,Q){var ke,X,ge,Te,x,W;t=U,Q&16&&o!==(o=(((X=(ke=Qe(t[16].name))==null?void 0:ke.l10n)==null?void 0:X.name)??t[16].name)+"")&&Z(a,o),t[16].quantity>1?C?C.p(t,Q):(C=_a(t),C.c(),C.m(i,null)):C&&(C.d(1),C=null),Q&16&&p!==(p=fa(t[16])+"")&&Z(m,p),Q&16&&(h=(ge=Qe(t[16].name))==null?void 0:ge.desc),h?$?$.p(t,Q):($=ma(t),$.c(),$.m(l,null)):$&&($.d(1),$=null),Q&16&&(T=(Te=Qe(t[16].name))==null?void 0:Te.canBeEquipped),T?I?I.p(t,Q):(I=ha(t),I.c(),I.m(v,A)):I&&(I.d(1),I=null),Q&16&&(B=(W=(x=Qe(t[16].name))==null?void 0:x.properties)==null?void 0:W.includes("Attunement")),B?z?z.p(t,Q):(z=ga(t),z.c(),z.m(v,O)):z&&(z.d(1),z=null)},d(U){U&&k(e),C&&C.d(),$&&$.d(),I&&I.d(),z&&z.d(),M=!1,S()}}}function a_(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T,A,B,O,R,D,M,S,C,$,I,z,q,F,ie,fe,me,ue,Y,U,Q,ke,X,ge,Te,x,W,ee,ye,be=t[3]&&pa();m=new o_({}),g=new Jp({});let de=t[4],pe=[];for(let K=0;K<de.length;K+=1)pe[K]=ba(da(t,de,K));return{c(){e=_("div"),n=_("div"),l=_("h2"),l.textContent="裝備",s=w(),i=_("span"),o=P(t[1]),a=P(" / "),u=P(t[0]),c=P(` lb
      `),be&&be.c(),r=w(),p=_("div"),te(m.$$.fragment),b=w(),te(g.$$.fragment),h=w(),y=_("div"),v=_("div"),T=_("label"),T.textContent="PP",A=w(),B=_("input"),O=w(),R=_("div"),D=_("label"),D.textContent="GP",M=w(),S=_("input"),C=w(),$=_("div"),I=_("label"),I.textContent="EP",z=w(),q=_("input"),F=w(),ie=_("div"),fe=_("label"),fe.textContent="SP",me=w(),ue=_("input"),Y=w(),U=_("div"),Q=_("label"),Q.textContent="CP",ke=w(),X=_("input"),ge=w(),Te=_("div"),x=_("ul");for(let K=0;K<pe.length;K+=1)pe[K].c();V(i,"text-red-600",t[3]),d(n,"class","flex gap-2 items-center"),d(p,"class","flex gap-1"),d(e,"class","flex gap-1 p-1 items-center justify-between"),d(T,"for","pp"),d(B,"type","number"),d(B,"id","pp"),d(B,"class","w-12 border rounded px-1"),d(v,"class","flex items-center gap-1"),d(D,"for","gp"),d(S,"type","number"),d(S,"id","gp"),d(S,"class","w-12 border rounded px-1"),d(R,"class","flex items-center gap-1"),d(I,"for","ep"),d(q,"type","number"),d(q,"id","ep"),d(q,"class","w-12 border rounded px-1"),d($,"class","flex items-center gap-1"),d(fe,"for","sp"),d(ue,"type","number"),d(ue,"id","sp"),d(ue,"class","w-12 border rounded px-1"),d(ie,"class","flex items-center gap-1"),d(Q,"for","cp"),d(X,"type","number"),d(X,"id","cp"),d(X,"class","w-12 border rounded px-1"),d(U,"class","flex items-center gap-1"),d(y,"class","flex gap-2 p-1 border-b border-gray-300 pb-2 mb-2 flex-wrap text-sm"),d(x,"class","flex flex-col gap-1"),d(Te,"class","overflow-scroll flex flex-col gap-1 p-2 h-full"),Wt(Te,"box-shadow","inset 0 0 5px #000")},m(K,oe){E(K,e,oe),f(e,n),f(n,l),f(n,s),f(n,i),f(i,o),f(i,a),f(i,u),f(i,c),be&&be.m(i,null),f(e,r),f(e,p),ne(m,p,null),f(p,b),ne(g,p,null),E(K,h,oe),E(K,y,oe),f(y,v),f(v,T),f(v,A),f(v,B),re(B,t[2].currency.pp),f(y,O),f(y,R),f(R,D),f(R,M),f(R,S),re(S,t[2].currency.gp),f(y,C),f(y,$),f($,I),f($,z),f($,q),re(q,t[2].currency.ep),f(y,F),f(y,ie),f(ie,fe),f(ie,me),f(ie,ue),re(ue,t[2].currency.sp),f(y,Y),f(y,U),f(U,Q),f(U,ke),f(U,X),re(X,t[2].currency.cp),E(K,ge,oe),E(K,Te,oe),f(Te,x);for(let Ce=0;Ce<pe.length;Ce+=1)pe[Ce]&&pe[Ce].m(x,null);W=!0,ee||(ye=[N(B,"input",t[8]),N(S,"input",t[9]),N(q,"input",t[10]),N(ue,"input",t[11]),N(X,"input",t[12])],ee=!0)},p(K,[oe]){if((!W||oe&2)&&Z(o,K[1]),(!W||oe&1)&&Z(u,K[0]),K[3]?be||(be=pa(),be.c(),be.m(i,null)):be&&(be.d(1),be=null),(!W||oe&8)&&V(i,"text-red-600",K[3]),oe&4&&Ie(B.value)!==K[2].currency.pp&&re(B,K[2].currency.pp),oe&4&&Ie(S.value)!==K[2].currency.gp&&re(S,K[2].currency.gp),oe&4&&Ie(q.value)!==K[2].currency.ep&&re(q,K[2].currency.ep),oe&4&&Ie(ue.value)!==K[2].currency.sp&&re(ue,K[2].currency.sp),oe&4&&Ie(X.value)!==K[2].currency.cp&&re(X,K[2].currency.cp),oe&240){de=K[4];let Ce;for(Ce=0;Ce<de.length;Ce+=1){const Le=da(K,de,Ce);pe[Ce]?pe[Ce].p(Le,oe):(pe[Ce]=ba(Le),pe[Ce].c(),pe[Ce].m(x,null))}for(;Ce<pe.length;Ce+=1)pe[Ce].d(1);pe.length=de.length}},i(K){W||(L(m.$$.fragment,K),L(g.$$.fragment,K),W=!0)},o(K){G(m.$$.fragment,K),G(g.$$.fragment,K),W=!1},d(K){K&&k(e),be&&be.d(),le(m),le(g),K&&k(h),K&&k(y),K&&k(ge),K&&k(Te),Ee(pe,K),ee=!1,Ve(ye)}}}function r_(t,e,n){let l,s,i,o,a;Re(t,ae,A=>n(2,a=A));function u(A){const B=a.gear.findIndex(R=>R.name===A),O=a.gear[B];O.quantity>1?O.quantity-=1:a.gear.splice(B,1),ae.set(a)}function c(A){A.equipped=!A.equipped,ae.set(a)}function r(A){A.attuned=!A.attuned,ae.set(a)}function p(){a.currency.pp=Ie(this.value),ae.set(a)}function m(){a.currency.gp=Ie(this.value),ae.set(a)}function b(){a.currency.ep=Ie(this.value),ae.set(a)}function g(){a.currency.sp=Ie(this.value),ae.set(a)}function h(){a.currency.cp=Ie(this.value),ae.set(a)}const y=A=>c(A),v=A=>r(A),T=A=>u(A.name);return t.$$.update=()=>{t.$$.dirty&4&&n(4,l=a.gear.sort((A,B)=>tl(A.name,B.name))),t.$$.dirty&4&&n(1,s=Du(a)),t.$$.dirty&4&&n(0,i=$u(a)),t.$$.dirty&3&&n(3,o=s>i)},[i,s,a,o,l,u,c,r,p,m,b,g,h,y,v,T]}class u_ extends Oe{constructor(e){super(),Me(this,e,r_,a_,Se,{})}}const{Boolean:c_}=lr;function va(t,e,n){const l=t.slice();return l[5]=e[n],l}function ya(t,e,n){const l=t.slice();l[8]=e[n];const s=Gn(l[0],l[8]);l[9]=s;const i=l[9]!==0?Hn(l[9]):"";l[10]=i;const o={Close:"貼身",Near:"近距",Far:"遠距",Self:"自身"};return l[11]=o,l}function Ol(t){const e=t.slice(),n=dr(e[0],e[8],"twoHanded");return e[14]=n,e}function Ml(t){const e=t.slice(),n=dr(e[0],e[8],"oneHanded");return e[14]=n,e}function wa(t){let e,n;return e=new Yt({props:{diceType:t[14],numDice:t[8].damage.oneHanded.numDice,modifier:Gn(t[0],t[8]),$$slots:{default:[f_]},$$scope:{ctx:t}}}),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},p(l,s){const i={};s&5&&(i.diceType=l[14]),s&4&&(i.numDice=l[8].damage.oneHanded.numDice),s&5&&(i.modifier=Gn(l[0],l[8])),s&32773&&(i.$$scope={dirty:s,ctx:l}),e.$set(i)},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function f_(t){let e,n,l=`${t[8].damage.oneHanded.numDice}${t[14]}${t[10]}`,s,i,o;return{c(){e=_("div"),n=_("span"),s=P(l),i=w(),o=_("i"),o.textContent="back_hand",d(o,"class","material-icons"),d(e,"class","bg-black text-white p-1 px-2 rounded-md flex flex-col items-center text-xs")},m(a,u){E(a,e,u),f(e,n),f(n,s),f(e,i),f(e,o)},p(a,u){u&5&&l!==(l=`${a[8].damage.oneHanded.numDice}${a[14]}${a[10]}`)&&Z(s,l)},d(a){a&&k(e)}}}function Ta(t){let e,n;return e=new Yt({props:{diceType:t[14],numDice:t[8].damage.twoHanded.numDice,modifier:Gn(t[0],t[8]),$$slots:{default:[d_]},$$scope:{ctx:t}}}),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},p(l,s){const i={};s&5&&(i.diceType=l[14]),s&4&&(i.numDice=l[8].damage.twoHanded.numDice),s&5&&(i.modifier=Gn(l[0],l[8])),s&32773&&(i.$$scope={dirty:s,ctx:l}),e.$set(i)},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function d_(t){let e,n,l=`${t[8].damage.twoHanded.numDice}${t[14]}${t[10]}`,s,i,o;return{c(){e=_("div"),n=_("span"),s=P(l),i=w(),o=_("i"),o.textContent="sign_language",d(o,"class","material-icons"),d(e,"class","bg-black text-white rounded-md p-1 px-2 flex flex-col items-center")},m(a,u){E(a,e,u),f(e,n),f(n,s),f(e,i),f(e,o)},p(a,u){u&5&&l!==(l=`${a[8].damage.twoHanded.numDice}${a[14]}${a[10]}`)&&Z(s,l)},d(a){a&&k(e)}}}function Ea(t){var A;let e,n,l=(((A=t[8].l10n)==null?void 0:A.name)??t[8].name)+"",s,i,o,a=(Array.isArray(t[8].range)?t[8].range.map(y).join("/"):t[11][t[8].range]??t[8].range)+"",u,c,r,p,m,b,g,h;function y(...B){return t[4](t[11],...B)}p=new Yt({props:{modifier:qs(t[0],t[8])}});let v=t[8].damage.oneHanded&&wa(Ml(t)),T=t[8].damage.twoHanded&&Ta(Ol(t));return{c(){e=_("tr"),n=_("td"),s=P(l),i=w(),o=_("td"),u=P(a),c=w(),r=_("td"),te(p.$$.fragment),m=w(),b=_("td"),v&&v.c(),g=w(),T&&T.c(),d(b,"class","flex gap-1"),d(e,"class","border-b")},m(B,O){E(B,e,O),f(e,n),f(n,s),f(e,i),f(e,o),f(o,u),f(e,c),f(e,r),ne(p,r,null),f(e,m),f(e,b),v&&v.m(b,null),f(b,g),T&&T.m(b,null),h=!0},p(B,O){var D;t=B,(!h||O&4)&&l!==(l=(((D=t[8].l10n)==null?void 0:D.name)??t[8].name)+"")&&Z(s,l),(!h||O&4)&&a!==(a=(Array.isArray(t[8].range)?t[8].range.map(y).join("/"):t[11][t[8].range]??t[8].range)+"")&&Z(u,a);const R={};O&5&&(R.modifier=qs(t[0],t[8])),p.$set(R),t[8].damage.oneHanded?v?(v.p(Ml(t),O),O&4&&L(v,1)):(v=wa(Ml(t)),v.c(),L(v,1),v.m(b,g)):v&&(Ge(),G(v,1,1,()=>{v=null}),We()),t[8].damage.twoHanded?T?(T.p(Ol(t),O),O&4&&L(T,1)):(T=Ta(Ol(t)),T.c(),L(T,1),T.m(b,null)):T&&(Ge(),G(T,1,1,()=>{T=null}),We())},i(B){h||(L(p.$$.fragment,B),L(v),L(T),h=!0)},o(B){G(p.$$.fragment,B),G(v),G(T),h=!1},d(B){B&&k(e),le(p),v&&v.d(),T&&T.d()}}}function ka(t){var s;let e,n=(((s=t[5].l10n)==null?void 0:s.name)??t[5].name)+"",l;return{c(){e=_("div"),l=P(n),d(e,"class","py-1")},m(i,o){E(i,e,o),f(e,l)},p(i,o){var a;o&2&&n!==(n=(((a=i[5].l10n)==null?void 0:a.name)??i[5].name)+"")&&Z(l,n)},d(i){i&&k(e)}}}function p_(t){let e,n,l,s,i,o,a,u,c=t[2],r=[];for(let g=0;g<c.length;g+=1)r[g]=Ea(ya(t,c,g));const p=g=>G(r[g],1,1,()=>{r[g]=null});let m=t[1],b=[];for(let g=0;g<m.length;g+=1)b[g]=ka(va(t,m,g));return{c(){e=_("h2"),e.textContent="攻擊",n=w(),l=_("div"),s=_("table"),i=_("tr"),i.innerHTML=`<th>攻擊</th> 
      <th>距離</th> 
      <th>命中/DC</th> 
      <th>傷害</th>`,o=w();for(let g=0;g<r.length;g+=1)r[g].c();a=w();for(let g=0;g<b.length;g+=1)b[g].c();d(i,"class","border-b"),d(s,"class","table-auto text-left text-sm w-full"),d(l,"class","overflow-y-auto")},m(g,h){E(g,e,h),E(g,n,h),E(g,l,h),f(l,s),f(s,i),f(s,o);for(let y=0;y<r.length;y+=1)r[y]&&r[y].m(s,null);f(s,a);for(let y=0;y<b.length;y+=1)b[y]&&b[y].m(s,null);u=!0},p(g,[h]){if(h&5){c=g[2];let y;for(y=0;y<c.length;y+=1){const v=ya(g,c,y);r[y]?(r[y].p(v,h),L(r[y],1)):(r[y]=Ea(v),r[y].c(),L(r[y],1),r[y].m(s,a))}for(Ge(),y=c.length;y<r.length;y+=1)p(y);We()}if(h&2){m=g[1];let y;for(y=0;y<m.length;y+=1){const v=va(g,m,y);b[y]?b[y].p(v,h):(b[y]=ka(v),b[y].c(),b[y].m(s,null))}for(;y<b.length;y+=1)b[y].d(1);b.length=m.length}},i(g){if(!u){for(let h=0;h<c.length;h+=1)L(r[h]);u=!0}},o(g){r=r.filter(c_);for(let h=0;h<r.length;h+=1)G(r[h]);u=!1},d(g){g&&k(e),g&&k(n),g&&k(l),Ee(r,g),Ee(b,g)}}}function __(t,e,n){let l,s,i,o;Re(t,he,u=>n(0,o=u));const a=(u,c)=>u[c]??c;return t.$$.update=()=>{t.$$.dirty&1&&n(3,l=o.gear.filter(u=>u.equipped)),t.$$.dirty&8&&n(2,s=l.map(u=>rr(u.name)).filter(Boolean)),t.$$.dirty&8&&n(1,i=l.map(u=>cr(u.name)).filter(Boolean).filter(u=>{var c;return u.canBeEquipped&&((c=u.properties)==null?void 0:c.includes("Attackable"))}))},[o,i,s,l,a]}class m_ extends Oe{constructor(e){super(),Me(this,e,__,p_,Se,{})}}function h_(t){try{const e=JSON.parse(t);return Il(e)}catch(e){return console.error("Failed to import character JSON:",e),Il(null)}}function g_(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T,A,B=t[0].tempHitPoints+"",O,R,D,M,S,C,$,I,z,q;return{c(){e=_("h2"),e.textContent="生命值",n=w(),l=_("label"),s=w(),i=_("input"),o=w(),a=_("div"),u=_("div"),c=P("最大: "),r=P(t[2]),p=w(),m=_("div"),b=_("button"),b.innerHTML='<i class="material-icons text-base align-middle">remove</i>',g=w(),h=_("button"),h.innerHTML='<i class="material-icons text-base align-middle">add</i>',y=w(),v=_("div"),T=_("div"),A=P("臨時: "),O=P(B),R=w(),D=_("div"),M=_("button"),M.innerHTML='<i class="material-icons text-base align-middle">remove</i>',S=w(),C=_("button"),C.innerHTML='<i class="material-icons text-base align-middle">add</i>',$=w(),I=_("button"),I.textContent="長休",d(l,"for","hitpoints"),d(i,"id","hitpoints"),d(i,"type","number"),d(i,"inputmode","numeric"),d(i,"class","pirata text-4xl text-center"),d(i,"min","0"),V(i,"text-red-600",t[1]),d(u,"class","whitespace-nowrap"),d(b,"class","hover:bg-gray-200 rounded"),d(h,"class","hover:bg-gray-200 rounded"),d(m,"class","flex items-center"),d(a,"class","flex gap-1 justify-between items-center text-sm mt-1"),d(T,"class","whitespace-nowrap text-blue-600"),d(M,"class","hover:bg-gray-200 rounded"),d(C,"class","hover:bg-gray-200 rounded"),d(D,"class","flex items-center"),d(v,"class","flex gap-1 justify-between items-center text-sm border-t pt-1 mt-1"),d(I,"class","bg-black text-white rounded-md text-sm self-center px-2 mt-1"),d(I,"title","恢復 HP、法術位，減少 1 級力竭")},m(F,ie){E(F,e,ie),E(F,n,ie),E(F,l,ie),E(F,s,ie),E(F,i,ie),re(i,t[0].hitPoints),E(F,o,ie),E(F,a,ie),f(a,u),f(u,c),f(u,r),f(a,p),f(a,m),f(m,b),f(m,g),f(m,h),E(F,y,ie),E(F,v,ie),f(v,T),f(T,A),f(T,O),f(v,R),f(v,D),f(D,M),f(D,S),f(D,C),E(F,$,ie),E(F,I,ie),z||(q=[N(i,"input",t[8]),N(b,"click",t[4]),N(h,"click",t[3]),N(M,"click",t[7]),N(C,"click",t[6]),N(I,"click",t[5])],z=!0)},p(F,[ie]){ie&1&&Ie(i.value)!==F[0].hitPoints&&re(i,F[0].hitPoints),ie&2&&V(i,"text-red-600",F[1]),ie&4&&Z(r,F[2]),ie&1&&B!==(B=F[0].tempHitPoints+"")&&Z(O,B)},i:j,o:j,d(F){F&&k(e),F&&k(n),F&&k(l),F&&k(s),F&&k(i),F&&k(o),F&&k(a),F&&k(y),F&&k(v),F&&k($),F&&k(I),z=!1,Ve(q)}}}function b_(t,e,n){let l,s,i;Re(t,he,m=>n(0,i=m));function o(){$e(he,i.maxHitPoints+=1,i),he.set(i)}function a(){$e(he,i.maxHitPoints=Math.max(1,i.maxHitPoints-1),i),i.hitPoints>i.maxHitPoints&&$e(he,i.hitPoints=i.maxHitPoints,i),he.set(i)}function u(){$e(he,i.hitPoints=Us(i),i);const m=[1,2,3,4,5,6,7,8,9];for(const b of m)i.spellSlots[b]&&$e(he,i.spellSlots[b].used=0,i);$e(he,i.deathSaves={successes:0,failures:0},i),i.exhaustion>0&&$e(he,i.exhaustion-=1,i),he.set(i)}function c(){$e(he,i.tempHitPoints+=1,i),he.set(i)}function r(){$e(he,i.tempHitPoints=Math.max(0,i.tempHitPoints-1),i),he.set(i)}function p(){i.hitPoints=Ie(this.value),he.set(i)}return t.$$.update=()=>{t.$$.dirty&1&&n(2,l=Us(i)),t.$$.dirty&1&&n(1,s=i.hitPoints<=0)},[i,s,l,o,a,u,c,r,p]}class v_ extends Oe{constructor(e){super(),Me(this,e,b_,g_,Se,{})}}function y_(t){let e;return{c(){e=_("div"),e.innerHTML=`<div>這是一個非官方的 Shadowdark 角色追蹤工具！
      <a target="_blank" href="https://www.thearcanelibrary.com/pages/shadowdark" class="svelte-1a204e">購買 Shadowdark</a></div> 

    <h2>匯入</h2> 
    <div>本工具可直接從 <a href="https://www.shadowdarklings.net" target="_blank" class="svelte-1a204e">Shadowdarkling Character Creator</a> 匯入您的角色。也能匯入先前匯出的 JSON 檔案。</div> 

    <h2>儲存</h2> 
    <div>本工具會自動將您的角色卡儲存於瀏覽器的 Local
      Storage。若您刪除本網站的儲存資料，請務必先匯出角色 JSON 檔。</div> 

    <h2>聯絡</h2> 
    <div>您可以透過 <a href="mailto:maxpaulus43@gmail.com" target="_blank" class="svelte-1a204e">maxpaulus43@gmail.com</a> 聯絡我（英文），我也會出沒在 Shadowdark 官方 Discord 頻道。</div> 

    <h2>問題回報</h2> 
    <div>本專案為免費且開源！歡迎提交 Pull Request 或
      <a href="https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet" target="_blank" class="svelte-1a204e">建立 Issue</a></div> 

    <h2>致謝</h2> 
    <div>看看其他很棒的 Shadowdark 工具！</div> 
    <div><a href="https://shadowdarklings.net" target="_blank" class="svelte-1a204e">https://shadowdarklings.net</a></div> 
    <div><a href="https://www.shadowdork.com" target="_blank" class="svelte-1a204e">https://www.shadowdork.com</a></div> 

    <h2>授權</h2> 
    <div>本工具為獨立產品，依據 Shadowdark RPG Third-Party License 發布，與 The
      Arcane Library, LLC 無關。 Shadowdark RPG © 2023 The Arcane Library, LLC.</div> 
    <hr/> 
    <div>免責聲明：我已獲得 The Arcane Library
      明確許可，可於本工具轉載角色創建資料（如天賦表）。</div> 

    <a href="https://www.buymeacoffee.com/tKsqTr4ABl" target="_blank" class="pirata text-xl rounded-md p-2 self-center svelte-1a204e">請我吃份口糧 🍖</a>`,d(e,"class","flex flex-col")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function w_(t){let e;return{c(){e=_("h1"),e.textContent="資訊",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function T_(t){let e,n,l,s,i,o,a;function u(r){t[2](r)}let c={$$slots:{header:[w_],default:[y_]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),je.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons">help</i>',n=w(),te(l.$$.fragment)},m(r,p){E(r,e,p),E(r,n,p),ne(l,r,p),i=!0,o||(a=N(e,"click",t[1]),o=!0)},p(r,[p]){const m={};p&8&&(m.$$scope={dirty:p,ctx:r}),!s&&p&1&&(s=!0,m.showModal=r[0],Ke(()=>s=!1)),l.$set(m)},i(r){i||(L(l.$$.fragment,r),i=!0)},o(r){G(l.$$.fragment,r),i=!1},d(r){r&&k(e),r&&k(n),le(l,r),o=!1,a()}}}function E_(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function i(o){l=o,n(0,l)}return[l,s,i]}class k_ extends Oe{constructor(e){super(),Me(this,e,E_,T_,Se,{})}}async function A_(t){const e=t.name;t=JSON.parse(JSON.stringify(t)),t.schemaVersion=_u,t.schemaType=mu;const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});if("showSaveFilePicker"in window&&(()=>{try{return window.self===window.top}catch{return!1}})())try{const a=await(await window.showSaveFilePicker({suggestedName:e,types:[{description:"json files",accept:{"application/json":[".json"]}}]})).createWritable();await a.write(n),await a.close();return}catch(o){if(o.name!=="AbortError"){console.error(o.name,o.message);return}}const s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=e,i.style.display="none",document.body.append(i),i.click(),setTimeout(()=>{URL.revokeObjectURL(s),i.remove()},1e3)}function Aa(t,e,n){const l=t.slice();return l[17]=e[n],l[19]=n,l}function Ba(t){let e,n=t[19]+1+"",l,s,i;function o(){return t[9](t[19])}return{c(){e=_("button"),l=P(n),d(e,"class","svelte-1bwcddv"),V(e,"green",t[3]===t[19]+1)},m(a,u){E(a,e,u),f(e,l),s||(i=N(e,"click",o),s=!0)},p(a,u){t=a,u&8&&V(e,"green",t[3]===t[19]+1)},d(a){a&&k(e),s=!1,i()}}}function B_(t){let e,n,l,s,i,o,a,u,c;return{c(){e=_("label"),n=_("div"),l=_("div"),l.textContent="通知持續時間:",s=w(),i=_("input"),o=w(),a=_("div"),a.textContent="秒",d(i,"class","w-16 text-right"),d(i,"id","notificationDuration"),d(i,"type","number"),d(i,"inputmode","numeric"),d(i,"min","0"),d(n,"class","flex flex-row gap-1 items-center"),d(e,"for","notificationDuration")},m(r,p){E(r,e,p),f(e,n),f(n,l),f(n,s),f(n,i),re(i,t[4].popoverDuration),f(n,o),f(n,a),u||(c=N(i,"input",t[10]),u=!0)},p(r,p){p&16&&Ie(i.value)!==r[4].popoverDuration&&re(i,r[4].popoverDuration)},d(r){r&&k(e),u=!1,c()}}}function Ca(t){let e,n,l,s,i,o,a;return{c(){e=_("div"),e.textContent="進階選項（請謹慎操作）",n=w(),l=_("button"),l.textContent="清除目前欄位資料",s=w(),i=_("button"),i.textContent="清除所有暫存資料（請謹慎操作）",d(l,"class","svelte-1bwcddv"),d(i,"class","svelte-1bwcddv")},m(u,c){E(u,e,c),E(u,n,c),E(u,l,c),E(u,s,c),E(u,i,c),o||(a=[N(l,"click",t[14]),N(i,"click",t[15])],o=!0)},p:j,d(u){u&&k(e),u&&k(n),u&&k(l),u&&k(s),u&&k(i),o=!1,Ve(a)}}}function C_(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T,A,B={length:cl},O=[];for(let M=0;M<B.length;M+=1)O[M]=Ba(Aa(t,B,M));let R=ze.isAvailable&&B_(t),D=!t[2]&&Ca(t);return{c(){e=_("div"),n=_("div"),l=_("h2"),l.textContent="選擇存檔欄位",s=w(),i=_("div");for(let M=0;M<O.length;M+=1)O[M].c();o=w(),R&&R.c(),a=w(),u=_("label"),c=_("div"),c.textContent="匯入 JSON",r=w(),p=_("input"),b=w(),g=_("button"),g.textContent="匯出 JSON",h=w(),y=_("a"),y.textContent="回報問題",v=w(),D&&D.c(),d(i,"class","flex gap-1 w-full justify-stretch"),d(c,"class","text-center"),d(p,"id","jsonImport"),d(p,"type","file"),d(p,"class","hidden"),d(p,"accept","application/json"),p.disabled=t[2],d(u,"for","jsonImport"),d(u,"class",m=Rs(t[2]?"btn-disabled":"btn")+" svelte-1bwcddv"),d(g,"class","svelte-1bwcddv"),d(y,"class","btn svelte-1bwcddv"),d(y,"href","https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet/issues/new"),d(y,"target","_blank"),d(e,"class","flex flex-col gap-1 min-w-[200px] svelte-1bwcddv"),d(e,"id","options")},m(M,S){E(M,e,S),f(e,n),f(n,l),f(n,s),f(n,i);for(let C=0;C<O.length;C+=1)O[C]&&O[C].m(i,null);f(e,o),R&&R.m(e,null),f(e,a),f(e,u),f(u,c),f(u,r),f(u,p),f(e,b),f(e,g),f(e,h),f(e,y),f(e,v),D&&D.m(e,null),T||(A=[N(p,"change",t[11]),N(p,"click",t[12]),N(g,"click",t[13])],T=!0)},p(M,S){if(S&8){B={length:cl};let C;for(C=0;C<B.length;C+=1){const $=Aa(M,B,C);O[C]?O[C].p($,S):(O[C]=Ba($),O[C].c(),O[C].m(i,null))}for(;C<O.length;C+=1)O[C].d(1);O.length=B.length}ze.isAvailable&&R.p(M,S),S&4&&(p.disabled=M[2]),S&4&&m!==(m=Rs(M[2]?"btn-disabled":"btn")+" svelte-1bwcddv")&&d(u,"class",m),M[2]?D&&(D.d(1),D=null):D?D.p(M,S):(D=Ca(M),D.c(),D.m(e,null))},d(M){M&&k(e),Ee(O,M),R&&R.d(),D&&D.d(),T=!1,Ve(A)}}}function S_(t){let e;return{c(){e=_("h1"),e.textContent="選項",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function O_(t){let e,n,l,s,i,o,a;function u(r){t[16](r)}let c={$$slots:{header:[S_],default:[C_]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ft({props:c}),je.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons translate-y-[1px]">settings</i>',n=w(),te(l.$$.fragment),d(e,"class","bg-black text-white rounded-md px-1 text-xs svelte-1bwcddv")},m(r,p){E(r,e,p),E(r,n,p),ne(l,r,p),i=!0,o||(a=N(e,"click",t[8]),o=!0)},p(r,[p]){const m={};p&1048637&&(m.$$scope={dirty:p,ctx:r}),!s&&p&2&&(s=!0,m.showModal=r[1],Ke(()=>s=!1)),l.$set(m)},i(r){i||(L(l.$$.fragment,r),i=!0)},o(r){G(l.$$.fragment,r),i=!1},d(r){r&&k(e),r&&k(n),le(l,r),o=!1,a()}}}function M_(t,e,n){let l,s,i,o,a,u;Re(t,yn,B=>n(6,s=B)),Re(t,qt,B=>n(7,i=B)),Re(t,_t,B=>n(3,o=B)),Re(t,wn,B=>n(4,a=B)),Re(t,he,B=>n(5,u=B));let{files:c}=e,r=!1;const p=()=>n(1,r=!0),m=B=>{$e(_t,o=B+1,o)};function b(){a.popoverDuration=Ie(this.value),wn.set(a)}function g(){c=this.files,n(0,c)}const h=B=>{B.currentTarget.value="",n(0,c=void 0)},y=()=>{A_(u)},v=()=>{$e(he,u=Ct(),u)},T=()=>{$e(he,u=Ct(),u),hd()};function A(B){r=B,n(1,r)}return t.$$set=B=>{"files"in B&&n(0,c=B.files)},t.$$.update=()=>{t.$$.dirty&192&&n(2,l=i&&!s)},[c,r,l,o,a,u,s,i,p,m,b,g,h,y,v,T,A]}class R_ extends Oe{constructor(e){super(),Me(this,e,M_,O_,Se,{files:0})}}function Sa(t,e,n){const l=t.slice();return l[4]=e[n],l}function Oa(t){let e;return{c(){e=_("div"),e.textContent="(必須至少達到 1 等級)"},m(n,l){E(n,e,l)},d(n){n&&k(e)}}}function $_(t){let e,n,l,s,i,o=Ut,a=[];for(let u=0;u<o.length;u+=1)a[u]=Ma(Sa(t,o,u));return{c(){e=_("select");for(let u=0;u<a.length;u+=1)a[u].c();e.disabled=l=!t[1]},m(u,c){E(u,e,c);for(let r=0;r<a.length;r+=1)a[r]&&a[r].m(e,null);ve(e,t[0].class),s||(i=N(e,"change",t[2]),s=!0)},p(u,c){if(c&0){o=Ut;let r;for(r=0;r<o.length;r+=1){const p=Sa(u,o,r);a[r]?a[r].p(p,c):(a[r]=Ma(p),a[r].c(),a[r].m(e,null))}for(;r<a.length;r+=1)a[r].d(1);a.length=o.length}c&1&&n!==(n=u[0].class)&&ve(e,u[0].class),c&2&&l!==(l=!u[1])&&(e.disabled=l)},d(u){u&&k(e),Ee(a,u),s=!1,i()}}}function D_(t){let e,n,l,s,i;return{c(){e=_("input"),d(e,"type","text"),e.value=n=t[0].class,e.disabled=l=!t[1]},m(o,a){E(o,e,a),s||(i=N(e,"input",t[2]),s=!0)},p(o,a){a&1&&n!==(n=o[0].class)&&e.value!==n&&(e.value=n),a&2&&l!==(l=!o[1])&&(e.disabled=l)},d(o){o&&k(e),s=!1,i()}}}function Ma(t){let e,n=$l(t[4])+"",l,s;return{c(){e=_("option"),l=P(n),s=w(),e.__value=t[4],e.value=e.__value},m(i,o){E(i,e,o),f(e,l),f(e,s)},p:j,d(i){i&&k(e)}}}function I_(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h=!t[1]&&Oa();function y(A,B){return A[0].hasCustomClass?D_:$_}let v=y(t),T=v(t);return{c(){e=_("div"),n=_("h2"),n.textContent="職業",l=w(),h&&h.c(),s=w(),i=_("div"),o=_("input"),c=w(),r=_("label"),r.textContent="自訂",p=w(),T.c(),m=gt(),d(o,"id","customClass"),d(o,"type","checkbox"),o.disabled=a=!t[1],o.checked=u=t[0].hasCustomClass,d(r,"for","customClass"),d(i,"class","flex items-center gap-1"),d(e,"class","flex justify-between")},m(A,B){E(A,e,B),f(e,n),f(e,l),h&&h.m(e,null),f(e,s),f(e,i),f(i,o),f(i,c),f(i,r),E(A,p,B),T.m(A,B),E(A,m,B),b||(g=N(o,"input",t[3]),b=!0)},p(A,[B]){A[1]?h&&(h.d(1),h=null):h||(h=Oa(),h.c(),h.m(e,s)),B&2&&a!==(a=!A[1])&&(o.disabled=a),B&1&&u!==(u=A[0].hasCustomClass)&&(o.checked=u),v===(v=y(A))&&T?T.p(A,B):(T.d(1),T=v(A),T&&(T.c(),T.m(m.parentNode,m)))},i:j,o:j,d(A){A&&k(e),h&&h.d(),A&&k(p),T.d(A),A&&k(m),b=!1,g()}}}function N_(t,e,n){let l,s;Re(t,he,a=>n(0,s=a));function i(a){const u=a.target.value;Cu(s,u),he.set(s)}function o(a){$e(he,s.hasCustomClass=a.target.checked,s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=s.level>=1)},[s,l,i,o]}class L_ extends Oe{constructor(e){super(),Me(this,e,N_,I_,Se,{})}}function P_(t){let e,n,l,s,i,o,a,u,c=t[0].armorClass>=0?"+":"",r,p=t[0].armorClass+"",m,b,g,h,y,v,T,A;return{c(){e=_("h2"),e.textContent="防禦等級",n=w(),l=_("div"),s=P(t[1]),i=w(),o=_("div"),a=_("span"),u=P("雜項加值: "),r=P(c),m=P(p),b=w(),g=_("div"),h=_("button"),h.innerHTML='<i class="material-icons">remove</i>',y=w(),v=_("button"),v.innerHTML='<i class="material-icons">add</i>',d(l,"class","flex w-full h-full justify-center items-center text-7xl pirata text-center"),d(a,"class","text-sm"),d(h,"class","hover:bg-gray-200 rounded"),d(v,"class","hover:bg-gray-200 rounded"),d(g,"class","flex"),d(o,"class","flex items-center justify-between w-full")},m(B,O){E(B,e,O),E(B,n,O),E(B,l,O),f(l,s),E(B,i,O),E(B,o,O),f(o,a),f(a,u),f(a,r),f(a,m),f(o,b),f(o,g),f(g,h),f(g,y),f(g,v),T||(A=[N(h,"click",t[3]),N(v,"click",t[2])],T=!0)},p(B,[O]){O&2&&Z(s,B[1]),O&1&&c!==(c=B[0].armorClass>=0?"+":"")&&Z(r,c),O&1&&p!==(p=B[0].armorClass+"")&&Z(m,p)},i:j,o:j,d(B){B&&k(e),B&&k(n),B&&k(l),B&&k(i),B&&k(o),T=!1,Ve(A)}}}function H_(t,e,n){let l,s;Re(t,he,a=>n(0,s=a));function i(){$e(he,s.armorClass+=1,s),he.set(s)}function o(){$e(he,s.armorClass-=1,s),he.set(s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=Ou(s))},[s,l,i,o]}class G_ extends Oe{constructor(e){super(),Me(this,e,H_,P_,Se,{})}}function W_(t){let e,n,l;return{c(){e=_("textarea"),d(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(s,i){E(s,e,i),re(e,t[1].notes),n||(l=N(e,"input",t[3]),n=!0)},p(s,i){i&2&&re(e,s[1].notes)},d(s){s&&k(e),n=!1,l()}}}function F_(t){let e;return{c(){e=_("h1"),e.textContent="筆記",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function q_(t){let e,n,l,s,i,o,a;function u(r){t[4](r)}let c={$$slots:{header:[F_],default:[W_]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),je.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons translate-y-1">notes</i>',n=w(),te(l.$$.fragment),d(e,"class","bg-black text-white px-1")},m(r,p){E(r,e,p),E(r,n,p),ne(l,r,p),i=!0,o||(a=N(e,"click",t[2]),o=!0)},p(r,[p]){const m={};p&34&&(m.$$scope={dirty:p,ctx:r}),!s&&p&1&&(s=!0,m.showModal=r[0],Ke(()=>s=!1)),l.$set(m)},i(r){i||(L(l.$$.fragment,r),i=!0)},o(r){G(l.$$.fragment,r),i=!1},d(r){r&&k(e),r&&k(n),le(l,r),o=!1,a()}}}function U_(t,e,n){let l;Re(t,he,u=>n(1,l=u));let s=!1;const i=()=>n(0,s=!0);function o(){l.notes=this.value,he.set(l)}function a(u){s=u,n(0,s)}return[s,l,i,o,a]}class V_ extends Oe{constructor(e){super(),Me(this,e,U_,q_,Se,{})}}function Ra(t,e,n){const l=t.slice();return l[12]=e[n],l}function $a(t){let e,n,l,s,i;return{c(){e=_("button"),n=_("i"),n.textContent="group",d(n,"class","material-icons translate-y-1"),d(e,"class",l=(t[5]?"bg-black":"bg-green-600")+" text-white px-1")},m(o,a){E(o,e,a),f(e,n),s||(i=N(e,"click",t[9]),s=!0)},p(o,a){a&32&&l!==(l=(o[5]?"bg-black":"bg-green-600")+" text-white px-1")&&d(e,"class",l)},d(o){o&&k(e),s=!1,i()}}}function j_(t){let e;return{c(){e=_("div"),e.textContent="同步中"},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function z_(t){let e,n,l;function s(){return t[10](t[12])}return{c(){e=_("button"),e.textContent="載入",d(e,"class","bg-black text-white p-1 rounded-md px-1")},m(i,o){E(i,e,o),n||(l=N(e,"click",s),n=!0)},p(i,o){t=i},d(i){i&&k(e),n=!1,l()}}}function Da(t){let e,n,l=t[12].name+"",s,i=t[12].id==t[1]?"（你）":"",o,a,u;function c(m,b){if(m[3]!==m[12].id)return z_;if(!m[5])return j_}let r=c(t),p=r&&r(t);return{c(){e=_("div"),n=_("div"),s=P(l),o=P(i),a=w(),p&&p.c(),u=w(),d(e,"class","flex gap-1 justify-between items-center p-1 rounded-md w-full"),V(e,"bg-yellow-300",t[3]===t[12].id)},m(m,b){E(m,e,b),f(e,n),f(n,s),f(n,o),f(e,a),p&&p.m(e,null),f(e,u)},p(m,b){b&1&&l!==(l=m[12].name+"")&&Z(s,l),b&3&&i!==(i=m[12].id==m[1]?"（你）":"")&&Z(o,i),r===(r=c(m))&&p?p.p(m,b):(p&&p.d(1),p=r&&r(m),p&&(p.c(),p.m(e,u))),b&9&&V(e,"bg-yellow-300",m[3]===m[12].id)},d(m){m&&k(e),p&&p.d()}}}function Y_(t){let e,n,l,s=t[0],i=[];for(let o=0;o<s.length;o+=1)i[o]=Da(Ra(t,s,o));return{c(){e=_("div"),e.textContent="注意：載入其他玩家僅載入其數據。這是玩家角色卡的唯讀預覽。",n=w(),l=_("div");for(let o=0;o<i.length;o+=1)i[o].c();d(e,"class","w-72 mt-4 mb-4"),d(l,"class","flex flex-col gap-1 w-full")},m(o,a){E(o,e,a),E(o,n,a),E(o,l,a);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(l,null)},p(o,a){if(a&107){s=o[0];let u;for(u=0;u<s.length;u+=1){const c=Ra(o,s,u);i[u]?i[u].p(c,a):(i[u]=Da(c),i[u].c(),i[u].m(l,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=s.length}},d(o){o&&k(e),o&&k(n),o&&k(l),Ee(i,o)}}}function K_(t){let e;return{c(){e=_("h1"),e.textContent="玩家",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function X_(t){let e,n,l,s,i=t[4]&&$a(t);function o(u){t[11](u)}let a={$$slots:{header:[K_],default:[Y_]},$$scope:{ctx:t}};return t[2]!==void 0&&(a.showModal=t[2]),n=new ft({props:a}),je.push(()=>Ye(n,"showModal",o)),{c(){i&&i.c(),e=w(),te(n.$$.fragment)},m(u,c){i&&i.m(u,c),E(u,e,c),ne(n,u,c),s=!0},p(u,[c]){u[4]?i?i.p(u,c):(i=$a(u),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null);const r={};c&32811&&(r.$$scope={dirty:c,ctx:u}),!l&&c&4&&(l=!0,r.showModal=u[2],Ke(()=>l=!1)),n.$set(r)},i(u){s||(L(n.$$.fragment,u),s=!0)},o(u){G(n.$$.fragment,u),s=!1},d(u){i&&i.d(u),u&&k(e),le(n,u)}}}function J_(t,e,n){let l,s,i,o,a,u;Re(t,Bt,h=>n(3,l=h)),Re(t,cs,h=>n(7,s=h)),Re(t,qn,h=>n(1,i=h)),Re(t,Dn,h=>n(8,o=h)),Re(t,qt,h=>n(4,a=h)),Re(t,yn,h=>n(5,u=h));let c=!1,r;function p(h){$e(Bt,l=h.id,l)}const m=()=>n(2,c=!0),b=h=>p(h);function g(h){c=h,n(2,c)}return t.$$.update=()=>{t.$$.dirty&387&&(n(0,r=o.map(h=>({id:h.id,name:h.name}))),r.unshift({id:i,name:(s==null?void 0:s.name)??"GM"}))},[r,i,c,l,a,u,p,s,o,m,b,g]}class Z_ extends Oe{constructor(e){super(),Me(this,e,J_,X_,Se,{})}}function Ia(t,e,n){const l=t.slice();return l[3]=e[n],l}function Q_(t){let e,n,l,s,i=Ls,o=[];for(let a=0;a<i.length;a+=1)o[a]=Na(Ia(t,i,a));return{c(){e=_("select");for(let a=0;a<o.length;a+=1)o[a].c()},m(a,u){E(a,e,u);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);ve(e,t[0].ancestry),l||(s=N(e,"change",t[2]),l=!0)},p(a,u){if(u&0){i=Ls;let c;for(c=0;c<i.length;c+=1){const r=Ia(a,i,c);o[c]?o[c].p(r,u):(o[c]=Na(r),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=i.length}u&1&&n!==(n=a[0].ancestry)&&ve(e,a[0].ancestry)},d(a){a&&k(e),Ee(o,a),l=!1,s()}}}function x_(t){let e,n,l,s;return{c(){e=_("input"),d(e,"type","text"),e.value=n=t[0].ancestry},m(i,o){E(i,e,o),l||(s=N(e,"input",t[2]),l=!0)},p(i,o){o&1&&n!==(n=i[0].ancestry)&&e.value!==n&&(e.value=n)},d(i){i&&k(e),l=!1,s()}}}function Na(t){let e,n=Bu(t[3])+"",l,s;return{c(){e=_("option"),l=P(n),s=w(),e.__value=t[3],e.value=e.__value},m(i,o){E(i,e,o),f(e,l),f(e,s)},p:j,d(i){i&&k(e)}}}function em(t){let e,n,l,s,i,o,a,u,c,r,p,m;function b(y,v){return y[0].hasCustomAncestry?x_:Q_}let g=b(t),h=g(t);return{c(){e=_("div"),n=_("h2"),n.textContent="種族",l=w(),s=_("div"),i=_("input"),a=w(),u=_("label"),u.textContent="自訂",c=w(),h.c(),r=gt(),d(i,"id","customAncestry"),d(i,"type","checkbox"),i.checked=o=t[0].hasCustomAncestry,d(u,"for","customAncestry"),d(s,"class","flex items-center gap-1"),d(e,"class","flex justify-between")},m(y,v){E(y,e,v),f(e,n),f(e,l),f(e,s),f(s,i),f(s,a),f(s,u),E(y,c,v),h.m(y,v),E(y,r,v),p||(m=N(i,"input",t[1]),p=!0)},p(y,[v]){v&1&&o!==(o=y[0].hasCustomAncestry)&&(i.checked=o),g===(g=b(y))&&h?h.p(y,v):(h.d(1),h=g(y),h&&(h.c(),h.m(r.parentNode,r)))},i:j,o:j,d(y){y&&k(e),y&&k(c),h.d(y),y&&k(r),p=!1,m()}}}function tm(t,e,n){let l;Re(t,he,o=>n(0,l=o));function s(o){$e(he,l.hasCustomAncestry=o.target.checked,l)}function i(o){const a=o.target.value;Su(l,a),he.set(l)}return[l,s,i]}class nm extends Oe{constructor(e){super(),Me(this,e,tm,em,Se,{})}}function La(t,e,n){const l=t.slice();return l[10]=e[n],l}function Pa(t,e,n){const l=t.slice();return l[10]=e[n],l}function lm(t){let e;return{c(){e=_("span"),e.textContent="擲骰",d(e,"class","text-xs px-1")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function sm(t){let e,n,l,s,i,o,a,u,c,r,p=[0,1,2],m=[];for(let h=0;h<3;h+=1)m[h]=Ha(Pa(t,p,h));let b=[0,1,2],g=[];for(let h=0;h<3;h+=1)g[h]=Ga(La(t,b,h));return{c(){e=_("div"),n=_("div"),l=_("span"),l.textContent="成功",s=w(),i=_("div");for(let h=0;h<3;h+=1)m[h].c();o=w(),a=_("div"),u=_("span"),u.textContent="失敗",c=w(),r=_("div");for(let h=0;h<3;h+=1)g[h].c();d(l,"class","text-xs text-gray-600 mb-1"),d(i,"class","flex gap-1"),d(n,"class","flex flex-col items-center"),d(u,"class","text-xs text-gray-600 mb-1"),d(r,"class","flex gap-1"),d(a,"class","flex flex-col items-center"),d(e,"class","flex justify-around")},m(h,y){E(h,e,y),f(e,n),f(n,l),f(n,s),f(n,i);for(let v=0;v<3;v+=1)m[v]&&m[v].m(i,null);f(e,o),f(e,a),f(a,u),f(a,c),f(a,r);for(let v=0;v<3;v+=1)g[v]&&g[v].m(r,null)},p(h,y){if(y&25){p=[0,1,2];let v;for(v=0;v<3;v+=1){const T=Pa(h,p,v);m[v]?m[v].p(T,y):(m[v]=Ha(T),m[v].c(),m[v].m(i,null))}for(;v<3;v+=1)m[v].d(1)}if(y&97){b=[0,1,2];let v;for(v=0;v<3;v+=1){const T=La(h,b,v);g[v]?g[v].p(T,y):(g[v]=Ga(T),g[v].c(),g[v].m(r,null))}for(;v<3;v+=1)g[v].d(1)}},d(h){h&&k(e),Ee(m,h),Ee(g,h)}}}function im(t){let e;return{c(){e=_("div"),e.textContent="死亡...",d(e,"class","text-center py-2 text-red-600 font-bold")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function om(t){let e;return{c(){e=_("div"),e.textContent="穩定！",d(e,"class","text-center py-2 text-green-600 font-bold")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Ha(t){let e,n,l;function s(){return t[8](t[10])}return{c(){e=_("button"),d(e,"class","w-5 h-5 rounded-full border-2 transition-colors"),V(e,"bg-green-500",t[10]<t[0].deathSaves.successes),V(e,"border-green-500",t[10]<t[0].deathSaves.successes),V(e,"border-gray-300",t[10]>=t[0].deathSaves.successes)},m(i,o){E(i,e,o),n||(l=N(e,"click",s),n=!0)},p(i,o){t=i,o&1&&V(e,"bg-green-500",t[10]<t[0].deathSaves.successes),o&1&&V(e,"border-green-500",t[10]<t[0].deathSaves.successes),o&1&&V(e,"border-gray-300",t[10]>=t[0].deathSaves.successes)},d(i){i&&k(e),n=!1,l()}}}function Ga(t){let e,n,l;function s(){return t[9](t[10])}return{c(){e=_("button"),d(e,"class","w-5 h-5 rounded-full border-2 transition-colors"),V(e,"bg-red-500",t[10]<t[0].deathSaves.failures),V(e,"border-red-500",t[10]<t[0].deathSaves.failures),V(e,"border-gray-300",t[10]>=t[0].deathSaves.failures)},m(i,o){E(i,e,o),n||(l=N(e,"click",s),n=!0)},p(i,o){t=i,o&1&&V(e,"bg-red-500",t[10]<t[0].deathSaves.failures),o&1&&V(e,"border-red-500",t[10]<t[0].deathSaves.failures),o&1&&V(e,"border-gray-300",t[10]>=t[0].deathSaves.failures)},d(i){i&&k(e),n=!1,l()}}}function am(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g;o=new Yt({props:{modifier:0,$$slots:{default:[lm]},$$scope:{ctx:t}}});function h(T,A){return T[2]?om:T[1]?im:sm}let y=h(t),v=y(t);return{c(){e=_("div"),n=_("div"),l=_("h3"),l.textContent="死亡豁免",s=w(),i=_("div"),te(o.$$.fragment),a=w(),u=_("button"),u.textContent="重置",c=w(),v.c(),r=w(),p=_("div"),p.textContent="10+ 成功 | 1 失敗 | 20 自動成功2次",d(l,"class","font-bold text-sm"),d(u,"class","text-xs px-2 py-0.5 bg-gray-300 rounded hover:bg-gray-400"),d(u,"title","重置死亡豁免"),d(i,"class","flex gap-1 items-center"),d(n,"class","flex justify-between items-center mb-2"),d(p,"class","text-[10px] text-gray-400 text-center mt-2"),d(e,"class","border rounded p-2 bg-gray-50")},m(T,A){E(T,e,A),f(e,n),f(n,l),f(n,s),f(n,i),ne(o,i,null),f(i,a),f(i,u),f(e,c),v.m(e,null),f(e,r),f(e,p),m=!0,b||(g=N(u,"click",t[7]),b=!0)},p(T,[A]){const B={};A&32768&&(B.$$scope={dirty:A,ctx:T}),o.$set(B),y===(y=h(T))&&v?v.p(T,A):(v.d(1),v=y(T),v&&(v.c(),v.m(e,r)))},i(T){m||(L(o.$$.fragment,T),m=!0)},o(T){G(o.$$.fragment,T),m=!1},d(T){T&&k(e),le(o),v.d(),b=!1,g()}}}function rm(t,e,n){let l,s,i;Re(t,ae,b=>n(0,i=b));function o(){i.deathSaves.successes<3&&($e(ae,i.deathSaves.successes+=1,i),ae.set(i))}function a(){i.deathSaves.successes>0&&($e(ae,i.deathSaves.successes-=1,i),ae.set(i))}function u(){i.deathSaves.failures<3&&($e(ae,i.deathSaves.failures+=1,i),ae.set(i))}function c(){i.deathSaves.failures>0&&($e(ae,i.deathSaves.failures-=1,i),ae.set(i))}function r(){$e(ae,i.deathSaves.successes=0,i),$e(ae,i.deathSaves.failures=0,i),ae.set(i)}const p=b=>{b<i.deathSaves.successes?a():o()},m=b=>{b<i.deathSaves.failures?c():u()};return t.$$.update=()=>{t.$$.dirty&1&&n(2,l=i.deathSaves.successes>=3),t.$$.dirty&1&&n(1,s=i.deathSaves.failures>=3)},[i,s,l,o,a,u,c,r,p,m]}class um extends Oe{constructor(e){super(),Me(this,e,rm,am,Se,{})}}function Wa(t,e,n){const l=t.slice();return l[13]=e[n],l}function Fa(t,e,n){const l=t.slice();l[13]=e[n];const s=l[6](l[13]);return l[14]=s,l}function qa(t,e,n){const l=t.slice();return l[19]=e[n],l}function Ua(t){let e,n,l;return{c(){e=_("button"),e.textContent="清除全部",d(e,"class","text-xs px-2 py-0.5 bg-red-500 text-white rounded hover:bg-red-600")},m(s,i){E(s,e,i),n||(l=N(e,"click",t[8]),n=!0)},p:j,d(s){s&&k(e),n=!1,l()}}}function Va(t){let e,n,l,s,i;function o(){return t[10](t[19])}return{c(){e=_("button"),n=P(t[19]),l=w(),d(e,"class","w-5 h-5 rounded border text-xs font-bold transition-colors"),d(e,"title",`力竭 ${t[19]} 級`),V(e,"bg-orange-500",t[1].exhaustion>=t[19]),V(e,"text-white",t[1].exhaustion>=t[19]),V(e,"border-orange-500",t[1].exhaustion>=t[19]),V(e,"border-gray-300",t[1].exhaustion<t[19]),V(e,"text-gray-400",t[1].exhaustion<t[19])},m(a,u){E(a,e,u),f(e,n),f(e,l),s||(i=N(e,"click",o),s=!0)},p(a,u){t=a,u&2&&V(e,"bg-orange-500",t[1].exhaustion>=t[19]),u&2&&V(e,"text-white",t[1].exhaustion>=t[19]),u&2&&V(e,"border-orange-500",t[1].exhaustion>=t[19]),u&2&&V(e,"border-gray-300",t[1].exhaustion<t[19]),u&2&&V(e,"text-gray-400",t[1].exhaustion<t[19])},d(a){a&&k(e),s=!1,i()}}}function ja(t){let e;return{c(){e=_("span"),e.textContent="死亡",d(e,"class","text-xs text-red-600 font-bold")},m(n,l){E(n,e,l)},d(n){n&&k(e)}}}function cm(t){let e;return{c(){e=_("div"),e.textContent="無狀態效果",d(e,"class","text-xs text-gray-500 text-center")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function fm(t){let e,n=t[0],l=[];for(let s=0;s<n.length;s+=1)l[s]=za(Wa(t,n,s));return{c(){e=_("div");for(let s=0;s<l.length;s+=1)l[s].c();d(e,"class","flex flex-wrap gap-1")},m(s,i){E(s,e,i);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null)},p(s,i){if(i&49){n=s[0];let o;for(o=0;o<n.length;o+=1){const a=Wa(s,n,o);l[o]?l[o].p(a,i):(l[o]=za(a),l[o].c(),l[o].m(e,null))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}},d(s){s&&k(e),Ee(l,s)}}}function dm(t){let e,n=Gs.filter(Ka),l=[];for(let s=0;s<n.length;s+=1)l[s]=Ya(Fa(t,n,s));return{c(){e=_("div");for(let s=0;s<l.length;s+=1)l[s].c();d(e,"class","grid grid-cols-3 gap-1 text-xs")},m(s,i){E(s,e,i);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null)},p(s,i){if(i&112){n=Gs.filter(Ka);let o;for(o=0;o<n.length;o+=1){const a=Fa(s,n,o);l[o]?l[o].p(a,i):(l[o]=Ya(a),l[o].c(),l[o].m(e,null))}for(;o<l.length;o+=1)l[o].d(1);l.length=n.length}},d(s){s&&k(e),Ee(l,s)}}}function za(t){let e,n=(t[4][t[13]]??t[13])+"",l,s,i,o;function a(){return t[12](t[13])}return{c(){e=_("button"),l=P(n),s=P(` ×
        `),d(e,"class","px-2 py-0.5 rounded bg-red-100 border border-red-400 text-red-800 text-xs hover:bg-red-200"),d(e,"title","點擊移除")},m(u,c){E(u,e,c),f(e,l),f(e,s),i||(o=N(e,"click",a),i=!0)},p(u,c){t=u,c&1&&n!==(n=(t[4][t[13]]??t[13])+"")&&Z(l,n)},d(u){u&&k(e),i=!1,o()}}}function Ya(t){let e,n=(t[4][t[13]]??t[13])+"",l,s,i,o;function a(){return t[11](t[13])}return{c(){e=_("button"),l=P(n),s=w(),d(e,"class","p-1 rounded border transition-colors text-left"),V(e,"bg-red-100",t[14]),V(e,"border-red-400",t[14]),V(e,"text-red-800",t[14]),V(e,"border-gray-200",!t[14]),V(e,"text-gray-600",!t[14]),V(e,"hover:bg-gray-100",!t[14])},m(u,c){E(u,e,c),f(e,l),f(e,s),i||(o=N(e,"click",a),i=!0)},p(u,c){t=u},d(u){u&&k(e),i=!1,o()}}}function pm(t){let e,n,l,s,i,o,a,u=t[2]?"收起":"展開",c,r,p,m,b,g,h,y,v,T,A=t[3]&&Ua(t),B=[1,2,3,4,5,6],O=[];for(let C=0;C<6;C+=1)O[C]=Va(qa(t,B,C));let R=t[1].exhaustion>=6&&ja();function D(C,$){return C[2]?dm:C[3]?fm:cm}let M=D(t),S=M(t);return{c(){e=_("div"),n=_("div"),l=_("h3"),l.textContent="狀態效果",s=w(),i=_("div"),A&&A.c(),o=w(),a=_("button"),c=P(u),r=w(),p=_("div"),m=_("span"),m.textContent="力竭等級:",b=w(),g=_("div");for(let C=0;C<6;C+=1)O[C].c();h=w(),R&&R.c(),y=w(),S.c(),d(l,"class","font-bold text-sm"),d(a,"class","text-xs px-2 py-0.5 bg-gray-300 rounded hover:bg-gray-400"),d(i,"class","flex gap-1"),d(n,"class","flex justify-between items-center mb-2"),d(m,"class","text-xs font-medium text-orange-800"),d(g,"class","flex gap-0.5"),d(p,"class","flex items-center gap-2 mb-2 p-1 bg-orange-50 rounded"),d(e,"class","border rounded p-2 bg-gray-50")},m(C,$){E(C,e,$),f(e,n),f(n,l),f(n,s),f(n,i),A&&A.m(i,null),f(i,o),f(i,a),f(a,c),f(e,r),f(e,p),f(p,m),f(p,b),f(p,g);for(let I=0;I<6;I+=1)O[I]&&O[I].m(g,null);f(p,h),R&&R.m(p,null),f(e,y),S.m(e,null),v||(T=N(a,"click",t[9]),v=!0)},p(C,[$]){if(C[3]?A?A.p(C,$):(A=Ua(C),A.c(),A.m(i,o)):A&&(A.d(1),A=null),$&4&&u!==(u=C[2]?"收起":"展開")&&Z(c,u),$&130){B=[1,2,3,4,5,6];let I;for(I=0;I<6;I+=1){const z=qa(C,B,I);O[I]?O[I].p(z,$):(O[I]=Va(z),O[I].c(),O[I].m(g,null))}for(;I<6;I+=1)O[I].d(1)}C[1].exhaustion>=6?R||(R=ja(),R.c(),R.m(p,null)):R&&(R.d(1),R=null),M===(M=D(C))&&S?S.p(C,$):(S.d(1),S=M(C),S&&(S.c(),S.m(e,null)))},i:j,o:j,d(C){C&&k(e),A&&A.d(),Ee(O,C),R&&R.d(),S.d(),v=!1,T()}}}const Ka=t=>t!=="Exhaustion";function _m(t,e,n){let l,s,i;Re(t,ae,y=>n(1,i=y));const o={Blinded:"目盲",Charmed:"魅惑",Deafened:"耳聾",Frightened:"恐懼",Grappled:"擒抱",Incapacitated:"失能",Invisible:"隱形",Paralyzed:"麻痺",Petrified:"石化",Poisoned:"中毒",Prone:"倒地",Restrained:"束縛",Stunned:"震懾",Unconscious:"昏迷",Exhaustion:"力竭"};function a(y){const v=i.conditions.indexOf(y);v>=0?i.conditions.splice(v,1):i.conditions.push(y),ae.set(i)}function u(y){return i.conditions.includes(y)}function c(y){$e(ae,i.exhaustion=Math.max(0,Math.min(6,y)),i),ae.set(i)}function r(){$e(ae,i.conditions=[],i),$e(ae,i.exhaustion=0,i),ae.set(i)}let p=!1;const m=()=>n(2,p=!p),b=y=>c(i.exhaustion>=y?y-1:y),g=y=>a(y),h=y=>a(y);return t.$$.update=()=>{t.$$.dirty&2&&n(0,l=i.conditions.filter(y=>y!=="Exhaustion")),t.$$.dirty&3&&n(3,s=l.length>0||i.exhaustion>0)},[l,i,p,s,o,a,u,c,r,m,b,g,h]}class mm extends Oe{constructor(e){super(),Me(this,e,_m,pm,Se,{})}}function Xa(t,e,n){const l=t.slice();return l[5]=e[n],l}function Ja(t){let e,n,l=t[5].msg+"",s,i,o,a=t[2].format(t[5].timestamp)+"",u;return{c(){e=_("div"),n=_("span"),s=P(l),i=w(),o=_("span"),u=P(a),d(o,"class","text-gray-400"),d(e,"class","shadow-sm rounded-md border border-gray-200 p-2 flex flex-col md:flex-row justify-between")},m(c,r){E(c,e,r),f(e,n),f(n,s),f(e,i),f(e,o),f(o,u)},p(c,r){r&2&&l!==(l=c[5].msg+"")&&Z(s,l),r&2&&a!==(a=c[2].format(c[5].timestamp)+"")&&Z(u,a)},d(c){c&&k(e)}}}function Za(t){let e,n,l;return{c(){e=_("button"),e.innerHTML=`<i class="material-icons translate-y-1">delete</i>
          清除通知`,d(e,"class","p-2 bg-white")},m(s,i){E(s,e,i),n||(l=N(e,"click",md),n=!0)},p:j,d(s){s&&k(e),n=!1,l()}}}function hm(t){let e,n,l,s=t[1],i=[];for(let a=0;a<s.length;a+=1)i[a]=Ja(Xa(t,s,a));let o=t[1].length&&Za();return{c(){e=_("div"),n=_("div");for(let a=0;a<i.length;a+=1)i[a].c();l=w(),o&&o.c(),d(n,"class","flex flex-col gap-1"),d(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(a,u){E(a,e,u),f(e,n);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(n,null);f(n,l),o&&o.m(n,null)},p(a,u){if(u&6){s=a[1];let c;for(c=0;c<s.length;c+=1){const r=Xa(a,s,c);i[c]?i[c].p(r,u):(i[c]=Ja(r),i[c].c(),i[c].m(n,l))}for(;c<i.length;c+=1)i[c].d(1);i.length=s.length}a[1].length?o?o.p(a,u):(o=Za(),o.c(),o.m(n,null)):o&&(o.d(1),o=null)},d(a){a&&k(e),Ee(i,a),o&&o.d()}}}function gm(t){let e;return{c(){e=_("h1"),e.textContent="通知",d(e,"slot","header")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function bm(t){let e,n,l,s,i,o,a;function u(r){t[4](r)}let c={$$slots:{header:[gm],default:[hm]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),je.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons translate-y-1">history</i>',n=w(),te(l.$$.fragment),d(e,"class","bg-black text-white px-1")},m(r,p){E(r,e,p),E(r,n,p),ne(l,r,p),i=!0,o||(a=N(e,"click",t[3]),o=!0)},p(r,[p]){const m={};p&258&&(m.$$scope={dirty:p,ctx:r}),!s&&p&1&&(s=!0,m.showModal=r[0],Ke(()=>s=!1)),l.$set(m)},i(r){i||(L(l.$$.fragment,r),i=!0)},o(r){G(l.$$.fragment,r),i=!1},d(r){r&&k(e),r&&k(n),le(l,r),o=!1,a()}}}function vm(t,e,n){let l;Re(t,us,u=>n(1,l=u));let s=!1;const i=new Intl.DateTimeFormat("zh-TW",{timeStyle:"medium"}),o=()=>n(0,s=!0);function a(u){s=u,n(0,s)}return[s,l,i,o,a]}class ym extends Oe{constructor(e){super(),Me(this,e,vm,bm,Se,{})}}function Qa(t,e,n){const l=t.slice();return l[25]=e[n],l}function xa(t){let e;return{c(){e=_("div"),e.innerHTML='<i class="material-icons">save</i>...',d(e,"title","save in progress..."),d(e,"class","absolute top-0 left-0 opacity-20 bg-black text-white p-1 rounded-md flex items-center")},m(n,l){E(n,e,l)},d(n){n&&k(e)}}}function er(t){let e,n,l,s,i,o,a,u,c;return{c(){e=_("button"),n=_("i"),n.textContent="undo",s=w(),i=_("button"),o=_("i"),o.textContent="redo",d(n,"class","material-icons translate-y-1 px-1"),e.disabled=l=!t[8],d(e,"class","bg-black text-white rounded-md"),V(e,"opacity-50",!t[8]),d(o,"class","material-icons translate-y-1 px-1"),i.disabled=a=!t[9],d(i,"class","bg-black text-white rounded-md"),V(i,"opacity-50",!t[9])},m(r,p){E(r,e,p),f(e,n),E(r,s,p),E(r,i,p),f(i,o),u||(c=[N(e,"click",t[13]),N(i,"click",t[14])],u=!0)},p(r,p){p&256&&l!==(l=!r[8])&&(e.disabled=l),p&256&&V(e,"opacity-50",!r[8]),p&512&&a!==(a=!r[9])&&(i.disabled=a),p&512&&V(i,"opacity-50",!r[9])},d(r){r&&k(e),r&&k(s),r&&k(i),u=!1,Ve(c)}}}function wm(t){let e,n;return e=new ym({}),{c(){te(e.$$.fragment)},m(l,s){ne(e,l,s),n=!0},i(l){n||(L(e.$$.fragment,l),n=!0)},o(l){G(e.$$.fragment,l),n=!1},d(l){le(e,l)}}}function Tm(t){let e;return{c(){e=_("div"),e.textContent="最高等級",d(e,"class","text-sm text-gray-600")},m(n,l){E(n,e,l)},p:j,d(n){n&&k(e)}}}function Em(t){let e,n,l,s,i,o=t[4].toLocaleString()+"",a,u,c,r,p,m,b;return{c(){e=_("div"),n=_("input"),l=w(),s=_("span"),i=P("/ "),a=P(o),u=w(),c=_("button"),r=P("🆙"),d(n,"id","xp"),d(n,"type","number"),d(n,"inputmode","numeric"),d(n,"min","0"),d(n,"class","w-20 svelte-z687v8"),d(s,"class","text-sm text-gray-600"),d(c,"class","text-2xl"),c.disabled=p=!t[2],d(c,"title","升級"),V(c,"opacity-20",!t[2]),d(e,"class","flex gap-1 items-center")},m(g,h){E(g,e,h),f(e,n),re(n,t[1].xp),f(e,l),f(e,s),f(s,i),f(s,a),f(e,u),f(e,c),f(c,r),m||(b=[N(n,"input",t[18]),N(c,"click",t[19])],m=!0)},p(g,h){h&2&&Ie(n.value)!==g[1].xp&&re(n,g[1].xp),h&16&&o!==(o=g[4].toLocaleString()+"")&&Z(a,o),h&4&&p!==(p=!g[2])&&(c.disabled=p),h&4&&V(c,"opacity-20",!g[2])},d(g){g&&k(e),m=!1,Ve(b)}}}function tr(t){let e,n=fr(t[25])+"",l,s;return{c(){e=_("option"),l=P(n),s=w(),e.__value=t[25],e.value=e.__value},m(i,o){E(i,e,o),f(e,l),f(e,s)},p:j,d(i){i&&k(e)}}}function km(t){let e,n,l,s,i,o,a,u,c,r,p,m,b,g,h,y,v,T,A,B,O,R,D,M,S,C,$,I,z,q,F,ie,fe,me,ue,Y,U,Q,ke,X,ge,Te,x,W,ee,ye,be,de,pe,K,oe,Ce,Le,se,_e,De,H,we,Pe,Ae,nt,lt,Kt,Lt,Tt,Xt,An,Je,Ze,vt,yt,$t,Xe,et,ce,qe,Be,Dt,fs,Et,ds,Bn,ps,bl,_s,nn,vl,ms,It,hs,ln,yl,gs,Pt,bs,sn,wl,vs,Jt,ys,Nt,on,Un,an,ws,Vn,rn,Ts,jn,un,Es,zn,cn,fn,Tl,ks;p=new k_({});let pt=t[6]&&xa(),dt=!t[7]&&er(t);function Ur(J){t[15](J)}let As={};t[0]!==void 0&&(As.files=t[0]),y=new R_({props:As}),je.push(()=>Ye(y,"files",Ur)),A=new V_({});let Ht=ze.isAvailable&&wm();R=new Z_({}),S=new bn({props:{forStat:"STR"}}),I=new bn({props:{forStat:"INT"}}),F=new bn({props:{forStat:"DEX"}}),me=new bn({props:{forStat:"WIS"}}),U=new bn({props:{forStat:"CON"}}),X=new bn({props:{forStat:"CHA"}}),x=new v_({}),ye=new G_({}),pe=new m_({}),Pe=new nm({}),lt=new L_({});function Bs(J,st){return J[3]?Tm:Em}let Yn=Bs(t),kt=Yn(t),dn=Ds,ot=[];for(let J=0;J<dn.length;J+=1)ot[J]=tr(Qa(t,dn,J));return an=new um({}),rn=new mm({}),un=new Mp({}),cn=new u_({}),{c(){e=_("div"),n=_("main"),l=_("div"),s=_("div"),i=_("div"),o=_("div"),a=_("div"),u=_("div"),c=_("h1"),c.textContent="D&D 5E",r=w(),te(p.$$.fragment),m=w(),pt&&pt.c(),b=w(),g=_("div"),dt&&dt.c(),h=w(),te(y.$$.fragment),T=w(),te(A.$$.fragment),B=w(),Ht&&Ht.c(),O=w(),te(R.$$.fragment),D=w(),M=_("div"),te(S.$$.fragment),C=w(),$=_("div"),te(I.$$.fragment),z=w(),q=_("div"),te(F.$$.fragment),ie=w(),fe=_("div"),te(me.$$.fragment),ue=w(),Y=_("div"),te(U.$$.fragment),Q=w(),ke=_("div"),te(X.$$.fragment),ge=w(),Te=_("div"),te(x.$$.fragment),W=w(),ee=_("div"),te(ye.$$.fragment),be=w(),de=_("div"),te(pe.$$.fragment),K=w(),oe=_("div"),Ce=_("div"),Le=_("label"),se=_("h2"),se.textContent="姓名",_e=w(),De=_("input"),H=w(),we=_("div"),te(Pe.$$.fragment),Ae=w(),nt=_("div"),te(lt.$$.fragment),Kt=w(),Lt=_("div"),Tt=_("label"),Xt=_("h2"),Xt.textContent="等級",An=w(),Je=_("input"),Ze=w(),vt=_("div"),yt=_("h2"),yt.textContent="經驗值",$t=w(),Xe=_("label"),et=w(),ce=_("div"),kt.c(),qe=w(),Be=_("div"),Dt=_("h2"),Dt.textContent="稱號",fs=w(),Et=_("input"),ds=w(),Bn=_("div"),ps=P("預設: "),bl=P(t[5]),_s=w(),nn=_("div"),vl=_("h2"),vl.textContent="陣營",ms=w(),It=_("select");for(let J=0;J<ot.length;J+=1)ot[J].c();hs=w(),ln=_("div"),yl=_("h2"),yl.textContent="背景",gs=w(),Pt=_("input"),bs=w(),sn=_("div"),wl=_("h2"),wl.textContent="神祇",vs=w(),Jt=_("input"),ys=w(),Nt=_("div"),on=_("div"),Un=_("div"),te(an.$$.fragment),ws=w(),Vn=_("div"),te(rn.$$.fragment),Ts=w(),jn=_("div"),te(un.$$.fragment),Es=w(),zn=_("div"),te(cn.$$.fragment),d(c,"class",""),d(u,"class","flex items-center gap-1"),d(g,"class","-translate-y-2 flex gap-1"),d(a,"class","flex flex-col items-center"),d(o,"class","flex gap-1 justify-around"),d(i,"class","col-span-full cell svelte-z687v8"),d(M,"class","cell svelte-z687v8"),d($,"class","cell svelte-z687v8"),d(q,"class","cell svelte-z687v8"),d(fe,"class","cell svelte-z687v8"),d(Y,"class","cell svelte-z687v8"),d(ke,"class","cell svelte-z687v8"),d(Te,"class","row-span-2 cell svelte-z687v8"),d(ee,"class","row-span-2 cell svelte-z687v8"),d(de,"class","col-span-full row-span-2 cell svelte-z687v8"),d(s,"class","flex-[2] min-w-[257px] h-[700px] grid grid-rows-8 grid-cols-2 gap-2"),d(De,"type","text"),d(De,"class","svelte-z687v8"),d(Ce,"class","col-span-full cell svelte-z687v8"),d(we,"class","col-span-full cell svelte-z687v8"),d(nt,"class","col-span-full cell svelte-z687v8"),d(Je,"type","number"),d(Je,"inputmode","numeric"),d(Je,"max",pl),d(Je,"min","1"),d(Je,"class","svelte-z687v8"),d(Lt,"class","cell svelte-z687v8"),d(Xe,"for","xp"),d(ce,"class","sheet-stat flex flex-col gap-1"),d(vt,"class","cell svelte-z687v8"),d(Et,"type","text"),d(Et,"placeholder",t[5]),d(Et,"class","svelte-z687v8"),d(Bn,"class","text-xs text-gray-500 mt-1"),d(Be,"class","col-span-full cell svelte-z687v8"),d(It,"class","svelte-z687v8"),t[1].alignment===void 0&&He(()=>t[21].call(It)),d(nn,"class","col-span-full cell svelte-z687v8"),d(Pt,"type","text"),d(Pt,"class","svelte-z687v8"),d(ln,"class","col-span-full cell svelte-z687v8"),d(Jt,"class","svelte-z687v8"),d(sn,"class","col-span-full cell svelte-z687v8"),d(oe,"class","flex-[2] min-w-[257px] h-[700px] grid grid-cols-2 gap-2"),Wt(oe,"grid-template-rows","auto auto auto auto auto auto auto auto auto auto"),d(Un,"class","cell overflow-y-auto svelte-z687v8"),d(Vn,"class","cell overflow-y-auto svelte-z687v8"),d(on,"class","grid grid-cols-2 gap-2"),d(jn,"class","cell svelte-z687v8"),d(zn,"class","cell svelte-z687v8"),d(Nt,"class","flex-[3] min-w-[257px] min-[805px]:h-[700px] grid gap-2"),Wt(Nt,"grid-template-rows","auto 1fr 1fr"),d(l,"id","sheet"),d(l,"class","bg-black min-w-[277px] max-w-[1000px] p-2 flex flex-wrap gap-2"),d(e,"class","flex items-center justify-center bg-black")},m(J,st){E(J,e,st),f(e,n),f(n,l),f(l,s),f(s,i),f(i,o),f(o,a),f(a,u),f(u,c),f(u,r),ne(p,u,null),f(a,m),pt&&pt.m(a,null),f(a,b),f(a,g),dt&&dt.m(g,null),f(g,h),ne(y,g,null),f(g,T),ne(A,g,null),f(g,B),Ht&&Ht.m(g,null),f(g,O),ne(R,g,null),f(s,D),f(s,M),ne(S,M,null),f(s,C),f(s,$),ne(I,$,null),f(s,z),f(s,q),ne(F,q,null),f(s,ie),f(s,fe),ne(me,fe,null),f(s,ue),f(s,Y),ne(U,Y,null),f(s,Q),f(s,ke),ne(X,ke,null),f(s,ge),f(s,Te),ne(x,Te,null),f(s,W),f(s,ee),ne(ye,ee,null),f(s,be),f(s,de),ne(pe,de,null),f(l,K),f(l,oe),f(oe,Ce),f(Ce,Le),f(Le,se),f(Le,_e),f(Le,De),re(De,t[1].name),f(oe,H),f(oe,we),ne(Pe,we,null),f(oe,Ae),f(oe,nt),ne(lt,nt,null),f(oe,Kt),f(oe,Lt),f(Lt,Tt),f(Tt,Xt),f(Tt,An),f(Tt,Je),re(Je,t[1].level),f(oe,Ze),f(oe,vt),f(vt,yt),f(vt,$t),f(vt,Xe),f(vt,et),f(vt,ce),kt.m(ce,null),f(oe,qe),f(oe,Be),f(Be,Dt),f(Be,fs),f(Be,Et),re(Et,t[1].title),f(Be,ds),f(Be,Bn),f(Bn,ps),f(Bn,bl),f(oe,_s),f(oe,nn),f(nn,vl),f(nn,ms),f(nn,It);for(let Zt=0;Zt<ot.length;Zt+=1)ot[Zt]&&ot[Zt].m(It,null);ve(It,t[1].alignment,!0),f(oe,hs),f(oe,ln),f(ln,yl),f(ln,gs),f(ln,Pt),re(Pt,t[1].background),f(oe,bs),f(oe,sn),f(sn,wl),f(sn,vs),f(sn,Jt),re(Jt,t[1].deity),f(l,ys),f(l,Nt),f(Nt,on),f(on,Un),ne(an,Un,null),f(on,ws),f(on,Vn),ne(rn,Vn,null),f(Nt,Ts),f(Nt,jn),ne(un,jn,null),f(Nt,Es),f(Nt,zn),ne(cn,zn,null),fn=!0,Tl||(ks=[N(De,"input",t[16]),N(Je,"input",t[17]),N(Et,"input",t[20]),N(It,"change",t[21]),N(Pt,"input",t[22]),N(Jt,"input",t[23])],Tl=!0)},p(J,[st]){J[6]?pt||(pt=xa(),pt.c(),pt.m(a,b)):pt&&(pt.d(1),pt=null),J[7]?dt&&(dt.d(1),dt=null):dt?dt.p(J,st):(dt=er(J),dt.c(),dt.m(g,h));const Zt={};if(!v&&st&1&&(v=!0,Zt.files=J[0],Ke(()=>v=!1)),y.$set(Zt),st&2&&De.value!==J[1].name&&re(De,J[1].name),st&2&&Ie(Je.value)!==J[1].level&&re(Je,J[1].level),Yn===(Yn=Bs(J))&&kt?kt.p(J,st):(kt.d(1),kt=Yn(J),kt&&(kt.c(),kt.m(ce,null))),(!fn||st&32)&&d(Et,"placeholder",J[5]),st&2&&Et.value!==J[1].title&&re(Et,J[1].title),(!fn||st&32)&&Z(bl,J[5]),st&0){dn=Ds;let bt;for(bt=0;bt<dn.length;bt+=1){const Cs=Qa(J,dn,bt);ot[bt]?ot[bt].p(Cs,st):(ot[bt]=tr(Cs),ot[bt].c(),ot[bt].m(It,null))}for(;bt<ot.length;bt+=1)ot[bt].d(1);ot.length=dn.length}st&2&&ve(It,J[1].alignment),st&2&&Pt.value!==J[1].background&&re(Pt,J[1].background),st&2&&Jt.value!==J[1].deity&&re(Jt,J[1].deity)},i(J){fn||(L(p.$$.fragment,J),L(y.$$.fragment,J),L(A.$$.fragment,J),L(Ht),L(R.$$.fragment,J),L(S.$$.fragment,J),L(I.$$.fragment,J),L(F.$$.fragment,J),L(me.$$.fragment,J),L(U.$$.fragment,J),L(X.$$.fragment,J),L(x.$$.fragment,J),L(ye.$$.fragment,J),L(pe.$$.fragment,J),L(Pe.$$.fragment,J),L(lt.$$.fragment,J),L(an.$$.fragment,J),L(rn.$$.fragment,J),L(un.$$.fragment,J),L(cn.$$.fragment,J),fn=!0)},o(J){G(p.$$.fragment,J),G(y.$$.fragment,J),G(A.$$.fragment,J),G(Ht),G(R.$$.fragment,J),G(S.$$.fragment,J),G(I.$$.fragment,J),G(F.$$.fragment,J),G(me.$$.fragment,J),G(U.$$.fragment,J),G(X.$$.fragment,J),G(x.$$.fragment,J),G(ye.$$.fragment,J),G(pe.$$.fragment,J),G(Pe.$$.fragment,J),G(lt.$$.fragment,J),G(an.$$.fragment,J),G(rn.$$.fragment,J),G(un.$$.fragment,J),G(cn.$$.fragment,J),fn=!1},d(J){J&&k(e),le(p),pt&&pt.d(),dt&&dt.d(),le(y),le(A),Ht&&Ht.d(),le(R),le(S),le(I),le(F),le(me),le(U),le(X),le(x),le(ye),le(pe),le(Pe),le(lt),kt.d(),Ee(ot,J),le(an),le(rn),le(un),le(cn),Tl=!1,Ve(ks)}}}function Am(t,e,n){let l,s,i,o,a,u,c,r,p;Re(t,he,$=>n(1,a=$)),Re(t,Fl,$=>n(6,u=$));const{isGM:m}=Td;Re(t,m,$=>n(7,c=$)),su(()=>{Ed(),ze.isAvailable?Lr():gd()});const{canUndo:b,canRedo:g}=he;Re(t,b,$=>n(8,r=$)),Re(t,g,$=>n(9,p=$));let h;const y=()=>he.undo(),v=()=>he.redo();function T($){h=$,n(0,h)}function A(){a.name=this.value,he.set(a)}function B(){a.level=Ie(this.value),he.set(a)}function O(){a.xp=Ie(this.value),he.set(a)}const R=()=>{Nu(a),he.set(a)};function D(){a.title=this.value,he.set(a)}function M(){a.alignment=Fe(this),he.set(a)}function S(){a.background=this.value,he.set(a)}function C(){a.deity=this.value,he.set(a)}return t.$$.update=()=>{if(t.$$.dirty&1&&h)for(const $ of h){$.text().then(I=>{$e(he,a=h_(I),a)}),n(0,h=void 0);break}t.$$.dirty&2&&ru(a),t.$$.dirty&2&&n(5,l=Mu(a)),t.$$.dirty&2&&n(4,s=mr(a.level)),t.$$.dirty&2&&n(3,i=a.level>=pl),t.$$.dirty&2&&n(2,o=hr(a))},[h,a,o,i,s,l,u,c,r,p,m,b,g,y,v,T,A,B,O,R,D,M,S,C]}class Bm extends Oe{constructor(e){super(),Me(this,e,Am,km,Se,{})}}new Bm({target:document.getElementById("app")});
